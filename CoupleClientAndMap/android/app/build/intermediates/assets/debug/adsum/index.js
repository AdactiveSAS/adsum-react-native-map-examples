/******/ (function(modules) { // webpackBootstrap
/******/ 	// The module cache
/******/ 	var installedModules = {};
/******/
/******/ 	// The require function
/******/ 	function __webpack_require__(moduleId) {
/******/
/******/ 		// Check if module is in cache
/******/ 		if(installedModules[moduleId]) {
/******/ 			return installedModules[moduleId].exports;
/******/ 		}
/******/ 		// Create a new module (and put it into the cache)
/******/ 		var module = installedModules[moduleId] = {
/******/ 			i: moduleId,
/******/ 			l: false,
/******/ 			exports: {}
/******/ 		};
/******/
/******/ 		// Execute the module function
/******/ 		modules[moduleId].call(module.exports, module, module.exports, __webpack_require__);
/******/
/******/ 		// Flag the module as loaded
/******/ 		module.l = true;
/******/
/******/ 		// Return the exports of the module
/******/ 		return module.exports;
/******/ 	}
/******/
/******/
/******/ 	// expose the modules object (__webpack_modules__)
/******/ 	__webpack_require__.m = modules;
/******/
/******/ 	// expose the module cache
/******/ 	__webpack_require__.c = installedModules;
/******/
/******/ 	// define getter function for harmony exports
/******/ 	__webpack_require__.d = function(exports, name, getter) {
/******/ 		if(!__webpack_require__.o(exports, name)) {
/******/ 			Object.defineProperty(exports, name, {
/******/ 				configurable: false,
/******/ 				enumerable: true,
/******/ 				get: getter
/******/ 			});
/******/ 		}
/******/ 	};
/******/
/******/ 	// getDefaultExport function for compatibility with non-harmony modules
/******/ 	__webpack_require__.n = function(module) {
/******/ 		var getter = module && module.__esModule ?
/******/ 			function getDefault() { return module['default']; } :
/******/ 			function getModuleExports() { return module; };
/******/ 		__webpack_require__.d(getter, 'a', getter);
/******/ 		return getter;
/******/ 	};
/******/
/******/ 	// Object.prototype.hasOwnProperty.call
/******/ 	__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };
/******/
/******/ 	// __webpack_public_path__
/******/ 	__webpack_require__.p = "";
/******/
/******/ 	// Load entry module and return exports
/******/ 	return __webpack_require__(__webpack_require__.s = 0);
/******/ })
/************************************************************************/
/******/ ([
/* 0 */
/***/ (function(module, exports, __webpack_require__) {

module.exports = __webpack_require__(1);


/***/ }),
/* 1 */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
Object.defineProperty(__webpack_exports__, "__esModule", { value: true });
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0__adactive_adsum_webview_map_bridge__ = __webpack_require__(2);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0__adactive_adsum_webview_map_bridge___default = __webpack_require__.n(__WEBPACK_IMPORTED_MODULE_0__adactive_adsum_webview_map_bridge__);
/* eslint-disable import/no-extraneous-dependencies */


function start() {
  var errorDiv = document.getElementById('error');
  var loadingDiv = document.getElementById('loading');
  var adsumWebMapProxy;

  try {
    adsumWebMapProxy = new __WEBPACK_IMPORTED_MODULE_0__adactive_adsum_webview_map_bridge__["AdsumWebMapProxy"]({
      addListenerOnMessageFromNative: function addListenerOnMessageFromNative(listener) {
        window.document.addEventListener('message', listener, false);
      }
    });

    adsumWebMapProxy.addEventListener(
      __WEBPACK_IMPORTED_MODULE_0__adactive_adsum_webview_map_bridge__["AdsumWebMapProxyEvents"].init.will,
      function AdsumWebMapProxyEventsWillInit(event) {
        // intercept the options to add the proper container !
        // eslint-disable-next-line no-param-reassign
        event.options.map.engine.container = document.getElementById('adsum-web-map-container');

        loadingDiv.classList.remove('hidden');
      }
    );

    adsumWebMapProxy.addEventListener(
      __WEBPACK_IMPORTED_MODULE_0__adactive_adsum_webview_map_bridge__["AdsumWebMapProxyEvents"].start.did,
      function AdsumWebMapProxyEventsDidStart() { loadingDiv.classList.add('hidden'); }
    );

    adsumWebMapProxy.addEventListener(
      __WEBPACK_IMPORTED_MODULE_0__adactive_adsum_webview_map_bridge__["AdsumWebMapProxyEvents"].init.error,
      function AdsumWebMapProxyEventsErrorInit() { loadingDiv.classList.add('hidden'); errorDiv.classList.remove('hidden'); }
    );

    adsumWebMapProxy.addEventListener(
      __WEBPACK_IMPORTED_MODULE_0__adactive_adsum_webview_map_bridge__["AdsumWebMapProxyEvents"].start.error,
      function AdsumWebMapProxyEventsErrorStart() { loadingDiv.classList.add('hidden'); errorDiv.classList.remove('hidden'); }
    );
  } catch (e) {
    console.error(e);
    loadingDiv.classList.add('hidden');
    errorDiv.classList.remove('hidden');
  }
}

document.addEventListener('DOMContentLoaded', start, false);


/***/ }),
/* 2 */
/***/ (function(module, exports, __webpack_require__) {

!function webpackUniversalModuleDefinition(e,t){ true?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.AdsumWebViewBridge=t():e.AdsumWebViewBridge=t()}("undefined"!=typeof self?self:this,function(){return function(e){var t={};function __webpack_require__(r){if(t[r])return t[r].exports;var n=t[r]={i:r,l:!1,exports:{}};return e[r].call(n.exports,n,n.exports,__webpack_require__),n.l=!0,n.exports}return __webpack_require__.m=e,__webpack_require__.c=t,__webpack_require__.d=function(e,t,r){__webpack_require__.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:r})},__webpack_require__.n=function(e){var t=e&&e.__esModule?function getDefault(){return e.default}:function getModuleExports(){return e};return __webpack_require__.d(t,"a",t),t},__webpack_require__.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},__webpack_require__.p="",__webpack_require__(__webpack_require__.s=142)}([function(e,t,r){var n=r(2),i=r(19),o=r(11),a=r(12),s=r(20),c=function $export(e,t,r){var c,u,l,h,p=e&$export.F,f=e&$export.G,d=e&$export.P,m=e&$export.B,g=f?n:e&$export.S?n[t]||(n[t]={}):(n[t]||{}).prototype,y=f?i:i[t]||(i[t]={}),v=y.prototype||(y.prototype={});for(c in f&&(r=t),r)l=((u=!p&&g&&void 0!==g[c])?g:r)[c],h=m&&u?s(l,n):d&&"function"==typeof l?s(Function.call,l):l,g&&a(g,c,l,e&$export.U),y[c]!=l&&o(y,c,h),d&&v[c]!=l&&(v[c]=l)};n.core=i,c.F=1,c.G=2,c.S=4,c.P=8,c.B=16,c.W=32,c.U=64,c.R=128,e.exports=c},function(e,t,r){var n=r(4);e.exports=function(e){if(!n(e))throw TypeError(e+" is not an object!");return e}},function(e,t){var r=e.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=r)},function(e,t){e.exports=function(e){try{return!!e()}catch(e){return!0}}},function(e,t){var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};e.exports=function(e){return"object"===(void 0===e?"undefined":r(e))?null!==e:"function"==typeof e}},function(e,t,r){var n=r(53)("wks"),i=r(34),o=r(2).Symbol,a="function"==typeof o;(e.exports=function(e){return n[e]||(n[e]=a&&o[e]||(a?o:i)("Symbol."+e))}).store=n},function(e,t,r){e.exports=!r(3)(function(){return 7!=Object.defineProperty({},"a",{get:function get(){return 7}}).a})},function(e,t,r){var n=r(1),i=r(101),o=r(23),a=Object.defineProperty;t.f=r(6)?Object.defineProperty:function defineProperty(e,t,r){if(n(e),t=o(t,!0),n(r),i)try{return a(e,t,r)}catch(e){}if("get"in r||"set"in r)throw TypeError("Accessors not supported!");return"value"in r&&(e[t]=r.value),e}},function(e,t,r){var n=r(25),i=Math.min;e.exports=function(e){return e>0?i(n(e),9007199254740991):0}},function(e,t,r){var n=r(24);e.exports=function(e){return Object(n(e))}},function(e,t){e.exports=function(e){if("function"!=typeof e)throw TypeError(e+" is not a function!");return e}},function(e,t,r){var n=r(7),i=r(33);e.exports=r(6)?function(e,t,r){return n.f(e,t,i(1,r))}:function(e,t,r){return e[t]=r,e}},function(e,t,r){var n=r(2),i=r(11),o=r(14),a=r(34)("src"),s=Function.toString,c=(""+s).split("toString");r(19).inspectSource=function(e){return s.call(e)},(e.exports=function(e,t,r,s){var u="function"==typeof r;u&&(o(r,"name")||i(r,"name",t)),e[t]!==r&&(u&&(o(r,a)||i(r,a,e[t]?""+e[t]:c.join(String(t)))),e===n?e[t]=r:s?e[t]?e[t]=r:i(e,t,r):(delete e[t],i(e,t,r)))})(Function.prototype,"toString",function toString(){return"function"==typeof this&&this[a]||s.call(this)})},function(e,t,r){var n=r(0),i=r(3),o=r(24),a=/"/g,s=function createHTML(e,t,r,n){var i=String(o(e)),s="<"+t;return""!==r&&(s+=" "+r+'="'+String(n).replace(a,"&quot;")+'"'),s+">"+i+"</"+t+">"};e.exports=function(e,t){var r={};r[e]=t(s),n(n.P+n.F*i(function(){var t=""[e]('"');return t!==t.toLowerCase()||t.split('"').length>3}),"String",r)}},function(e,t){var r={}.hasOwnProperty;e.exports=function(e,t){return r.call(e,t)}},function(e,t,r){var n=r(50),i=r(24);e.exports=function(e){return n(i(e))}},function(e,t,r){var n=r(51),i=r(33),o=r(15),a=r(23),s=r(14),c=r(101),u=Object.getOwnPropertyDescriptor;t.f=r(6)?u:function getOwnPropertyDescriptor(e,t){if(e=o(e),t=a(t,!0),c)try{return u(e,t)}catch(e){}if(s(e,t))return i(!n.f.call(e,t),e[t])}},function(e,t,r){var n=r(14),i=r(9),o=r(72)("IE_PROTO"),a=Object.prototype;e.exports=Object.getPrototypeOf||function(e){return e=i(e),n(e,o)?e[o]:"function"==typeof e.constructor&&e instanceof e.constructor?e.constructor.prototype:e instanceof Object?a:null}},function(e,t,r){"use strict";var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},i=r(135),o=r(353),a=Object.prototype.toString;function isArray(e){return"[object Array]"===a.call(e)}function isObject(e){return null!==e&&"object"===(void 0===e?"undefined":n(e))}function isFunction(e){return"[object Function]"===a.call(e)}function forEach(e,t){if(null!==e&&void 0!==e)if("object"!==(void 0===e?"undefined":n(e))&&(e=[e]),isArray(e))for(var r=0,i=e.length;r<i;r++)t.call(null,e[r],r,e);else for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&t.call(null,e[o],o,e)}e.exports={isArray:isArray,isArrayBuffer:function isArrayBuffer(e){return"[object ArrayBuffer]"===a.call(e)},isBuffer:o,isFormData:function isFormData(e){return"undefined"!=typeof FormData&&e instanceof FormData},isArrayBufferView:function isArrayBufferView(e){return"undefined"!=typeof ArrayBuffer&&ArrayBuffer.isView?ArrayBuffer.isView(e):e&&e.buffer&&e.buffer instanceof ArrayBuffer},isString:function isString(e){return"string"==typeof e},isNumber:function isNumber(e){return"number"==typeof e},isObject:isObject,isUndefined:function isUndefined(e){return void 0===e},isDate:function isDate(e){return"[object Date]"===a.call(e)},isFile:function isFile(e){return"[object File]"===a.call(e)},isBlob:function isBlob(e){return"[object Blob]"===a.call(e)},isFunction:isFunction,isStream:function isStream(e){return isObject(e)&&isFunction(e.pipe)},isURLSearchParams:function isURLSearchParams(e){return"undefined"!=typeof URLSearchParams&&e instanceof URLSearchParams},isStandardBrowserEnv:function isStandardBrowserEnv(){return("undefined"==typeof navigator||"ReactNative"!==navigator.product)&&"undefined"!=typeof window&&"undefined"!=typeof document},forEach:forEach,merge:function merge(){var e={};function assignValue(t,r){"object"===n(e[r])&&"object"===(void 0===t?"undefined":n(t))?e[r]=merge(e[r],t):e[r]=t}for(var t=0,r=arguments.length;t<r;t++)forEach(arguments[t],assignValue);return e},extend:function extend(e,t,r){return forEach(t,function assignValue(t,n){e[n]=r&&"function"==typeof t?i(t,r):t}),e},trim:function trim(e){return e.replace(/^\s*/,"").replace(/\s*$/,"")}}},function(e,t){var r=e.exports={version:"2.5.6"};"number"==typeof __e&&(__e=r)},function(e,t,r){var n=r(10);e.exports=function(e,t,r){if(n(e),void 0===t)return e;switch(r){case 1:return function(r){return e.call(t,r)};case 2:return function(r,n){return e.call(t,r,n)};case 3:return function(r,n,i){return e.call(t,r,n,i)}}return function(){return e.apply(t,arguments)}}},function(e,t){var r={}.toString;e.exports=function(e){return r.call(e).slice(8,-1)}},function(e,t,r){"use strict";var n=r(3);e.exports=function(e,t){return!!e&&n(function(){t?e.call(null,function(){},1):e.call(null)})}},function(e,t,r){var n=r(4);e.exports=function(e,t){if(!n(e))return e;var r,i;if(t&&"function"==typeof(r=e.toString)&&!n(i=r.call(e)))return i;if("function"==typeof(r=e.valueOf)&&!n(i=r.call(e)))return i;if(!t&&"function"==typeof(r=e.toString)&&!n(i=r.call(e)))return i;throw TypeError("Can't convert object to primitive value")}},function(e,t){e.exports=function(e){if(void 0==e)throw TypeError("Can't call method on  "+e);return e}},function(e,t){var r=Math.ceil,n=Math.floor;e.exports=function(e){return isNaN(e=+e)?0:(e>0?n:r)(e)}},function(e,t,r){var n=r(0),i=r(19),o=r(3);e.exports=function(e,t){var r=(i.Object||{})[e]||Object[e],a={};a[e]=t(r),n(n.S+n.F*o(function(){r(1)}),"Object",a)}},function(e,t,r){var n=r(20),i=r(50),o=r(9),a=r(8),s=r(89);e.exports=function(e,t){var r=1==e,c=2==e,u=3==e,l=4==e,h=6==e,p=5==e||h,f=t||s;return function(t,s,d){for(var m,g,y=o(t),v=i(y),_=n(s,d,3),b=a(v.length),w=0,x=r?f(t,b):c?f(t,0):void 0;b>w;w++)if((p||w in v)&&(g=_(m=v[w],w,y),e))if(r)x[w]=g;else if(g)switch(e){case 3:return!0;case 5:return m;case 6:return w;case 2:x.push(m)}else if(l)return!1;return h?-1:u||l?l:x}}},function(e,t,r){"use strict";var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};if(r(6)){var i=r(31),o=r(2),a=r(3),s=r(0),c=r(64),u=r(95),l=r(20),h=r(40),p=r(33),f=r(11),d=r(42),m=r(25),g=r(8),y=r(127),v=r(36),_=r(23),b=r(14),w=r(52),x=r(4),M=r(9),S=r(86),C=r(37),P=r(17),E=r(38).f,T=r(88),O=r(34),A=r(5),L=r(27),k=r(54),R=r(61),I=r(91),N=r(46),F=r(58),j=r(39),B=r(90),V=r(117),D=r(7),U=r(16),G=D.f,z=U.f,H=o.RangeError,W=o.TypeError,q=o.Uint8Array,X=Array.prototype,Y=u.ArrayBuffer,J=u.DataView,Z=L(0),K=L(2),Q=L(3),$=L(4),ee=L(5),te=L(6),re=k(!0),ne=k(!1),ie=I.values,oe=I.keys,ae=I.entries,se=X.lastIndexOf,ce=X.reduce,ue=X.reduceRight,le=X.join,he=X.sort,pe=X.slice,fe=X.toString,de=X.toLocaleString,me=A("iterator"),ge=A("toStringTag"),ye=O("typed_constructor"),ve=O("def_constructor"),_e=c.CONSTR,be=c.TYPED,we=c.VIEW,xe=L(1,function(e,t){return Ee(R(e,e[ve]),t)}),Me=a(function(){return 1===new q(new Uint16Array([1]).buffer)[0]}),Se=!!q&&!!q.prototype.set&&a(function(){new q(1).set({})}),Ce=function toOffset(e,t){var r=m(e);if(r<0||r%t)throw H("Wrong offset!");return r},Pe=function validate(e){if(x(e)&&be in e)return e;throw W(e+" is not a typed array!")},Ee=function allocate(e,t){if(!(x(e)&&ye in e))throw W("It is not a typed array constructor!");return new e(t)},Te=function speciesFromList(e,t){return Oe(R(e,e[ve]),t)},Oe=function fromList(e,t){for(var r=0,n=t.length,i=Ee(e,n);n>r;)i[r]=t[r++];return i},Ae=function addGetter(e,t,r){G(e,t,{get:function get(){return this._d[r]}})},Le=function from(e){var t,r,n,i,o,a,s=M(e),c=arguments.length,u=c>1?arguments[1]:void 0,h=void 0!==u,p=T(s);if(void 0!=p&&!S(p)){for(a=p.call(s),n=[],t=0;!(o=a.next()).done;t++)n.push(o.value);s=n}for(h&&c>2&&(u=l(u,arguments[2],2)),t=0,r=g(s.length),i=Ee(this,r);r>t;t++)i[t]=h?u(s[t],t):s[t];return i},ke=function of(){for(var e=0,t=arguments.length,r=Ee(this,t);t>e;)r[e]=arguments[e++];return r},Re=!!q&&a(function(){de.call(new q(1))}),Ie=function toLocaleString(){return de.apply(Re?pe.call(Pe(this)):Pe(this),arguments)},Ne={copyWithin:function copyWithin(e,t){return V.call(Pe(this),e,t,arguments.length>2?arguments[2]:void 0)},every:function every(e){return $(Pe(this),e,arguments.length>1?arguments[1]:void 0)},fill:function fill(e){return B.apply(Pe(this),arguments)},filter:function filter(e){return Te(this,K(Pe(this),e,arguments.length>1?arguments[1]:void 0))},find:function find(e){return ee(Pe(this),e,arguments.length>1?arguments[1]:void 0)},findIndex:function findIndex(e){return te(Pe(this),e,arguments.length>1?arguments[1]:void 0)},forEach:function forEach(e){Z(Pe(this),e,arguments.length>1?arguments[1]:void 0)},indexOf:function indexOf(e){return ne(Pe(this),e,arguments.length>1?arguments[1]:void 0)},includes:function includes(e){return re(Pe(this),e,arguments.length>1?arguments[1]:void 0)},join:function join(e){return le.apply(Pe(this),arguments)},lastIndexOf:function lastIndexOf(e){return se.apply(Pe(this),arguments)},map:function map(e){return xe(Pe(this),e,arguments.length>1?arguments[1]:void 0)},reduce:function reduce(e){return ce.apply(Pe(this),arguments)},reduceRight:function reduceRight(e){return ue.apply(Pe(this),arguments)},reverse:function reverse(){for(var e,t=Pe(this).length,r=Math.floor(t/2),n=0;n<r;)e=this[n],this[n++]=this[--t],this[t]=e;return this},some:function some(e){return Q(Pe(this),e,arguments.length>1?arguments[1]:void 0)},sort:function sort(e){return he.call(Pe(this),e)},subarray:function subarray(e,t){var r=Pe(this),n=r.length,i=v(e,n);return new(R(r,r[ve]))(r.buffer,r.byteOffset+i*r.BYTES_PER_ELEMENT,g((void 0===t?n:v(t,n))-i))}},Fe=function slice(e,t){return Te(this,pe.call(Pe(this),e,t))},je=function set(e){Pe(this);var t=Ce(arguments[1],1),r=this.length,n=M(e),i=g(n.length),o=0;if(i+t>r)throw H("Wrong length!");for(;o<i;)this[t+o]=n[o++]},Be={entries:function entries(){return ae.call(Pe(this))},keys:function keys(){return oe.call(Pe(this))},values:function values(){return ie.call(Pe(this))}},Ve=function isTAIndex(e,t){return x(e)&&e[be]&&"symbol"!=(void 0===t?"undefined":n(t))&&t in e&&String(+t)==String(t)},De=function getOwnPropertyDescriptor(e,t){return Ve(e,t=_(t,!0))?p(2,e[t]):z(e,t)},Ue=function defineProperty(e,t,r){return!(Ve(e,t=_(t,!0))&&x(r)&&b(r,"value"))||b(r,"get")||b(r,"set")||r.configurable||b(r,"writable")&&!r.writable||b(r,"enumerable")&&!r.enumerable?G(e,t,r):(e[t]=r.value,e)};_e||(U.f=De,D.f=Ue),s(s.S+s.F*!_e,"Object",{getOwnPropertyDescriptor:De,defineProperty:Ue}),a(function(){fe.call({})})&&(fe=de=function toString(){return le.call(this)});var Ge=d({},Ne);d(Ge,Be),f(Ge,me,Be.values),d(Ge,{slice:Fe,set:je,constructor:function constructor(){},toString:fe,toLocaleString:Ie}),Ae(Ge,"buffer","b"),Ae(Ge,"byteOffset","o"),Ae(Ge,"byteLength","l"),Ae(Ge,"length","e"),G(Ge,ge,{get:function get(){return this[be]}}),e.exports=function(e,t,r,n){var u=e+((n=!!n)?"Clamped":"")+"Array",l="get"+e,p="set"+e,d=o[u],m=d||{},v=d&&P(d),_=!d||!c.ABV,b={},M=d&&d.prototype,S=function addElement(e,r){G(e,r,{get:function get(){return function getter(e,r){var n=e._d;return n.v[l](r*t+n.o,Me)}(this,r)},set:function set(e){return function setter(e,r,i){var o=e._d;n&&(i=(i=Math.round(i))<0?0:i>255?255:255&i),o.v[p](r*t+o.o,i,Me)}(this,r,e)},enumerable:!0})};_?(d=r(function(e,r,n,i){h(e,d,u,"_d");var o,a,s,c,l=0,p=0;if(x(r)){if(!(r instanceof Y||"ArrayBuffer"==(c=w(r))||"SharedArrayBuffer"==c))return be in r?Oe(d,r):Le.call(d,r);o=r,p=Ce(n,t);var m=r.byteLength;if(void 0===i){if(m%t)throw H("Wrong length!");if((a=m-p)<0)throw H("Wrong length!")}else if((a=g(i)*t)+p>m)throw H("Wrong length!");s=a/t}else s=y(r),o=new Y(a=s*t);for(f(e,"_d",{b:o,o:p,l:a,e:s,v:new J(o)});l<s;)S(e,l++)}),M=d.prototype=C(Ge),f(M,"constructor",d)):a(function(){d(1)})&&a(function(){new d(-1)})&&F(function(e){new d,new d(null),new d(1.5),new d(e)},!0)||(d=r(function(e,r,n,i){var o;return h(e,d,u),x(r)?r instanceof Y||"ArrayBuffer"==(o=w(r))||"SharedArrayBuffer"==o?void 0!==i?new m(r,Ce(n,t),i):void 0!==n?new m(r,Ce(n,t)):new m(r):be in r?Oe(d,r):Le.call(d,r):new m(y(r))}),Z(v!==Function.prototype?E(m).concat(E(v)):E(m),function(e){e in d||f(d,e,m[e])}),d.prototype=M,i||(M.constructor=d));var T=M[me],O=!!T&&("values"==T.name||void 0==T.name),A=Be.values;f(d,ye,!0),f(M,be,u),f(M,we,!0),f(M,ve,d),(n?new d(1)[ge]==u:ge in M)||G(M,ge,{get:function get(){return u}}),b[u]=d,s(s.G+s.W+s.F*(d!=m),b),s(s.S,u,{BYTES_PER_ELEMENT:t}),s(s.S+s.F*a(function(){m.of.call(d,1)}),u,{from:Le,of:ke}),"BYTES_PER_ELEMENT"in M||f(M,"BYTES_PER_ELEMENT",t),s(s.P,u,Ne),j(u),s(s.P+s.F*Se,u,{set:je}),s(s.P+s.F*!O,u,Be),i||M.toString==fe||(M.toString=fe),s(s.P+s.F*a(function(){new d(1).slice()}),u,{slice:Fe}),s(s.P+s.F*(a(function(){return[1,2].toLocaleString()!=new d([1,2]).toLocaleString()})||!a(function(){M.toLocaleString.call([1,2])})),u,{toLocaleString:Ie}),N[u]=O?T:A,i||O||f(M,me,A)}}else e.exports=function(){}},function(e,t,r){var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},i=r(122),o=r(0),a=r(53)("metadata"),s=a.store||(a.store=new(r(125))),c=function getOrCreateMetadataMap(e,t,r){var n=s.get(e);if(!n){if(!r)return;s.set(e,n=new i)}var o=n.get(t);if(!o){if(!r)return;n.set(t,o=new i)}return o};e.exports={store:s,map:c,has:function ordinaryHasOwnMetadata(e,t,r){var n=c(t,r,!1);return void 0!==n&&n.has(e)},get:function ordinaryGetOwnMetadata(e,t,r){var n=c(t,r,!1);return void 0===n?void 0:n.get(e)},set:function ordinaryDefineOwnMetadata(e,t,r,n){c(r,n,!0).set(e,t)},keys:function ordinaryOwnMetadataKeys(e,t){var r=c(e,t,!1),n=[];return r&&r.forEach(function(e,t){n.push(t)}),n},key:function toMetaKey(e){return void 0===e||"symbol"==(void 0===e?"undefined":n(e))?e:String(e)},exp:function exp(e){o(o.S,"Reflect",e)}}},function(e,t,r){var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},i=r(34)("meta"),o=r(4),a=r(14),s=r(7).f,c=0,u=Object.isExtensible||function(){return!0},l=!r(3)(function(){return u(Object.preventExtensions({}))}),h=function setMeta(e){s(e,i,{value:{i:"O"+ ++c,w:{}}})},p=e.exports={KEY:i,NEED:!1,fastKey:function fastKey(e,t){if(!o(e))return"symbol"==(void 0===e?"undefined":n(e))?e:("string"==typeof e?"S":"P")+e;if(!a(e,i)){if(!u(e))return"F";if(!t)return"E";h(e)}return e[i].i},getWeak:function getWeak(e,t){if(!a(e,i)){if(!u(e))return!0;if(!t)return!1;h(e)}return e[i].w},onFreeze:function onFreeze(e){return l&&p.NEED&&u(e)&&!a(e,i)&&h(e),e}}},function(e,t){e.exports=!1},function(e,t,r){var n=r(5)("unscopables"),i=Array.prototype;void 0==i[n]&&r(11)(i,n,{}),e.exports=function(e){i[n][e]=!0}},function(e,t){e.exports=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}}},function(e,t){var r=0,n=Math.random();e.exports=function(e){return"Symbol(".concat(void 0===e?"":e,")_",(++r+n).toString(36))}},function(e,t,r){var n=r(103),i=r(73);e.exports=Object.keys||function keys(e){return n(e,i)}},function(e,t,r){var n=r(25),i=Math.max,o=Math.min;e.exports=function(e,t){return(e=n(e))<0?i(e+t,0):o(e,t)}},function(e,t,r){var n=r(1),i=r(104),o=r(73),a=r(72)("IE_PROTO"),s=function Empty(){},c=function createDict(){var e,t=r(70)("iframe"),n=o.length;for(t.style.display="none",r(74).appendChild(t),t.src="javascript:",(e=t.contentWindow.document).open(),e.write("<script>document.F=Object<\/script>"),e.close(),c=e.F;n--;)delete c.prototype[o[n]];return c()};e.exports=Object.create||function create(e,t){var r;return null!==e?(s.prototype=n(e),r=new s,s.prototype=null,r[a]=e):r=c(),void 0===t?r:i(r,t)}},function(e,t,r){var n=r(103),i=r(73).concat("length","prototype");t.f=Object.getOwnPropertyNames||function getOwnPropertyNames(e){return n(e,i)}},function(e,t,r){"use strict";var n=r(2),i=r(7),o=r(6),a=r(5)("species");e.exports=function(e){var t=n[e];o&&t&&!t[a]&&i.f(t,a,{configurable:!0,get:function get(){return this}})}},function(e,t){e.exports=function(e,t,r,n){if(!(e instanceof t)||void 0!==n&&n in e)throw TypeError(r+": incorrect invocation!");return e}},function(e,t,r){var n=r(20),i=r(115),o=r(86),a=r(1),s=r(8),c=r(88),u={},l={};(t=e.exports=function(e,t,r,h,p){var f,d,m,g,y=p?function(){return e}:c(e),v=n(r,h,t?2:1),_=0;if("function"!=typeof y)throw TypeError(e+" is not iterable!");if(o(y)){for(f=s(e.length);f>_;_++)if((g=t?v(a(d=e[_])[0],d[1]):v(e[_]))===u||g===l)return g}else for(m=y.call(e);!(d=m.next()).done;)if((g=i(m,v,d.value,t))===u||g===l)return g}).BREAK=u,t.RETURN=l},function(e,t,r){var n=r(12);e.exports=function(e,t,r){for(var i in t)n(e,i,t[i],r);return e}},function(e,t,r){"use strict";r.d(t,"c",function(){return ht}),r.d(t,"e",function(){return lt}),r.d(t,"b",function(){return Rt}),r.d(t,"d",function(){return ze}),r.d(t,"a",function(){return b}),r.d(t,"g",function(){return O}),r.d(t,"h",function(){return rt}),r.d(t,"f",function(){return It});var n=r(373),i=r(374),o=(r.n(i),r(68)),a=r(375),c=(r.n(a),r(96)),u=r(376),l=function(){return function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function sliceIterator(e,t){var r=[],n=!0,i=!1,o=void 0;try{for(var a,s=e[Symbol.iterator]();!(n=(a=s.next()).done)&&(r.push(a.value),!t||r.length!==t);n=!0);}catch(e){i=!0,o=e}finally{try{!n&&s.return&&s.return()}finally{if(i)throw o}}return r}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),h=function get(e,t,r){null===e&&(e=Function.prototype);var n=Object.getOwnPropertyDescriptor(e,t);if(void 0===n){var i=Object.getPrototypeOf(e);return null===i?void 0:get(i,t,r)}if("value"in n)return n.value;var o=n.get;return void 0!==o?o.call(r):void 0},p="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},f=function(){function defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(e,t,r){return t&&defineProperties(e.prototype,t),r&&defineProperties(e,r),e}}();function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var d="none",m="visible",g="transparent",y=new n.W,_=function(e){function VisibleBox3(){return _classCallCheck(this,VisibleBox3),_possibleConstructorReturn(this,(VisibleBox3.__proto__||Object.getPrototypeOf(VisibleBox3)).apply(this,arguments))}return _inherits(VisibleBox3,n["b"]),f(VisibleBox3,[{key:"setFromObject",value:function setFromObject(e){var t=this;return this.makeEmpty(),e.updateMatrixWorld(!0),e.traverseVisible(function(e){var r=e.geometry;if(void 0!==r)if(r.isGeometry)for(var n=r.vertices,i=0,o=n.length;i<o;i++)y.copy(n[i]),y.applyMatrix4(e.matrixWorld),t.expandByPoint(y);else if(r.isBufferGeometry){var a=r.attributes.position;if(void 0!==a)for(var s=0,c=a.count;s<c;s++)y.fromBufferAttribute(a,s).applyMatrix4(e.matrixWorld),t.expandByPoint(y)}}),this}}]),VisibleBox3}(),b={AdsumObject3D:"AdsumObject3D",BuildingObject:"BuildingObject",FloorObject:"FloorObject",LabelImageObject:"LabelImageObject",LabelObject:"LabelObject",LabelTextObject:"LabelTextObject",SiteObject:"SiteObject",SpaceObject:"SpaceObject",PathSectionObject:"PathSectionObject",UserObject:"UserObject"},w=new _,M=function(){function AdsumObject3D(){_classCallCheck(this,AdsumObject3D),this.id=null,this.isAdsumObject=!0,this._mesh=null,this._levelOfDetails=null,this.placeId=null}return f(AdsumObject3D,null,[{key:"_createFromMesh",value:function _createFromMesh(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Symbol("AdsumObjectId"),n=new this;return n.id=r,n._setMesh(e),t.levelOfDetails&&(n._levelOfDetails=t.levelOfDetails),t.placeId&&null!==t.placeId?n.placeId=t.placeId:n.placeId=Symbol("AdsumMapPlaceId"),n._mesh.onBeforeRender=n._onBeforeRender.bind(n),n}}]),f(AdsumObject3D,[{key:"getType",value:function getType(){return b.AdsumObject3D}},{key:"_setMesh",value:function _setMesh(e){return null!==this._mesh&&(this._mesh.adsumObject=null),this._mesh=e,this._mesh.adsumObject=this,this}},{key:"setDisplayMode",value:function setDisplayMode(e){switch(e){case d:this._mesh.visible=!1;break;case m:this._mesh.visible=!0,void 0!==this._mesh.material&&(this._mesh.material.visible=!0);break;case g:if(this._mesh.visible=!0,void 0===this._mesh.material)throw new Error("AdsumWebMap.AdsumObject3D: DisplayMode transparent is not supported with the current object");this._mesh.material.visible=!1;break;default:throw new Error("Unexpected")}}},{key:"getDisplayMode",value:function getDisplayMode(){return this._mesh.visible&&void 0!==this._mesh.material?this._mesh.material.visible?m:g:d}},{key:"moveTo",value:function moveTo(e,t,r){this._mesh.position.x=e,this._mesh.position.y=t,this._mesh.position.z=r}},{key:"moveBy",value:function moveBy(e,t,r){this._mesh.position.x+=e,this._mesh.position.y+=t,this._mesh.position.z+=r}},{key:"getSizeAndCenter",value:function getSizeAndCenter(){var e=this;if(!(arguments.length>0&&void 0!==arguments[0])||arguments[0])w.setFromObject(this._mesh);else{w.makeEmpty();var t=this._mesh.geometry.vertices,r=new n.W;t.forEach(function(t){r.copy(t),r.applyMatrix4(e._mesh.matrixWorld),w.expandByPoint(r)})}var i=new n.W,o=new n.W;return w.getCenter(i),w.getSize(o),{size:o,center:i}}},{key:"rotateZ",value:function rotateZ(e){this._mesh.rotateZ(e)}},{key:"update",value:function update(){this._mesh.matrixAutoUpdate||this._mesh.updateMatrix(),this._mesh.updateMatrixWorld()}},{key:"_applyLod",value:function _applyLod(e){null!==this._levelOfDetails&&this._levelOfDetails.applyLod(this,e)}},{key:"_onBeforeRender",value:function _onBeforeRender(e,t,r,n,i,o){}},{key:"_raycast",value:function _raycast(e,t){!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(!1===this._mesh.visible)return!1;if(void 0===this._mesh.material||this._mesh.material.visible){var r=[];if(this._mesh.raycast(e,r),1===r.length){var n=r[0];t.push({object:this,distance:n.distance,position:this._mesh.worldToLocal(n.point)})}}return!0}},{key:"_addChild",value:function _addChild(e){this._mesh.add(e._mesh)}},{key:"_dispose",value:function _dispose(){var e=function e(t){t.geometry&&t.geometry.dispose&&t.geometry.dispose(),t.material&&(Object.keys(t.material).forEach(function(e){var r=t.material[e];null!==r&&"object"===r&&r.dispose&&r.dispose()}),t.material.dispose&&t.material.dispose())};this._mesh.traverse(e),e(this._mesh),null!==this._mesh.parent&&this._mesh.parent.remove(this._mesh)}}]),AdsumObject3D}(),E=function(e){function UserObject(){var e;return _classCallCheck(this,UserObject),(e=_possibleConstructorReturn(this,(UserObject.__proto__||Object.getPrototypeOf(UserObject)).call(this))).isUser=!0,e.parent=null,e}return _inherits(UserObject,M),f(UserObject,null,[{key:"createDefault",value:function createDefault(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Symbol("AdsumObjectId"),i=new n.N(e/2,e/2-e/8,32);i.merge(new n.d(e/8,16));var o=new n.x({color:769978,side:n.h});o.transparent=!0;var a=new n.w(i,o);return this._createFromMesh(a,t,r)}}]),f(UserObject,[{key:"getType",value:function getType(){return b.UserObject}}]),UserObject}(),T=function(){function ObjectManager(){_classCallCheck(this,ObjectManager),this.site=null,this.buildings=new Map,this.floors=new Map,this.spaces=new Map,this.labels=new Map,this.user=null,this.pathSectionObjects=new Map}return f(ObjectManager,[{key:"init",value:function init(e,t){this.site=e.site,this.buildings=e.buildingsMap,this.floors=e.floorsMap,this.spaces=e.spacesMap,this.labels=e.labelsMap,this.user=E.createDefault(t.meterToAdsumDistance(3),{placeId:Symbol("UserPlace")},Symbol("UserPositionId"))}},{key:"getFloor",value:function getFloor(e){return this.floors.has(e)?this.floors.get(e):null}},{key:"getBuilding",value:function getBuilding(e){return this.buildings.has(e)?this.buildings.get(e):null}},{key:"getSpace",value:function getSpace(e){return this.spaces.has(e)?this.spaces.get(e):null}},{key:"getLabel",value:function getLabel(e){return this.labels.has(e)?this.labels.get(e):null}}]),ObjectManager}(),O={floor:{didChanged:"scene.floor.didChanged"}},ke=function(e){function SceneManager(e){var t;return _classCallCheck(this,SceneManager),(t=_possibleConstructorReturn(this,(SceneManager.__proto__||Object.getPrototypeOf(SceneManager)).call(this))).awm=e,t.scene=null,t.currentFloor=null,t}return _inherits(SceneManager,n["i"]),f(SceneManager,[{key:"init",value:function init(e){this.scene=e.scene,e.site.setDisplayMode(m),e.buildingsMap.forEach(function(e){e.setDisplayMode(m)}),e.floorsMap.forEach(function(e){e.setDisplayMode(d)}),this.currentFloor=null}},{key:"getCurrentFloor",value:function getCurrentFloor(){return this.currentFloor}},{key:"setCurrentFloor",value:function setCurrentFloor(e){var t=this,r=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return e===this.currentFloor?Promise.resolve():new Promise(function(n,i){try{r&&console.warn("AdsumWebMap.SceneManager.setCurrentFloor: animated parameter is not supported yet"),null===t.currentFloor?(t.awm.objectManager.site.setDisplayMode(g),t.awm.objectManager.buildings.forEach(function(e){e.setDisplayMode(g)})):t.currentFloor.setDisplayMode(d),null===e?(t.awm.objectManager.site.setDisplayMode(m),t.awm.objectManager.buildings.forEach(function(e){e.setDisplayMode(m)})):e.setDisplayMode(m);var o=t.currentFloor;t.currentFloor=e,t.dispatchEvent({type:O.floor.didChanged,previous:o,current:e}),n()}catch(e){i(e)}})}}]),SceneManager}(),Re=function(){function EngineManager(e,t){_classCallCheck(this,EngineManager),this.awm=e,this.options=t,this.container=t.container,this.canvas=document.createElementNS("http://www.w3.org/1999/xhtml","canvas"),this.renderer=new n.Z({antialias:!0,alpha:!0,powerPreference:t.gpuPower,canvas:this.canvas,logarithmicDepthBuffer:!0}),this.renderer.capabilities.logarithmicDepthBuffer=null!==this.renderer.extensions.get("EXT_frag_depth"),this.container.appendChild(this.canvas),this.options.shadowEnabled&&(this.renderer.shadowMap.type=n.E,this.renderer.shadowMap.enabled=!0,this.renderer.shadowMap.autoUpdate=!1,this.renderer.shadowMap.needsUpdate=!0),this.renderer.setClearColor(this.options.clearColor),this._animationFrameId=null,this._animationFrameIdTween=null}return f(EngineManager,[{key:"init",value:function init(){this.options.autoCompileMaterials&&this.compileMaterials(),this._resizeCanvas()}},{key:"compileMaterials",value:function compileMaterials(){var e=this,t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.renderer.compile(this.awm.sceneManager.scene,this.awm.cameraManager.camera),t&&this.renderer.domElement.addEventListener("webglcontextrestored",function(){e.compileMaterials(!1)},!1)}},{key:"start",value:function start(){this._resizeCanvas(),this._animationFrameId=requestAnimationFrame(this.start.bind(this)),Object(i.update)(),this.awm.cameraManager.control.update(),this._updateLevelOfDetails(this.awm.cameraManager.camera),this.renderer.render(this.awm.sceneManager.scene,this.awm.cameraManager.camera)}},{key:"_updateLevelOfDetails",value:function _updateLevelOfDetails(e){var t=this,r=this.awm.objectManager.site;r._applyLod(e),r.getDisplayMode()!==d&&(r.buildings.forEach(function(r){return t._updateLevelOfDetailsOnBuilding(r,e)}),r.spaces.forEach(function(r){return t._updateLevelOfDetailsOnSpace(r,e)}),r.labels.forEach(function(t){return t._applyLod(e)}))}},{key:"_updateLevelOfDetailsOnBuilding",value:function _updateLevelOfDetailsOnBuilding(e,t){var r=this;e._applyLod(t),e.getDisplayMode()!==d&&(e.floors.forEach(function(e){return r._updateLevelOfDetailsOnFloor(e,t)}),e.labels.forEach(function(e){return e._applyLod(t)}))}},{key:"_updateLevelOfDetailsOnFloor",value:function _updateLevelOfDetailsOnFloor(e,t){var r=this;e._applyLod(t),e.getDisplayMode()!==d&&(e.spaces.forEach(function(e){return r._updateLevelOfDetailsOnSpace(e,t)}),e.labels.forEach(function(e){return e._applyLod(t)}))}},{key:"_updateLevelOfDetailsOnSpace",value:function _updateLevelOfDetailsOnSpace(e,t){e._applyLod(t),e.getDisplayMode()!==d&&e.labels.forEach(function(e){return e._applyLod(t)})}},{key:"_getDevicePixelRatio",value:function _getDevicePixelRatio(){return window.devicePixelRatio||1}},{key:"_resizeCanvas",value:function _resizeCanvas(){var e=this.renderer.getSize(),t=e.width,r=e.height,n=t!==this.container.clientWidth||r!==this.container.clientHeight,i=this.renderer.getPixelRatio()!==this._getDevicePixelRatio();if((n||i)&&(n&&this.renderer.setSize(this.container.clientWidth,this.container.clientHeight),i&&this.renderer.setPixelRatio(this._getDevicePixelRatio()),n)){var o=this.awm.cameraManager,a=o.camera,s=o.control;a.aspect=this.container.clientWidth/this.container.clientHeight,a.updateProjectionMatrix(),s.update()}}}]),EngineManager}(),Ie={Vector3:n.W,MOUSE:n.t,Quaternion:n.J,Spherical:n.R,EventDispatcher:n.i,Vector2:n.V,OrbitControls:function(e,t){var r,n,i,o,a;this.object=e,this.domElement=void 0!==t?t:document,this.enabled=!0,this.target=new Ie.Vector3,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.25,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.panningMode=Ie.ScreenSpacePanning,this.keyPanSpeed=7,this.autoRotate=!1,this.autoRotateSpeed=2,this.enableKeys=!0,this.keys={LEFT:37,UP:38,RIGHT:39,BOTTOM:40},this.mouseButtons={ORBIT:Ie.MOUSE.LEFT,ZOOM:Ie.MOUSE.MIDDLE,PAN:Ie.MOUSE.RIGHT},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this.getPolarAngle=function(){return d.phi},this.getAzimuthalAngle=function(){return d.theta},this.saveState=function(){s.target0.copy(s.target),s.position0.copy(s.object.position),s.zoom0=s.object.zoom},this.reset=function(){s.target.copy(s.target0),s.object.position.copy(s.position0),s.object.zoom=s.zoom0,s.object.updateProjectionMatrix(),s.dispatchEvent(c),s.update(),p=h.NONE},this.update=(r=new Ie.Vector3,n=(new Ie.Quaternion).setFromUnitVectors(e.up,new Ie.Vector3(0,1,0)),i=n.clone().inverse(),o=new Ie.Vector3,a=new Ie.Quaternion,function(){var e=s.object.position;return r.copy(e).sub(s.target),r.applyQuaternion(n),d.setFromVector3(r),s.autoRotate&&p===h.NONE&&N(2*Math.PI/60/60*s.autoRotateSpeed),d.theta+=m.theta,d.phi+=m.phi,d.theta=Math.max(s.minAzimuthAngle,Math.min(s.maxAzimuthAngle,d.theta)),d.phi=Math.max(s.minPolarAngle,Math.min(s.maxPolarAngle,d.phi)),d.makeSafe(),d.radius*=g,d.radius=Math.max(s.minDistance,Math.min(s.maxDistance,d.radius)),s.target.add(y),r.setFromSpherical(d),r.applyQuaternion(i),e.copy(s.target).add(r),s.object.lookAt(s.target),!0===s.enableDamping?(m.theta*=1-s.dampingFactor,m.phi*=1-s.dampingFactor,y.multiplyScalar(1-s.dampingFactor)):(m.set(0,0,0),y.set(0,0,0)),g=1,!!(v||o.distanceToSquared(s.object.position)>f||8*(1-a.dot(s.object.quaternion))>f)&&(s.dispatchEvent(c),o.copy(s.object.position),a.copy(s.object.quaternion),v=!1,!0)}),this.dispose=function(){s.domElement.removeEventListener("contextmenu",G,!1),s.domElement.removeEventListener("mousedown",D,!1),s.domElement.removeEventListener("wheel",F,!1),s.domElement.removeEventListener("touchstart",$,!1),s.domElement.removeEventListener("touchend",V,!1),s.domElement.removeEventListener("touchmove",z,!1),document.removeEventListener("mousemove",B,!1),document.removeEventListener("mouseup",H,!1),window.removeEventListener("keydown",U,!1)};var s=this,c={type:"change"},u={type:"start"},l={type:"end"},h={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_DOLLY:4,TOUCH_PAN:5},p=h.NONE,f=1e-6,d=new Ie.Spherical,m=new Ie.Spherical,g=1,y=new Ie.Vector3,v=!1,_=new Ie.Vector2,b=new Ie.Vector2,w=new Ie.Vector2,x=new Ie.Vector2,M=new Ie.Vector2,C=new Ie.Vector2,P=new Ie.Vector2,E=new Ie.Vector2,T=new Ie.Vector2;function S(){return Math.pow(.95,s.zoomSpeed)}function N(e){m.theta-=e}function L(e){m.phi-=e}var O,A=(O=new Ie.Vector3,function(e,t){O.setFromMatrixColumn(t,0),O.multiplyScalar(-e),y.add(O)}),R=function(){var e=new Ie.Vector3;return function(t,r){switch(s.panningMode){case Ie.ScreenSpacePanning:e.setFromMatrixColumn(r,1);break;case Ie.HorizontalPanning:e.setFromMatrixColumn(r,0),e.crossVectors(s.object.up,e)}e.multiplyScalar(t),y.add(e)}}(),j=function(){var e=new Ie.Vector3;return function(t,r){var n=s.domElement===document?s.domElement.body:s.domElement;if(s.object.isPerspectiveCamera){var i=s.object.position;e.copy(i).sub(s.target);var o=e.length();o*=Math.tan(s.object.fov/2*Math.PI/180),A(2*t*o/n.clientHeight,s.object.matrix),R(2*r*o/n.clientHeight,s.object.matrix)}else s.object.isOrthographicCamera?(A(t*(s.object.right-s.object.left)/s.object.zoom/n.clientWidth,s.object.matrix),R(r*(s.object.top-s.object.bottom)/s.object.zoom/n.clientHeight,s.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),s.enablePan=!1)}}();function k(e){s.object.isPerspectiveCamera?g/=e:s.object.isOrthographicCamera?(s.object.zoom=Math.max(s.minZoom,Math.min(s.maxZoom,s.object.zoom*e)),s.object.updateProjectionMatrix(),v=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),s.enableZoom=!1)}function I(e){s.object.isPerspectiveCamera?g*=e:s.object.isOrthographicCamera?(s.object.zoom=Math.max(s.minZoom,Math.min(s.maxZoom,s.object.zoom/e)),s.object.updateProjectionMatrix(),v=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),s.enableZoom=!1)}function D(e){if(!1!==s.enabled){switch(e.preventDefault(),e.button){case s.mouseButtons.ORBIT:if(!1===s.enableRotate)return;!function(e){_.set(e.clientX,e.clientY)}(e),p=h.ROTATE;break;case s.mouseButtons.ZOOM:if(!1===s.enableZoom)return;!function(e){P.set(e.clientX,e.clientY)}(e),p=h.DOLLY;break;case s.mouseButtons.PAN:if(!1===s.enablePan)return;!function(e){x.set(e.clientX,e.clientY)}(e),p=h.PAN}p!==h.NONE&&(document.addEventListener("mousemove",B,!1),document.addEventListener("mouseup",H,!1),s.dispatchEvent(u))}}function B(e){if(!1!==s.enabled)switch(e.preventDefault(),p){case h.ROTATE:if(!1===s.enableRotate)return;!function(e){b.set(e.clientX,e.clientY),w.subVectors(b,_).multiplyScalar(s.rotateSpeed);var t=s.domElement===document?s.domElement.body:s.domElement;N(2*Math.PI*w.x/t.clientWidth),L(2*Math.PI*w.y/t.clientHeight),_.copy(b),s.update()}(e);break;case h.DOLLY:if(!1===s.enableZoom)return;!function(e){E.set(e.clientX,e.clientY),T.subVectors(E,P),T.y>0?k(S()):T.y<0&&I(S()),P.copy(E),s.update()}(e);break;case h.PAN:if(!1===s.enablePan)return;!function(e){M.set(e.clientX,e.clientY),C.subVectors(M,x).multiplyScalar(s.panSpeed),j(C.x,C.y),x.copy(M),s.update()}(e)}}function H(e){!1!==s.enabled&&(document.removeEventListener("mousemove",B,!1),document.removeEventListener("mouseup",H,!1),s.dispatchEvent(l),p=h.NONE)}function F(e){!1===s.enabled||!1===s.enableZoom||p!==h.NONE&&p!==h.ROTATE||(e.preventDefault(),e.stopPropagation(),s.dispatchEvent(u),function(e){e.deltaY<0?I(S()):e.deltaY>0&&k(S()),s.update()}(e),s.dispatchEvent(l))}function U(e){!1!==s.enabled&&!1!==s.enableKeys&&!1!==s.enablePan&&function(e){switch(e.keyCode){case s.keys.UP:j(0,s.keyPanSpeed),s.update();break;case s.keys.BOTTOM:j(0,-s.keyPanSpeed),s.update();break;case s.keys.LEFT:j(s.keyPanSpeed,0),s.update();break;case s.keys.RIGHT:j(-s.keyPanSpeed,0),s.update()}}(e)}function $(e){if(!1!==s.enabled){switch(e.touches.length){case 1:if(!1===s.enableRotate)return;!function(e){_.set(e.touches[0].pageX,e.touches[0].pageY)}(e),p=h.TOUCH_ROTATE;break;case 2:if(!1===s.enableZoom)return;!function(e){var t=e.touches[0].pageX-e.touches[1].pageX,r=e.touches[0].pageY-e.touches[1].pageY,n=Math.sqrt(t*t+r*r);P.set(0,n)}(e),p=h.TOUCH_DOLLY;break;case 3:if(!1===s.enablePan)return;!function(e){x.set(e.touches[0].pageX,e.touches[0].pageY)}(e),p=h.TOUCH_PAN;break;default:p=h.NONE}p!==h.NONE&&s.dispatchEvent(u)}}function z(e){if(!1!==s.enabled)switch(e.preventDefault(),e.stopPropagation(),e.touches.length){case 1:if(!1===s.enableRotate)return;if(p!==h.TOUCH_ROTATE)return;!function(e){b.set(e.touches[0].pageX,e.touches[0].pageY),w.subVectors(b,_).multiplyScalar(s.rotateSpeed);var t=s.domElement===document?s.domElement.body:s.domElement;N(2*Math.PI*w.x/t.clientWidth),L(2*Math.PI*w.y/t.clientHeight),_.copy(b),s.update()}(e);break;case 2:if(!1===s.enableZoom)return;if(p!==h.TOUCH_DOLLY)return;!function(e){var t=e.touches[0].pageX-e.touches[1].pageX,r=e.touches[0].pageY-e.touches[1].pageY,n=Math.sqrt(t*t+r*r);E.set(0,n),T.subVectors(E,P),T.y>0?I(S()):T.y<0&&k(S()),P.copy(E),s.update()}(e);break;case 3:if(!1===s.enablePan)return;if(p!==h.TOUCH_PAN)return;!function(e){M.set(e.touches[0].pageX,e.touches[0].pageY),C.subVectors(M,x).multiplyScalar(s.panSpeed),j(C.x,C.y),x.copy(M),s.update()}(e);break;default:p=h.NONE}}function V(e){!1!==s.enabled&&(s.dispatchEvent(l),p=h.NONE)}function G(e){!1!==s.enabled&&e.preventDefault()}s.domElement.addEventListener("contextmenu",G,!1),s.domElement.addEventListener("mousedown",D,!1),s.domElement.addEventListener("wheel",F,!1),s.domElement.addEventListener("touchstart",$,!1),s.domElement.addEventListener("touchend",V,!1),s.domElement.addEventListener("touchmove",z,!1),window.addEventListener("keydown",U,!1),this.update()}};Ie.OrbitControls.prototype=Object.create(Ie.EventDispatcher.prototype),Ie.OrbitControls.prototype.constructor=Ie.OrbitControls,Object.defineProperties(Ie.OrbitControls.prototype,{center:{get:function get(){return console.warn("THREE.OrbitControls: .center has been renamed to .target"),this.target}},noZoom:{get:function get(){return console.warn("THREE.OrbitControls: .noZoom has been deprecated. Use .enableZoom instead."),!this.enableZoom},set:function set(e){console.warn("THREE.OrbitControls: .noZoom has been deprecated. Use .enableZoom instead."),this.enableZoom=!e}},noRotate:{get:function get(){return console.warn("THREE.OrbitControls: .noRotate has been deprecated. Use .enableRotate instead."),!this.enableRotate},set:function set(e){console.warn("THREE.OrbitControls: .noRotate has been deprecated. Use .enableRotate instead."),this.enableRotate=!e}},noPan:{get:function get(){return console.warn("THREE.OrbitControls: .noPan has been deprecated. Use .enablePan instead."),!this.enablePan},set:function set(e){console.warn("THREE.OrbitControls: .noPan has been deprecated. Use .enablePan instead."),this.enablePan=!e}},noKeys:{get:function get(){return console.warn("THREE.OrbitControls: .noKeys has been deprecated. Use .enableKeys instead."),!this.enableKeys},set:function set(e){console.warn("THREE.OrbitControls: .noKeys has been deprecated. Use .enableKeys instead."),this.enableKeys=!e}},staticMoving:{get:function get(){return console.warn("THREE.OrbitControls: .staticMoving has been deprecated. Use .enableDamping instead."),!this.enableDamping},set:function set(e){console.warn("THREE.OrbitControls: .staticMoving has been deprecated. Use .enableDamping instead."),this.enableDamping=!e}},dynamicDampingFactor:{get:function get(){return console.warn("THREE.OrbitControls: .dynamicDampingFactor has been renamed. Use .dampingFactor instead."),this.dampingFactor},set:function set(e){console.warn("THREE.OrbitControls: .dynamicDampingFactor has been renamed. Use .dampingFactor instead."),this.dampingFactor=e}}}),Ie.ScreenSpacePanning=0,Ie.HorizontalPanning=1;var Fe=Ie.OrbitControls,Be={UP:new n.W(0,0,1),ZOOM_MIN:25,ZOOM_MAX:2e4},Ve=function CameraCalibration(){_classCallCheck(this,CameraCalibration),this.eye=new n.W,this.up=Be.UP.clone(),this.target=new n.W,this.zoomMin=Be.ZOOM_MIN,this.zoomMax=Be.ZOOM_MAX},De=function(e){function CameraCenterOnOptions(){return _classCallCheck(this,CameraCenterOnOptions),_possibleConstructorReturn(this,(CameraCenterOnOptions.__proto__||Object.getPrototypeOf(CameraCenterOnOptions)).apply(this,arguments))}return _inherits(CameraCenterOnOptions,o["a"]),f(CameraCenterOnOptions,[{key:"reset",value:function reset(){this.zoom=!0,this.fitRatio=1.5}}]),CameraCenterOnOptions}(),Ue=new _,Ge=function(e){function CameraManager(e,t){var r;return _classCallCheck(this,CameraManager),(r=_possibleConstructorReturn(this,(CameraManager.__proto__||Object.getPrototypeOf(CameraManager)).call(this))).awm=e,r.options=t,r.camera=new n.F(45,1,.1,5e4),r.control=null,r.floorPlane=new n.G,r.floorPlane.normal.set(0,0,-1),r.ray=new n.K,r.cameraCalibrations=new Map,r._tween=null,r}return _inherits(CameraManager,n["i"]),f(CameraManager,[{key:"init",value:function init(e){var t=this.awm.engineManager.canvas;this.camera.aspect=t.clientWidth/t.clientHeight,this.camera.near=e.meterToAdsumDistance(1),this.camera.far=e.meterToAdsumDistance(1e4),this.camera.up.set(0,0,1),this.camera.updateProjectionMatrix(),this.control=new Fe(this.camera,this.awm.engineManager.canvas),this.control.enableZoom=!0,this.control.enableRotate=!0,this.control.minPolarAngle=Math.PI/20,this.control.maxPolarAngle=Math.PI/2,this.control.minDistance=e.meterToAdsumDistance(5),this.control.enableZoom=!0,this.control.enableDamping=!1,this.control.enableKeys=!1,this.control.panningMode=1,this.control.mouseButtons={PAN:n.t.LEFT,ZOOM:n.t.MIDDLE,ORBIT:n.t.RIGHT}}},{key:"centerOnFloor",value:function centerOnFloor(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this.reset();try{var r=null;if(this.cameraCalibrations.has(e))r=this.cameraCalibrations.get(e);else{console.warn("AdsumWebMap.CameraManager: Missing calibration for centerOnFloor");var i=null===e?this.awm.objectManager.site:e;Ue.setFromObject(i._mesh);var o=new n.Q;Ue.getBoundingSphere(o);var a=new n.W;i._mesh.getWorldPosition(a),o.center.z=a.z,(r=new Ve).target.copy(o.center),r.eye.copy(o.center);var s=1.5*o.radius*Math.sin(Math.PI/4);r.eye.setZ(r.eye.z+s),r.eye.setY(r.eye.y-s)}return this.floorPlane.constant=r.target.z,this.camera.up.copy(r.up),this.goTo(r.eye,r.target,t)}catch(e){return Promise.reject(e)}}},{key:"centerOn",value:function centerOn(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;this.reset();try{var n=null;null===r?n=this.options.centerOnOptions:n=new De(r);var i=e.getSizeAndCenter(),o=i.size,a=i.center,s=this.control.target.clone().sub(this.camera.position),c=a.clone().sub(s);if(n.zoom){var u=this.camera,l=u.aspect,h=u.fov,p=Math.max(o.x,o.y,o.z)/(2*Math.atan(Math.PI*h/360)),f=p/l,d=n.fitRatio*Math.max(p,f);d=Math.min(Math.max(d,this.control.minDistance),this.control.maxDistance);var m=s.normalize().multiplyScalar(d);c.copy(a).sub(m)}return 0!=this.control.target.z-a.z&&(s.normalize(),this.ray.origin.copy(c),this.ray.direction.copy(s),this.ray.intersectPlane(this.floorPlane,a)),this.goTo(c,a,t)}catch(e){return Promise.reject(e)}}},{key:"setCameraCalibrations",value:function setCameraCalibrations(e){var t=this;this.cameraCalibrations=new Map,e.forEach(function(e,r){var i=t.awm.objectManager,o=null===r?i.site:i.getFloor(r);if(null!==o){o._mesh.updateMatrixWorld();var a=new n.W;if(o._mesh.getWorldPosition(a),e.target.z!==a.z){console.warn("AdsumWebMap: invalid calibration target of "+o.id+", it's not on the floor");var s=new n.G;s.normal.set(0,0,-1),s.constant=a.z;var c=new n.W;c.copy(e.target).sub(e.eye),c.normalize();var u=new n.K;u.origin.copy(e.eye),u.direction.copy(c),u.intersectPlane(s,e.target)}t.cameraCalibrations.set(null===r?null:o,e)}})}},{key:"goTo",value:function goTo(e,t){var r=this,n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return new Promise(function(o,a){try{if(r.reset(),n){r.control.enabled=!1;var s={positionX:r.camera.position.x,positionY:r.camera.position.y,positionZ:r.camera.position.z,targetX:r.control.target.x,targetY:r.control.target.y,targetZ:r.control.target.z};r._tween=new i.Tween(s).to({positionX:e.x,positionY:e.y,positionZ:e.z,targetX:t.x,targetY:t.y,targetZ:t.z},700).on("update",function(){r.camera.position.set(s.positionX,s.positionY,s.positionZ),r.control.target.set(s.targetX,s.targetY,s.targetZ),r.control.update()}).on("stop",function(){r._setCameraPositionAndTarget(e,t),r.control.enabled=!0,o(!1)}).on("complete",function(){r.control.enabled=!0,o(!0)}).easing(i.Easing.Quadratic.InOut).start()}r._setCameraPositionAndTarget(e,t),n||o(!0)}catch(e){a(e)}})}},{key:"reset",value:function reset(){return null!==this._tween&&(this._tween.stop(),this._tween=null),this}},{key:"_setCameraPositionAndTarget",value:function _setCameraPositionAndTarget(e,t){this.camera.position.copy(e),this.control.target.copy(t),this.control.update()}}]),CameraManager}(),ze={click:"click",dblClick:"dblClick"},He=function(e){function MouseManager(e){var t;return _classCallCheck(this,MouseManager),(t=_possibleConstructorReturn(this,(MouseManager.__proto__||Object.getPrototypeOf(MouseManager)).call(this))).awm=e,t._dragging=!1,t._mouse=new n.V,t._raycaster=new n.L,t}return _inherits(MouseManager,n["i"]),f(MouseManager,[{key:"init",value:function init(){var e=this;this.awm.engineManager.canvas.addEventListener("mousemove",this._onMouseMove.bind(this));var t=new a.Manager(this.awm.engineManager.canvas);t.add(new a.Tap({event:"doubletap",threshold:10,taps:2,posThreshold:50*window.devicePixelRatio})),t.add(new a.Tap({event:"singletap",threshold:10,time:500,interval:100})),t.get("doubletap").recognizeWith("singletap"),t.get("singletap").requireFailure("doubletap"),t.on("singletap ",this._onMouseClick.bind(this)),t.on("doubletap ",this._onMouseDblClick.bind(this)),this.awm.engineManager.canvas.addEventListener("mousedown",function(){e._dragging=!0},!1),window.document.addEventListener("mouseup",function(){e._dragging=!1},!1)}},{key:"_onMouseClick",value:function _onMouseClick(e){this._setMouseCoordinate(e),this.dispatchEvent({type:ze.click,intersects:this._raycast()})}},{key:"_onMouseDblClick",value:function _onMouseDblClick(e){this._setMouseCoordinate(e),this.dispatchEvent({type:ze.dblClick,intersects:this._raycast()})}},{key:"_onMouseMove",value:function _onMouseMove(){}},{key:"_setMouseCoordinate",value:function _setMouseCoordinate(e){var t=0,r=0;if(void 0===e.clientX&&void 0===e.clientY){var n=e.target.getBoundingClientRect();t=e.center.x-n.left,r=e.center.y-n.top}else e.offsetX||0===e.offsetX?(t=e.offsetX,r=e.offsetY):(t=e.layerX,r=e.layerY);this._mouse.set(t/this.awm.engineManager.canvas.clientWidth*2-1,-r/this.awm.engineManager.canvas.clientHeight*2+1),this._raycaster.setFromCamera(this._mouse,this.awm.cameraManager.camera),this._raycaster.near=this.awm.cameraManager.camera.near,this._raycaster.far=this.awm.cameraManager.camera.far}},{key:"_raycast",value:function _raycast(){var e=[];return this.awm.objectManager.site._raycast(this._raycaster,e),e.sort(function(e,t){return e.distance-t.distance}),e}}]),MouseManager}();function getAdsumObjectGroundAndPosition(e){var t=null,r=null;switch(e.getType()){case b.SiteObject:case b.FloorObject:t=e;break;case b.BuildingObject:t=e.site,r=e._mesh.position.clone();break;case b.SpaceObject:case b.UserObject:t=e.parent,r=e._mesh.position.clone();break;case b.LabelObject:case b.LabelTextObject:case b.LabelImageObject:r=e._mesh.position.clone();var n=e.parent;n.isSpace?(t=n.parent,r.applyMatrix4(n.matrix)):n.isBuilding?(t=n.site,r.applyMatrix4(n.matrix)):t=n;break;default:throw new Error("Unexpected")}return{ground:t,groundPosition:r}}function getUtmPosition(e,t,r){var n=e._mesh.localToWorld(t.clone());return n.setZ(e.isSite?0:e.altitude),r.adsumToUtm(n)}var We=function(){function PathNode(e,t,r,n){var i=arguments.length>4&&void 0!==arguments[4]&&arguments[4];_classCallCheck(this,PathNode),this.id=e||Symbol("PathNodeId"),this.ground=t,this.links=new Set,this.utmPosition=n,this.groundPosition=r,this.isDynamic=!1,this._isGate=i}return f(PathNode,null,[{key:"create",value:function create(e,t,r,n){var i=arguments.length>4&&void 0!==arguments[4]&&arguments[4];return new this(e,t,r,getUtmPosition(t,r,n),i)}},{key:"updateFromAdsumObject",value:function updateFromAdsumObject(e,t,r){var n=getAdsumObjectGroundAndPosition(t),i=n.ground,o=n.groundPosition;e.ground=i,e.groundPosition=o,e.utmPosition=getUtmPosition(i,o,r)}},{key:"createFromAdsumObject",value:function createFromAdsumObject(e,t,r){var n=getAdsumObjectGroundAndPosition(t),i=n.ground,o=n.groundPosition;return this.create(e,i,o,r)}}]),f(PathNode,[{key:"getLinkTo",value:function getLinkTo(e){var t=null;return this.links.forEach(function(r){r.to!==e&&r.from!==e||(t=r)}),t}}]),PathNode}(),qe=0,Xe=1,Ye=2,Je=function(){function PathLink(e,t,r,n){var i=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];_classCallCheck(this,PathLink),this.id=e,this.type=t,this.from=r,this.to=n,this.bidirectional=i,this.distance=Math.sqrt(Math.pow(r.utmPosition.N-n.utmPosition.N,2)+Math.pow(r.utmPosition.E-n.utmPosition.E,2)+Math.pow(r.utmPosition.alt-n.utmPosition.alt,2))}return f(PathLink,[{key:"isAccessible",value:function isAccessible(e){return this.type===qe||(e?this.type===Xe:this.type===Ye)}}]),PathLink}(),Ze=function(){function AStar(e){_classCallCheck(this,AStar),this.pathNetwork=e,this._cache=new Map,this._computing=new Map,this._symbolStrings=new Map,this._symbolIncrement=0}return f(AStar,[{key:"search",value:function search(e,t){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this._isCached(e,t,r))return this._getFromCache(e,t,r);if(this._isComputing(e,t,r))return this._getFromComputing(e,t,r);var n=Promise.resolve().then(function(){var n=new Map,i=new Set,o=new Map,a=function _loop(){for(var e=Array.from(n.values()),a=e[0],s=1;s<e.length;s++){var c=e[s];o.get(c.id).d<o.get(a.id).d&&(a=c)}if(a===t){for(var u=[a],l=o.get(a.id).parent;null!==l;){u.push(l),l=o.get(l.id).parent}return{v:u.reverse()}}n.delete(a.id),i.add(a.id);var h=[],p=[];a.links.forEach(function(e){e.isAccessible(r)&&(e.from===a?(h.push(e.to),p.push(e.distance)):e.to===a&&e.bidirectional&&(h.push(e.from),p.push(e.distance)))});for(var f=0;f<h.length;f++){var d=h[f];if(!i.has(d.id)){n.has(d.id)||(o.set(d.id,{d:1/0,parent:null}),n.set(d.id,d));var m=o.get(a.id).d+p[f],g=o.get(d.id);m<g.d&&(g.parent=a,g.d=m)}}};for(o.set(e.id,{d:0,parent:null}),o.set(t.id,{d:1/0,parent:null}),n.set(e.id,e);n.size>0;){var s=a();if("object"===(void 0===s?"undefined":p(s)))return s.v}return[]});return this._addToComputing(e,t,r,n),n}},{key:"_addToCache",value:function _addToCache(e,t,r,n){if(!e.isDynamic&&!t.isDynamic){var i=this._getCacheKey(e,t,r);this._cache.set(i,n.map(function(e){return e.id}))}}},{key:"_getFromCache",value:function _getFromCache(e,t,r){var n=this,i=this._getCacheKey(e,t,r);return Promise.resolve(this._cache.get(i).map(function(e){return n.pathNetwork.nodes.get(e)}))}},{key:"_getCacheKey",value:function _getCacheKey(e,t,r){return this._stringifyId(e.id)+":"+this._stringifyId(t.id)+(r?":pmr":"")}},{key:"_stringifyId",value:function _stringifyId(e){return"symbol"!=(void 0===e?"undefined":p(e))?""+e:(this._symbolStrings.has(e)||this._symbolStrings.set(e,"s"+this._symbolIncrement++),this._symbolStrings.get(e))}},{key:"_isCached",value:function _isCached(e,t,r){return this._cache.has(this._getCacheKey(e,t,r))}},{key:"_addToComputing",value:function _addToComputing(e,t,r,n){var i=this,o=this._getCacheKey(e,t,r);this._computing.set(o,n),n.then(function(n){i._addToCache(e,t,r,n),i._computing.delete(o)})}},{key:"_getFromComputing",value:function _getFromComputing(e,t,r){var n=this,i=this._getCacheKey(e,t,r);return this._computing.get(i).then(function(){return n.search(e,t,r)})}},{key:"_isComputing",value:function _isComputing(e,t,r){return this._computing.has(this._getCacheKey(e,t,r))}}]),AStar}(),Ke=function(){function PathSection(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[];_classCallCheck(this,PathSection),this.from=e,this.to=r,this.ground=t,this.nodes=n,this._distance=null,this._curve=null}return f(PathSection,[{key:"getDistance",value:function getDistance(){if(null===this._distance){this._distance=0;for(var e=0;e<this.nodes.length-1;e++){var t=this.nodes[e].getLinkTo(this.nodes[e+1]);this._distance+=t.distance}}return this._distance}},{key:"getCurve",value:function getCurve(){if(this.nodes.length<2)return null;if(null===this._curve){this._curve=[];for(var e=0;e<this.nodes.length-1;e++)this._curve.push({from:this.nodes[e].groundPosition,to:this.nodes[e+1].groundPosition})}return this._curve}},{key:"interpolate",value:function interpolate(e,t){var r=this.getCurve();if(null===r)return[];var i=e;e>this.getDistance()/3&&(console.warn("AdsumWebMap.PathSection.interpolate: short pathSection"),i=this.getDistance()/3);var o=Math.floor(this.getDistance()/i)-1,a=this.getDistance()/(o+1),s=[],c=a,u=new n.W;return r.forEach(function(e){var r=e.from,n=e.to,i=t.adsumDistanceToMeter(u.subVectors(r,n).length());if(i<c)c-=i;else{for(var o=c/i;o<=1;)u.lerpVectors(r,n,o),s.push(u.clone()),o+=a/i;c=i*(o-1)}}),s}}]),PathSection}(),Qe=function(){function PathNetwork(e){_classCallCheck(this,PathNetwork),this.awm=e,this.nodes=new Map,this.spaceGatesByAdsumObjectId=new Map,this.buildingGatesByAdsumObjectId=new Map,this.aStar=new Ze(this)}return f(PathNetwork,[{key:"init",value:function init(e){var t=this;e.get("nodes").forEach(function(e){var r=t._findParentAndGround(e.location),i=r.parent,o=r.ground;if(null!==i){var a=new n.W(e.position.x,e.position.y,e.position.z+.1),s=We.create(e.id,o,a,t.awm.projector,e.isGate);t.nodes.set(s.id,s),e.isGate&&("STORE"===e.location.type||"SHAPE"===e.location.type?(t.spaceGatesByAdsumObjectId.has(e.location.id)||t.spaceGatesByAdsumObjectId.set(e.location.id,[]),t.spaceGatesByAdsumObjectId.get(e.location.id).push(s)):"BUILDING"===e.location.type?(t.buildingGatesByAdsumObjectId.has(e.location.id)||t.buildingGatesByAdsumObjectId.set(e.location.id,[]),t.buildingGatesByAdsumObjectId.get(e.location.id).push(s)):console.warn("AdsumWebMap.PathNetwork: Invalid node gate on "+e.type+"#"+e.id))}else console.warn("AdsumWebMap.PathNetwork: invalid node")}),e.get("links").forEach(function(e){var r=t.nodes.get(e.from),n=t.nodes.get(e.to);if(void 0!==r&&void 0!==n){var i=new Je(e.id,e.type,r,n,e.bidirectional);r.links.add(i),i.bidirectional&&n.links.add(i)}else console.warn("AdsumWebMap.PathNetwork: invalid link")})}},{key:"computePath",value:function computePath(e){var t=this,r=e.from,n=e.to;return!r.pathNode.isDynamic&&this.nodes.has(r.pathNode.id)||this.attachNodeLocation(r),!n.pathNode.isDynamic&&this.nodes.has(n.pathNode.id)||this.attachNodeLocation(n),this.aStar.search(r.pathNode,n.pathNode,e.pmr).then(function(r){t._buildPathSections(e,r)})}},{key:"attachNodeLocation",value:function attachNodeLocation(e){var t=e.pathNode,r=t.ground,i=t.groundPosition,o=null;if(e.adsumObject&&e.adsumObject.isSpace)o=this.spaceGatesByAdsumObjectId.get(e.adsumObject.id)||[];else if(e.adsumObject&&e.adsumObject.isBuilding)o=this.buildingGatesByAdsumObjectId.get(e.adsumObject.id)||[];else{o=[];var a=1/0,s=[];if(this.nodes.forEach(function(t){if(t!==e.pathNode&&t.ground===r){var n=t.groundPosition.distanceToSquared(e.pathNode.groundPosition);n<=9*a&&s.push({squareDistance:n,node:t}),n<a&&(a=n)}}),a!==1/0){s.sort(function(e,t){return e.squareDistance-t.squareDistance});var c=new n.L(r._mesh.localToWorld(i.clone())),u=[],l=[];s.forEach(function(e){var t=e.squareDistance,n=e.node;if(!(t>9*a)){c.ray.direction=r._mesh.localToWorld(n.groundPosition.clone()),c.ray.direction.sub(c.ray.origin),c.near=0,c.far=c.ray.direction.length(),c.ray.direction.normalize();for(var i=0;i<l.length;i++)if(l[i].angleTo(c.ray.direction)<Math.PI/4)return;u.length=0;for(var s=0;s<r._mesh.children.length;s++){var h=r._mesh.children[s],p=h.adsumObject;if((!p||!p.isLabel&&!p.isUser)&&(c.intersectObject(h,!1,u),0!==u.length))return}o.push(n),l.push(c.ray.direction)}})}}e.pathNode.links.forEach(function(t){t.from.links.delete(t),t.to.links.delete(t),e.pathNode.links.delete(t)}),o.forEach(function(t){var r=new Je(Symbol("PathLinkId"),qe,e.pathNode,t);e.pathNode.links.add(r),t.links.add(r)}),this.nodes.set(e.pathNode.id,e.pathNode),e.pathNode.needsUpdate=!1}},{key:"_findParentAndGround",value:function _findParentAndGround(e){var t=null,r=null;switch(e.type){case"STORE":case"SHAPE":null!==(t=this.awm.objectManager.getSpace(e.id))&&(r=t.parent);break;case"FLOOR":null!==(t=this.awm.objectManager.getFloor(e.id))&&(r=t);break;case"BUILDING":r=(t=this.awm.objectManager.getBuilding(e.id)).site;break;case"SITE":r=t=this.awm.objectManager.site;break;default:console.warn("AdsumWebMap.WayfindingManager.PathNetwork: unknown location.type "+e.type+" ")}return null===t&&console.warn("AdsumWebMap.WayfindingManager.PathNetwork: invalid location "+e.type+"#"+e.id),{parent:t,ground:r}}},{key:"_buildPathSections",value:function _buildPathSections(e,t){if(0===t.length)throw new Error("AdsumWebMap.PathNetwork: No path found to destination");e.clear();var r=new Ke(e.from,e.from.pathNode.ground);e.pathSections.push(r);for(var n=0;n<t.length;n++){var i=t[n];if(r.ground!==i.ground){r.to=null,r=new Ke(null,i.ground),e.pathSections.push(r)}r.nodes.push(i)}r.to=e.to}}]),PathNetwork}(),$e=function(){function BasicDotPathSectionDrawer(e,t,r){_classCallCheck(this,BasicDotPathSectionDrawer),this.pathSectionObject=e,this.cameraManager=t,this.projector=r,this.speed=30,this.center=!0,this.tweens=[]}return f(BasicDotPathSectionDrawer,[{key:"draw",value:function draw(){for(var e=[],t=this.pathSectionObject._mesh.children,r=0;r<t.length;r++){var n=this.projector.adsumDistanceToMeter(this.pathSectionObject.patternSpace)/this.speed*r*1e3;e.push(this._showPattern(r,n))}return this.pathSectionObject._mesh.visible=!0,this.center&&e.push(this.cameraManager.centerOn(this.pathSectionObject)),this.pathSectionObject.animations.push(this),Promise.all(e).then(function(){})}},{key:"stop",value:function stop(){this.tweens.forEach(function(e){e.stop()})}},{key:"_showPattern",value:function _showPattern(e,t){var r=this;return new Promise(function(n,o){var a=r.pathSectionObject._mesh.children[e];a.traverse(function(e){e.material&&(e.material.opacity=0,e.material.transparent=!0)});var s=new i.Tween({opacity:0}).to({opacity:1},1e3).delay(t).easing(i.Easing.Exponential.In).on("complete",function(){a.traverse(function(e){e.material&&(e.material.opacity=1)}),n(!0)}).on("stop",function(){o(new Error("Path was stopped"))}).start();r.tweens.push(s)})}}]),BasicDotPathSectionDrawer}(),et=function(){function AdsumLocation(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;_classCallCheck(this,AdsumLocation),this.isLocation=!0,this.id=e,this.pathNode=t,this.adsumObject=r}return f(AdsumLocation,[{key:"updateFromObjectPosition",value:function updateFromObjectPosition(e){We.updateFromAdsumObject(this.pathNode,this.adsumObject,e)}}]),AdsumLocation}(),tt=function(){function LocationRepository(){_classCallCheck(this,LocationRepository),this.locations=new Map,this.locationsByAdsumObject=new Map,this.projector=null,this.objectManager=null,this.pathNetwork=null,this.userLocation=null}return f(LocationRepository,[{key:"init",value:function init(e,t,r){var n=this;this.projector=e,this.objectManager=r,this.pathNetwork=t,r.labels.forEach(function(e){if(!e.parent.isBuilding&&!e.parent.isSpace){var t=new et(e.placeId,We.createFromAdsumObject(null,e,n.projector),e);n.locations.set(t.id,t),n.locationsByAdsumObject.set(e,t),n.pathNetwork.attachNodeLocation(t)}}),r.spaces.forEach(function(e){var t=new et(e.placeId,We.createFromAdsumObject(null,e,n.projector),e);n.locations.set(t.id,t),n.locationsByAdsumObject.set(e,t),n.pathNetwork.attachNodeLocation(t)}),r.buildings.forEach(function(e){var t=new et(e.placeId,We.createFromAdsumObject(null,e,n.projector),e);n.locations.set(t.id,t),n.locationsByAdsumObject.set(e,t),n.pathNetwork.attachNodeLocation(t)})}},{key:"createUserLocation",value:function createUserLocation(){if(null!==this.userLocation)throw new Error("Unexpected");this.userLocation=new et(Symbol("UserLocation"),We.createFromAdsumObject(Symbol("UserPathNode"),this.objectManager.user,this.projector),this.objectManager.user),this.userLocation.pathNode.isDynamic=!0,this.locations.set(this.userLocation.id,this.userLocation)}},{key:"get",value:function get(e){return this.locations.has(e)?this.locations.get(e):null}},{key:"getByAdsumObject",value:function getByAdsumObject(e){return this.locationsByAdsumObject.has(e)?this.locationsByAdsumObject.get(e):null}}]),LocationRepository}(),rt={user:{position:{didChanged:"wayfinding.user.position.didChanged"}}},nt=function(e){function WayfindingManager(e,t){var r;return _classCallCheck(this,WayfindingManager),(r=_possibleConstructorReturn(this,(WayfindingManager.__proto__||Object.getPrototypeOf(WayfindingManager)).call(this))).awm=e,r.projector=null,r.locationRepository=new tt,r.pathNetwork=new Qe(e),r.options=t,r}return _inherits(WayfindingManager,n["i"]),f(WayfindingManager,[{key:"init",value:function init(e){this.projector=e.projector,this.pathNetwork.init(e.paths),this.options.pathBuilder.init(this.projector,this.awm.objectManager),this.locationRepository.init(this.projector,this.pathNetwork,this.awm.objectManager)}},{key:"computePath",value:function computePath(e){return this.removePath(e),null===e.from&&(e.from=this.locationRepository.userLocation,null===e.from)?Promise.reject(new Error("AdsumWebMap.WayfindingManager: cannot compute path because user position is not set")):null===e.to&&(e.to=this.locationRepository.userLocation,null===e.to)?Promise.reject(new Error("AdsumWebMap.WayfindingManager: cannot compute path because user position is not set")):this.pathNetwork.computePath(e)}},{key:"removePath",value:function removePath(e){var t=this;e.pathSections.forEach(function(e){t.removePathSection(e)})}},{key:"drawPathSection",value:function drawPathSection(e){this.removePathSection(e);var t=this.options.pathBuilder.build(e);return new $e(t,this.awm.cameraManager,this.projector).draw()}},{key:"removePathSection",value:function removePathSection(e){this.awm.objectManager.pathSectionObjects.forEach(function(t){t.pathSection===e&&t._dispose()})}},{key:"getUserUtmPosition",value:function getUserUtmPosition(){var e=this.locationRepository.userLocation;return null===e?null:{utm:e.pathNode.utmPosition,floor:e.adsumObject.parent.isFloor?e.adsumObject.parent:null}}},{key:"getUserGpsPosition",value:function getUserGpsPosition(){if(null===this.locationRepository.userLocation)return null;var e=this.getUserUtmPosition(),t=e.utm,r=e.floor;return{gps:this.projector.utmToGps(t),floor:r}}},{key:"setUserAdsumPosition",value:function setUserAdsumPosition(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=e.x,i=e.y,o=e.z,a=null===t?this.awm.objectManager.site:t,s=this.awm.objectManager.user;return s._mesh.position.set(n,i,o),r&&a._mesh.worldToLocal(s._mesh.position),s._mesh.position.setZ(s._mesh.position.z+.1),a._addChild(s),s.parent=a,s.update(),null===this.locationRepository.userLocation?this.locationRepository.createUserLocation():this.locationRepository.userLocation.updateFromObjectPosition(this.projector),this.dispatchEvent({type:rt.user.position.didChanged,floor:t}),this}},{key:"setUserGpsPosition",value:function setUserGpsPosition(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return this.setUserAdsumPosition(this.projector.gpsToAdsum(e),t,!0)}},{key:"setUserUtmPosition",value:function setUserUtmPosition(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return this.setUserAdsumPosition(this.projector.utmToAdsum(e),t,!0)}},{key:"getUserDistanceFromPath",value:function getUserDistanceFromPath(e){var t=this;return Math.min.apply(Math,function _toConsumableArray(e){if(Array.isArray(e)){for(var t=0,r=Array(e.length);t<e.length;t++)r[t]=e[t];return r}return Array.from(e)}(e.pathSections.map(function(e){return t.getUserDistanceFromPathSection(e)})))}},{key:"getUserDistanceFromPathSection",value:function getUserDistanceFromPathSection(e){var t=this.locationRepository.userLocation;if(null===t)throw new Error("AdsumWebMap.WayfindingManager.getUserDistanceFromPathSection: no user position set");if(e.ground!==t.pathNode.ground)return 1/0;var r=new n.W,i=new n.r,o=e.getCurve(),a=t.pathNode.groundPosition,s=1/0;return null===o?e.nodes.length>0&&(s=a.distanceTo(e.nodes[0].groundPosition)):o.forEach(function(e){var t=e.from,n=e.to;i.set(t,n),i.closestPointToPoint(a,!0,r);var o=a.distanceTo(r);o<s&&(s=o)}),this.projector.adsumDistanceToMeter(s)}}]),WayfindingManager}(),it=function(e){function EngineOptions(){return _classCallCheck(this,EngineOptions),_possibleConstructorReturn(this,(EngineOptions.__proto__||Object.getPrototypeOf(EngineOptions)).apply(this,arguments))}return _inherits(EngineOptions,o["a"]),f(EngineOptions,[{key:"reset",value:function reset(){h(EngineOptions.prototype.__proto__||Object.getPrototypeOf(EngineOptions.prototype),"reset",this).call(this),this.container=null,this.gpuPower="high-performance",this.autoCompileMaterials=!0,this.clearColor=16777215,this.fogEnabled=!1,this.fogRatio=0,this.fogColor=16777215,this.backgroundImage=null,this.shadowEnabled=!1,this.shadowSize=2048}}]),EngineOptions}(),ot=function(e){function CameraOptions(){return _classCallCheck(this,CameraOptions),_possibleConstructorReturn(this,(CameraOptions.__proto__||Object.getPrototypeOf(CameraOptions)).apply(this,arguments))}return _inherits(CameraOptions,o["a"]),f(CameraOptions,[{key:"reset",value:function reset(){h(CameraOptions.prototype.__proto__||Object.getPrototypeOf(CameraOptions.prototype),"reset",this).call(this),this.centerOnOptions=new De,this.force2D=!1,this.zoomEnabled=!0,this.rotationEnabled=!0,this.keepInFloorBounds=!1}}]),CameraOptions}(),at=function(e){function PathSectionObject(){var e;return _classCallCheck(this,PathSectionObject),(e=_possibleConstructorReturn(this,(PathSectionObject.__proto__||Object.getPrototypeOf(PathSectionObject)).call(this))).isPathSection=!0,e.pathSection=null,e.patternSpace=null,e.animations=[],e}return _inherits(PathSectionObject,M),f(PathSectionObject,null,[{key:"_createFromPathSection",value:function _createFromPathSection(e,t,r){var n=this._createFromMesh(t);return n.pathSection=e,n.patternSpace=r,n}}]),f(PathSectionObject,[{key:"getType",value:function getType(){return b.PathSectionObject}},{key:"_dispose",value:function _dispose(){this.animations.forEach(function(e){e.stop()}),this._mesh.traverse(function(e){e.material&&e.isMaterial&&e.material.dispose()}),null!==this._mesh.parent&&this._mesh.parent.remove(this._mesh)}}]),PathSectionObject}(),st=function(e){function DotPathBuilderOptions(){return _classCallCheck(this,DotPathBuilderOptions),_possibleConstructorReturn(this,(DotPathBuilderOptions.__proto__||Object.getPrototypeOf(DotPathBuilderOptions)).apply(this,arguments))}return _inherits(DotPathBuilderOptions,o["a"]),f(DotPathBuilderOptions,[{key:"reset",value:function reset(){h(DotPathBuilderOptions.prototype.__proto__||Object.getPrototypeOf(DotPathBuilderOptions.prototype),"reset",this).call(this),this.patternSpace=5,this.patternSize=1,this.patternMesh=null}}]),DotPathBuilderOptions}(),ct=function(){function DotPathBuilder(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck(this,DotPathBuilder),this.projector=null,this.objectManager=null,this.options=new st(e)}return f(DotPathBuilder,[{key:"init",value:function init(e,t){this.projector=e,this.objectManager=t}},{key:"build",value:function build(e){var t=new n.n;t.visible=!1;for(var r=e.interpolate(this.options.patternSpace,this.projector),i=0;i<r.length-1;i++){var o=r[i],a=r[i+1],s=this._createPattern();s.position.copy(o);var c=a.clone().sub(s.position),u=0;u=0===c.y?c.x>0?Math.PI/2:-Math.PI/2:Math.atan(c.x/c.y),c.y<0&&(u+=Math.PI),s.setRotationFromAxisAngle(new n.W(-0,-0,-1),u),t.add(s)}var l=at._createFromPathSection(e,t,this.options.patternSpace);return e.ground._addChild(l),l.update(),this.objectManager.pathSectionObjects.set(l.id,l),l}},{key:"_createPattern",value:function _createPattern(){null===this.options.patternMesh&&(this.options.patternMesh=this._createDefaultPattern());var e=this.options.patternMesh.clone();return e.traverse(function(e){e.material&&e.material.isMaterial&&(e.material=e.material.clone())}),e}},{key:"_createDefaultPattern",value:function _createDefaultPattern(){var e=document.createElement("canvas"),t=e.getContext("2d");e.width=64,e.height=64;var r=.5*e.height,i=.65*e.width,o=(e.width-i)/2,a=(e.height-r)/2;t.arc(e.width/2,e.height/2,35,0,2*Math.PI),t.fillStyle="#0bbfba",t.fill(),t.beginPath(),t.moveTo(o,a+r),t.lineTo(o+i/2,a),t.lineTo(o+i,a+r),t.lineTo(o+i-10,a+r),t.lineTo(o+i/2,a+2*r*10/i),t.lineTo(o+10,a+r),t.closePath(),t.fillStyle="#ffffff",t.fill(),t.lineWidth=1,t.strokeStyle="#000000",t.stroke();var s=new n.c(e),c=new n.x({color:16777215,map:s,side:n.l}),u=new n.H(this.projector.meterToAdsumDistance(this.options.patternSize),this.projector.meterToAdsumDistance(this.options.patternSize));return new n.w(u,c)}}]),DotPathBuilder}(),ut=function(e){function WayfindingOptions(){return _classCallCheck(this,WayfindingOptions),_possibleConstructorReturn(this,(WayfindingOptions.__proto__||Object.getPrototypeOf(WayfindingOptions)).apply(this,arguments))}return _inherits(WayfindingOptions,o["a"]),f(WayfindingOptions,[{key:"reset",value:function reset(){h(WayfindingOptions.prototype.__proto__||Object.getPrototypeOf(WayfindingOptions.prototype),"reset",this).call(this),this.pathBuilder=new ct}}]),WayfindingOptions}(),lt=function(e){function Options(){return _classCallCheck(this,Options),_possibleConstructorReturn(this,(Options.__proto__||Object.getPrototypeOf(Options)).apply(this,arguments))}return _inherits(Options,o["a"]),f(Options,[{key:"reset",value:function reset(){h(Options.prototype.__proto__||Object.getPrototypeOf(Options.prototype),"reset",this).call(this),this.engine=new it,this.camera=new ot,this.wayfinding=new ut,this.loader=null}}]),Options}(),ht=function(){function AdsumWebMap(e){_classCallCheck(this,AdsumWebMap);var t=new lt(e);this.objectManager=new T,this.sceneManager=new ke(this),this.engineManager=new Re(this,t.engine),this.cameraManager=new Ge(this,t.camera),this.mouseManager=new He(this),this.wayfindingManager=new nt(this,t.wayfinding),this.deviceId=null,this.defaultFloor=null,this.loader=t.loader}return f(AdsumWebMap,[{key:"init",value:function init(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return null!==t&&(this.loader=t),this.loader.load().then(function(t){return e.projector=t.projector,e.objectManager.init(t,e.projector),e.sceneManager.init(t),e.cameraManager.init(e.projector),e.engineManager.init(t),e.mouseManager.init(),e.wayfindingManager.init(t),e.setDeviceId(t.deviceId,!1)})}},{key:"start",value:function start(){this.engineManager.start()}},{key:"getDeviceId",value:function getDeviceId(){return this.deviceId}},{key:"setDeviceId",value:function setDeviceId(e){var t=this,r=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return this.deviceId=e,this.defaultFloor=null,this.loader.loadCalibration(this.deviceId).then(function(e){var n=e.cameraCalibrations,i=e.defaultFloorId,o=e.userPosition;return null!==o&&(null===o.floorId?t.wayfindingManager.setUserAdsumPosition(o.position,null,!0):t.wayfindingManager.setUserAdsumPosition(o.position,t.objectManager.getFloor(o.floorId),!0)),t.cameraManager.setCameraCalibrations(n),null!==i&&(t.defaultFloor=t.objectManager.getFloor(i)),t.sceneManager.setCurrentFloor(t.defaultFloor,r)}).then(function(){return t.cameraManager.centerOnFloor(t.defaultFloor,r)}).then(function(){})}}]),AdsumWebMap}(),pt=function(e){function AdsumLoaderOptions(){return _classCallCheck(this,AdsumLoaderOptions),_possibleConstructorReturn(this,(AdsumLoaderOptions.__proto__||Object.getPrototypeOf(AdsumLoaderOptions)).apply(this,arguments))}return _inherits(AdsumLoaderOptions,o["a"]),f(AdsumLoaderOptions,[{key:"reset",value:function reset(){h(AdsumLoaderOptions.prototype.__proto__||Object.getPrototypeOf(AdsumLoaderOptions.prototype),"reset",this).call(this),this.entityManager=null,this.shadowEnabled=!1,this.shadowMapSize=2048,this.fogEnabled=!1,this.fogRatio=0,this.fogColor=16777215,this.preferAmbientOcclusion=!0,this.shapeAmbientOcclusionTopColor=16777215,this.shapeAmbientOcclusionBottomColor=8421504,this.deviceId=null}},{key:"preferLambertMaterial",value:function preferLambertMaterial(){return!1}},{key:"advancedLightingEnabled",value:function advancedLightingEnabled(){return!0}}]),AdsumLoaderOptions}(),ft=function(){function AdsumTextureLoader(e,t){var r=this;_classCallCheck(this,AdsumTextureLoader),this.texturesByReference=new Map;var i=[c.e.TEXTURE];t&&i.push(c.e.TEXTURE_OCCLUSION),e.findBy({context:function context(e){return i.includes(e)}}).forEach(function(e){r.texturesByReference.set(e.reference,e)}),this.threeLoader=new n.U,this.regex=/\/texture\/reference\/(?:[a-f0-9]{2,3}\/)*(.*)$/}return f(AdsumTextureLoader,[{key:"load",value:function load(e,t,r,n){var i=this.regex.exec(e),o=e;if(null!==i){var a=i[1];this.texturesByReference.has(a)&&(o=this.texturesByReference.get(a).uri)}return this.threeLoader.load(o,t,r,n)}}]),AdsumTextureLoader}(),dt={Group:n.n,Matrix4:n.v,Vector3:n.W,Quaternion:n.J,Vector4:n.X,Math:n.u,Object3D:n.D,DoubleSide:n.h,MeshLambertMaterial:n.y,MeshBasicMaterial:n.x,MeshPhongMaterial:n.z,FrontSide:n.l,MultiMaterial:n.C,SkinnedMesh:n.P,Mesh:n.w,Line:n.q,PerspectiveCamera:n.F,DirectionalLight:n.g,PointLight:n.I,SpotLight:n.S,AmbientLight:n.a,Geometry:n.m,Vector2:n.V,Color:n.f,Face3:n.j,Loader:n.s,Texture:n.T,MirroredRepeatWrapping:n.A,RepeatWrapping:n.M,ClampToEdgeWrapping:n.e,MixOperation:n.B,ImageLoader:n.p,Scene:n.O};var mt=function(e){function SiteObject(){var e;return _classCallCheck(this,SiteObject),(e=_possibleConstructorReturn(this,(SiteObject.__proto__||Object.getPrototypeOf(SiteObject)).call(this))).isSite=!0,e.buildings=new Set,e.spaces=new Set,e.labels=new Set,e}return _inherits(SiteObject,M),f(SiteObject,[{key:"getType",value:function getType(){return b.SiteObject}},{key:"addLabel",value:function addLabel(e){var t,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=0,i=0,o=0;if(null!==r&&(n=(t=r).x,i=t.y,o=t.z),null!==e.parent)throw new Error("AdsumWebMap.LabelObject#addLabel: Changing labelObject parent is not supported yet.");e.parent=this,this.labels.add(e),e.moveTo(n,i,o),this._mesh.add(e._mesh),e.update()}},{key:"_raycast",value:function _raycast(e,t){var r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return!1!==h(SiteObject.prototype.__proto__||Object.getPrototypeOf(SiteObject.prototype),"_raycast",this).call(this,e,t,r)&&(r&&(this.buildings.forEach(function(n){n._raycast(e,t,r)}),this.labels.forEach(function(n){n._raycast(e,t,r)}),this.spaces.forEach(function(n){n._raycast(e,t,r)})),!0)}}]),SiteObject}(),gt=function(e){function BuildingObject(){var e;return _classCallCheck(this,BuildingObject),(e=_possibleConstructorReturn(this,(BuildingObject.__proto__||Object.getPrototypeOf(BuildingObject)).call(this))).isBuilding=!0,e.site=null,e.floors=new Set,e.labels=new Set,e._labelGroup=new n.n,e._initialColor=null,e}return _inherits(BuildingObject,M),f(BuildingObject,[{key:"getType",value:function getType(){return b.BuildingObject}},{key:"addLabel",value:function addLabel(e){var t,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=0,i=0,o=0;if(null!==r&&(n=(t=r).x,i=t.y,o=t.z),null!==e.parent)throw new Error("AdsumWebMap.SpaceObject#addLabel: Changing labelObject parent is not supported yet.");return e.parent=this,this.labels.add(e),e.moveTo(n,i,o),this._labelGroup.add(e._mesh),this.update(),this}},{key:"setColor",value:function setColor(e){return this._mesh.material.color.set(e),this}},{key:"isInitialColor",value:function isInitialColor(){return this._initialColor.equals(this._mesh.material.color)}},{key:"resetColor",value:function resetColor(){return this._mesh.material.color.copy(this._initialColor),this}},{key:"_setMesh",value:function _setMesh(e){return h(BuildingObject.prototype.__proto__||Object.getPrototypeOf(BuildingObject.prototype),"_setMesh",this).call(this,e),this._mesh.add(this._labelGroup),this._updateLabelGroup(),this._initialColor=this._mesh.material.color.clone(),this}},{key:"_raycast",value:function _raycast(e,t){var r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return!1!==h(BuildingObject.prototype.__proto__||Object.getPrototypeOf(BuildingObject.prototype),"_raycast",this).call(this,e,t,r)&&(r&&(this.floors.forEach(function(n){n._raycast(e,t,r)}),this.labels.forEach(function(n){n._raycast(e,t,r)})),!0)}},{key:"_updateLabelGroup",value:function _updateLabelGroup(){h(BuildingObject.prototype.__proto__||Object.getPrototypeOf(BuildingObject.prototype),"update",this).call(this);var e=this.getSizeAndCenter(!1).size;this._labelGroup.position.setZ(e.z),this._labelGroup.updateMatrixWorld()}}]),BuildingObject}(),yt=function(e){function FloorObject(){var e;return _classCallCheck(this,FloorObject),(e=_possibleConstructorReturn(this,(FloorObject.__proto__||Object.getPrototypeOf(FloorObject)).call(this))).isFloor=!0,e.building=null,e.spaces=new Set,e.labels=new Set,e.altitude=null,e}return _inherits(FloorObject,M),f(FloorObject,[{key:"getType",value:function getType(){return b.FloorObject}},{key:"addLabel",value:function addLabel(e){var t,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=0,i=0,o=0;if(null!==r&&(n=(t=r).x,i=t.y,o=t.z),null!==e.parent)throw new Error("AdsumWebMap.LabelObject#addLabel: Changing labelObject parent is not supported yet.");e.parent=this,this.labels.add(e),e.moveTo(n,i,o),this._mesh.add(e._mesh),e.update()}},{key:"_raycast",value:function _raycast(e,t){var r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return!1!==h(FloorObject.prototype.__proto__||Object.getPrototypeOf(FloorObject.prototype),"_raycast",this).call(this,e,t,r)&&(r&&(this.spaces.forEach(function(n){n._raycast(e,t,r)}),this.labels.forEach(function(n){n._raycast(e,t,r)})),!0)}}]),FloorObject}(),vt=function(e){function SpaceObject(){var e;return _classCallCheck(this,SpaceObject),(e=_possibleConstructorReturn(this,(SpaceObject.__proto__||Object.getPrototypeOf(SpaceObject)).call(this))).isSpace=!0,e.parent=null,e.labels=new Set,e._labelGroup=new n.n,e._initialColor=null,e}return _inherits(SpaceObject,M),f(SpaceObject,[{key:"getType",value:function getType(){return b.SpaceObject}},{key:"_setMesh",value:function _setMesh(e){return h(SpaceObject.prototype.__proto__||Object.getPrototypeOf(SpaceObject.prototype),"_setMesh",this).call(this,e),this._mesh.add(this._labelGroup),this._updateLabelGroup(),this._initialColor=this._mesh.material.color.clone(),this}},{key:"setColor",value:function setColor(e){return this._mesh.material.color.set(e),this}},{key:"isInitialColor",value:function isInitialColor(){return this._initialColor.equals(this._mesh.material.color)}},{key:"resetColor",value:function resetColor(){return this._mesh.material.color.copy(this._initialColor),this}},{key:"isBounced",value:function isBounced(){return 1!==this._mesh.scale.z}},{key:"getBounceFactor",value:function getBounceFactor(){return this._mesh.scale.z}},{key:"bounceUp",value:function bounceUp(e){return this._mesh.scale.setZ(e),this.update(),this}},{key:"bounceDown",value:function bounceDown(){return this.bounceUp(1)}},{key:"addLabel",value:function addLabel(e){var t,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=0,i=0,o=0;if(null!==r&&(n=(t=r).x,i=t.y,o=t.z),null!==e.parent)throw new Error("AdsumWebMap.SpaceObject#addLabel: Changing labelObject parent is not supported yet.");return e.parent=this,this.labels.add(e),e.moveTo(n,i,o),this._labelGroup.add(e._mesh),this.update(),this}},{key:"_raycast",value:function _raycast(e,t){var r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return!1!==h(SpaceObject.prototype.__proto__||Object.getPrototypeOf(SpaceObject.prototype),"_raycast",this).call(this,e,t,r)&&(r&&this.labels.forEach(function(n){n._raycast(e,t,r)}),!0)}},{key:"update",value:function update(){this._labelGroup.scale.z!==1/this.getBounceFactor()&&this._updateLabelGroup(),h(SpaceObject.prototype.__proto__||Object.getPrototypeOf(SpaceObject.prototype),"update",this).call(this)}},{key:"_updateLabelGroup",value:function _updateLabelGroup(){h(SpaceObject.prototype.__proto__||Object.getPrototypeOf(SpaceObject.prototype),"update",this).call(this);var e=this.getSizeAndCenter(!1).size;this._labelGroup.scale.setZ(1/this.getBounceFactor()),this._labelGroup.position.setZ(e.z/this.getBounceFactor()),this._labelGroup.updateMatrixWorld()}}]),SpaceObject}(),_t=function LoaderResult(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;_classCallCheck(this,LoaderResult),this.scene=null,this.site=null,this.buildingsMap=new Map,this.floorsMap=new Map,this.spacesMap=new Map,this.labelsMap=new Map,this.deviceId=e,this.projector=null,this.paths=null},bt={BILLBOARD:"BILLBOARD",STATIC:"STATIC",FLIP:"FLIP"},wt=new n.W,xt=function(e){function LabelObject(){var e;return _classCallCheck(this,LabelObject),(e=_possibleConstructorReturn(this,(LabelObject.__proto__||Object.getPrototypeOf(LabelObject)).call(this))).isLabel=!0,e.parent=null,e.orientationMode=bt.BILLBOARD,e.autoScale=!1,e}return _inherits(LabelObject,M),f(LabelObject,[{key:"getType",value:function getType(){return b.LabelObject}},{key:"_onBeforeRender",value:function _onBeforeRender(e,t,r,i,o,a){h(LabelObject.prototype.__proto__||Object.getPrototypeOf(LabelObject.prototype),"_onBeforeRender",this).call(this,e,t,r,i,o,a);var s=!1;this.orientationMode===bt.BILLBOARD&&(this._mesh.quaternion.setFromRotationMatrix(this._mesh.parent.matrixWorld).inverse(),this._mesh.quaternion.multiply(r.quaternion).normalize(),s=!0);var c=new n.W;this._mesh.getWorldPosition(c);var u=wt.subVectors(r.position,c).length();if(this.autoScale){var l=Math.tan(r.fov*Math.PI/180/2)*u/1e3;this.orientationMode===bt.BILLBOARD?(this._mesh.geometry.computeBoundingBox(),this._mesh.position.z-=this._mesh.geometry.boundingBox.max.y*this._mesh.scale.z,this._mesh.scale.set(l,l,l),this._mesh.position.z+=this._mesh.geometry.boundingBox.max.y*this._mesh.scale.z):this._mesh.scale.set(l,l,1)}s&&this._mesh.updateMatrixWorld()}}]),LabelObject}(),Mt=function(e){function LabelImageObject(){var e;return _classCallCheck(this,LabelImageObject),(e=_possibleConstructorReturn(this,(LabelImageObject.__proto__||Object.getPrototypeOf(LabelImageObject)).call(this))).isLabelImage=!0,e.width=null,e.height=null,e}return _inherits(LabelImageObject,xt),f(LabelImageObject,[{key:"getType",value:function getType(){return b.LabelImageObject}}],[{key:"create",value:function create(e,t,r){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:Symbol("AdsumObjectId"),o=r.width,a=r.height,s=r.orientationMode,c=r.autoScale;return new Promise(function(r,i){t.load(e,function(e){r(new n.x({color:16777215,side:n.l,map:e,transparent:!0,depthWrite:!1}))},void 0,i)}).then(function(e){var t=new n.H(o,a),u=new n.w(t,e),l=LabelImageObject._createFromMesh(u,r,i);if(s)switch(s){case bt.BILLBOARD:case bt.STATIC:l.orientationMode=s;break;default:console.warn("AdsumWebMap.LabelImageObject#create: Unsupported orientation mode "+s)}return c&&(l.autoScale=!0),l})}}]),LabelImageObject}(),St=new Map,Ct={TEXTURE_OVERSAMPLING:5,BACKGROUND_PADDING:10,LINE_HEIGHT_INTERVAL:1.25,renderOnTexture:function renderOnTexture(e,t){var r=null;null===r&&(r=document.createElement("canvas"));var i=t.font,o=t.size,a=t.color,s=t.backgroundColor,c=o+"pt "+(void 0===i?"Arial":i),u=Ct.getFontHeight(c),l=e.length*u,h=r.getContext("2d");h.textBaseline="hanging",h.textAlign="center",h.font=c;var p=0;e.forEach(function(e){p=Math.max(p,h.measureText(e).width)}),r.width=5*(p+10),r.height=5*(l+10),h.clearRect(0,0,r.width,r.height),s&&(h.fillStyle="rgba("+255*s.r+","+255*s.g+","+255*s.b+",0.7)",Ct.fillRectRounded(h,0,0,r.width,r.height,20)),h.scale(5,5),h.textBaseline="hanging",h.font=c,h.textAlign="center",h.fillStyle="rgb("+255*a.r+","+255*a.g+","+255*a.b+")";for(var f=(u-u/1.25)/2,d=0;d<e.length;d++)h.fillText(e[d],Math.round(5+p/2),Math.round(d*u+(d+1)*f+5));var m=new n.c(r);return m.needsUpdate=!0,m},getFontHeight:function getFontHeight(e){if(St.has(e))return St.get(e);var t=null;null===t&&(t=document.createElement("canvas")),t.width=1e3,t.height=500;var r=t.getContext("2d");r.fillStyle="black",r.fillRect(0,0,t.width,t.height),r.textBaseline="top",r.fillStyle="white",r.font=e,r.fillText("gM",0,t.height/2);for(var n=r.getImageData(0,0,t.width,t.height).data,i=-1,o=-1,a=0;a<t.height;a++)for(var s=0;s<t.width;s++)if(0!==n[4*(a*t.width+s)]){-1===i&&(i=a),o=a+1;break}var c=1.25*(o-i);return St.set(e,c),c},fillRectRounded:function fillRectRounded(e,t,r,n,i,o){e.beginPath(),e.moveTo(t+o,r),e.lineTo(t+n-o,r),e.quadraticCurveTo(t+n,r,t+n,r+o),e.lineTo(t+n,r+i-o),e.quadraticCurveTo(t+n,r+i,t+n-o,r+i),e.lineTo(t+o,r+i),e.quadraticCurveTo(t,r+i,t,r+i-o),e.lineTo(t,r+o),e.quadraticCurveTo(t,r,t+o,r),e.closePath(),e.fill()}},Pt=function(e){function LabelTextObject(){var e;return _classCallCheck(this,LabelTextObject),(e=_possibleConstructorReturn(this,(LabelTextObject.__proto__||Object.getPrototypeOf(LabelTextObject)).call(this))).isLabelText=!0,e}return _inherits(LabelTextObject,xt),f(LabelTextObject,[{key:"getType",value:function getType(){return b.LabelTextObject}}],[{key:"create",value:function create(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Symbol("AdsumObjectId"),i=e.split("\n"),o=Ct.renderOnTexture(i,t),a=new n.H(o.image.width/Ct.TEXTURE_OVERSAMPLING,o.image.height/Ct.TEXTURE_OVERSAMPLING),s=new n.x({color:16777215,map:o,side:n.l,transparent:!0,depthWrite:!1}),c=this._createFromMesh(new n.w(a,s),t,r);if(t.orientationMode)switch(t.orientationMode){case bt.BILLBOARD:case bt.STATIC:c.orientationMode=t.orientationMode;break;default:console.warn("AdsumWebMap.LabelImageObject#create: Unsupported orientation mode "+t.orientationMode)}return t.autoScale&&(c.autoScale=!0),c}}]),LabelTextObject}(),Et=new n.W,Tt=function(){function LevelOfDetails(){_classCallCheck(this,LevelOfDetails),this.levels=new Map,this.active=!0,this.currentLevel=null,this.currentDistance=null}return f(LevelOfDetails,[{key:"addLevelState",value:function addLevelState(e,t){this.levels.set(e,t)}},{key:"applyLod",value:function applyLod(e,t){if(this.active){var r=new n.W,i=new n.W;t.getWorldPosition(r),e._mesh.getWorldPosition(i),Et.subVectors(r,i);var o=Et.length();if(this.currentDistance!==o){var a=null,s=null;this.levels.forEach(function(e,t){t>o||null!==s&&t<s||(a=e,s=t)}),null!==s?(this.currentDistance=o,s!==this.currentLevel&&a.apply(e)):console.warn("AdsumWebMap.LevelOfDetails: cannot find LevelState matching, make sure you have a default one which startAt 0")}}}}]),LevelOfDetails}(),Ot=function(){function AbstractLevelState(){_classCallCheck(this,AbstractLevelState)}return f(AbstractLevelState,[{key:"apply",value:function apply(e){}}]),AbstractLevelState}(),At=function(e){function DisplayLevelState(e){var t;return _classCallCheck(this,DisplayLevelState),(t=_possibleConstructorReturn(this,(DisplayLevelState.__proto__||Object.getPrototypeOf(DisplayLevelState)).call(this))).displayMode=e,t}return _inherits(DisplayLevelState,Ot),f(DisplayLevelState,[{key:"apply",value:function apply(e){h(DisplayLevelState.prototype.__proto__||Object.getPrototypeOf(DisplayLevelState.prototype),"apply",this).call(this,e),e.setDisplayMode(this.displayMode)}}]),DisplayLevelState}(),Lt=new n.W,kt=function(){function AdsumProjector(e,t,r){_classCallCheck(this,AdsumProjector),this.matrix=new n.v,this.inverseMatrix=null,this.matrix.set(e[0],e[1],0,t[0],e[3],e[4],0,t[1],0,0,1,0,0,0,0,1);var i=new n.W;i.setFromMatrixScale(this.matrix),this.scale=(i.x+i.y)/2;var o=u.a.fromDegree(r.latitude,r.longitude,0);this.utmGridZone=new u.d(o)}return f(AdsumProjector,null,[{key:"createFake",value:function createFake(){return new this([1,0,0,0,1,0],[0,0,0],{latitude:0,longitude:0})}}]),f(AdsumProjector,[{key:"meterToAdsumDistance",value:function meterToAdsumDistance(e){return e*this.scale}},{key:"adsumDistanceToMeter",value:function adsumDistanceToMeter(e){return e/this.scale}},{key:"gpsToAdsum",value:function gpsToAdsum(e){return this.utmToAdsum(this.gpsToUtm(e))}},{key:"gpsToUtm",value:function gpsToUtm(e){var t=e.lat,r=e.long,n=e.alt;return u.b.toUtm(u.a.fromDegree(t,r,n),this.utmGridZone)}},{key:"utmToAdsum",value:function utmToAdsum(e){var t=e.E,r=e.N,i=e.alt,o=new n.W(t,r,i);return o.applyMatrix4(this.matrix),o}},{key:"adsumToGps",value:function adsumToGps(e){return this.utmToGps(this.adsumToUtm(e))}},{key:"adsumToUtm",value:function adsumToUtm(e){return null===this.inverseMatrix&&(this.inverseMatrix=new n.v,this.inverseMatrix.getInverse(this.matrix)),Lt.copy(e),Lt.applyMatrix4(this.inverseMatrix),new u.c(Lt.x,Lt.y,Lt.z,this.utmGridZone.hemi,this.utmGridZone.zone)}},{key:"utmToGps",value:function utmToGps(e){return u.b.toGps(e)}}]),AdsumProjector}(),Rt=function(){function AdsumLoader(e){_classCallCheck(this,AdsumLoader),this.options=new pt(e),this.isAoMap=!0,this.result=new _t(e.deviceId),this.adsumTextureLoader=null,this._registerAdsumTextureLoader()}return f(AdsumLoader,[{key:"load",value:function load(){var e=this;return this._startEntityManagerLoading(),this._registerAdsumTextureLoader().then(function(){return Promise.all([e._loadCollada(),e._loadProjectorTransform().then(function(){return e._loadLabels()}),e._loadPaths()])}).then(function(){return e._loadLabels()}).then(function(){return e._addLabels()}).then(function(){return e.result.scene.updateMatrixWorld(!0),e.result})}},{key:"_loadCollada",value:function _loadCollada(){var e=this,t=this.options.entityManager.getRepository("File"),r=this.options.entityManager.getRepository("MapFile"),n=this.options.entityManager.getRepository("Place");return Promise.all([t.load(),r.load()]).then(function(){var t=e._getColladaUri();return Promise.all([e._parseCollada(t),n.load()])}).then(function(t){var r=l(t,1)[0].scene;e.result.scene=r,e._parseAndTransformAdsumScene(r,n),e._adjustSceneSettings()})}},{key:"loadCalibration",value:function loadCalibration(e){var t=this.options.entityManager.getRepository("SiteCalibration"),r=this.options.entityManager.getRepository("FloorCalibration");return Promise.all([t.load(),r.load()]).then(function(){var n=t.findOneBy({device:function device(t){return t.is(e)}}),i=null,o=null,a=new Map;if(null!==n&&(r.getList(n.floor_calibrations).forEach(function(e){var t=new Ve;t.eye.copy(e.eye),t.up.copy(e.up),t.target.copy(e.target),t.zoomMin=e.zoom_min||Be.ZOOM_MIN,t.zoomMax=e.zoom_max||Be.ZOOM_MAX;var r=-1===e.floor_id?null:e.floor_id;a.set(r,t)}),i=-1===n.start_floor?null:n.start_floor,null!==n.start_point_floor)){var s=n.start_point_floor;o={floorId:-1!==s?s:null,position:n.start_point_position}}return{cameraCalibrations:a,defaultFloorId:i,userPosition:o}})}},{key:"_loadLabels",value:function _loadLabels(){var e=this,t=this.options.entityManager.getRepository("CustomObject"),r=this.options.entityManager.getRepository("File");return Promise.all([t.load(),r.load()]).then(function(){var i=[];return t.getAll().forEach(function(t){var o={orientationMode:t.orientation_mode,autoScale:t.autoscale,placeId:t.place.value};if(0!==t.priority){var a=new Tt;a.addLevelState(0,new At(m)),a.addLevelState(200*t.priority,new At(d)),o.levelOfDetails=a}if(t.type===c.b.PICTO){var s=r.get(t.file);o.width=t.width,o.height=t.height,i.push(Mt.create(s.uri,e.adsumTextureLoader,o,t.id))}else{var u=t.label.replace(/<br[ ]*\/?>/gi,"\n");o.font=t.font,o.size=t.font_size,o.color=new n.f(t.font_color),o.backgroundColor=null===t.background_color?null:new n.f(t.background_color),i.push(Promise.resolve(Pt.create(u,o,t.id)))}}),Promise.all(i).then(function(t){t.forEach(function(t){e.result.labelsMap.set(t.id,t)})})})}},{key:"_startEntityManagerLoading",value:function _startEntityManagerLoading(){this.options.entityManager.getRepository("Site").load(),this.options.entityManager.getRepository("MapFile").load(),this.options.entityManager.getRepository("File").load(),this.options.entityManager.getRepository("Place").load(),this.options.entityManager.getRepository("CustomObject").load(),this.options.entityManager.getRepository("SiteCalibration").load(),this.options.entityManager.getRepository("FloorCalibration").load()}},{key:"_registerAdsumTextureLoader",value:function _registerAdsumTextureLoader(){var e=this;return this.options.entityManager.getRepository("File").load().then(function(){e.adsumTextureLoader=new ft(e.options.entityManager.getRepository("File"),e.isAoMap),n.s.Handlers.add(e.adsumTextureLoader.regex,e.adsumTextureLoader)})}},{key:"_getColladaUri",value:function _getColladaUri(){var e=this.options.entityManager.getRepository("File"),t=this.options.entityManager.getRepository("MapFile"),r=t.findOneBy({type:c.f.AO_DAE,file:function file(e){return null!==e.value}}),n=null;if(this.isAoMap&&null!==r)n=r.file;else{var i=t.findOneBy({type:c.f.DAE,file:function file(e){return null!==e.value}});if(null===i)throw new Error("AdsumWebMap.AdsumLoader: No map found");n=i.file,this.isAoMap=!1}return e.get(n).uri}},{key:"_parseCollada",value:function _parseCollada(e){return new Promise(function(t,r){return(new function AdsumColladaLoader(){var e=void 0,r=void 0,n=null,i=null,a=null,s={},c=void 0,u=void 0,l=void 0,h=void 0,p=void 0,f=void 0,d=void 0,m={},g={},y={},_={},b={},w={},M={},E={},T={centerGeometry:!1,convertUpAxis:!1,subdivideFaces:!0,upAxis:"Y",defaultEnvMap:null},O=1,ke="Y",Re=null;function v(t,o,s){if(n=(new DOMParser).parseFromString(t,"text/xml"),o=o||a,void 0!==s){var v=s.split("/");v.pop(),p=(v.length<1?".":v.join("/"))+"/"}!function(){var e=n.querySelectorAll("asset")[0];if(e&&e.childNodes)for(var t=0;t<e.childNodes.length;t++){var r=e.childNodes[t];switch(r.nodeName){case"unit":var i=r.getAttribute("meter");i&&(O=parseFloat(i));break;case"up_axis":ke=r.textContent.charAt(0)}}}(),function(){if(!0!==T.convertUpAxis||ke===T.upAxis)Re=null;else switch(ke){case"X":Re="Y"===T.upAxis?"XtoY":"XtoZ";break;case"Y":Re="X"===T.upAxis?"YtoX":"YtoZ";break;case"Z":Re="X"===T.upAxis?"ZtoX":"ZtoY"}}(),m=x("library_images image",I,"image"),b=x("library_materials material",se,"material"),w=x("library_effects effect",re,"effect"),_=x("library_geometries geometry",W,"geometry"),M=x("library_cameras camera",pe,"camera"),E=x("library_lights light",ge,"light"),y=x("library_controllers controller",D,"controller"),g=x("library_animations animation",ce,"animation"),l=x("library_visual_scenes visual_scene",F,"visual_scene"),h=x("library_kinematics_models kinematics_model",be,"kinematics_model"),f=[],d=[],e=function(){var e=n.querySelectorAll("scene instance_visual_scene")[0];if(e){var t=e.getAttribute("url").replace(/^#/,"");return l[t.length>0?t:"visual_scene0"]}return null}(),i=new dt.Scene;for(var S=0;S<e.nodes.length;S++)i.add(j(e.nodes[S]));i.scale.multiplyScalar(O),c=[],function t(r){var n=e.getChildById(r.colladaId,!0),i=null;if(n&&n.keys){i={fps:60,hierarchy:[{node:n,keys:n.keys,sids:n.sids}],node:r,name:"animation_"+r.name,length:0},c.push(i);for(var o=0,a=n.keys.length;o<a;o++)i.length=Math.max(i.length,n.keys[o].time)}else i={hierarchy:[{keys:[],sids:[]}]};for(o=0,a=r.children.length;o<a;o++)for(var s=0,u=t(r.children[o]).hierarchy.length;s<u;s++)i.hierarchy.push({keys:[],sids:[]});return i}(i),r=function(){var e=n.querySelectorAll("instance_kinematics_model")[0];if(e){var t=e.getAttribute("url").replace(/^#/,"");return h[t.length>0?t:"kinematics_model0"]}return null}(),function(){if(r&&0===r.joints.length)u=void 0;else{var t={},a=function o(n,a){var s=a.getAttribute("id"),c=e.getChildById(s,!0),u=r.joints[n];i.traverse(function(e){e.colladaId==s&&(t[n]={node:e,transforms:c.transforms,joint:u,position:u.zeroPosition})})};u={joints:r&&r.joints,getJointValue:function getJointValue(e){var r=t[e];if(r)return r.position;console.log("getJointValue: joint "+e+" doesn't exist")},setJointValue:function setJointValue(e,r){var n=t[e];if(n){var i=n.joint;if(r>i.limits.max||r<i.limits.min)console.log("setJointValue: joint "+e+" value "+r+" outside of limits (min: "+i.limits.min+", max: "+i.limits.max+")");else if(i.static)console.log("setJointValue: joint "+e+" is static");else{var o=n.node,a=i.axis,s=n.transforms,u=new dt.Matrix4,l=new dt.Matrix4;for(c=0;c<s.length;c++){var h=s[c];if(h.sid&&-1!==h.sid.indexOf("joint"+e))switch(i.type){case"revolute":u.multiply(l.makeRotationAxis(a,dt.Math.degToRad(r)));break;case"prismatic":u.multiply(l.makeTranslation(a.x*r,a.y*r,a.z*r));break;default:console.warn("setJointValue: unknown joint type: "+i.type)}else switch(h.type){case"matrix":u.multiply(h.obj);break;case"translate":u.multiply(l.makeTranslation(h.obj.x,h.obj.y,h.obj.z));break;case"rotate":u.multiply(l.makeRotationAxis(h.obj,h.angle))}}var p=u.elements,f=Array.prototype.slice.call(p),d=[f[0],f[4],f[8],f[12],f[1],f[5],f[9],f[13],f[2],f[6],f[10],f[14],f[3],f[7],f[11],f[15]];o.matrix.set.apply(o.matrix,d),o.matrix.decompose(o.position,o.quaternion,o.scale),t[e].position=r}}else console.log("setJointValue: joint "+e+" doesn't exist")}};var s=n.querySelector("scene instance_kinematics_scene");if(s)for(var c=0;c<s.childNodes.length;c++){var l=s.childNodes[c];if(1==l.nodeType)switch(l.nodeName){case"bind_joint_axis":var h=l.getAttribute("target").split("/").pop(),p=l.querySelector("axis param").textContent,f=parseInt(p.split("joint").pop().split(".")[0]),d=n.querySelector('[sid="'+h+'"]');d&&a(f,d.parentElement)}}}}();var C={scene:i,morphs:f,skins:d,animations:c,kinematics:u,dae:{images:m,materials:b,cameras:M,lights:E,effects:w,geometries:_,controllers:y,animations:g,visualScenes:l,visualScene:e,scene:e,kinematicsModels:h,kinematicsModel:r}};return o&&o(C),C}function x(e,t,r){for(var i=n.querySelectorAll(e),o={},a=0,s=i.length,c=0;c<s;c++){var u=i[c],l=(new t).parse(u);l.id&&0!==l.id.length||(l.id=r+a++),o[l.id]=l}return o}function A(e,t){var r=t instanceof z?y[t.url]:t;if(r&&r.morph){for(var n=r.morph,i=0;i<n.targets.length;i++){var o=n.targets[i],a=_[o];if(a.mesh&&a.mesh.primitives&&a.mesh.primitives.length){var s=a.mesh.primitives[0].geometry;s.vertices.length===e.vertices.length&&e.morphTargets.push({name:"target_1",vertices:s.vertices})}}e.morphTargets.push({name:"target_Z",vertices:e.vertices})}else console.log("could not find morph controller!")}function S(e,t,r,n){if(e.world=e.world||new dt.Matrix4,e.localworld=e.localworld||new dt.Matrix4,e.world.copy(e.matrix),e.localworld.copy(e.matrix),e.channels&&e.channels.length){var i=e.channels[0].sampler.output[r];i instanceof dt.Matrix4&&(e.world.copy(i),e.localworld.copy(i),0===r&&e.matrix.copy(i))}n&&e.world.multiplyMatrices(n,e.world),t.push(e);for(var o=0;o<e.nodes.length;o++)S(e.nodes[o],t,r,e.world)}function N(e,t){for(var r=0;r<e.length;r++){var n=e[r],i=-1;if("JOINT"==n.type){for(var o=0;o<t.joints.length;o++)if(n.sid===t.joints[o]){i=o;break}if(i>=0){var a=t.invBindMatrices[i];for(n.invBindMatrix=a,n.skinningMatrix=new dt.Matrix4,n.skinningMatrix.multiplyMatrices(n.world,a),n.animatrix=new dt.Matrix4,n.animatrix.copy(n.localworld),n.weights=[],o=0;o<t.weights.length;o++)for(var s=0;s<t.weights[o].length;s++){var c=t.weights[o][s];c.joint===i&&n.weights.push(c)}}else console.warn("ColladaLoader: Could not find joint '"+n.sid+"'."),n.skinningMatrix=new dt.Matrix4,n.weights=[]}}}function L(t,r,n){void 0===n&&(n=40);var i=y[r.url];if(i&&i.skin)if(r.skeleton&&r.skeleton.length){for(var o=function(){var e=void 0,t=1e6,r=-t,n=0;for(var i in g){var o=g[i];e=e||o.id;for(var a=0;a<o.sampler.length;a++){var s=o.sampler[a];s.create(),t=Math.min(t,s.startTime),r=Math.max(r,s.endTime),n=Math.max(n,s.input.length)}}return{start:t,end:r,frames:n,ID:e}}(),a=e.getChildById(r.skeleton[0],!0)||e.getChildBySid(r.skeleton[0],!0),s=function(e){var t=[];return function s(e,t,r){var n={};n.name=t.sid,n.parent=e,n.matrix=t.matrix;var i=[new dt.Vector3,new dt.Quaternion,new dt.Vector3];for(var o in n.matrix.decompose(i[0],i[1],i[2]),n.pos=[i[0].x,i[0].y,i[0].z],n.scl=[i[2].x,i[2].y,i[2].z],n.rotq=[i[1].x,i[1].y,i[1].z,i[1].w],r.push(n),t.nodes)s(t.sid,t.nodes[o],r)}(-1,a,t),t}(),c=i.skin.joints,u=[],l=0;l<c.length;l++)for(var h=0;h<s.length;h++)s[h].name===c[l]&&(u[l]=s[h]);for(l=0;l<u.length;l++)for(h=0;h<u.length;h++)u[l].parent===u[h].name&&(u[l].parent=h);for(new dt.Vector3,l=0;l<t.vertices.length;l++)t.vertices[l].applyMatrix4(i.skin.bindShapeMatrix);var p=[],f=[],d=i.skin.weights;for(l=0;l<d.length;l++){var m=new dt.Vector4(d[l][0]?d[l][0].joint:0,d[l][1]?d[l][1].joint:0,d[l][2]?d[l][2].joint:0,d[l][3]?d[l][3].joint:0),v=new dt.Vector4(d[l][0]?d[l][0].weight:0,d[l][1]?d[l][1].weight:0,d[l][2]?d[l][2].weight:0,d[l][3]?d[l][3].weight:0);p.push(m),f.push(v)}t.skinIndices=p,t.skinWeights=f,t.bones=u;var _={name:o.ID,fps:30,length:o.frames/30,hierarchy:[]};for(h=0;h<u.length;h++)_.hierarchy.push({parent:u[h].parent,name:u[h].name,keys:[]});for(console.log("ColladaLoader:",o.ID+" has "+u.length+" bones."),function(e,t,r){var n=[];S(t,n,-1),N(n,r.skin);for(var i=new dt.Vector3,o=[],a=0;a<e.vertices.length;a++)o.push(new dt.Vector3);for(a=0;a<n.length;a++)if("JOINT"==n[a].type)for(var s=0;s<n[a].weights.length;s++){var c=n[a].weights[s],u=c.index,l=c.weight,h=e.vertices[u],p=o[u];i.x=h.x,i.y=h.y,i.z=h.z,i.applyMatrix4(n[a].skinningMatrix),p.x+=i.x*l,p.y+=i.y*l,p.z+=i.z*l}for(a=0;a<e.vertices.length;a++)e.vertices[a]=o[a]}(t,a,i),n=0;n<o.frames;n++){var b=[];for(S(a,b,n),N(b,i.skin),l=0;l<b.length;l++)for(h=0;h<_.hierarchy.length;h++)if(_.hierarchy[h].name===b[l].sid){var w={};w.time=n/30,w.matrix=b[l].animatrix,0===n&&(b[l].matrix=w.matrix);var x=[new dt.Vector3,new dt.Quaternion,new dt.Vector3];w.matrix.decompose(x[0],x[1],x[2]),w.pos=[x[0].x,x[0].y,x[0].z],w.scl=[x[2].x,x[2].y,x[2].z],w.rot=x[1],_.hierarchy[h].keys.push(w)}t.animation=_}}else console.log("ColladaLoader: Could not find the skeleton for the skin. ");else console.log("ColladaLoader: Could not find skin controller.")}function j(e,t){var r=new dt.Object3D,n=void 0,i=void 0,o=void 0,a=void 0;for(o=0;o<e.controllers.length;o++){var s=y[e.controllers[o].url];switch(s.type){case"skin":if(_[s.skin.source])(u=new G).url=s.skin.source,u.instance_material=e.controllers[o].instance_material,e.geometries.push(u),n=e.controllers[o];else if(y[s.skin.source]){var c=y[s.skin.source];i=c,c.morph&&_[c.morph.source]&&((u=new G).url=c.morph.source,u.instance_material=e.controllers[o].instance_material,e.geometries.push(u))}break;case"morph":var u;_[s.morph.source]&&((u=new G).url=s.morph.source,u.instance_material=e.controllers[o].instance_material,e.geometries.push(u),i=e.controllers[o]),console.log("ColladaLoader: Morph-controller partially supported.")}}var l={};for(o=0;o<e.geometries.length;o++){var h,p=e.geometries[o],m=p.instance_material,g=_[p.url],v={},x=[],S=0;if(g){if(!g.mesh||!g.mesh.primitives)continue;if(0===r.name.length&&(r.name=g.id),m)for(a=0;a<m.length;a++){var C=m[a],P=b[C.target],O=P.instance_effect.url,k=w[O].shader.material;if(g.doubleSided){if(!(C.symbol in l)){var R=k.clone();R.side=dt.DoubleSide,l[C.symbol]=R}k=l[C.symbol]}k.opacity=k.opacity?k.opacity:1,v[C.symbol]=S,x.push(k),(h=k).name=null===P.name||""===P.name?P.id:P.name,S++}var I,N=h||new dt.MeshLambertMaterial({color:14540253,side:g.doubleSided?dt.DoubleSide:dt.FrontSide}),F=g.mesh.geometry3js;if(S>1)for(N=new dt.MultiMaterial(x),a=0;a<F.faces.length;a++){var B=F.faces[a];B.materialIndex=v[B.daeMaterial]}void 0!==n?(L(F,n),F.morphTargets.length>0?(N.morphTargets=!0,N.skinning=!1):(N.morphTargets=!1,N.skinning=!0),(I=new dt.SkinnedMesh(F,N,!1)).name="skin_"+d.length,d.push(I)):void 0!==i?(A(F,i),N.morphTargets=!0,(I=new dt.Mesh(F,N)).name="morph_"+f.length,f.push(I)):I=!0===F.isLineStrip?new dt.Line(F):new dt.Mesh(F,N),r.add(I)}}for(o=0;o<e.cameras.length;o++){var V=e.cameras[o],D=M[V.url],U=new dt.PerspectiveCamera(D.yfov,parseFloat(D.aspect_ratio),parseFloat(D.znear),parseFloat(D.zfar));r.add(U)}for(o=0;o<e.lights.length;o++){var z=null,H=e.lights[o],W=E[H.url];if(W&&W.technique){var q=W.color.getHex(),X=W.intensity,Y=W.distance,J=W.falloff_angle;switch(W.technique){case"directional":(z=new dt.DirectionalLight(q,X,Y)).position.set(0,0,1);break;case"point":z=new dt.PointLight(q,X,Y);break;case"spot":(z=new dt.SpotLight(q,X,Y,J)).position.set(0,0,1);break;case"ambient":z=new dt.AmbientLight(q)}}z&&r.add(z)}if(r.name=e.name||e.id||"",r.colladaId=e.id||"",r.layer=e.layer||"",r.matrix=e.matrix,r.matrix.decompose(r.position,r.quaternion,r.scale),T.centerGeometry&&r.geometry){var Z=new dt.Vector3;object.geometry.computeBoundingBox(),object.geometry.boundingBox.getCenter(Z),r.geometry.center(),Z.multiply(r.scale),Z.applyQuaternion(r.quaternion),r.position.add(Z)}for(o=0;o<e.nodes.length;o++)r.add(j(e.nodes[o]));return r}function C(e){for(var t=n.querySelectorAll("library_nodes node"),r=0;r<t.length;r++){var i=t[r].attributes.getNamedItem("id");if(i&&i.value===e)return t[r]}}function P(e,t){for(var r=null,n=0,i=e.length;n<i&&null===r;n++){var o=e[n];if(o.time===t)r=o;else if(o.time>t)break}return r}function R(e,t){for(var r=-1,n=0,i=e.length;n<i&&-1===r;n++)e[n].time>=t&&(r=n);return r}function k(e,t,r,n){var i=function(e,t,r){for(r=r>=0?r:r+e.length;r>=0;r--){var n=e[r];if(n.hasTarget(t))return n}return null}(e,n,r?r-1:0),o=function(e,t,r){for(;r<e.length;r++){var n=e[r];if(n.hasTarget(t))return n}return null}(e,n,r+1);if(i&&o){var a=void 0,s=(t.time-i.time)/(o.time-i.time),c=i.getTarget(n),u=o.getTarget(n).data,l=c.data;if("matrix"===c.type)a=l;else if(l.length){a=[];for(var h=0;h<l.length;++h)a[h]=l[h]+(u[h]-l[h])*s}else a=l+(u-l)*s;t.addTarget(n,c.transform,c.member,a)}}function I(){this.id="",this.init_from=""}function D(){this.id="",this.name="",this.type="",this.skin=null,this.morph=null}function B(){this.method=null,this.source=null,this.targets=null,this.weights=null}function H(){this.source="",this.bindShapeMatrix=null,this.invBindMatrices=[],this.joints=[],this.weights=[]}function F(){this.id="",this.name="",this.nodes=[],this.scene=new dt.Group}function U(){this.id="",this.name="",this.sid="",this.nodes=[],this.controllers=[],this.transforms=[],this.geometries=[],this.channels=[],this.matrix=new dt.Matrix4}function $(){this.sid="",this.type="",this.data=[],this.obj=null}function z(){this.url="",this.skeleton=[],this.instance_material=[]}function V(){this.symbol="",this.target=""}function G(){this.url="",this.instance_material=[]}function W(){this.id="",this.mesh=null}function Y(e){this.geometry=e.id,this.primitives=[],this.vertices=null,this.geometry3js=null}function Z(){this.material="",this.count=0,this.inputs=[],this.vcount=null,this.p=[],this.geometry=new dt.Geometry}function X(){Z.call(this),this.vcount=[]}function q(){Z.call(this),this.vcount=1}function J(){Z.call(this),this.vcount=3}function K(){this.source="",this.count=0,this.stride=0,this.params=[]}function Q(){this.input={}}function ee(){this.semantic="",this.offset=0,this.source="",this.set=0}function te(e){this.id=e,this.type=null}function se(){this.id="",this.name="",this.instance_effect=null}function ie(){this.color=new dt.Color,this.color.setRGB(Math.random(),Math.random(),Math.random()),this.color.a=1,this.texture=null,this.texcoord=null,this.texOpts=null}function ne(e,t){this.type=e,this.effect=t,this.material=null}function oe(e){this.effect=e,this.init_from=null,this.format=null}function ae(e){this.effect=e,this.source=null,this.wrap_s=null,this.wrap_t=null,this.minfilter=null,this.magfilter=null,this.mipfilter=null}function re(){this.id="",this.name="",this.shader=null,this.surface={},this.sampler={}}function le(){this.url=""}function ce(){this.id="",this.name="",this.source={},this.sampler=[],this.channel=[]}function he(e){this.animation=e,this.source="",this.target="",this.fullSid=null,this.sid=null,this.dotSyntax=null,this.arrSyntax=null,this.arrIndices=null,this.member=null}function de(e){this.id="",this.animation=e,this.inputs=[],this.input=null,this.output=null,this.strideOut=null,this.interpolation=null,this.startTime=null,this.endTime=null,this.duration=0}function ue(e){this.targets=[],this.time=e}function pe(){this.id="",this.name="",this.technique=""}function me(){this.url=""}function ge(){this.id="",this.name="",this.technique=""}function fe(){this.url=""}function be(){this.id="",this.name="",this.joints=[],this.links=[]}function ye(){this.sid="",this.name="",this.axis=new dt.Vector3,this.limits={min:0,max:0},this.type="",this.static=!1,this.zeroPosition=0,this.middlePosition=0}function Ee(){this.sid="",this.name="",this.transforms=[],this.attachments=[]}function we(){this.joint="",this.transforms=[],this.links=[]}function Me(e){var t=e.getAttribute("id");return void 0!=s[t]?s[t]:(s[t]=new te(t).parse(e),s[t])}function _e(e){for(var t=ve(e),r=[],n=0,i=t.length;n<i;n++)r.push(!("true"!==t[n]&&"1"!==t[n]));return r}function Te(e){for(var t=ve(e),r=[],n=0,i=t.length;n<i;n++)r.push(parseFloat(t[n]));return r}function Oe(e){for(var t=ve(e),r=[],n=0,i=t.length;n<i;n++)r.push(parseInt(t[n],10));return r}function ve(e){return e.length>0?function(e){return e.replace(/^\s+/,"").replace(/\s+$/,"")}(e).split(/\s+/):[]}function xe(e,t,r){return e.hasAttribute(t)?parseInt(e.getAttribute(t),10):r}function Ae(e,t){(new dt.ImageLoader).load(t,function(t){e.image=t,e.needsUpdate=!0})}function Se(e,t){e.doubleSided=!1;var r=t.querySelectorAll("extra double_sided")[0];r&&r&&1===parseInt(r.textContent,10)&&(e.doubleSided=!0)}function Ne(e,t){if(!0===T.convertUpAxis&&ke!==T.upAxis)switch(Re){case"XtoY":var r=e[0];e[0]=t*e[1],e[1]=r;break;case"XtoZ":r=e[2],e[2]=e[1],e[1]=e[0],e[0]=r;break;case"YtoX":r=e[0],e[0]=e[1],e[1]=t*r;break;case"YtoZ":r=e[1],e[1]=t*e[2],e[2]=r;break;case"ZtoX":r=e[0],e[0]=e[1],e[1]=e[2],e[2]=r;break;case"ZtoY":r=e[1],e[1]=e[2],e[2]=t*r}}function Le(e,t){var r=[e[t],e[t+1],e[t+2]];return Ne(r,-1),new dt.Vector3(r[0],r[1],r[2])}function je(e){if(T.convertUpAxis){var t=[e[0],e[4],e[8]];Ne(t,-1),e[0]=t[0],e[4]=t[1],e[8]=t[2],Ne(t=[e[1],e[5],e[9]],-1),e[1]=t[0],e[5]=t[1],e[9]=t[2],Ne(t=[e[2],e[6],e[10]],-1),e[2]=t[0],e[6]=t[1],e[10]=t[2],Ne(t=[e[0],e[1],e[2]],-1),e[0]=t[0],e[1]=t[1],e[2]=t[2],Ne(t=[e[4],e[5],e[6]],-1),e[4]=t[0],e[5]=t[1],e[6]=t[2],Ne(t=[e[8],e[9],e[10]],-1),e[8]=t[0],e[9]=t[1],e[10]=t[2],Ne(t=[e[3],e[7],e[11]],-1),e[3]=t[0],e[7]=t[1],e[11]=t[2]}return(new dt.Matrix4).set(e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8],e[9],e[10],e[11],e[12],e[13],e[14],e[15])}function Ce(e){return e>-1&&e<3&&(e={X:0,Y:1,Z:2}[e=Pe(["X","Y","Z"][e])]),e}function Pe(e){if(T.convertUpAxis)switch(e){case"X":switch(Re){case"XtoY":case"XtoZ":case"YtoX":e="Y";break;case"ZtoX":e="Z"}break;case"Y":switch(Re){case"XtoY":case"YtoX":case"ZtoX":e="X";break;case"XtoZ":case"YtoZ":case"ZtoY":e="Z"}break;case"Z":switch(Re){case"XtoZ":e="X";break;case"YtoZ":case"ZtoX":case"ZtoY":e="Y"}}return e}return I.prototype.parse=function(e){this.id=e.getAttribute("id");for(var t=0;t<e.childNodes.length;t++){var r=e.childNodes[t];"init_from"===r.nodeName&&(this.init_from=r.textContent)}return this},D.prototype.parse=function(e){this.id=e.getAttribute("id"),this.name=e.getAttribute("name"),this.type="none";for(var t=0;t<e.childNodes.length;t++){var r=e.childNodes[t];switch(r.nodeName){case"skin":this.skin=(new H).parse(r),this.type=r.nodeName;break;case"morph":this.morph=(new B).parse(r),this.type=r.nodeName}}return this},B.prototype.parse=function(e){var t={},r=void 0,n=[];for(this.method=e.getAttribute("method"),this.source=e.getAttribute("source").replace(/^#/,""),r=0;r<e.childNodes.length;r++){var i=e.childNodes[r];if(1==i.nodeType)switch(i.nodeName){case"source":t[(a=(new te).parse(i)).id]=a;break;case"targets":n=this.parseInputs(i);break;default:console.log(i.nodeName)}}for(r=0;r<n.length;r++){var o=n[r],a=t[o.source];switch(o.semantic){case"MORPH_TARGET":this.targets=a.read();break;case"MORPH_WEIGHT":this.weights=a.read()}}return this},B.prototype.parseInputs=function(e){for(var t=[],r=0;r<e.childNodes.length;r++){var n=e.childNodes[r];if(1==n.nodeType)switch(n.nodeName){case"input":t.push((new ee).parse(n))}}return t},H.prototype.parse=function(e){var t={},r=void 0,n=void 0;this.source=e.getAttribute("source").replace(/^#/,""),this.invBindMatrices=[],this.joints=[],this.weights=[];for(var i=0;i<e.childNodes.length;i++){var o=e.childNodes[i];if(1==o.nodeType)switch(o.nodeName){case"bind_shape_matrix":var a=Te(o.textContent);this.bindShapeMatrix=je(a);break;case"source":var s=(new te).parse(o);t[s.id]=s;break;case"joints":r=o;break;case"vertex_weights":n=o;break;default:console.log(o.nodeName)}}return this.parseJoints(r,t),this.parseWeights(n,t),this},H.prototype.parseJoints=function(e,t){for(var r=0;r<e.childNodes.length;r++){var n=e.childNodes[r];if(1==n.nodeType)switch(n.nodeName){case"input":var i=(new ee).parse(n),o=t[i.source];"JOINT"===i.semantic?this.joints=o.read():"INV_BIND_MATRIX"===i.semantic&&(this.invBindMatrices=o.read())}}},H.prototype.parseWeights=function(e,t){for(var r=void 0,n=void 0,i=[],o=0;o<e.childNodes.length;o++){var a=e.childNodes[o];if(1==a.nodeType)switch(a.nodeName){case"input":i.push((new ee).parse(a));break;case"v":r=Oe(a.textContent);break;case"vcount":n=Oe(a.textContent)}}var s=0;for(o=0;o<n.length;o++){for(var c=n[o],u=[],l=0;l<c;l++){for(var h={},p=0;p<i.length;p++){var f=i[p],d=r[s+f.offset];switch(f.semantic){case"JOINT":h.joint=d;break;case"WEIGHT":h.weight=t[f.source].data[d]}}u.push(h),s+=i.length}for(l=0;l<u.length;l++)u[l].index=o;this.weights.push(u)}},F.prototype.getChildById=function(e,t){for(var r=0;r<this.nodes.length;r++){var n=this.nodes[r].getChildById(e,t);if(n)return n}return null},F.prototype.getChildBySid=function(e,t){for(var r=0;r<this.nodes.length;r++){var n=this.nodes[r].getChildBySid(e,t);if(n)return n}return null},F.prototype.parse=function(e){this.id=e.getAttribute("id"),this.name=e.getAttribute("name"),this.nodes=[];for(var t=0;t<e.childNodes.length;t++){var r=e.childNodes[t];if(1==r.nodeType)switch(r.nodeName){case"node":this.nodes.push((new U).parse(r))}}return this},U.prototype.getChannelForTransform=function(e){for(var t=0;t<this.channels.length;t++){var r=this.channels[t],n=r.target.split("/");n.shift();var i,o=n.shift(),a=o.indexOf(".")>=0,s=o.indexOf("(")>=0;if(a)o=(n=o.split(".")).shift();else if(s){o=(i=o.split("(")).shift();for(var c=0;c<i.length;c++)i[c]=parseInt(i[c].replace(/\)/,""))}if(o===e)return r.info={sid:o,dotSyntax:a,arrSyntax:s,arrIndices:i},r}return null},U.prototype.getChildById=function(e,t){if(this.id===e)return this;if(t)for(var r=0;r<this.nodes.length;r++){var n=this.nodes[r].getChildById(e,t);if(n)return n}return null},U.prototype.getChildBySid=function(e,t){if(this.sid===e)return this;if(t)for(var r=0;r<this.nodes.length;r++){var n=this.nodes[r].getChildBySid(e,t);if(n)return n}return null},U.prototype.getTransformBySid=function(e){for(var t=0;t<this.transforms.length;t++)if(this.transforms[t].sid===e)return this.transforms[t];return null},U.prototype.parse=function(e){this.id=e.getAttribute("id"),this.sid=e.getAttribute("sid"),this.name=e.getAttribute("name"),this.type=e.getAttribute("type"),this.layer=e.getAttribute("layer"),this.type="JOINT"===this.type?this.type:"NODE",this.nodes=[],this.transforms=[],this.geometries=[],this.cameras=[],this.lights=[],this.controllers=[],this.matrix=new dt.Matrix4;for(var t=0;t<e.childNodes.length;t++){var r=e.childNodes[t];if(1==r.nodeType)switch(r.nodeName){case"node":this.nodes.push((new U).parse(r));break;case"instance_camera":this.cameras.push((new me).parse(r));break;case"instance_controller":this.controllers.push((new z).parse(r));break;case"instance_geometry":this.geometries.push((new G).parse(r));break;case"instance_light":this.lights.push((new fe).parse(r));break;case"instance_node":var n=C(r.getAttribute("url").replace(/^#/,""));n&&this.nodes.push((new U).parse(n));break;case"rotate":case"translate":case"scale":case"matrix":case"lookat":case"skew":this.transforms.push((new $).parse(r));break;case"extra":break;default:console.log(r.nodeName)}}return this.channels=function(e){var t=[],r=1e6,n=-1e6;for(var i in g)for(var o=g[i],a=0;a<o.channel.length;a++){var s=o.channel[a],c=o.sampler[a];(i=s.target.split("/")[0])==e.id&&(c.create(),s.sampler=c,r=Math.min(r,c.startTime),n=Math.max(n,c.endTime),t.push(s))}return t.length&&(e.startTime=r,e.endTime=n),t}(this),function(e){if(e.channels&&e.channels.length){for(var t=[],r=[],n=0,i=e.channels.length;n<i;n++){var o,a=e.channels[n],s=a.fullSid,c=a.sampler,u=c.input,l=e.getTransformBySid(a.sid);if(a.arrIndices){o=[];for(var h=0,p=a.arrIndices.length;h<p;h++)o[h]=Ce(a.arrIndices[h])}else o=Pe(a.member);if(l)for(-1===r.indexOf(s)&&r.push(s),h=0,p=u.length;h<p;h++){var f=u[h],d=c.getData(l.type,h,o);if(!(y=P(t,f))){y=new ue(f);var m=R(t,f);t.splice(-1===m?t.length:m,0,y)}y.addTarget(s,l,o,d)}else console.log('Could not find transform "'+a.sid+'" in node '+e.id)}for(n=0;n<r.length;n++){var g=r[n];for(h=0;h<t.length;h++){var y;(y=t[h]).hasTarget(g)||k(t,y,h,g)}}e.keys=t,e.sids=r}}(this),this.updateMatrix(),this},U.prototype.updateMatrix=function(){this.matrix.identity();for(var e=0;e<this.transforms.length;e++)this.transforms[e].apply(this.matrix)},$.prototype.parse=function(e){return this.sid=e.getAttribute("sid"),this.type=e.nodeName,this.data=Te(e.textContent),this.convert(),this},$.prototype.convert=function(){switch(this.type){case"matrix":this.obj=je(this.data);break;case"rotate":this.angle=dt.Math.degToRad(this.data[3]);case"translate":Ne(this.data,-1),this.obj=new dt.Vector3(this.data[0],this.data[1],this.data[2]);break;case"scale":Ne(this.data,1),this.obj=new dt.Vector3(this.data[0],this.data[1],this.data[2]);break;default:console.log("Can not convert Transform of type "+this.type)}},$.prototype.apply=function(){var e=new dt.Matrix4;return function(t){switch(this.type){case"matrix":t.multiply(this.obj);break;case"translate":t.multiply(e.makeTranslation(this.obj.x,this.obj.y,this.obj.z));break;case"rotate":t.multiply(e.makeRotationAxis(this.obj,this.angle));break;case"scale":t.scale(this.obj)}}}(),$.prototype.update=function(e,t){var r=["X","Y","Z","ANGLE"];switch(this.type){case"matrix":if(t)if(1===t.length)switch(t[0]){case 0:this.obj.n11=e[0],this.obj.n21=e[1],this.obj.n31=e[2],this.obj.n41=e[3];break;case 1:this.obj.n12=e[0],this.obj.n22=e[1],this.obj.n32=e[2],this.obj.n42=e[3];break;case 2:this.obj.n13=e[0],this.obj.n23=e[1],this.obj.n33=e[2],this.obj.n43=e[3];break;case 3:this.obj.n14=e[0],this.obj.n24=e[1],this.obj.n34=e[2],this.obj.n44=e[3]}else if(2===t.length){var n="n"+(t[0]+1)+(t[1]+1);this.obj[n]=e}else console.log("Incorrect addressing of matrix in transform.");else this.obj.copy(e);break;case"translate":case"scale":switch("[object Array]"===Object.prototype.toString.call(t)&&(t=r[t[0]]),t){case"X":this.obj.x=e;break;case"Y":this.obj.y=e;break;case"Z":this.obj.z=e;break;default:this.obj.x=e[0],this.obj.y=e[1],this.obj.z=e[2]}break;case"rotate":switch("[object Array]"===Object.prototype.toString.call(t)&&(t=r[t[0]]),t){case"X":this.obj.x=e;break;case"Y":this.obj.y=e;break;case"Z":this.obj.z=e;break;case"ANGLE":this.angle=dt.Math.degToRad(e);break;default:this.obj.x=e[0],this.obj.y=e[1],this.obj.z=e[2],this.angle=dt.Math.degToRad(e[3])}}},z.prototype.parse=function(e){this.url=e.getAttribute("url").replace(/^#/,""),this.skeleton=[],this.instance_material=[];for(var t=0;t<e.childNodes.length;t++){var r=e.childNodes[t];if(1===r.nodeType)switch(r.nodeName){case"skeleton":this.skeleton.push(r.textContent.replace(/^#/,""));break;case"bind_material":for(var n=r.querySelectorAll("instance_material"),i=0;i<n.length;i++){var o=n[i];this.instance_material.push((new V).parse(o))}}}return this},V.prototype.parse=function(e){return this.symbol=e.getAttribute("symbol"),this.target=e.getAttribute("target").replace(/^#/,""),this},G.prototype.parse=function(e){this.url=e.getAttribute("url").replace(/^#/,""),this.instance_material=[];for(var t=0;t<e.childNodes.length;t++){var r=e.childNodes[t];if(1==r.nodeType&&"bind_material"===r.nodeName){for(var n=r.querySelectorAll("instance_material"),i=0;i<n.length;i++){var o=n[i];this.instance_material.push((new V).parse(o))}break}}return this},W.prototype.parse=function(e){this.id=e.getAttribute("id"),Se(this,e);for(var t=0;t<e.childNodes.length;t++){var r=e.childNodes[t];switch(r.nodeName){case"mesh":this.mesh=new Y(this).parse(r)}}return this},Y.prototype.parse=function(e){this.primitives=[];for(var t=0;t<e.childNodes.length;t++){var r=e.childNodes[t];switch(r.nodeName){case"source":Me(r);break;case"vertices":this.vertices=(new Q).parse(r);break;case"linestrips":this.primitives.push((new q).parse(r));break;case"triangles":this.primitives.push((new J).parse(r));break;case"polygons":this.primitives.push((new Z).parse(r));break;case"polylist":this.primitives.push((new X).parse(r))}}if(this.geometry3js=new dt.Geometry,null===this.vertices)return this;var n=s[this.vertices.input.POSITION.source].data;for(t=0;t<n.length;t+=3)this.geometry3js.vertices.push(Le(n,t).clone());for(t=0;t<this.primitives.length;t++){var i=this.primitives[t];i.setVertices(this.vertices),this.handlePrimitive(i,this.geometry3js)}return this.geometry3js.calcNormals&&(this.geometry3js.computeVertexNormals(),delete this.geometry3js.calcNormals),this},Y.prototype.handlePrimitive=function(e,t){if(e instanceof q)t.isLineStrip=!0;else{var r=void 0,n=void 0,i=void 0,o=void 0,a=void 0,c=void 0,u=void 0,l=void 0,h=e.p,p=e.inputs,f=0,d=0,m=[];for(r=0;r<p.length;r++){var g=(i=p[r]).offset+1;switch(d=d<g?g:d,i.semantic){case"TEXCOORD":m.push(i.set)}}for(var y=0;y<h.length;++y)for(var v=h[y],_=0;_<v.length;){var b=[],w=[],x=null,M=[];for(l=e.vcount?e.vcount.length?e.vcount[f++]:e.vcount:v.length/d,r=0;r<l;r++)for(n=0;n<p.length;n++)switch(i=p[n],c=s[i.source],a=(o=v[_+r*d+i.offset])*(u=c.accessor.params.length),i.semantic){case"VERTEX":b.push(o);break;case"NORMAL":w.push(Le(c.data,a));break;case"TEXCOORD":void 0===(x=x||{})[i.set]&&(x[i.set]=[]),x[i.set].push(new dt.Vector2(c.data[a],c.data[a+1]));break;case"COLOR":M.push((new dt.Color).setRGB(c.data[a],c.data[a+1],c.data[a+2]))}if(0===w.length)if(i=this.vertices.input.NORMAL){u=(c=s[i.source]).accessor.params.length;for(var S=0,C=b.length;S<C;S++)w.push(Le(c.data,b[S]*u))}else t.calcNormals=!0;if(!x&&(x={},i=this.vertices.input.TEXCOORD))for(m.push(i.set),u=(c=s[i.source]).accessor.params.length,S=0,C=b.length;S<C;S++)a=b[S]*u,void 0===x[i.set]&&(x[i.set]=[]),x[i.set].push(new dt.Vector2(c.data[a],1-c.data[a+1]));if(0===M.length&&(i=this.vertices.input.COLOR))for(u=(c=s[i.source]).accessor.params.length,S=0,C=b.length;S<C;S++)a=b[S]*u,M.push((new dt.Color).setRGB(c.data[a],c.data[a+1],c.data[a+2]));var P,E,O=null,A=[];if(3===l)A.push(new dt.Face3(b[0],b[1],b[2],w,M.length?M:new dt.Color));else if(4===l)A.push(new dt.Face3(b[0],b[1],b[3],w.length?[w[0].clone(),w[1].clone(),w[3].clone()]:[],M.length?[M[0],M[1],M[3]]:new dt.Color)),A.push(new dt.Face3(b[1],b[2],b[3],w.length?[w[1].clone(),w[2].clone(),w[3].clone()]:[],M.length?[M[1],M[2],M[3]]:new dt.Color));else if(l>4&&T.subdivideFaces){var L=M.length?M:new dt.Color;for(n=1;n<l-1;)A.push(new dt.Face3(b[0],b[n],b[n+1],w.length?[w[0].clone(),w[n++].clone(),w[n].clone()]:[],L))}if(A.length)for(S=0,C=A.length;S<C;S++)for((O=A[S]).daeMaterial=e.material,t.faces.push(O),n=0;n<m.length;n++)P=x[m[n]],E=l>4?[P[0],P[S+1],P[S+2]]:4===l?0===S?[P[0],P[1],P[3]]:[P[1].clone(),P[2],P[3].clone()]:[P[0],P[1],P[2]],void 0===t.faceVertexUvs[n]&&(t.faceVertexUvs[n]=[]),t.faceVertexUvs[n].push(E);else console.log("dropped face with vcount "+l+" for geometry with id: "+t.id);_+=d*l}}},Z.prototype.setVertices=function(e){for(var t=0;t<this.inputs.length;t++)this.inputs[t].source===e.id&&(this.inputs[t].source=e.input.POSITION.source)},Z.prototype.parse=function(e){this.material=e.getAttribute("material"),this.count=xe(e,"count",0);for(var t=0;t<e.childNodes.length;t++){var r=e.childNodes[t];switch(r.nodeName){case"input":this.inputs.push((new ee).parse(e.childNodes[t]));break;case"vcount":this.vcount=Oe(r.textContent);break;case"p":this.p.push(Oe(r.textContent));break;case"ph":console.warn("polygon holes not yet supported!")}}return this},X.prototype=Object.create(Z.prototype),X.prototype.constructor=X,q.prototype=Object.create(Z.prototype),q.prototype.constructor=q,J.prototype=Object.create(Z.prototype),J.prototype.constructor=J,K.prototype.parse=function(e){this.params=[],this.source=e.getAttribute("source"),this.count=xe(e,"count",0),this.stride=xe(e,"stride",0);for(var t=0;t<e.childNodes.length;t++){var r=e.childNodes[t];if("param"===r.nodeName){var n={};n.name=r.getAttribute("name"),n.type=r.getAttribute("type"),this.params.push(n)}}return this},Q.prototype.parse=function(e){this.id=e.getAttribute("id");for(var t=0;t<e.childNodes.length;t++)if("input"===e.childNodes[t].nodeName){var r=(new ee).parse(e.childNodes[t]);this.input[r.semantic]=r}return this},ee.prototype.parse=function(e){return this.semantic=e.getAttribute("semantic"),this.source=e.getAttribute("source").replace(/^#/,""),this.set=xe(e,"set",-1),this.offset=xe(e,"offset",0),"TEXCOORD"===this.semantic&&this.set<0&&(this.set=0),this},te.prototype.parse=function(e){this.id=e.getAttribute("id");for(var t=0;t<e.childNodes.length;t++){var r=e.childNodes[t];switch(r.nodeName){case"bool_array":this.data=_e(r.textContent),this.type=r.nodeName;break;case"float_array":this.data=Te(r.textContent),this.type=r.nodeName;break;case"int_array":this.data=Oe(r.textContent),this.type=r.nodeName;break;case"IDREF_array":case"Name_array":this.data=ve(r.textContent),this.type=r.nodeName;break;case"technique_common":for(var n=0;n<r.childNodes.length;n++)if("accessor"===r.childNodes[n].nodeName){this.accessor=(new K).parse(r.childNodes[n]);break}}}return this},te.prototype.read=function(){var e=[],t=this.accessor.params[0];switch(t.type){case"IDREF":case"Name":case"name":case"float":return this.data;case"float4x4":for(var r=0;r<this.data.length;r+=16){var n=je(this.data.slice(r,r+16));e.push(n)}break;default:console.log("ColladaLoader: Source: Read dont know how to read "+t.type+".")}return e},se.prototype.parse=function(e){this.id=e.getAttribute("id"),this.name=e.getAttribute("name");for(var t=0;t<e.childNodes.length;t++)if("instance_effect"===e.childNodes[t].nodeName){this.instance_effect=(new le).parse(e.childNodes[t]);break}return this},ie.prototype.isColor=function(){return null===this.texture},ie.prototype.isTexture=function(){return null!=this.texture},ie.prototype.parse=function(e){"transparent"===e.nodeName&&(this.opaque=e.getAttribute("opaque"));for(var t=0;t<e.childNodes.length;t++){var r=e.childNodes[t];if(1==r.nodeType)switch(r.nodeName){case"color":var n=Te(r.textContent);this.color=new dt.Color,this.color.setRGB(n[0],n[1],n[2]),this.color.a=n[3];break;case"texture":this.texture=r.getAttribute("texture"),this.texcoord=r.getAttribute("texcoord"),this.texOpts={offsetU:0,offsetV:0,repeatU:1,repeatV:1,wrapU:1,wrapV:1},this.parseTexture(r)}}return this},ie.prototype.parseTexture=function(e){if(!e.childNodes)return this;e.childNodes[1]&&"extra"===e.childNodes[1].nodeName&&(e=e.childNodes[1]).childNodes[1]&&"technique"===e.childNodes[1].nodeName&&(e=e.childNodes[1]);for(var t=0;t<e.childNodes.length;t++){var r=e.childNodes[t];switch(r.nodeName){case"offsetU":case"offsetV":case"repeatU":case"repeatV":this.texOpts[r.nodeName]=parseFloat(r.textContent);break;case"wrapU":case"wrapV":"TRUE"===r.textContent.toUpperCase()?this.texOpts[r.nodeName]=1:this.texOpts[r.nodeName]=parseInt(r.textContent);break;default:this.texOpts[r.nodeName]=r.textContent}}return this},ne.prototype.parse=function(e){for(var t=0;t<e.childNodes.length;t++){var r=e.childNodes[t];if(1==r.nodeType)switch(r.nodeName){case"ambient":case"emission":case"diffuse":case"specular":case"transparent":this[r.nodeName]=(new ie).parse(r);break;case"bump":var n=r.getAttribute("bumptype");n?"heightfield"===n.toLowerCase()?this.bump=(new ie).parse(r):"normalmap"===n.toLowerCase()?this.normal=(new ie).parse(r):(console.error("Shader.prototype.parse: Invalid value for attribute 'bumptype' ("+n+") - valid bumptypes are 'HEIGHTFIELD' and 'NORMALMAP' - defaulting to 'HEIGHTFIELD'"),this.bump=(new ie).parse(r)):(console.warn("Shader.prototype.parse: Attribute 'bumptype' missing from bump node - defaulting to 'HEIGHTFIELD'"),this.bump=(new ie).parse(r));break;case"shininess":case"reflectivity":case"index_of_refraction":case"transparency":var i=r.querySelectorAll("float");i.length>0&&(this[r.nodeName]=parseFloat(i[0].textContent))}}return this.create(),this},ne.prototype.create=function(){var e={},t=!1;if(void 0!==this.transparency&&void 0!==this.transparent){var r=(this.transparent.color.r+this.transparent.color.g+this.transparent.color.b)/3*this.transparency;r>0&&(t=!0,e.transparent=!0,e.opacity=1-r)}var n={diffuse:"map",ambient:"lightMap",specular:"specularMap",emission:"emissionMap",bump:"bumpMap",normal:"normalMap"};for(var i in this)switch(i){case"ambient":case"emission":case"diffuse":case"specular":case"bump":case"normal":var o=this[i];if(o instanceof ie)if(o.isTexture()){var a=o.texture,s=this.effect.sampler[a];if(void 0!==s&&void 0!==s.source){var c=this.effect.surface[s.source];if(void 0!==c){var u=m[c.init_from];if(u){var l,h=p+u.init_from,f=dt.Loader.Handlers.get(h);null!==f?l=f.load(h):Ae(l=new dt.Texture,h),"MIRROR"===s.wrap_s?l.wrapS=dt.MirroredRepeatWrapping:"WRAP"===s.wrap_s||o.texOpts.wrapU?l.wrapS=dt.RepeatWrapping:l.wrapS=dt.ClampToEdgeWrapping,"MIRROR"===s.wrap_t?l.wrapT=dt.MirroredRepeatWrapping:"WRAP"===s.wrap_t||o.texOpts.wrapV?l.wrapT=dt.RepeatWrapping:l.wrapT=dt.ClampToEdgeWrapping,l.offset.x=o.texOpts.offsetU,l.offset.y=o.texOpts.offsetV,l.repeat.x=o.texOpts.repeatU,l.repeat.y=o.texOpts.repeatV,e[n[i]]=l,"emission"===i&&(e.emissive=16777215)}}}}else"diffuse"!==i&&t||("emission"===i?e.emissive=o.color.getHex():e[i]=o.color.getHex());break;case"shininess":e[i]=this[i];break;case"reflectivity":e[i]=this[i],e[i]>0&&(e.envMap=T.defaultEnvMap),e.combine=dt.MixOperation;break;case"index_of_refraction":e.refractionRatio=this[i],1!==this[i]&&(e.envMap=T.defaultEnvMap)}switch(e.side=this.effect.doubleSided?dt.DoubleSide:dt.FrontSide,void 0!==e.diffuse&&(e.color=e.diffuse,delete e.diffuse),void 0!==e.ambient&&delete e.ambient,this.type){case"constant":void 0!=e.emissive&&(e.color=e.emissive),this.material=new dt.MeshBasicMaterial(e);break;case"phong":case"blinn":this.material=new dt.MeshPhongMaterial(e);break;case"lambert":default:this.material=new dt.MeshLambertMaterial(e)}return this.material},oe.prototype.parse=function(e){for(var t=0;t<e.childNodes.length;t++){var r=e.childNodes[t];if(1==r.nodeType)switch(r.nodeName){case"init_from":this.init_from=r.textContent;break;case"format":this.format=r.textContent;break;default:console.log("unhandled Surface prop: "+r.nodeName)}}return this},ae.prototype.parse=function(e){for(var t=0;t<e.childNodes.length;t++){var r=e.childNodes[t];if(1==r.nodeType)switch(r.nodeName){case"source":this.source=r.textContent;break;case"minfilter":this.minfilter=r.textContent;break;case"magfilter":this.magfilter=r.textContent;break;case"mipfilter":this.mipfilter=r.textContent;break;case"wrap_s":this.wrap_s=r.textContent;break;case"wrap_t":this.wrap_t=r.textContent;break;default:console.log("unhandled Sampler2D prop: "+r.nodeName)}}return this},re.prototype.create=function(){if(null===this.shader)return null},re.prototype.parse=function(e){this.id=e.getAttribute("id"),this.name=e.getAttribute("name"),Se(this,e),this.shader=null;for(var t=0;t<e.childNodes.length;t++){var r=e.childNodes[t];if(1==r.nodeType)switch(r.nodeName){case"profile_COMMON":this.parseTechnique(this.parseProfileCOMMON(r))}}return this},re.prototype.parseNewparam=function(e){for(var t=e.getAttribute("sid"),r=0;r<e.childNodes.length;r++){var n=e.childNodes[r];if(1==n.nodeType)switch(n.nodeName){case"surface":this.surface[t]=new oe(this).parse(n);break;case"sampler2D":this.sampler[t]=new ae(this).parse(n);break;case"extra":break;default:console.log(n.nodeName)}}},re.prototype.parseProfileCOMMON=function(e){for(var t=void 0,r=0;r<e.childNodes.length;r++){var n=e.childNodes[r];if(1==n.nodeType)switch(n.nodeName){case"profile_COMMON":this.parseProfileCOMMON(n);break;case"technique":t=n;break;case"newparam":this.parseNewparam(n);break;case"image":var i=(new I).parse(n);m[i.id]=i;break;case"extra":break;default:console.log(n.nodeName)}}return t},re.prototype.parseTechnique=function(e){for(var t=0;t<e.childNodes.length;t++){var r=e.childNodes[t];if(1==r.nodeType)switch(r.nodeName){case"constant":case"lambert":case"blinn":case"phong":this.shader=new ne(r.nodeName,this).parse(r);break;case"extra":this.parseExtra(r)}}},re.prototype.parseExtra=function(e){for(var t=0;t<e.childNodes.length;t++){var r=e.childNodes[t];if(1==r.nodeType)switch(r.nodeName){case"technique":this.parseExtraTechnique(r)}}},re.prototype.parseExtraTechnique=function(e){for(var t=0;t<e.childNodes.length;t++){var r=e.childNodes[t];if(1==r.nodeType)switch(r.nodeName){case"bump":this.shader.parse(e)}}},le.prototype.parse=function(e){return this.url=e.getAttribute("url").replace(/^#/,""),this},ce.prototype.parse=function(e){this.id=e.getAttribute("id"),this.name=e.getAttribute("name"),this.source={};for(var t=0;t<e.childNodes.length;t++){var r=e.childNodes[t];if(1==r.nodeType)switch(r.nodeName){case"animation":var n=(new ce).parse(r);for(var i in n.source)this.source[i]=n.source[i];for(var o=0;o<n.channel.length;o++)this.channel.push(n.channel[o]),this.sampler.push(n.sampler[o]);break;case"source":i=(new te).parse(r),this.source[i.id]=i;break;case"sampler":this.sampler.push(new de(this).parse(r));break;case"channel":this.channel.push(new he(this).parse(r))}}return this},he.prototype.parse=function(e){this.source=e.getAttribute("source").replace(/^#/,""),this.target=e.getAttribute("target");var t=this.target.split("/");t.shift();var r=t.shift(),n=r.indexOf(".")>=0,i=r.indexOf("(")>=0;if(n)t=r.split("."),this.sid=t.shift(),this.member=t.shift();else if(i){var o=r.split("(");this.sid=o.shift();for(var a=0;a<o.length;a++)o[a]=parseInt(o[a].replace(/\)/,""));this.arrIndices=o}else this.sid=r;return this.fullSid=r,this.dotSyntax=n,this.arrSyntax=i,this},de.prototype.parse=function(e){this.id=e.getAttribute("id"),this.inputs=[];for(var t=0;t<e.childNodes.length;t++){var r=e.childNodes[t];if(1==r.nodeType)switch(r.nodeName){case"input":this.inputs.push((new ee).parse(r))}}return this},de.prototype.create=function(){for(var e=0;e<this.inputs.length;e++){var t=this.inputs[e],r=this.animation.source[t.source];switch(t.semantic){case"INPUT":this.input=r.read();break;case"OUTPUT":this.output=r.read(),this.strideOut=r.accessor.stride;break;case"INTERPOLATION":this.interpolation=r.read();break;case"IN_TANGENT":case"OUT_TANGENT":break;default:console.log(t.semantic)}}if(this.startTime=0,this.endTime=0,this.duration=0,this.input.length){for(this.startTime=1e8,this.endTime=-1e8,e=0;e<this.input.length;e++)this.startTime=Math.min(this.startTime,this.input[e]),this.endTime=Math.max(this.endTime,this.input[e]);this.duration=this.endTime-this.startTime}},de.prototype.getData=function(e,t,r){var n=void 0;if("matrix"===e&&16===this.strideOut)n=this.output[t];else if(this.strideOut>1){n=[],t*=this.strideOut;for(var i=0;i<this.strideOut;++i)n[i]=this.output[t+i];if(3===this.strideOut)switch(e){case"rotate":case"translate":Ne(n,-1);break;case"scale":Ne(n,1)}else 4===this.strideOut&&"matrix"===e&&Ne(n,-1)}else n=this.output[t],r&&"translate"===e&&(n=function(e,t){if(!0!==T.convertUpAxis||ke===T.upAxis)return t;switch(e){case"X":t="XtoY"===Re?-1*t:t;break;case"Y":t="YtoZ"===Re||"YtoX"===Re?-1*t:t;break;case"Z":t="ZtoY"===Re?-1*t:t}return t}(r,n));return n},ue.prototype.addTarget=function(e,t,r,n){this.targets.push({sid:e,member:r,transform:t,data:n})},ue.prototype.apply=function(e){for(var t=0;t<this.targets.length;++t){var r=this.targets[t];e&&r.sid!==e||r.transform.update(r.data,r.member)}},ue.prototype.getTarget=function(e){for(var t=0;t<this.targets.length;++t)if(this.targets[t].sid===e)return this.targets[t];return null},ue.prototype.hasTarget=function(e){for(var t=0;t<this.targets.length;++t)if(this.targets[t].sid===e)return!0;return!1},ue.prototype.interpolate=function(e,t){for(var r=0,n=this.targets.length;r<n;r++){var i,o=this.targets[r],a=e.getTarget(o.sid);if("matrix"!==o.transform.type&&a){var s=(t-this.time)/(e.time-this.time),c=a.data,u=o.data;if(s<0&&(s=0),s>1&&(s=1),u.length){i=[];for(var l=0;l<u.length;++l)i[l]=u[l]+(c[l]-u[l])*s}else i=u+(c-u)*s}else i=o.data;o.transform.update(i,o.member)}},pe.prototype.parse=function(e){this.id=e.getAttribute("id"),this.name=e.getAttribute("name");for(var t=0;t<e.childNodes.length;t++){var r=e.childNodes[t];if(1==r.nodeType)switch(r.nodeName){case"optics":this.parseOptics(r)}}return this},pe.prototype.parseOptics=function(e){for(var t=0;t<e.childNodes.length;t++)if("technique_common"===e.childNodes[t].nodeName)for(var r=e.childNodes[t],n=0;n<r.childNodes.length;n++)if(this.technique=r.childNodes[n].nodeName,"perspective"===this.technique)for(var i=r.childNodes[n],o=0;o<i.childNodes.length;o++)switch((s=i.childNodes[o]).nodeName){case"yfov":this.yfov=s.textContent;break;case"xfov":this.xfov=s.textContent;break;case"znear":this.znear=s.textContent;break;case"zfar":this.zfar=s.textContent;break;case"aspect_ratio":this.aspect_ratio=s.textContent}else if("orthographic"===this.technique){var a=r.childNodes[n];for(o=0;o<a.childNodes.length;o++){var s;switch((s=a.childNodes[o]).nodeName){case"xmag":this.xmag=s.textContent;break;case"ymag":this.ymag=s.textContent;break;case"znear":this.znear=s.textContent;break;case"zfar":this.zfar=s.textContent;break;case"aspect_ratio":this.aspect_ratio=s.textContent}}}return this},me.prototype.parse=function(e){return this.url=e.getAttribute("url").replace(/^#/,""),this},ge.prototype.parse=function(e){this.id=e.getAttribute("id"),this.name=e.getAttribute("name");for(var t=0;t<e.childNodes.length;t++){var r=e.childNodes[t];if(1==r.nodeType)switch(r.nodeName){case"technique_common":this.parseCommon(r);break;case"technique":this.parseTechnique(r)}}return this},ge.prototype.parseCommon=function(e){for(var t=0;t<e.childNodes.length;t++)switch(e.childNodes[t].nodeName){case"directional":case"point":case"spot":case"ambient":this.technique=e.childNodes[t].nodeName;for(var r=e.childNodes[t],n=0;n<r.childNodes.length;n++){var i=r.childNodes[n];switch(i.nodeName){case"color":var o=Te(i.textContent);this.color=new dt.Color(0),this.color.setRGB(o[0],o[1],o[2]),this.color.a=o[3];break;case"falloff_angle":this.falloff_angle=parseFloat(i.textContent);break;case"quadratic_attenuation":var a=parseFloat(i.textContent);this.distance=a?Math.sqrt(1/a):0}}}return this},ge.prototype.parseTechnique=function(e){this.profile=e.getAttribute("profile");for(var t=0;t<e.childNodes.length;t++){var r=e.childNodes[t];switch(r.nodeName){case"intensity":this.intensity=parseFloat(r.textContent)}}return this},fe.prototype.parse=function(e){return this.url=e.getAttribute("url").replace(/^#/,""),this},be.prototype.parse=function(e){this.id=e.getAttribute("id"),this.name=e.getAttribute("name"),this.joints=[],this.links=[];for(var t=0;t<e.childNodes.length;t++){var r=e.childNodes[t];if(1==r.nodeType)switch(r.nodeName){case"technique_common":this.parseCommon(r)}}return this},be.prototype.parseCommon=function(e){for(var t=0;t<e.childNodes.length;t++){var r=e.childNodes[t];if(1==r.nodeType)switch(e.childNodes[t].nodeName){case"joint":this.joints.push((new ye).parse(r));break;case"link":this.links.push((new Ee).parse(r))}}return this},ye.prototype.parse=function(e){this.sid=e.getAttribute("sid"),this.name=e.getAttribute("name"),this.axis=new dt.Vector3,this.limits={min:0,max:0},this.type="",this.static=!1,this.zeroPosition=0,this.middlePosition=0;var t=Te(e.querySelector("axis").textContent);this.axis=Le(t,0);var r=e.querySelector("limits min")?parseFloat(e.querySelector("limits min").textContent):-360,n=e.querySelector("limits max")?parseFloat(e.querySelector("limits max").textContent):360;this.limits={min:r,max:n};for(var i=["prismatic","revolute"],o=0;o<i.length;o++){var a=i[o];e.querySelector(a)&&(this.type=a)}return this.limits.min>=this.limits.max&&(this.static=!0),this.middlePosition=(this.limits.min+this.limits.max)/2,this},Ee.prototype.parse=function(e){this.sid=e.getAttribute("sid"),this.name=e.getAttribute("name"),this.transforms=[],this.attachments=[];for(var t=0;t<e.childNodes.length;t++){var r=e.childNodes[t];if(1==r.nodeType)switch(r.nodeName){case"attachment_full":this.attachments.push((new we).parse(r));break;case"rotate":case"translate":case"matrix":this.transforms.push((new $).parse(r))}}return this},we.prototype.parse=function(e){this.joint=e.getAttribute("joint").split("/").pop(),this.links=[];for(var t=0;t<e.childNodes.length;t++){var r=e.childNodes[t];if(1==r.nodeType)switch(r.nodeName){case"link":this.links.push((new Ee).parse(r));break;case"rotate":case"translate":case"matrix":this.transforms.push((new $).parse(r))}}return this},{load:function load(e,t,r,n){var i=0;if(document.implementation&&document.implementation.createDocument){var o=new XMLHttpRequest;o.onreadystatechange=function(){4===o.readyState?0===o.status||200===o.status?o.response?(a=t,v(o.response,void 0,e)):n?n({type:"error",url:e}):console.error("ColladaLoader: Empty or non-existing file ("+e+")"):n?n({type:"error",url:e}):console.error("ColladaLoader: Couldn't load \""+e+'" ('+o.status+")"):3===o.readyState&&r&&(0===i&&(i=o.getResponseHeader("Content-Length")),r({total:i,loaded:o.responseText.length}))},o.open("GET",e,!0),o.send(null)}else alert("Don't know how to parse XML!")},parse:v,applySkin:L,geometries:_,options:T}}).load(e,t,null,r)})}},{key:"_parseAndTransformAdsumScene",value:function _parseAndTransformAdsumScene(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,i=e;if(!e.geometry&&!e.material&&e.children.length>0&&("Mesh"===e.children[0].type||e.children[0].isLight)){var o=e.parent;o.remove(e);var a=e.children[0];a.isLight?(a.matrix=e.matrix,a.matrix.decompose(a.position,a.quaternion,a.scale)):a.applyMatrix(e.matrix),o.add(a);for(var s=e.children.length-1;s>=0;s--){var c=e.children[s];a.add(c)}(i=a).name=e.name,i.colladaId=e.colladaId,e.dispose&&e.dispose()}var u=i.name||"";if(i.material)if(i.material.flatShading=!0,i.material.side=n.l,i.material.isMeshPhongMaterial?(i.material.emissionMap&&!i.material.map&&(i.material.map=i.material.emissionMap,i.material.emissionMap=null,i.material.color=16777215),i.material.shininess=1e-4):i.material.isMeshLambertMaterial&&i.material.emissionMap&&!i.material.map&&(i.material.map=i.material.emissionMap,i.material.emissionMap=null),i.material.lightMap)i.material=new n.z({aoMap:i.material.lightMap,map:i.material.map,color:i.material.color});else if(this.options.preferLambertMaterial()&&i.material.isMeshPhongMaterial){for(var l=["alphaTest","blendDst","blendDstAlpha","blendEquation","blendEquationAlpha","blending","blendSrc","blendSrcAlpha","clipIntersection","clippingPlanes","clipShadows","colorWrite","depthFunc","depthTest","depthWrite","fog","lights","name","overdraw","polygonOffset","polygonOffsetFactor","polygonOffsetUnits","precision","premultipliedAlpha","dithering","flatShading","side","transparent","vertexColors","visible","userData","alphaMap","aoMap","aoMapIntensity","color","combine","emissive","emissiveMap","emissiveIntensity","envMap","lightMap","lightMapIntensity","map","morphNormals","morphTargets","reflectivity","refractionRatio","skinning","specularMap","wireframe","wireframeLinecap","wireframeLinejoin","wireframeLinewidth"],h={},p=0;p<l.length;p++){var f=l[p];h[f]=i.material[f]}i.material=new n.y(h)}if(u.startsWith("SITE"))this.isAoMap&&(i.rotateX(-Math.PI/2),i.updateMatrix()),this.result.site=mt._createFromMesh(i,{},-1),r=this.result.site;else if(u.startsWith("BUILDING")){var d=u.match(/BUILDING_(\d+)_.*/),m={},g=parseInt(d[1],10),y=t.findOneBy({building_id:g});null===y?console.warn("AdsumLoader: No place associated to building "+g):m.placeId=y.id;var v=gt._createFromMesh(i,m,g);v.site=r,v.site.buildings.add(v),this.result.buildingsMap.set(v.id,v),r=v}else if(u.startsWith("FLOOR")){var _=u.match(/FLOOR_(\d+)_.*/),b=yt._createFromMesh(i,{},parseInt(_[1],10));b.altitude=i.position.z,b.building=r,b.building.floors.add(b),this.result.floorsMap.set(b.id,b),r=b}else if(u.startsWith("SHAPE")||u.startsWith("STORE")){var w=u.match(/(?:SHAPE|STORE)_(\d+)_.*/),x={},M=parseInt(w[1],10),S=t.findOneBy({shape_id:M});null===S?console.warn("AdsumLoader: No place associated to space "+M):x.placeId=S.id;var C=vt._createFromMesh(i,x,M);C.parent=r,C.parent.spaces.add(C),this.result.spacesMap.set(C.id,C),r=C}for(var P=i.children.length-1;P>=0;P--)this._parseAndTransformAdsumScene(i.children[P],t,r)}},{key:"_adjustSceneSettings",value:function _adjustSceneSettings(){var e=this;this.result.scene.traverse(function(t){t instanceof n.w&&(t.material.shininess=1e-5,e.options.shadowEnabled&&(t!==e.result.site._mesh&&(t.castShadow=!0),t.receiveShadow=!0))}),this._createLights(),this._createFog(),this.result.site._mesh.material.emissive&&this.result.site._mesh.material.emissive.set(0),this.result.site._mesh.material.shininess&&(this.result.site._mesh.material.shininess=1e-5),this.result.buildingsMap.forEach(function(t){var r=t._mesh;if(r.material&&r.material.specular&&r.material.specular.set(0,0,0),r.geometry){var i=new n.W;r.geometry.computeBoundingBox(),r.geometry.boundingBox.getCenter(i),r.geometry.center(),r.geometry.translate(0,0,i.z),i.z=0,i.multiply(r.scale),i.applyQuaternion(r.quaternion),r.position.add(i),r.children.forEach(function(e){e.position.sub(i)}),r.updateMatrix(),r.updateMatrixWorld()}e._colorShapeVertices(r)}),this.result.floorsMap.forEach(function(e){e._mesh.material.emissive&&e._mesh.material.emissive.set(0),e._mesh.material.shininess&&(e._mesh.material.shininess=1e-5)}),this.result.spacesMap.forEach(function(t){var r=t._mesh;if(e._colorShapeVertices(r),r.geometry){var i=new n.W;r.geometry.computeBoundingBox(),r.geometry.boundingBox.getCenter(i),r.geometry.center(),r.geometry.translate(0,0,i.z),i.z=0,i.multiply(r.scale),i.applyQuaternion(r.quaternion),r.position.add(i),r.updateMatrix(),r.updateMatrixWorld()}})}},{key:"_colorShapeVertices",value:function _colorShapeVertices(e){if(this.isAoMap){var t=e.geometry,r=new n.f(this.options.shapeAmbientOcclusionTopColor),i=new n.f(this.options.shapeAmbientOcclusionBottomColor);t.faces.forEach(function(e){var n=r,o=r,a=r;t.vertices[e.a]&&0===t.vertices[e.a].z&&(n=i),t.vertices[e.b]&&0===t.vertices[e.b].z&&(o=i),t.vertices[e.c]&&0===t.vertices[e.c].z&&(a=i),e.vertexColors.push(n),e.vertexColors.push(o),e.vertexColors.push(a)}),t.colorsNeedUpdate=!0,e.material.vertexColors=n.Y,e.material.needsUpdate=!0}}},{key:"_createLights",value:function _createLights(){var e=this.options.advancedLightingEnabled()?.5:1,t=new n.o(16777215,8947848,e);if(t.position.set(0,0,1),this.result.scene.add(t),t.updateMatrixWorld(),this.options.advancedLightingEnabled()){var r=new n.g(16777215,.2);r.position.set(1,0,0),this.result.scene.add(r),r.updateMatrixWorld();var i=new n.b,o=new n.Q;i.setFromObject(this.result.scene).getBoundingSphere(o);var a=o.radius,s=o.center.clone();s.z+=a/2,s.y+=a/2,s.x-=a/2;var c=new n.g(16777215,.85);c.position.copy(s),c.target.position.copy(o.center),this.options.shadowEnabled&&(c.castShadow=!0,c.shadow.camera.near=a/4,c.shadow.camera.far=2*a,c.shadow.camera.right=a,c.shadow.camera.left=-a,c.shadow.camera.top=a,c.shadow.camera.bottom=-a,c.shadow.mapSize.width=this.options.shadowMapSize,c.shadow.mapSize.height=this.options.shadowMapSize),this.result.scene.add(c.target),this.result.scene.add(c),c.updateMatrixWorld(),c.target.updateMatrixWorld()}}},{key:"_createFog",value:function _createFog(){this.options.fogEnabled&&(this.result.scene.fog=new n.k(this.options.fogColor,this.options.fogRatio))}},{key:"_addLabels",value:function _addLabels(){var e=this,t=this.options.entityManager.getRepository("Place"),r=this.options.entityManager.getRepository("CustomObject");return t.load().then(function(){e.result.labelsMap.forEach(function(n){var i=r.get(n.id),o=t.get(i.place),a={x:i.offset.x,y:i.offset.y,z:i.offset.z};if(i.orientation_mode===c.a.BILLBOARD){var s=n.getSizeAndCenter().size;a.z+=s.y/2}else a.z+=1.1;var u=i.orientation_mode===c.a.STATIC;i.rotation&&u&&n.rotateZ(i.rotation*Math.PI/180),i.permanent_display||n.setDisplayMode(d),null!==o.shape_id?e.result.spacesMap.get(o.shape_id).addLabel(n,a):null!==o.building_id?e.result.buildingsMap.get(o.building_id).addLabel(n,a):-1===o.floor_id?e.result.site.addLabel(n,{x:a.x+o.position.x,y:a.y+o.position.y,z:a.z+o.position.z}):e.result.floorsMap.get(o.floor_id).addLabel(n,{x:a.x+o.position.x,y:a.y+o.position.y,z:a.z+o.position.z})})})}},{key:"_loadProjectorTransform",value:function _loadProjectorTransform(){var e=this,t=this.options.entityManager.getRepository("Site");return t.load().then(function(){var r=t.getCurrent();if(r.gps_positions.size<4||6!==r.gps_transform.size||3!==r.gps_translate.size)return console.warn("AdsumWebMap.AdsumLoader: No gps positions available, wayfinding will not be accurate (we assume world unit match meter) !!"),void(e.result.projector=kt.createFake());e.result.projector=new kt(Array.from(r.gps_transform),Array.from(r.gps_translate),Array.from(r.gps_positions)[0])})}},{key:"_loadPaths",value:function _loadPaths(){var e=this,t=this.options.entityManager.getRepository("MapFile");return t.load().then(function(){var r=t.findOneBy({type:c.f.PATH});null===r?(console.warn("AdsumWebMap.AdsumLoader: No paths found, wayfinding will not be working !"),e.result.paths=new Map,e.result.paths.set("nodes",[]),e.result.paths.set("links",[])):e.result.paths=r.paths})}}]),AdsumLoader}(),It=function(){function Path(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];_classCallCheck(this,Path),this.from=e,this.to=t,this.pmr=r,this._distance=null,this.pathSections=[],this.computed=!1}return f(Path,[{key:"getDistance",value:function getDistance(){var e=this;return this.computed?(null===this._distance&&(this._distance=0,this.pathSections.forEach(function(t){e._distance+=t.getDistance()})),this._distance):null}},{key:"clear",value:function clear(){this.computed=!1,this.pathSections=[],this._distance=null}}]),Path}()},function(e,t,r){var n=r(7).f,i=r(14),o=r(5)("toStringTag");e.exports=function(e,t,r){e&&!i(e=r?e:e.prototype,o)&&n(e,o,{configurable:!0,value:t})}},function(e,t,r){var n=r(0),i=r(24),o=r(3),a=r(76),s="["+a+"]",c=RegExp("^"+s+s+"*"),u=RegExp(s+s+"*$"),l=function exporter(e,t,r){var i={},s=o(function(){return!!a[e]()||"​"!="​"[e]()}),c=i[e]=s?t(h):a[e];r&&(i[r]=c),n(n.P+n.F*s,"String",i)},h=l.trim=function(e,t){return e=String(i(e)),1&t&&(e=e.replace(c,"")),2&t&&(e=e.replace(u,"")),e};e.exports=l},function(e,t){e.exports={}},function(e,t,r){var n=r(4);e.exports=function(e,t){if(!n(e)||e._t!==t)throw TypeError("Incompatible receiver, "+t+" required!");return e}},function(e,t,r){var n,i,o,a,s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};a=function(){var e=e||function(e,t){var n=Object.create||function(){function F(){}return function(e){var t;return F.prototype=e,t=new F,F.prototype=null,t}}(),i={},o=i.lib={},a=o.Base={extend:function extend(e){var t=n(this);return e&&t.mixIn(e),t.hasOwnProperty("init")&&this.init!==t.init||(t.init=function(){t.$super.init.apply(this,arguments)}),t.init.prototype=t,t.$super=this,t},create:function create(){var e=this.extend();return e.init.apply(e,arguments),e},init:function init(){},mixIn:function mixIn(e){for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t]);e.hasOwnProperty("toString")&&(this.toString=e.toString)},clone:function clone(){return this.init.prototype.extend(this)}},s=o.WordArray=a.extend({init:function init(e,t){e=this.words=e||[],this.sigBytes=void 0!=t?t:4*e.length},toString:function toString(e){return(e||u).stringify(this)},concat:function concat(e){var t=this.words,r=e.words,n=this.sigBytes,i=e.sigBytes;if(this.clamp(),n%4)for(var o=0;o<i;o++){var a=r[o>>>2]>>>24-o%4*8&255;t[n+o>>>2]|=a<<24-(n+o)%4*8}else for(o=0;o<i;o+=4)t[n+o>>>2]=r[o>>>2];return this.sigBytes+=i,this},clamp:function clamp(){var t=this.words,r=this.sigBytes;t[r>>>2]&=4294967295<<32-r%4*8,t.length=e.ceil(r/4)},clone:function clone(){var clone=a.clone.call(this);return clone.words=this.words.slice(0),clone},random:function random(t){for(var r,n=[],i=function r(t){t=t;var n=987654321,i=4294967295;return function(){var r=((n=36969*(65535&n)+(n>>16)&i)<<16)+(t=18e3*(65535&t)+(t>>16)&i)&i;return r/=4294967296,(r+=.5)*(e.random()>.5?1:-1)}},o=0;o<t;o+=4){var a=i(4294967296*(r||e.random()));r=987654071*a(),n.push(4294967296*a()|0)}return new s.init(n,t)}}),c=i.enc={},u=c.Hex={stringify:function stringify(e){for(var t=e.words,r=e.sigBytes,n=[],i=0;i<r;i++){var o=t[i>>>2]>>>24-i%4*8&255;n.push((o>>>4).toString(16)),n.push((15&o).toString(16))}return n.join("")},parse:function parse(e){for(var t=e.length,r=[],n=0;n<t;n+=2)r[n>>>3]|=parseInt(e.substr(n,2),16)<<24-n%8*4;return new s.init(r,t/2)}},l=c.Latin1={stringify:function stringify(e){for(var t=e.words,r=e.sigBytes,n=[],i=0;i<r;i++){var o=t[i>>>2]>>>24-i%4*8&255;n.push(String.fromCharCode(o))}return n.join("")},parse:function parse(e){for(var t=e.length,r=[],n=0;n<t;n++)r[n>>>2]|=(255&e.charCodeAt(n))<<24-n%4*8;return new s.init(r,t)}},h=c.Utf8={stringify:function stringify(e){try{return decodeURIComponent(escape(l.stringify(e)))}catch(e){throw new Error("Malformed UTF-8 data")}},parse:function parse(e){return l.parse(unescape(encodeURIComponent(e)))}},p=o.BufferedBlockAlgorithm=a.extend({reset:function reset(){this._data=new s.init,this._nDataBytes=0},_append:function _append(e){"string"==typeof e&&(e=h.parse(e)),this._data.concat(e),this._nDataBytes+=e.sigBytes},_process:function _process(t){var r=this._data,n=r.words,i=r.sigBytes,o=this.blockSize,a=i/(4*o),c=(a=t?e.ceil(a):e.max((0|a)-this._minBufferSize,0))*o,u=e.min(4*c,i);if(c){for(var l=0;l<c;l+=o)this._doProcessBlock(n,l);var h=n.splice(0,c);r.sigBytes-=u}return new s.init(h,u)},clone:function clone(){var clone=a.clone.call(this);return clone._data=this._data.clone(),clone},_minBufferSize:0}),f=(o.Hasher=p.extend({cfg:a.extend(),init:function init(e){this.cfg=this.cfg.extend(e),this.reset()},reset:function reset(){p.reset.call(this),this._doReset()},update:function update(e){return this._append(e),this._process(),this},finalize:function finalize(e){return e&&this._append(e),this._doFinalize()},blockSize:16,_createHelper:function _createHelper(e){return function(t,r){return new e.init(r).finalize(t)}},_createHmacHelper:function _createHmacHelper(e){return function(t,r){return new f.HMAC.init(e,r).finalize(t)}}}),i.algo={});return i}(Math);return e},"object"===s(t)?e.exports=t=a():(i=[],void 0===(o="function"==typeof(n=a)?n.apply(t,i):n)||(e.exports=o))},function(e,t,r){"use strict";var n=r(99),i=function(){function defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(e,t,r){return t&&defineProperties(e.prototype,t),r&&defineProperties(e,r),e}}();var o=function(){function AdsumObject3DDelegate(e){!function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,AdsumObject3DDelegate),this.objectManagerProxy=e}return i(AdsumObject3DDelegate,[{key:"_getInstance",value:function _getInstance(e){return this.objectManagerProxy.deserializeAdsumObject3D(e)}},{key:"getPlaceId",value:function getPlaceId(e){return n.a.serialize(this._getInstance(e).placeId)}},{key:"getDisplayMode",value:function getDisplayMode(e){return this._getInstance(e).getDisplayMode()}},{key:"setDisplayMode",value:function setDisplayMode(e,t){this._getInstance(e).setDisplayMode(t)}}]),AdsumObject3DDelegate}();t.a=o},function(e,t,r){var n=r(21);e.exports=Object("z").propertyIsEnumerable(0)?Object:function(e){return"String"==n(e)?e.split(""):Object(e)}},function(e,t){t.f={}.propertyIsEnumerable},function(e,t,r){var n=r(21),i=r(5)("toStringTag"),o="Arguments"==n(function(){return arguments}());e.exports=function(e){var t,r,a;return void 0===e?"Undefined":null===e?"Null":"string"==typeof(r=function tryGet(e,t){try{return e[t]}catch(e){}}(t=Object(e),i))?r:o?n(t):"Object"==(a=n(t))&&"function"==typeof t.callee?"Arguments":a}},function(e,t,r){var n=r(19),i=r(2),o=i["__core-js_shared__"]||(i["__core-js_shared__"]={});(e.exports=function(e,t){return o[e]||(o[e]=void 0!==t?t:{})})("versions",[]).push({version:n.version,mode:r(31)?"pure":"global",copyright:"© 2018 Denis Pushkarev (zloirock.ru)"})},function(e,t,r){var n=r(15),i=r(8),o=r(36);e.exports=function(e){return function(t,r,a){var s,c=n(t),u=i(c.length),l=o(a,u);if(e&&r!=r){for(;u>l;)if((s=c[l++])!=s)return!0}else for(;u>l;l++)if((e||l in c)&&c[l]===r)return e||l||0;return!e&&-1}}},function(e,t){t.f=Object.getOwnPropertySymbols},function(e,t,r){var n=r(21);e.exports=Array.isArray||function isArray(e){return"Array"==n(e)}},function(e,t,r){var n=r(4),i=r(21),o=r(5)("match");e.exports=function(e){var t;return n(e)&&(void 0!==(t=e[o])?!!t:"RegExp"==i(e))}},function(e,t,r){var n=r(5)("iterator"),i=!1;try{var o=[7][n]();o.return=function(){i=!0},Array.from(o,function(){throw 2})}catch(e){}e.exports=function(e,t){if(!t&&!i)return!1;var r=!1;try{var o=[7],a=o[n]();a.next=function(){return{done:r=!0}},o[n]=function(){return a},e(o)}catch(e){}return r}},function(e,t,r){"use strict";var n=r(1);e.exports=function(){var e=n(this),t="";return e.global&&(t+="g"),e.ignoreCase&&(t+="i"),e.multiline&&(t+="m"),e.unicode&&(t+="u"),e.sticky&&(t+="y"),t}},function(e,t,r){"use strict";var n=r(11),i=r(12),o=r(3),a=r(24),s=r(5);e.exports=function(e,t,r){var c=s(e),u=r(a,c,""[e]),l=u[0],h=u[1];o(function(){var t={};return t[c]=function(){return 7},7!=""[e](t)})&&(i(String.prototype,e,l),n(RegExp.prototype,c,2==t?function(e,t){return h.call(e,this,t)}:function(e){return h.call(e,this)}))}},function(e,t,r){var n=r(1),i=r(10),o=r(5)("species");e.exports=function(e,t){var r,a=n(e).constructor;return void 0===a||void 0==(r=n(a)[o])?t:i(r)}},function(e,t,r){var n=r(2).navigator;e.exports=n&&n.userAgent||""},function(e,t,r){"use strict";var n=r(2),i=r(0),o=r(12),a=r(42),s=r(30),c=r(41),u=r(40),l=r(4),h=r(3),p=r(58),f=r(44),d=r(77);e.exports=function(e,t,r,m,g,y){var v=n[e],_=v,b=g?"set":"add",w=_&&_.prototype,x={},M=function fixMethod(e){var t=w[e];o(w,e,"delete"==e?function(e){return!(y&&!l(e))&&t.call(this,0===e?0:e)}:"has"==e?function has(e){return!(y&&!l(e))&&t.call(this,0===e?0:e)}:"get"==e?function get(e){return y&&!l(e)?void 0:t.call(this,0===e?0:e)}:"add"==e?function add(e){return t.call(this,0===e?0:e),this}:function set(e,r){return t.call(this,0===e?0:e,r),this})};if("function"==typeof _&&(y||w.forEach&&!h(function(){(new _).entries().next()}))){var S=new _,C=S[b](y?{}:-0,1)!=S,P=h(function(){S.has(1)}),E=p(function(e){new _(e)}),T=!y&&h(function(){for(var e=new _,t=5;t--;)e[b](t,t);return!e.has(-0)});E||((_=t(function(t,r){u(t,_,e);var n=d(new v,t,_);return void 0!=r&&c(r,g,n[b],n),n})).prototype=w,w.constructor=_),(P||T)&&(M("delete"),M("has"),g&&M("get")),(T||C)&&M(b),y&&w.clear&&delete w.clear}else _=m.getConstructor(t,e,g,b),a(_.prototype,r),s.NEED=!0;return f(_,e),x[e]=_,i(i.G+i.W+i.F*(_!=v),x),y||m.setStrong(_,e,g),_}},function(e,t,r){for(var n,i=r(2),o=r(11),a=r(34),s=a("typed_array"),c=a("view"),u=!(!i.ArrayBuffer||!i.DataView),l=u,h=0,p="Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array".split(",");h<9;)(n=i[p[h++]])?(o(n.prototype,s,!0),o(n.prototype,c,!0)):l=!1;e.exports={ABV:u,CONSTR:l,TYPED:s,VIEW:c}},function(e,t,r){"use strict";e.exports=r(31)||!r(3)(function(){var e=Math.random();__defineSetter__.call(null,e,function(){}),delete r(2)[e]})},function(e,t,r){"use strict";var n=r(0);e.exports=function(e){n(n.S,e,{of:function of(){for(var e=arguments.length,t=new Array(e);e--;)t[e]=arguments[e];return new this(t)}})}},function(e,t,r){"use strict";var n=r(0),i=r(10),o=r(20),a=r(41);e.exports=function(e){n(n.S,e,{from:function from(e){var t,r,n,s,c=arguments[1];return i(this),(t=void 0!==c)&&i(c),void 0==e?new this:(r=[],t?(n=0,s=o(c,arguments[2],2),a(e,!1,function(e){r.push(s(e,n++))})):a(e,!1,r.push,r),new this(r))}})}},function(e,t,r){"use strict";r.d(t,"a",function(){return i});var n=function(){function defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(e,t,r){return t&&defineProperties(e.prototype,t),r&&defineProperties(e,r),e}}();var i=function(){function AbstractOptions(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};!function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,AbstractOptions),this.fromJSON(e)}return n(AbstractOptions,[{key:"reset",value:function reset(){}},{key:"fromJSON",value:function fromJSON(e){var t=this;this.reset(),Object.keys(e).forEach(function(r){t.hasOwnProperty(r)&&(t[r]instanceof AbstractOptions?t[r].fromJSON(e[r]):t[r]=e[r])})}},{key:"toJSON",value:function toJSON(){var e=this,t={};return Object.keys(this).forEach(function(r){e.hasOwnProperty(r)&&(e[r]instanceof AbstractOptions?t[r]=e[r].toJSON():t[r]=e[r])}),t}}]),AbstractOptions}()},function(e,t){var r,n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};r=function(){return this}();try{r=r||Function("return this")()||(0,eval)("this")}catch(e){"object"===("undefined"==typeof window?"undefined":n(window))&&(r=window)}e.exports=r},function(e,t,r){var n=r(4),i=r(2).document,o=n(i)&&n(i.createElement);e.exports=function(e){return o?i.createElement(e):{}}},function(e,t,r){var n=r(2),i=r(19),o=r(31),a=r(102),s=r(7).f;e.exports=function(e){var t=i.Symbol||(i.Symbol=o?{}:n.Symbol||{});"_"==e.charAt(0)||e in t||s(t,e,{value:a.f(e)})}},function(e,t,r){var n=r(53)("keys"),i=r(34);e.exports=function(e){return n[e]||(n[e]=i(e))}},function(e,t){e.exports="constructor,hasOwnProperty,isPrototypeOf,propertyIsEnumerable,toLocaleString,toString,valueOf".split(",")},function(e,t,r){var n=r(2).document;e.exports=n&&n.documentElement},function(e,t,r){var n=r(4),i=r(1),o=function check(e,t){if(i(e),!n(t)&&null!==t)throw TypeError(t+": can't set as prototype!")};e.exports={set:Object.setPrototypeOf||("__proto__"in{}?function(e,t,n){try{(n=r(20)(Function.call,r(16).f(Object.prototype,"__proto__").set,2))(e,[]),t=!(e instanceof Array)}catch(e){t=!0}return function setPrototypeOf(e,r){return o(e,r),t?e.__proto__=r:n(e,r),e}}({},!1):void 0),check:o}},function(e,t){e.exports="\t\n\v\f\r   ᠎             　\u2028\u2029\ufeff"},function(e,t,r){var n=r(4),i=r(75).set;e.exports=function(e,t,r){var o,a=t.constructor;return a!==r&&"function"==typeof a&&(o=a.prototype)!==r.prototype&&n(o)&&i&&i(e,o),e}},function(e,t,r){"use strict";var n=r(25),i=r(24);e.exports=function repeat(e){var t=String(i(this)),r="",o=n(e);if(o<0||o==1/0)throw RangeError("Count can't be negative");for(;o>0;(o>>>=1)&&(t+=t))1&o&&(r+=t);return r}},function(e,t){e.exports=Math.sign||function sign(e){return 0==(e=+e)||e!=e?e:e<0?-1:1}},function(e,t){var r=Math.expm1;e.exports=!r||r(10)>22025.465794806718||r(10)<22025.465794806718||-2e-17!=r(-2e-17)?function expm1(e){return 0==(e=+e)?e:e>-1e-6&&e<1e-6?e+e*e/2:Math.exp(e)-1}:r},function(e,t,r){var n=r(25),i=r(24);e.exports=function(e){return function(t,r){var o,a,s=String(i(t)),c=n(r),u=s.length;return c<0||c>=u?e?"":void 0:(o=s.charCodeAt(c))<55296||o>56319||c+1===u||(a=s.charCodeAt(c+1))<56320||a>57343?e?s.charAt(c):o:e?s.slice(c,c+2):a-56320+(o-55296<<10)+65536}}},function(e,t,r){"use strict";var n=r(31),i=r(0),o=r(12),a=r(11),s=r(46),c=r(83),u=r(44),l=r(17),h=r(5)("iterator"),p=!([].keys&&"next"in[].keys()),f=function returnThis(){return this};e.exports=function(e,t,r,d,m,g,y){c(r,t,d);var v,_,b,w=function getMethod(e){if(!p&&e in C)return C[e];switch(e){case"keys":return function keys(){return new r(this,e)};case"values":return function values(){return new r(this,e)}}return function entries(){return new r(this,e)}},x=t+" Iterator",M="values"==m,S=!1,C=e.prototype,P=C[h]||C["@@iterator"]||m&&C[m],E=P||w(m),T=m?M?w("entries"):E:void 0,O="Array"==t&&C.entries||P;if(O&&(b=l(O.call(new e)))!==Object.prototype&&b.next&&(u(b,x,!0),n||"function"==typeof b[h]||a(b,h,f)),M&&P&&"values"!==P.name&&(S=!0,E=function values(){return P.call(this)}),n&&!y||!p&&!S&&C[h]||a(C,h,E),s[t]=E,s[x]=f,m)if(v={values:M?E:w("values"),keys:g?E:w("keys"),entries:T},y)for(_ in v)_ in C||o(C,_,v[_]);else i(i.P+i.F*(p||S),t,v);return v}},function(e,t,r){"use strict";var n=r(37),i=r(33),o=r(44),a={};r(11)(a,r(5)("iterator"),function(){return this}),e.exports=function(e,t,r){e.prototype=n(a,{next:i(1,r)}),o(e,t+" Iterator")}},function(e,t,r){var n=r(57),i=r(24);e.exports=function(e,t,r){if(n(t))throw TypeError("String#"+r+" doesn't accept regex!");return String(i(e))}},function(e,t,r){var n=r(5)("match");e.exports=function(e){var t=/./;try{"/./"[e](t)}catch(r){try{return t[n]=!1,!"/./"[e](t)}catch(e){}}return!0}},function(e,t,r){var n=r(46),i=r(5)("iterator"),o=Array.prototype;e.exports=function(e){return void 0!==e&&(n.Array===e||o[i]===e)}},function(e,t,r){"use strict";var n=r(7),i=r(33);e.exports=function(e,t,r){t in e?n.f(e,t,i(0,r)):e[t]=r}},function(e,t,r){var n=r(52),i=r(5)("iterator"),o=r(46);e.exports=r(19).getIteratorMethod=function(e){if(void 0!=e)return e[i]||e["@@iterator"]||o[n(e)]}},function(e,t,r){var n=r(236);e.exports=function(e,t){return new(n(e))(t)}},function(e,t,r){"use strict";var n=r(9),i=r(36),o=r(8);e.exports=function fill(e){for(var t=n(this),r=o(t.length),a=arguments.length,s=i(a>1?arguments[1]:void 0,r),c=a>2?arguments[2]:void 0,u=void 0===c?r:i(c,r);u>s;)t[s++]=e;return t}},function(e,t,r){"use strict";var n=r(32),i=r(118),o=r(46),a=r(15);e.exports=r(82)(Array,"Array",function(e,t){this._t=a(e),this._i=0,this._k=t},function(){var e=this._t,t=this._k,r=this._i++;return!e||r>=e.length?(this._t=void 0,i(1)):i(0,"keys"==t?r:"values"==t?e[r]:[r,e[r]])},"values"),o.Arguments=o.Array,n("keys"),n("values"),n("entries")},function(e,t,r){var n,i,o,a=r(20),s=r(108),c=r(74),u=r(70),l=r(2),h=l.process,p=l.setImmediate,f=l.clearImmediate,d=l.MessageChannel,m=l.Dispatch,g=0,y={},v=function run(){var e=+this;if(y.hasOwnProperty(e)){var t=y[e];delete y[e],t()}},_=function listener(e){v.call(e.data)};p&&f||(p=function setImmediate(e){for(var t=[],r=1;arguments.length>r;)t.push(arguments[r++]);return y[++g]=function(){s("function"==typeof e?e:Function(e),t)},n(g),g},f=function clearImmediate(e){delete y[e]},"process"==r(21)(h)?n=function defer(e){h.nextTick(a(v,e,1))}:m&&m.now?n=function defer(e){m.now(a(v,e,1))}:d?(o=(i=new d).port2,i.port1.onmessage=_,n=a(o.postMessage,o,1)):l.addEventListener&&"function"==typeof postMessage&&!l.importScripts?(n=function defer(e){l.postMessage(e+"","*")},l.addEventListener("message",_,!1)):n="onreadystatechange"in u("script")?function defer(e){c.appendChild(u("script")).onreadystatechange=function(){c.removeChild(this),v.call(e)}}:function defer(e){setTimeout(a(v,e,1),0)}),e.exports={set:p,clear:f}},function(e,t,r){var n=r(2),i=r(92).set,o=n.MutationObserver||n.WebKitMutationObserver,a=n.process,s=n.Promise,c="process"==r(21)(a);e.exports=function(){var e,t,r,u=function flush(){var n,i;for(c&&(n=a.domain)&&n.exit();e;){i=e.fn,e=e.next;try{i()}catch(n){throw e?r():t=void 0,n}}t=void 0,n&&n.enter()};if(c)r=function notify(){a.nextTick(u)};else if(!o||n.navigator&&n.navigator.standalone)if(s&&s.resolve){var l=s.resolve(void 0);r=function notify(){l.then(u)}}else r=function notify(){i.call(n,u)};else{var h=!0,p=document.createTextNode("");new o(u).observe(p,{characterData:!0}),r=function notify(){p.data=h=!h}}return function(n){var i={fn:n,next:void 0};t&&(t.next=i),e||(e=i,r()),t=i}}},function(e,t,r){"use strict";var n=r(10);e.exports.f=function(e){return new function PromiseCapability(e){var t,r;this.promise=new e(function(e,n){if(void 0!==t||void 0!==r)throw TypeError("Bad Promise constructor");t=e,r=n}),this.resolve=n(t),this.reject=n(r)}(e)}},function(e,t,r){"use strict";var n=r(2),i=r(6),o=r(31),a=r(64),s=r(11),c=r(42),u=r(3),l=r(40),h=r(25),p=r(8),f=r(127),d=r(38).f,m=r(7).f,g=r(90),y=r(44),v="prototype",_="Wrong index!",b=n.ArrayBuffer,w=n.DataView,x=n.Math,M=n.RangeError,S=n.Infinity,C=b,P=x.abs,E=x.pow,T=x.floor,O=x.log,A=x.LN2,L=i?"_b":"buffer",k=i?"_l":"byteLength",R=i?"_o":"byteOffset";function packIEEE754(e,t,r){var n,i,o,a=new Array(r),s=8*r-t-1,c=(1<<s)-1,u=c>>1,l=23===t?E(2,-24)-E(2,-77):0,h=0,p=e<0||0===e&&1/e<0?1:0;for((e=P(e))!=e||e===S?(i=e!=e?1:0,n=c):(n=T(O(e)/A),e*(o=E(2,-n))<1&&(n--,o*=2),(e+=n+u>=1?l/o:l*E(2,1-u))*o>=2&&(n++,o/=2),n+u>=c?(i=0,n=c):n+u>=1?(i=(e*o-1)*E(2,t),n+=u):(i=e*E(2,u-1)*E(2,t),n=0));t>=8;a[h++]=255&i,i/=256,t-=8);for(n=n<<t|i,s+=t;s>0;a[h++]=255&n,n/=256,s-=8);return a[--h]|=128*p,a}function unpackIEEE754(e,t,r){var n,i=8*r-t-1,o=(1<<i)-1,a=o>>1,s=i-7,c=r-1,u=e[c--],l=127&u;for(u>>=7;s>0;l=256*l+e[c],c--,s-=8);for(n=l&(1<<-s)-1,l>>=-s,s+=t;s>0;n=256*n+e[c],c--,s-=8);if(0===l)l=1-a;else{if(l===o)return n?NaN:u?-S:S;n+=E(2,t),l-=a}return(u?-1:1)*n*E(2,l-t)}function unpackI32(e){return e[3]<<24|e[2]<<16|e[1]<<8|e[0]}function packI8(e){return[255&e]}function packI16(e){return[255&e,e>>8&255]}function packI32(e){return[255&e,e>>8&255,e>>16&255,e>>24&255]}function packF64(e){return packIEEE754(e,52,8)}function packF32(e){return packIEEE754(e,23,4)}function addGetter(e,t,r){m(e[v],t,{get:function get(){return this[r]}})}function get(e,t,r,n){var i=f(+r);if(i+t>e[k])throw M(_);var o=e[L]._b,a=i+e[R],s=o.slice(a,a+t);return n?s:s.reverse()}function set(e,t,r,n,i,o){var a=f(+r);if(a+t>e[k])throw M(_);for(var s=e[L]._b,c=a+e[R],u=n(+i),l=0;l<t;l++)s[c+l]=u[o?l:t-l-1]}if(a.ABV){if(!u(function(){b(1)})||!u(function(){new b(-1)})||u(function(){return new b,new b(1.5),new b(NaN),"ArrayBuffer"!=b.name})){for(var I,N=(b=function ArrayBuffer(e){return l(this,b),new C(f(e))})[v]=C[v],F=d(C),j=0;F.length>j;)(I=F[j++])in b||s(b,I,C[I]);o||(N.constructor=b)}var B=new w(new b(2)),V=w[v].setInt8;B.setInt8(0,2147483648),B.setInt8(1,2147483649),!B.getInt8(0)&&B.getInt8(1)||c(w[v],{setInt8:function setInt8(e,t){V.call(this,e,t<<24>>24)},setUint8:function setUint8(e,t){V.call(this,e,t<<24>>24)}},!0)}else b=function ArrayBuffer(e){l(this,b,"ArrayBuffer");var t=f(e);this._b=g.call(new Array(t),0),this[k]=t},w=function DataView(e,t,r){l(this,w,"DataView"),l(e,b,"DataView");var n=e[k],i=h(t);if(i<0||i>n)throw M("Wrong offset!");if(i+(r=void 0===r?n-i:p(r))>n)throw M("Wrong length!");this[L]=e,this[R]=i,this[k]=r},i&&(addGetter(b,"byteLength","_l"),addGetter(w,"buffer","_b"),addGetter(w,"byteLength","_l"),addGetter(w,"byteOffset","_o")),c(w[v],{getInt8:function getInt8(e){return get(this,1,e)[0]<<24>>24},getUint8:function getUint8(e){return get(this,1,e)[0]},getInt16:function getInt16(e){var t=get(this,2,e,arguments[1]);return(t[1]<<8|t[0])<<16>>16},getUint16:function getUint16(e){var t=get(this,2,e,arguments[1]);return t[1]<<8|t[0]},getInt32:function getInt32(e){return unpackI32(get(this,4,e,arguments[1]))},getUint32:function getUint32(e){return unpackI32(get(this,4,e,arguments[1]))>>>0},getFloat32:function getFloat32(e){return unpackIEEE754(get(this,4,e,arguments[1]),23,4)},getFloat64:function getFloat64(e){return unpackIEEE754(get(this,8,e,arguments[1]),52,8)},setInt8:function setInt8(e,t){set(this,1,e,packI8,t)},setUint8:function setUint8(e,t){set(this,1,e,packI8,t)},setInt16:function setInt16(e,t){set(this,2,e,packI16,t,arguments[2])},setUint16:function setUint16(e,t){set(this,2,e,packI16,t,arguments[2])},setInt32:function setInt32(e,t){set(this,4,e,packI32,t,arguments[2])},setUint32:function setUint32(e,t){set(this,4,e,packI32,t,arguments[2])},setFloat32:function setFloat32(e,t){set(this,4,e,packF32,t,arguments[2])},setFloat64:function setFloat64(e,t){set(this,8,e,packF64,t,arguments[2])}});y(b,"ArrayBuffer"),y(w,"DataView"),s(w[v],a.VIEW,!0),t.ArrayBuffer=b,t.DataView=w},function(e,t,r){"use strict";r.d(t,"d",function(){return Sr}),r.d(t,"g",function(){return w}),r.d(t,"e",function(){return ie}),r.d(t,"a",function(){return be}),r.d(t,"b",function(){return xe}),r.d(t,"f",function(){return ze}),r.d(t,"c",function(){return Er});var n=r(68),i=r(349),o=r(350),a=r.n(o),s=r(351),c=r.n(s),u=r(370),l=r.n(u),h=r(371),p=r.n(h),f=r(372),d=r.n(f),m=function get(e,t,r){null===e&&(e=Function.prototype);var n=Object.getOwnPropertyDescriptor(e,t);if(void 0===n){var i=Object.getPrototypeOf(e);return null===i?void 0:get(i,t,r)}if("value"in n)return n.value;var o=n.get;return void 0!==o?o.call(r):void 0},g=function(){return function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function sliceIterator(e,t){var r=[],n=!0,i=!1,o=void 0;try{for(var a,s=e[Symbol.iterator]();!(n=(a=s.next()).done)&&(r.push(a.value),!t||r.length!==t);n=!0);}catch(e){i=!0,o=e}finally{try{!n&&s.return&&s.return()}finally{if(i)throw o}}return r}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),y="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},v=function(){function defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(e,t,r){return t&&defineProperties(e.prototype,t),r&&defineProperties(e,r),e}}();function _toConsumableArray(e){if(Array.isArray(e)){for(var t=0,r=Array(e.length);t<e.length;t++)r[t]=e[t];return r}return Array.from(e)}function _defineProperty(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var _,b="PUBLISHED",w=function(e){function Options(){return _classCallCheck(this,Options),_possibleConstructorReturn(this,(Options.__proto__||Object.getPrototypeOf(Options)).apply(this,arguments))}return _inherits(Options,n["a"]),v(Options,[{key:"reset",value:function reset(){this.endpoint=null,this.username=null,this.key=null,this.site=null,this.locale=null,this.state=b,this.logger=new i.c,this.cacheManager=null}},{key:"getEndpoint",value:function getEndpoint(){return this.constructor.formatApiEndpoint(this.endpoint)}},{key:"validate",value:function validate(){if("string"!=typeof this.endpoint)throw new TypeError("AdsumClientApi.Options.endpoint: Should be a string");if("string"!=typeof this.username)throw new TypeError("AdsumClientApi.Options.username: Should be a string");if("string"!=typeof this.key)throw new TypeError("AdsumClientApi.Options.key: Should be a string");if(!Number.isInteger(this.site))throw new TypeError("AdsumClientApi.Options.site: Should be an integer");if(this.site<=0)throw new TypeError("AdsumClientApi.Options.site: Should be positive");var e=i.a.isValidLogger(this.logger),t=e.isValid,r=e.reasons;if(!t)throw new TypeError(r.join(", "))}}],[{key:"getApiVersion",value:function getApiVersion(){return"2.3"}},{key:"formatApiEndpoint",value:function formatApiEndpoint(e){return"/"!==e.charAt(e.length-1)?e+"/2.3":e+"2.3"}}]),Options}(),x=(_=0,function(){return++_}),M=new WeakMap,S=new a.a,C=function(){function EventDispatcher(){throw _classCallCheck(this,EventDispatcher),new Error("EventDispatcher couldn't be instantiated")}return v(EventDispatcher,null,[{key:"_getObjectId",value:function _getObjectId(e){return M.has(e)||M.set(e,x()),M.get(e)}},{key:"_getUniversalEventName",value:function _getUniversalEventName(e,t){return e.constructor.name+t+this._getObjectId(e)}},{key:"subscribe",value:function subscribe(e,t,r){var n=this._getUniversalEventName(e,t);S.on(n,r)}},{key:"unsubscribe",value:function unsubscribe(e,t,r){var n=this._getUniversalEventName(e,t);S.removeListener(n,r)}},{key:"publish",value:function publish(e,t,r){S.emit(this._getUniversalEventName(e,t),r)}}]),EventDispatcher}(),P="CREATE",E="UPDATE",T="REMOVE",O="IDENTIFIER_WILL_CHANGE",A="IDENTIFIER_DID_CHANGE",L="INITIAL",k="LOADING",R="LOADED",I="ERROR",N=function(){function Vector(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;_classCallCheck(this,Vector),this.x=e,this.y=t,this.z=r}return v(Vector,null,[{key:"fromJSON",value:function fromJSON(e){var t=new Vector;return t.set(e),t}}]),v(Vector,[{key:"set",value:function set(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}},{key:"toJSON",value:function toJSON(){return{x:this.x,y:this.y,z:this.z}}}]),Vector}(),F="Must be valid",j="Must be a Symbol",B=function(){function AbstractValidator(){if(_classCallCheck(this,AbstractValidator),this.constructor===AbstractValidator)throw new TypeError("AbstractValidator is abstract");if(void 0===this.isValid)throw new TypeError("#isValid is abstract")}return v(AbstractValidator,null,[{key:"message",get:function get(){return F}}]),AbstractValidator}(),V=function(e){function AnyValidator(e){var t;return _classCallCheck(this,AnyValidator),(t=_possibleConstructorReturn(this,(AnyValidator.__proto__||Object.getPrototypeOf(AnyValidator)).call(this))).validators=e,t}return _inherits(AnyValidator,B),v(AnyValidator,[{key:"isValid",value:function isValid(e,t,r){for(var n=0;n<this.validators.length;n++)if(this.validators[n].isValid(e,t,r))return!0;return!1}}]),AnyValidator}(),D=function(e){function AllValidator(e){var t;return _classCallCheck(this,AllValidator),(t=_possibleConstructorReturn(this,(AllValidator.__proto__||Object.getPrototypeOf(AllValidator)).call(this))).validators=e,t}return _inherits(AllValidator,B),v(AllValidator,[{key:"isValid",value:function isValid(e,t,r){for(var n=0;n<this.validators.length;n++)if(!this.validators[n].isValid(e,t,r))return!1;return!0}}]),AllValidator}(),U=function(e){function NullValidator(){return _classCallCheck(this,NullValidator),_possibleConstructorReturn(this,(NullValidator.__proto__||Object.getPrototypeOf(NullValidator)).apply(this,arguments))}return _inherits(NullValidator,B),v(NullValidator,[{key:"isValid",value:function isValid(e,t,r){return null===t[r]}}]),NullValidator}(),G=function(e){function SymbolValidator(){return _classCallCheck(this,SymbolValidator),_possibleConstructorReturn(this,(SymbolValidator.__proto__||Object.getPrototypeOf(SymbolValidator)).apply(this,arguments))}return _inherits(SymbolValidator,B),v(SymbolValidator,[{key:"isValid",value:function isValid(e,t,r){return"symbol"==y(t[r])}}],[{key:"message",get:function get(){return j}}]),SymbolValidator}(),z=function(e){function IntegerValidator(){return _classCallCheck(this,IntegerValidator),_possibleConstructorReturn(this,(IntegerValidator.__proto__||Object.getPrototypeOf(IntegerValidator)).apply(this,arguments))}return _inherits(IntegerValidator,B),v(IntegerValidator,[{key:"isValid",value:function isValid(e,t,r){return Number.isInteger(t[r])}}]),IntegerValidator}(),H=function(e){function NegativeValidator(){return _classCallCheck(this,NegativeValidator),_possibleConstructorReturn(this,(NegativeValidator.__proto__||Object.getPrototypeOf(NegativeValidator)).apply(this,arguments))}return _inherits(NegativeValidator,B),v(NegativeValidator,[{key:"isValid",value:function isValid(e,t,r){return Number.isFinite(t[r])&&t[r]<0}}]),NegativeValidator}(),W=function(e){function NotValidator(e){var t;return _classCallCheck(this,NotValidator),(t=_possibleConstructorReturn(this,(NotValidator.__proto__||Object.getPrototypeOf(NotValidator)).call(this))).validator=e,t}return _inherits(NotValidator,B),v(NotValidator,[{key:"isValid",value:function isValid(e,t,r){return!this.validator.isValid(e,t,r)}}]),NotValidator}(),q=function(){function SetUtils(){_classCallCheck(this,SetUtils)}return v(SetUtils,null,[{key:"toJSON",value:function toJSON(e){for(var t=Array.from(e.values()),r=0;r<t.length;r++)"object"==y(t[r])&&null!==t[r]&&"function"==typeof t[r].toJSON&&(t[r]=t[r].toJSON());return t}},{key:"set",value:function set(e,t){e.clear(),t.forEach(function(t){e.add(t)})}}]),SetUtils}(),X=function(){function MapUtils(){_classCallCheck(this,MapUtils)}return v(MapUtils,null,[{key:"toJSON",value:function toJSON(e){var t=Object.create(null);return e.forEach(function(e,r){t[r]=e}),t}},{key:"set",value:function set(e,t){e.clear(),"object"==(void 0===t?"undefined":y(t))?Object.keys(t).forEach(function(r){e.set(r,t[r])}):t.forEach(function(t){var r=g(t,2),n=r[0],i=r[1];e.set(n,i)})}}]),MapUtils}(),Y=function(){function Reference(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;_classCallCheck(this,Reference),this.classOf=e,this.value=null,this.set(t)}return v(Reference,null,[{key:"cast",value:function cast(e,t){if(null===t||"symbol"==(void 0===t?"undefined":y(t))||Number.isInteger(t))return t;if("object"!=(void 0===t?"undefined":y(t)))throw new TypeError("Expected integer, null, "+e+" or Reference<"+e+"> but got "+(void 0===t?"undefined":y(t)));if(t instanceof Reference){if(t.classOf!==e)throw new TypeError("Expected reference of "+e+" but got reference of "+t.classOf);return t.value}var r=null;switch(t.constructor.getName()){case"Label":case"Picto":r="CustomObject";break;case"Kiosk":case"Mobile":case"Web":r="Device";break;case"MapAoDae":case"MapConfig":case"MapDae":case"MapHelper":case"MapLight":case"MapPath":r="MapFile";break;case"MediaImage":case"MediaPdf":case"MediaText":case"MediaUrl":case"MediaVideo":case"Movie":r="Media";break;case"Exhibitor":case"Person":case"Product":case"Room":case"Service":case"Store":r="Poi";break;default:r=t.constructor.name}if(!t._isEntity)throw new TypeError("Expected integer, null or "+e+" or Reference<"+e+">");if(r!==e)throw new TypeError("Expected integer, null or "+e+" or Reference<"+e+"> but got "+t.constructor.getName());return t.id}}]),v(Reference,[{key:"set",value:function set(e){return this.value=this.constructor.cast(this.classOf,e),this}},{key:"toJSON",value:function toJSON(){return this.value}},{key:"is",value:function is(e){return this.constructor.cast(this.classOf,e)===this.value}}]),Reference}(),J=function(){function Collection(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;_classCallCheck(this,Collection),this.classOf=e,this.values=new Set,t&&this.set(t)}return v(Collection,[{key:Symbol.iterator,value:function value(){return this.values[Symbol.iterator]()}},{key:"forEach",value:function forEach(e){return this.values.forEach(e),this}},{key:"set",value:function set(e){var t=this;return this.clear(),e.forEach(function(e){t.add(e)}),this}},{key:"at",value:function at(e){var t=0,r=null;return this.values.forEach(function(n){t===e&&(r=n),t++}),r}},{key:"add",value:function add(e){return this.has(e)?this:(this.values.add(new Y(this.classOf,e)),this)}},{key:"remove",value:function remove(e){var t=this;return this.forEach(function(r){r.is(e)&&t.values.delete(r)}),this}},{key:"has",value:function has(e){var t=!1;return this.forEach(function(r){!t&&r.is(e)&&(t=!0)}),t}},{key:"indexOf",value:function indexOf(e){var t=-1,r=0;return this.forEach(function(n){-1===t&&n.is(e)&&(t=r),r++}),t}},{key:"clear",value:function clear(){return this.values.clear()}},{key:"toJSON",value:function toJSON(){var e=[];return this.forEach(function(t){e.push(t.toJSON())}),e}},{key:"size",get:function get(){return this.values.size}}]),Collection}(),Z=function(){function OrderedCollection(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;_classCallCheck(this,OrderedCollection),this.classOf=e,this.values=[],t&&this.set(t)}return v(OrderedCollection,null,[{key:"castPosition",value:function castPosition(e,t){var r=e;if(null===e||void 0===e)return null;if("string"==typeof e&&(r=Number.isNaN(Number(e))?e:parseInt(e,10)),!Number.isInteger(r))throw new TypeError("Position has to be an integer.");return r>=t?null:r}},{key:"order",value:function order(e){var t=-1;return e.map(function(e){if(t++,null===e)throw new TypeError("OrderedCollection should not have null value");return"object"!=(void 0===e?"undefined":y(e))?{id:e,position:t}:e instanceof Y||e._isEntity?{id:e,position:t}:e}).sort(function(t,r){return r.position!==t.position?r.position-t.position:"symbol"==y(t.id)&&"symbol"==y(r.id)?e.indexOf(t)-e.indexOf(r):"symbol"==y(t.id)?1:"symbol"==y(r.id)?-1:t.id-r.id}).map(function(e){return e.id})}}]),v(OrderedCollection,[{key:Symbol.iterator,value:function value(){return this.values[Symbol.iterator]()}},{key:"forEach",value:function forEach(e){this.values.forEach(function(t){e(t)})}},{key:"set",value:function set(e){var t=this;return this.clear(),this.constructor.order(e).forEach(function(e){t.values.push(new Y(t.classOf,e))}),this}},{key:"add",value:function add(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=this.constructor.castPosition(t,this.size),n=this.indexOf(e);return-1!==n&&this.removeAt(n),null===r?this.values.push(new Y(this.classOf,e)):this.values.splice(r,0,new Y(this.classOf,e)),this}},{key:"remove",value:function remove(e){var t=this.indexOf(e);return t>-1&&this.removeAt(t),this}},{key:"removeAt",value:function removeAt(e){return this.values.splice(e,1),this}},{key:"has",value:function has(e){var t=!1;return this.forEach(function(r){!t&&r.is(e)&&(t=!0)}),t}},{key:"indexOf",value:function indexOf(e){var t=-1,r=0;return this.forEach(function(n){-1===t&&n.is(e)&&(t=r),r++}),t}},{key:"at",value:function at(e){var t=0,r=null;return this.values.forEach(function(n){t===e&&(r=n),t++}),r}},{key:"clear",value:function clear(){return this.values.length=0,this}},{key:"toJSON",value:function toJSON(){var e=this.size;return this.values.map(function(t){return{id:t.toJSON(),position:--e}})}},{key:"size",get:function get(){return this.values.length}}]),OrderedCollection}(),K=new Map,Q=function(){function AbstractEntity(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;_classCallCheck(this,AbstractEntity),this.constructor._isAbstract()&&this._throwIsAbstract(),this._isEntity=!0,this._reset(),null!==e&&this.fromJSON(e)}return v(AbstractEntity,[{key:"set",value:function set(e,t){return this[e]instanceof Set?q.set(this[e],t):this[e]instanceof Map?X.set(this[e],t):this[e]instanceof Y||this[e]instanceof J||this[e]instanceof Z||this[e]instanceof N?this[e].set(t):this[e]=t,this}}],[{key:"getName",value:function getName(){return"AbstractEntity"}},{key:"create",value:function create(){return new this(arguments.length>0&&void 0!==arguments[0]?arguments[0]:null)}},{key:"keys",get:function get(){var e=[];return e.push("id"),e}}]),v(AbstractEntity,[{key:"toJSON",value:function toJSON(){var e=this,t={};return this.constructor.keys.forEach(function(r){e[r]instanceof Date||e[r]instanceof Y||e[r]instanceof J||e[r]instanceof Z||e[r]instanceof N?t[r]=e[r].toJSON():e[r]instanceof Set?t[r]=q.toJSON(e[r]):e[r]instanceof Map?t[r]=X.toJSON(e[r]):t[r]=e[r]}),t}},{key:"fromJSON",value:function fromJSON(e){var t=this;return this.constructor.keys.forEach(function(r){e.hasOwnProperty(r)&&t.set(r,e[r])}),this}},{key:"clone",value:function clone(){return this.constructor.create(this.constructor._deepClone(this.toJSON()))}},{key:"_reset",value:function _reset(){this.id=null}},{key:"_throwIsAbstract",value:function _throwIsAbstract(){throw new TypeError(this.constructor.getName()+" is abstract")}}],[{key:"_deepClone",value:function _deepClone(e){if(null===e||"object"!=(void 0===e?"undefined":y(e)))return e;if(Array.isArray(e)){for(var t=[],r=0;r<e.length;r++)t.push(this._deepClone(e[r]));return t}for(var n={},i=Object.keys(e),o=0;o<i.length;o++){var a=i[o];n[a]=this._deepClone(e[a])}return n}},{key:"_setPropertyValidator",value:function _setPropertyValidator(e,t){K.get(this.getName()).set(e,t)}},{key:"_isAbstract",value:function _isAbstract(){return!0}},{key:"_buildValidators",value:function _buildValidators(){K.set(this.getName(),new Map),this._setPropertyValidator("id",new V([new U,new G,new D([new z,new W(new H)])]))}},{key:"_validators",get:function get(){return K.has(this.getName())||this._buildValidators(),K.get(this.getName())}}]),AbstractEntity}(),$=function HasSiteTrait(e){return function(t){function _class(){return _classCallCheck(this,_class),_possibleConstructorReturn(this,(_class.__proto__||Object.getPrototypeOf(_class)).apply(this,arguments))}return _inherits(_class,e),v(_class,[{key:"_reset",value:function _reset(){m(_class.prototype.__proto__||Object.getPrototypeOf(_class.prototype),"_reset",this).call(this),this.site=new Y("Site",null)}}],[{key:"keys",get:function get(){var e=m(_class.__proto__||Object.getPrototypeOf(_class),"keys",this);return e.push("site"),e}}]),_class}()},ee=function(e){function NonEmptyStringValidator(){return _classCallCheck(this,NonEmptyStringValidator),_possibleConstructorReturn(this,(NonEmptyStringValidator.__proto__||Object.getPrototypeOf(NonEmptyStringValidator)).apply(this,arguments))}return _inherits(NonEmptyStringValidator,B),v(NonEmptyStringValidator,[{key:"isValid",value:function isValid(e,t,r){return"string"==typeof t[r]&&t[r].length>0&&t[r].length<=255}}]),NonEmptyStringValidator}(),te=function HasNameTrait(e){return function(t){function _class2(){return _classCallCheck(this,_class2),_possibleConstructorReturn(this,(_class2.__proto__||Object.getPrototypeOf(_class2)).apply(this,arguments))}return _inherits(_class2,e),v(_class2,[{key:"_reset",value:function _reset(){m(_class2.prototype.__proto__||Object.getPrototypeOf(_class2.prototype),"_reset",this).call(this),this.name=null}}],[{key:"_buildValidators",value:function _buildValidators(){m(_class2.__proto__||Object.getPrototypeOf(_class2),"_buildValidators",this).call(this),this._setPropertyValidator("name",new ee)}},{key:"keys",get:function get(){var e=m(_class2.__proto__||Object.getPrototypeOf(_class2),"keys",this);return e.push("name"),e}}]),_class2}()},re=function HasMetadataTrait(e){return function(t){function _class3(){return _classCallCheck(this,_class3),_possibleConstructorReturn(this,(_class3.__proto__||Object.getPrototypeOf(_class3)).apply(this,arguments))}return _inherits(_class3,e),v(_class3,[{key:"_reset",value:function _reset(){m(_class3.prototype.__proto__||Object.getPrototypeOf(_class3.prototype),"_reset",this).call(this),this.metadata=new Map}}],[{key:"keys",get:function get(){var e=m(_class3.__proto__||Object.getPrototypeOf(_class3),"keys",this);return e.push("metadata"),e}}]),_class3}()},ne=function(e){function EnumValidator(e){var t;return _classCallCheck(this,EnumValidator),(t=_possibleConstructorReturn(this,(EnumValidator.__proto__||Object.getPrototypeOf(EnumValidator)).call(this))).enum=e,t.enumKeys=Object.keys(t.enum),t.enumValues=[],t.enumKeys.forEach(function(e){t.enumValues.push(t.enum[e])}),t}return _inherits(EnumValidator,B),v(EnumValidator,[{key:"isValid",value:function isValid(e,t,r){return this.enumValues.includes(t[r])}}]),EnumValidator}(),ie={DEFAULT:"default",TEXTURE:"texture",TEXTURE_MODEL:"texture_model",MEDIA:"media",MEDIA_FILE:"media_file",MEDIA_PREVIEW:"media_preview",MAP:"map",PICTO:"picto",CATEGORY:"category",SITE:"site",POI:"poi",TEXTURE_LOW:"texture_low",TEXTURE_OCCLUSION:"texture_occlusion",TEXTURE_HELPER:"texture_helper"},oe=function(e){function FileBase(){return _classCallCheck(this,FileBase),_possibleConstructorReturn(this,(FileBase.__proto__||Object.getPrototypeOf(FileBase)).apply(this,arguments))}return _inherits(FileBase,te($(re(Q)))),v(FileBase,[{key:"fromBlob",value:function fromBlob(e){throw new Error("File#fromBlob is available in Browser environment")}},{key:"_reset",value:function _reset(){m(FileBase.prototype.__proto__||Object.getPrototypeOf(FileBase.prototype),"_reset",this).call(this),this.reference=null,this.content_hash=null,this.file_type=null,this.uri=null,this.context=ie.DEFAULT}}],[{key:"getName",value:function getName(){return"File"}},{key:"_isAbstract",value:function _isAbstract(){return!1}},{key:"fromFileEntity",value:function fromFileEntity(e){if(!(e instanceof this))throw new TypeError("Expected an instance of File");var t=new this;return t.name=e.name,t.uri=e.uri,t.file_type=e.file_type,t.content_hash=e.content_hash,t.site=e.site,t}},{key:"fromBlob",value:function fromBlob(e){var t=new this;return t.fromBlob(e),t}},{key:"_buildValidators",value:function _buildValidators(){m(FileBase.__proto__||Object.getPrototypeOf(FileBase),"_buildValidators",this).call(this),this._setPropertyValidator("uri",new ee),this._setPropertyValidator("context",new ne(ie))}},{key:"_getBlobFromUri",value:function _getBlobFromUri(e){throw new Error("File#_getBlobFromUri is available in Browser environment")}},{key:"_addBlobUri",value:function _addBlobUri(e,t){throw new Error("File#_addBlobUri is available in Browser environment")}},{key:"_getBufferFromUri",value:function _getBufferFromUri(e){throw new Error("File#_getBufferFromUri is available in Node environment")}},{key:"_addBufferUri",value:function _addBufferUri(e,t){throw new Error("File#_addBufferUri is available in Node environment")}},{key:"keys",get:function get(){var e=m(FileBase.__proto__||Object.getPrototypeOf(FileBase),"keys",this);return e.push("reference"),e.push("context"),e.push("file_type"),e.push("content_hash"),e.push("uri"),e}}]),FileBase}(),ae=new Map,se=new Map,ce=function(e){function File$1(){return _classCallCheck(this,File$1),_possibleConstructorReturn(this,(File$1.__proto__||Object.getPrototypeOf(File$1)).apply(this,arguments))}return _inherits(File$1,oe),v(File$1,[{key:"fromBlob",value:function fromBlob(e){if(!(e instanceof Blob))throw new TypeError("Expected an instance of Blob");this.name="blob",this.file_type=e.type,this.uri=ae.has(e)?ae.get(e):URL.createObjectURL(e),se.set(this.uri,e),ae.set(e,this.uri),e instanceof window.File&&(this.name=e.name)}}],[{key:"_getBlobFromUri",value:function _getBlobFromUri(e){return null===e?null:se.has(e)?se.get(e):null}},{key:"_addBlobUri",value:function _addBlobUri(e,t){se.set(e,t)}}]),File$1}(),ue=new WeakMap,le=c.a.create({timeout:0,maxContentLength:-1}),he=function(){function RequestBase(){_classCallCheck(this,RequestBase),this.parameters={},this.headers={},this.method="GET",this.url=null,this.data=null,this.responseType="json"}return v(RequestBase,null,[{key:"sendRequest",value:function sendRequest(e){if(!(e instanceof this))throw new Error("Request instance expected");return le.request({headers:e.headers,method:e.method,url:e.url,params:e.parameters,data:e.data,responseType:e.responseType}).then(function(t){return"document"===e.responseType&&(t.responseXML=t.data),t})}},{key:"getUriContentHash",value:function getUriContentHash(e){var t=this;return this._getBufferFromUri(e).then(function(e){return t.getBufferContentHash(e)})}},{key:"getBufferContentHash",value:function getBufferContentHash(e){throw new Error("This is abstract")}},{key:"_getBufferFromUri",value:function _getBufferFromUri(e){var t=ce._getBufferFromUri(e);if(null!==t)return Promise.resolve(t);var r=new this;return r.method="get",r.responseType="arraybuffer",r.url=e,this.sendRequest(r).then(function(r){return t=r.data,ce._addBufferUri(e,t),t})}},{key:"formatRequestContext",value:function formatRequestContext(e){return{request:{headers:e.headers,method:e.method,url:e.url,params:e.parameters,data:e.data,responseType:e.responseType}}}},{key:"formatApiError",value:function formatApiError(e,t){var r=this.formatRequestContext(t),n=null,i=null;if(e.response){var o=e.response,a=o.status,s=o.data,c=o.headers;a>=400&&a<500?(n=403===a?"Authentication failed; check your credentials, clock and authorizations":"Request failed due to invalid request",i={response:{data:s,headers:c},request:r}):503===a?(n="Server is busy",i={response:{data:s,headers:c},request:r}):(n="Server error",i={response:{data:s,headers:c},request:r})}else e.request?(n="No response from Server",i={request:r}):(n="No response from Server",i=e);return{message:n,context:i}}}]),v(RequestBase,[{key:"addParameter",value:function addParameter(e,t){return this.parameters[e]=t,this}},{key:"addParameters",value:function addParameters(e){for(var t=Object.keys(e),r=0;r<t.length;r++){var n=t[r];this.addParameter(n,e[n])}return this}},{key:"formattedParameters",value:function formattedParameters(){for(var e=[],t=Object.keys(this.parameters),r=0;r<t.length;r++){var n=t[r],i=this.parameters[n];e.push(n+"="+i)}return e.join("&")}},{key:"addHeader",value:function addHeader(e,t){return this.headers[e]=t,this}},{key:"addHeaders",value:function addHeaders(e){for(var t=Object.keys(e),r=0;r<t.length;r++){var n=t[r];this.addHeader(n,e[n])}return this}},{key:"formattedUrl",value:function formattedUrl(){return this.url+"?"+this.formattedParameters()}},{key:"url",get:function get(){return ue.get(this)},set:function set(e){var t=e;if(null!==e&&-1!==e.indexOf("?")){var r=e.split("?"),n=r.splice(0,1);t=g(n,1)[0];for(var i=r.join("?").split("&"),o=0;o<i.length;o++){var a=i[o].split("="),s=a.splice(0,1)[0],c=a.join("=");this.addParameter(s,c)}}return ue.set(this,t),this}}]),RequestBase}(),pe=function(e){function Request(){return _classCallCheck(this,Request),_possibleConstructorReturn(this,(Request.__proto__||Object.getPrototypeOf(Request)).apply(this,arguments))}return _inherits(Request,he),v(Request,null,[{key:"getBufferContentHash",value:function getBufferContentHash(e){return l()(p.a.create(e,e.length)).toString()}},{key:"formatRequestContext",value:function formatRequestContext(e){var t=m(Request.__proto__||Object.getPrototypeOf(Request),"formatRequestContext",this).call(this,e);if(t.data instanceof FormData){var r={};t.data.entries().forEach(function(e){var t=g(e,2),n=t[0],i=t[1];r[n]=i instanceof Blob?"Blob":i}),t.data=r}return t}}]),Request}(),fe=function(){function Storage(){_classCallCheck(this,Storage),this._idToEntityMap=new Map,this._entityList=null}return v(Storage,[{key:Symbol.iterator,value:function value(){return this.getAll()[Symbol.iterator]()}},{key:"store",value:function store(e){return this._idToEntityMap.set(e.id,e),this._entityList=null,e}},{key:"remove",value:function remove(e){this.has(e.id)&&(this._idToEntityMap.delete(e.id),this._entityList=null)}},{key:"getAll",value:function getAll(){var e=this;return null===this._entityList&&(this._entityList=[],this._idToEntityMap.forEach(function(t){e._entityList.push(t)})),this._entityList}},{key:"get",value:function get(e){return this.has(e)?this._idToEntityMap.get(e):null}},{key:"has",value:function has(e){return this._idToEntityMap.has(e)}},{key:"clone",value:function clone(){var e=new Storage;return this.getAll().forEach(function(t){e._idToEntityMap.set(t.id,t.clone())}),e}}]),Storage}(),de=function(){function AbstractRepository(e){_classCallCheck(this,AbstractRepository),this._expectedClassOf=this.constructor.getEntityClass().getName(),this._logger=new i.b(e.options.logger,this._expectedClassOf),this._init(e)}return v(AbstractRepository,[{key:"isLoaded",value:function isLoaded(){return this._status===R}},{key:"isLoading",value:function isLoading(){return this._status===k}},{key:"load",value:function load(){var e=this,t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(this.isLoading()||this.isLoaded())return this.isLoading()?this._task:Promise.resolve();this._logger.info("loading start"),this._status=k;var r=this._loadIntoNewStorage(t).then(function(t){e._logger.debug("loading storing data"),e._storage=t,e._status=R,e._logger.info("loading success")}).catch(function(t){return e._logger.error("loading fail",{error:t}),e._status=I,Promise.reject(t)});return this._task=r,r}},{key:"loadFromCache",value:function loadFromCache(){var e=this,t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.isLoading()||this.isLoaded())return this.isLoading()?this._task:Promise.resolve();this._logger.info("loading start"),this._status=k;var r=this._loadFromCacheIntoNewStorage(t).then(function(t){e._logger.debug("loading storing data"),e._storage=t,e._status=R,e._logger.info("loading success")}).catch(function(t){return e._logger.error("loading fail",{error:t}),e._status=I,Promise.reject(t)});return this._task=r,r}},{key:"getAll",value:function getAll(){return this._assertIsLoaded(),this._storage.getAll()}},{key:"get",value:function get(e){switch(this._assertIsLoaded(),!0){case e instanceof Y:if(e.classOf!==this._expectedClassOf)throw new TypeError("Expected a Reference<"+this._expectedClassOf+"> but got Reference<"+e.classOf+">");return this._storage.get(e.value);case"object"==(void 0===e?"undefined":y(e))&&null!==e:return this._storage.get(e.id);case"string"==typeof e:return this._storage.get(parseInt(e,10));default:return this._storage.get(e)}}},{key:"getList",value:function getList(e){var t=this,r=[];return e.forEach(function(e){r.push(t.get(e))}),r}},{key:"findBy",value:function findBy(e){if("object"!=(void 0===e?"undefined":y(e)))throw new Error("Filters need to be specified");var t=Object.keys(e);return this.getAll().filter(function(r){for(var n=0;n<t.length;n++){var i=t[n],o=e[i],a=!1;switch(void 0===o?"undefined":y(o)){case"function":a=o(r[i]);break;default:a=r[i]===o}if(!a)return!1}return!0})}},{key:"findOneBy",value:function findOneBy(e){var t=this.findBy(e);if(t.length>1)throw new Error("Result isn't unique, please use #findBy method instead");return 0===t.length?null:t[0]}},{key:"persist",value:function persist(e){this._logger.info("persist entity",{entity:e}),this.em._assertIsNotLocked(),this._persist(e)}},{key:"remove",value:function remove(e){this._logger.info("remove entity",{id:e}),this.em._assertIsNotLocked(),this._remove(e)}},{key:"validate",value:function validate(e){return this._logger.info("validate entity",{entity:e}),this.constructor._throwExceptionIfNotSupported(e),this._assertIsLoaded(),this._validate(e)}},{key:"validateProperty",value:function validateProperty(e,t){return this._logger.info("validate entity",{entity:e}),this.constructor._throwExceptionIfNotSupported(e),this._assertIsLoaded(),this._validateProperty(e,t)}},{key:"isValid",value:function isValid(e){return 0===this.validate(e).size}},{key:"_init",value:function _init(e){this._logger.debug("initialisation"),this.em=e,this._eventDispatcher=C,this._storage=new fe,this._status=L,this._task=null}},{key:"_loadFromCacheIntoNewStorage",value:function _loadFromCacheIntoNewStorage(){var e=this,t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],r=this.em.options.cacheManager;return null===r?Promise.reject(new Error("AbstractRepository.loadFromCache: no CacheManager")):r.get(this.constructor.getName(),this.em.options,t).then(function(t){return e._putResultIntoNewStorage(t)})}},{key:"_validateProperty",value:function _validateProperty(e,t){var r=e.constructor._validators;if(!r.has(t))return null;var n=r.get(t);return n.isValid(this.em,e,t)?null:n.constructor.message}},{key:"_getLoadRequest",value:function _getLoadRequest(e){var t=new pe;return t.url=this.em.options.getEndpoint()+"/"+this.constructor._endpoint,t.parameters.start=e||0,t}},{key:"_getCreateRequest",value:function _getCreateRequest(e){var t=new pe,r=e.toJSON();return delete r.id,this.constructor._readOnlyKeys.forEach(function(e){delete r[e]}),t.method="POST",t.url=this.em.options.getEndpoint()+"/"+this.constructor._endpoint,t.data=JSON.stringify(r),t.addHeader("Content-Type","application/json"),t}},{key:"_getUpdateRequest",value:function _getUpdateRequest(e,t){var r=new pe,n=e.toJSON(),i=this.constructor._readOnlyKeys;return Object.keys(n).forEach(function(e){-1!==t.indexOf(e)&&-1===i.indexOf(e)||delete n[e]}),r.method="POST",r.url=this.em.options.getEndpoint()+"/"+this.constructor._endpoint+"/"+e.id,r.data=JSON.stringify(n),r.addHeader("Content-Type","application/json"),r}},{key:"_getRemoveRequest",value:function _getRemoveRequest(e){var t=new pe;t.method="DELETE",t.url=this.em.options.getEndpoint()+"/"+this.constructor._endpoint;var r=e.map(function(e){return e.id}).join(",");return t.addParameter("id",r),t}},{key:"_assertIsLoaded",value:function _assertIsLoaded(){if(!this.isLoaded())throw this._logger.error("is not loaded"),new Error("The repository "+this.constructor.getName()+" must be loaded but it's in "+this._status+" state for now !")}},{key:"_loadIntoNewStorage",value:function _loadIntoNewStorage(){var e=this,t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return this._logger.verbose("loading first page"),this._loadFromCacheIntoNewStorage(!1).catch(function(){return e._loadFromApiIntoNewStorage()}).catch(function(r){return t?(e._logger.error("loading failed, fallback to outdated cache",{error:r}),e._loadFromCacheIntoNewStorage(!0).catch(function(){return Promise.reject(r)})):Promise.reject(r)})}},{key:"_loadFromApiIntoNewStorage",value:function _loadFromApiIntoNewStorage(){var e=this;return this.em._xhr(this._getLoadRequest(),200).then(function(t){e._logger.verbose("loading first page success");var r=[],n=t.headers["content-range"];if(!n)throw new Error("Content-Range is not present");var i=n.match(/^(-?[0-9]+)-(-?[0-9]+)\/([0-9]+)$/);if(!i)throw new Error("Content-Range invalid");var o=parseInt(i[1],10),a=parseInt(i[2],10),s=parseInt(i[3],10),c=a-o;for(r.push(Promise.resolve(t));a+1<s;)e._logger.verbose("loading next page"),a=(o=a+1)+c,r.push(e.em._xhr(e._getLoadRequest(o),200));return Promise.all(r).then(function(t){e._logger.verbose("loading all pages success");for(var r=[],n=0;n<t.length;n++){var i=t[n].data;if(!Array.isArray(i)){var o="Return format expected to be an array while loading "+e.constructor.getName();throw new Error(o)}r=r.concat(i)}if(r.length!==s)throw new Error('"Expected '+s+" results for but got "+r.length);return r})}).then(function(t){return e._putResultIntoNewStorage(t)})}},{key:"_putResultIntoNewStorage",value:function _putResultIntoNewStorage(e){for(var t=new fe,r=0;r<e.length;r++){var n=this.constructor.fromJSON(e[r]);null!==n&&t.store(n)}return t}},{key:"_replaceStorage",value:function _replaceStorage(e){var t,r=this,n=this._storage;this._storage=e;var i=(_defineProperty(t={},P,[]),_defineProperty(t,E,[]),_defineProperty(t,T,[]),t);return n.getAll().forEach(function(e){null===r.get(e.id)&&i[T].push(e)}),this.getAll().forEach(function(e){if(n.has(e.id)){var t=n.get(e.id),o=r.constructor._compare(t,e);0!==o.length&&(i[E]={current:e,previous:t,changes:o})}else i[P]=e}),i}},{key:"_persist",value:function _persist(e,t){this._logger.debug("persist",{entity:e,internal:t}),this._assertIsLoaded(),this.constructor._throwExceptionIfNotSupported(e),this._assertIsValid(e),null===e.id?this._create(e,t):this._update(e,t)}},{key:"_remove",value:function _remove(e,t){this._logger.debug("remove",{id:e,internal:t}),this._assertIsLoaded();var r=this.get(e);if(null!==r&&(this._storage.remove(r),this._eventDispatcher.publish(this,T,r),!t)){var n=[this,T,[r.clone()]];this._logger.debug("commit",{commit:n}),this.em._uow.commits.add(n)}}},{key:"_validate",value:function _validate(e){var t=this,r=e.constructor._validators,n=new Map;return r.forEach(function(r){var i=g(r,2),o=i[0],a=i[1];a.isValid(t.em,e,o)||n.set(o,a.constructor.message)}),n}},{key:"_assertIsValid",value:function _assertIsValid(e){if(!this.isValid(e)){var t="Given "+e.constructor.getName()+" is not valid";throw this.validate(e).forEach(function(e){var r=g(e,2),n=r[0],i=r[1];t+="\n\t"+n+": "+i}),new TypeError(t)}}},{key:"_create",value:function _create(e,t){if(null===e.id&&(e.id=Symbol("AdsumClientApi_entity_id")),this._overrideSiteEntity(e),this._storage.store(e),this._logger.debug("create",{entity:e,internal:t}),this._eventDispatcher.publish(this,P,e),!t){var r=[this,P,e.clone()];this._logger.debug("commit",{commit:r}),this.em._uow.commits.add(r)}}},{key:"_update",value:function _update(e,t){var r=this.get(e.id);if(null===r)throw new TypeError("Provided entity has id set but is not found, are you sure the entity is not remove ?");if(r.constructor===e.constructor){var n=this.constructor._compare(r,e);if(0!==n.length&&(this._logger.debug("update",{entity:e,previous:r,changes:n,internal:t}),this._storage.store(e),this._eventDispatcher.publish(this,E,{current:e,previous:r,changes:n}),!t)){var i=[this,E,{current:e.clone(),previous:r,changes:n}];this._logger.debug("commit",{commit:i}),this.em._uow.commits.add(i)}}else this._switchType(e,r,t)}},{key:"_overrideSiteEntity",value:function _overrideSiteEntity(e){-1!==e.constructor.keys.indexOf("site")&&(e.site=this.em.options.site)}},{key:"_switchType",value:function _switchType(e,t,r){this._logger.debug("switch type",{entity:e,previous:t,internal:r}),e.id=null,this._create(e,r),this._remove(t,r)}}],[{key:"getName",value:function getName(){return this.getEntityClass().getName()}},{key:"getEntityClass",value:function getEntityClass(){throw new Error("You must implements #getEntityClass")}},{key:"fromJSON",value:function fromJSON(e){return this.getEntityClass().create(e)}},{key:"_compare",value:function _compare(e,t){var r=this;if(this._throwExceptionIfNotSupported(e),this._throwExceptionIfNotSupported(t),t.constructor!==e.constructor)throw new TypeError("Cannot compare two entity of different classes");var n=e.toJSON(),i=t.toJSON(),o=[];return Object.keys(n).forEach(function(e){var t=n[e],a=i[e];r._areDeepEqual(t,a)||o.push(e)}),o}},{key:"_areDeepEqual",value:function _areDeepEqual(e,t){if(e===t)return!0;if("object"!=(void 0===e?"undefined":y(e))||(void 0===e?"undefined":y(e))!=(void 0===t?"undefined":y(t)))return!1;if(null===e||null===t)return!1;if(e.constructor!==t.constructor)return!1;if(Array.isArray(e)){if(e.length!==t.length)return!1;for(var r=new Set,n=0;n<e.length;n++){for(var i=e[n],o=!1,a=0;a<t.length;a++)if(!r.has(a)&&this._areDeepEqual(i,t[a])){r.add(a),o=!0;break}if(!o)return!1}return!0}var s=Object.keys(e);if(!this._areDeepEqual(s,Object.keys(t)))return!1;for(var c=0;c<s.length;c++){var u=s[c];if(!this._areDeepEqual(e[u],t[u]))return!1}return!0}},{key:"_throwExceptionIfNotSupported",value:function _throwExceptionIfNotSupported(e){if(!(e instanceof this.getEntityClass()))throw new TypeError("Unsupported entity")}},{key:"_readOnlyKeys",get:function get(){return[]}},{key:"_endpoint",get:function get(){return this.getEntityClass().getName().toLowerCase()}}]),AbstractRepository}(),me=function(e){function ReferenceValidator(){return _classCallCheck(this,ReferenceValidator),_possibleConstructorReturn(this,(ReferenceValidator.__proto__||Object.getPrototypeOf(ReferenceValidator)).apply(this,arguments))}return _inherits(ReferenceValidator,B),v(ReferenceValidator,[{key:"isValid",value:function isValid(e,t,r){return this.constructor.isReference(e,t[r])}}],[{key:"isReference",value:function isReference(e,t){if(!(t instanceof Y))return!1;var r=e.getRepository(t.classOf);return null!==r&&(t.is(null)||null!==r.get(t))}}]),ReferenceValidator}(),ge=function(e){function NotNullReferenceValidator(){return _classCallCheck(this,NotNullReferenceValidator),_possibleConstructorReturn(this,(NotNullReferenceValidator.__proto__||Object.getPrototypeOf(NotNullReferenceValidator)).apply(this,arguments))}return _inherits(NotNullReferenceValidator,me),v(NotNullReferenceValidator,[{key:"isValid",value:function isValid(e,t,r){return m(NotNullReferenceValidator.prototype.__proto__||Object.getPrototypeOf(NotNullReferenceValidator.prototype),"isValid",this).call(this,e,t,r)&&!t[r].is(null)}}]),NotNullReferenceValidator}(),ye=function(e){function VectorValidator(){return _classCallCheck(this,VectorValidator),_possibleConstructorReturn(this,(VectorValidator.__proto__||Object.getPrototypeOf(VectorValidator)).apply(this,arguments))}return _inherits(VectorValidator,B),v(VectorValidator,[{key:"isValid",value:function isValid(e,t,r){var n=t[r];return n instanceof N&&Number.isFinite(n.x)&&Number.isFinite(n.y)&&Number.isFinite(n.z)}}]),VectorValidator}(),ve=function(e){function IntegerValidator$1(){return _classCallCheck(this,IntegerValidator$1),_possibleConstructorReturn(this,(IntegerValidator$1.__proto__||Object.getPrototypeOf(IntegerValidator$1)).apply(this,arguments))}return _inherits(IntegerValidator$1,B),v(IntegerValidator$1,[{key:"isValid",value:function isValid(e,t,r){return Number.isFinite(t[r])}}]),IntegerValidator$1}(),_e=function(e){function BooleanValidator(){return _classCallCheck(this,BooleanValidator),_possibleConstructorReturn(this,(BooleanValidator.__proto__||Object.getPrototypeOf(BooleanValidator)).apply(this,arguments))}return _inherits(BooleanValidator,B),v(BooleanValidator,[{key:"isValid",value:function isValid(e,t,r){return"boolean"==typeof t[r]}}]),BooleanValidator}(),be={BILLBOARD:"BILLBOARD",STATIC:"STATIC",FLIP:"FLIP"},we=function(e){function CustomObject(){return _classCallCheck(this,CustomObject),_possibleConstructorReturn(this,(CustomObject.__proto__||Object.getPrototypeOf(CustomObject)).apply(this,arguments))}return _inherits(CustomObject,$(re(Q))),v(CustomObject,[{key:"_reset",value:function _reset(){m(CustomObject.prototype.__proto__||Object.getPrototypeOf(CustomObject.prototype),"_reset",this).call(this),this.type=null,this.place=new Y("Place",null),this.poi=new Y("Poi",null),this.offset=new N,this.autoscale=!1,this.rotation=0,this.priority=0,this.orientation_mode=be.BILLBOARD,this.permanent_display=!0}}],[{key:"getName",value:function getName(){return"CustomObject"}},{key:"_buildValidators",value:function _buildValidators(){m(CustomObject.__proto__||Object.getPrototypeOf(CustomObject),"_buildValidators",this).call(this),this._setPropertyValidator("place",new ge),this._setPropertyValidator("poi",new me),this._setPropertyValidator("offset",new ye),this._setPropertyValidator("autoscale",new _e),this._setPropertyValidator("rotation",new ve),this._setPropertyValidator("priority",new z),this._setPropertyValidator("orientation_mode",new ne(be)),this._setPropertyValidator("permanent_display",new _e)}},{key:"keys",get:function get(){var e=m(CustomObject.__proto__||Object.getPrototypeOf(CustomObject),"keys",this);return e.push("type"),e.push("place"),e.push("poi"),e.push("offset"),e.push("autoscale"),e.push("rotation"),e.push("priority"),e.push("orientation_mode"),e.push("permanent_display"),e}}]),CustomObject}(),xe={PICTO:"picto",LABEL:"label"},Me={LEFT:"left",RIGHT:"right",CENTER:"center"},Se=function(e){function PositiveValidator(){return _classCallCheck(this,PositiveValidator),_possibleConstructorReturn(this,(PositiveValidator.__proto__||Object.getPrototypeOf(PositiveValidator)).apply(this,arguments))}return _inherits(PositiveValidator,B),v(PositiveValidator,[{key:"isValid",value:function isValid(e,t,r){return Number.isFinite(t[r])&&t[r]>0}}]),PositiveValidator}(),Ce=function(e){function ConstantValidator(e){var t;return _classCallCheck(this,ConstantValidator),(t=_possibleConstructorReturn(this,(ConstantValidator.__proto__||Object.getPrototypeOf(ConstantValidator)).call(this))).constant=e,t}return _inherits(ConstantValidator,B),v(ConstantValidator,[{key:"isValid",value:function isValid(e,t,r){return t[r]===this.constant}}]),ConstantValidator}(),Pe=function(e){function StringValidator(e){var t;return _classCallCheck(this,StringValidator),(t=_possibleConstructorReturn(this,(StringValidator.__proto__||Object.getPrototypeOf(StringValidator)).call(this))).regex=e,t}return _inherits(StringValidator,B),v(StringValidator,[{key:"isValid",value:function isValid(e,t,r){return"string"==typeof t[r]&&null!==t[r].match(this.regex)}}]),StringValidator}(),Ee=function(e){function Label(){return _classCallCheck(this,Label),_possibleConstructorReturn(this,(Label.__proto__||Object.getPrototypeOf(Label)).apply(this,arguments))}return _inherits(Label,we),v(Label,[{key:"_reset",value:function _reset(){m(Label.prototype.__proto__||Object.getPrototypeOf(Label.prototype),"_reset",this).call(this),this.type=xe.LABEL,this.alignment=Me.CENTER,this.font="Arial",this.font_size=5,this.font_color="#000000",this.background_color=null,this.label=null}}],[{key:"getName",value:function getName(){return"Label"}},{key:"_isAbstract",value:function _isAbstract(){return!1}},{key:"_buildValidators",value:function _buildValidators(){m(Label.__proto__||Object.getPrototypeOf(Label),"_buildValidators",this).call(this),this._setPropertyValidator("type",new Ce(xe.LABEL)),this._setPropertyValidator("font",new V([new U,new ee])),this._setPropertyValidator("alignment",new ne(Me)),this._setPropertyValidator("font_size",new D([new z,new Se])),this._setPropertyValidator("background_color",new V([new U,new Pe(/^#([A-Fa-f0-9]{6}|[A-Fa-f0-9]{3})$/)])),this._setPropertyValidator("font_color",new Pe(/^#([A-Fa-f0-9]{6}|[A-Fa-f0-9]{3})$/)),this._setPropertyValidator("label",new ee)}},{key:"keys",get:function get(){var e=m(Label.__proto__||Object.getPrototypeOf(Label),"keys",this);return e.push("font"),e.push("alignment"),e.push("font_size"),e.push("font_color"),e.push("background_color"),e.push("label"),e}}]),Label}(),Te=function HasFileTrait(e){return function(t){function _class4(){return _classCallCheck(this,_class4),_possibleConstructorReturn(this,(_class4.__proto__||Object.getPrototypeOf(_class4)).apply(this,arguments))}return _inherits(_class4,e),v(_class4,[{key:"_reset",value:function _reset(){m(_class4.prototype.__proto__||Object.getPrototypeOf(_class4.prototype),"_reset",this).call(this),this.file=new Y("File",null)}}],[{key:"_buildValidators",value:function _buildValidators(){m(_class4.__proto__||Object.getPrototypeOf(_class4),"_buildValidators",this).call(this),this._setPropertyValidator("file",new ge)}},{key:"keys",get:function get(){var e=m(_class4.__proto__||Object.getPrototypeOf(_class4),"keys",this);return e.push("file"),e}}]),_class4}()},Oe=function(e){function Picto(){return _classCallCheck(this,Picto),_possibleConstructorReturn(this,(Picto.__proto__||Object.getPrototypeOf(Picto)).apply(this,arguments))}return _inherits(Picto,Te(we)),v(Picto,[{key:"_reset",value:function _reset(){m(Picto.prototype.__proto__||Object.getPrototypeOf(Picto.prototype),"_reset",this).call(this),this.type=xe.PICTO,this.width=null,this.height=null,this.original_md5=null}}],[{key:"getName",value:function getName(){return"Picto"}},{key:"_isAbstract",value:function _isAbstract(){return!1}},{key:"_buildValidators",value:function _buildValidators(){m(Picto.__proto__||Object.getPrototypeOf(Picto),"_buildValidators",this).call(this),this._setPropertyValidator("type",new Ce(xe.PICTO)),this._setPropertyValidator("width",new Se),this._setPropertyValidator("height",new Se),this._setPropertyValidator("original_md5",new V([new U,new ee]))}},{key:"keys",get:function get(){var e=m(Picto.__proto__||Object.getPrototypeOf(Picto),"keys",this);return e.push("width"),e.push("height"),e.push("original_md5"),e}}]),Picto}(),Ae=function(e){function CustomObjectRepository(){return _classCallCheck(this,CustomObjectRepository),_possibleConstructorReturn(this,(CustomObjectRepository.__proto__||Object.getPrototypeOf(CustomObjectRepository)).apply(this,arguments))}return _inherits(CustomObjectRepository,de),v(CustomObjectRepository,null,[{key:"getEntityClass",value:function getEntityClass(){return we}},{key:"fromJSON",value:function fromJSON(e){if("object"!=(void 0===e?"undefined":y(e))||null===e)throw new TypeError("Expected an object");switch(e.type){case"label":return new Ee(e);case"picto":return new Oe(e);default:throw new Error("Unable to parse CustomObject "+e.type)}}}]),CustomObjectRepository}(),Le=function(){function DateUtils(){_classCallCheck(this,DateUtils)}return v(DateUtils,null,[{key:"fromJSON",value:function fromJSON(e){if(null===e||void 0===e)return null;if(e instanceof Date)return Number.isFinite(e.getTime())?e:null;if("string"!=typeof e&&!Number.isFinite(e))return null;var t=new Date;return t.setTime("string"==typeof e?Date.parse(e):e),Number.isFinite(t.getTime())?t:null}}]),DateUtils}(),ke=function(e){function DateValidator(){return _classCallCheck(this,DateValidator),_possibleConstructorReturn(this,(DateValidator.__proto__||Object.getPrototypeOf(DateValidator)).apply(this,arguments))}return _inherits(DateValidator,B),v(DateValidator,[{key:"isValid",value:function isValid(e,t,r){return t[r]instanceof Date&&Number.isFinite(t[r].getTime())}}]),DateValidator}(),Re=function(e){function Device(){return _classCallCheck(this,Device),_possibleConstructorReturn(this,(Device.__proto__||Object.getPrototypeOf(Device)).apply(this,arguments))}return _inherits(Device,te($(re(Q)))),v(Device,[{key:"set",value:function set(e,t){return"validate_at"===e?(this[e]=Le.fromJSON(t),this):m(Device.prototype.__proto__||Object.getPrototypeOf(Device.prototype),"set",this).call(this,e,t)}},{key:"_reset",value:function _reset(){m(Device.prototype.__proto__||Object.getPrototypeOf(Device.prototype),"_reset",this).call(this),this.type=null,this.core_version=null,this.width=null,this.height=null,this.validate_at=null,this.site_calibration=new Y("SiteCalibration",null)}}],[{key:"getName",value:function getName(){return"Device"}},{key:"_buildValidators",value:function _buildValidators(){m(Device.__proto__||Object.getPrototypeOf(Device),"_buildValidators",this).call(this),this._setPropertyValidator("site_calibration",new me),this._setPropertyValidator("core_version",new V([new U,new ee])),this._setPropertyValidator("width",new V([new U,new z])),this._setPropertyValidator("height",new V([new U,new z])),this._setPropertyValidator("validate_at",new V([new U,new ke]))}},{key:"keys",get:function get(){var e=m(Device.__proto__||Object.getPrototypeOf(Device),"keys",this);return e.push("type"),e.push("site_calibration"),e.push("core_version"),e.push("width"),e.push("height"),e.push("validate_at"),e}}]),Device}(),Ie="kiosk",Ne="mobile",Fe="web",je=function(e){function Kiosk(){return _classCallCheck(this,Kiosk),_possibleConstructorReturn(this,(Kiosk.__proto__||Object.getPrototypeOf(Kiosk)).apply(this,arguments))}return _inherits(Kiosk,Re),v(Kiosk,[{key:"_reset",value:function _reset(){m(Kiosk.prototype.__proto__||Object.getPrototypeOf(Kiosk.prototype),"_reset",this).call(this),this.type=Ie,this.position=new N,this.os=null,this.location=null}}],[{key:"getName",value:function getName(){return"Kiosk"}},{key:"_isAbstract",value:function _isAbstract(){return!1}},{key:"_buildValidators",value:function _buildValidators(){m(Kiosk.__proto__||Object.getPrototypeOf(Kiosk),"_buildValidators",this).call(this),this._setPropertyValidator("type",new Ce(Ie)),this._setPropertyValidator("position",new ye),this._setPropertyValidator("os",new V([new ee,new U])),this._setPropertyValidator("location",new V([new ee,new U]))}},{key:"keys",get:function get(){var e=m(Kiosk.__proto__||Object.getPrototypeOf(Kiosk),"keys",this);return e.push("position"),e.push("os"),e.push("location"),e}}]),Kiosk}(),Be=function(e){function Mobile(){return _classCallCheck(this,Mobile),_possibleConstructorReturn(this,(Mobile.__proto__||Object.getPrototypeOf(Mobile)).apply(this,arguments))}return _inherits(Mobile,Re),v(Mobile,[{key:"_reset",value:function _reset(){m(Mobile.prototype.__proto__||Object.getPrototypeOf(Mobile.prototype),"_reset",this).call(this),this.type=Ne}}],[{key:"getName",value:function getName(){return"Mobile"}},{key:"_isAbstract",value:function _isAbstract(){return!1}},{key:"_buildValidators",value:function _buildValidators(){m(Mobile.__proto__||Object.getPrototypeOf(Mobile),"_buildValidators",this).call(this),this._setPropertyValidator("type",new Ce(Ne))}}]),Mobile}(),Ve=function(e){function Web(){return _classCallCheck(this,Web),_possibleConstructorReturn(this,(Web.__proto__||Object.getPrototypeOf(Web)).apply(this,arguments))}return _inherits(Web,Re),v(Web,[{key:"_reset",value:function _reset(){m(Web.prototype.__proto__||Object.getPrototypeOf(Web.prototype),"_reset",this).call(this),this.type=Fe}}],[{key:"getName",value:function getName(){return"Web"}},{key:"_isAbstract",value:function _isAbstract(){return!1}},{key:"_buildValidators",value:function _buildValidators(){m(Web.__proto__||Object.getPrototypeOf(Web),"_buildValidators",this).call(this),this._setPropertyValidator("type",new Ce(Fe))}}]),Web}(),De=function(e){function DeviceRepository(){return _classCallCheck(this,DeviceRepository),_possibleConstructorReturn(this,(DeviceRepository.__proto__||Object.getPrototypeOf(DeviceRepository)).apply(this,arguments))}return _inherits(DeviceRepository,de),v(DeviceRepository,null,[{key:"getEntityClass",value:function getEntityClass(){return Re}},{key:"fromJSON",value:function fromJSON(e){if("object"!=(void 0===e?"undefined":y(e))||null===e)throw new TypeError("Expected an object");switch(e.type){case"kiosk":return new je(e);case"mobile":return new Be(e);case"web":return new Ve(e);default:throw new Error("Unable to parse Device "+e.type)}}}]),DeviceRepository}(),Ue=function IsVersionedTrait(e){return function(t){function _class5(){return _classCallCheck(this,_class5),_possibleConstructorReturn(this,(_class5.__proto__||Object.getPrototypeOf(_class5)).apply(this,arguments))}return _inherits(_class5,e),v(_class5,[{key:"set",value:function set(e,t){return"created_at"===e||"updated_at"===e?(this[e]=Le.fromJSON(t),this):m(_class5.prototype.__proto__||Object.getPrototypeOf(_class5.prototype),"set",this).call(this,e,t)}},{key:"_reset",value:function _reset(){m(_class5.prototype.__proto__||Object.getPrototypeOf(_class5.prototype),"_reset",this).call(this),this.version=null,this.created_at=null,this.updated_at=null}}],[{key:"keys",get:function get(){var e=m(_class5.__proto__||Object.getPrototypeOf(_class5),"keys",this);return e.push("version"),e.push("created_at"),e.push("updated_at"),e}}]),_class5}()},Ge=function(e){function MapFile(){return _classCallCheck(this,MapFile),_possibleConstructorReturn(this,(MapFile.__proto__||Object.getPrototypeOf(MapFile)).apply(this,arguments))}return _inherits(MapFile,te(Ue($(Te(re(Q)))))),v(MapFile,[{key:"_reset",value:function _reset(){m(MapFile.prototype.__proto__||Object.getPrototypeOf(MapFile.prototype),"_reset",this).call(this),this.type=null}}],[{key:"getName",value:function getName(){return"MapFile"}},{key:"_isAbstract",value:function _isAbstract(){return!0}},{key:"keys",get:function get(){var e=m(MapFile.__proto__||Object.getPrototypeOf(MapFile),"keys",this);return e.push("type"),e}}]),MapFile}(),ze={AO_DAE:"aoDae",CONFIG:"config",DAE:"dae",HELPER:"helper",IVE:"ive",LIGHT:"light",OSG:"osg",PATH:"path"},He=function(e){function MapConfig(){return _classCallCheck(this,MapConfig),_possibleConstructorReturn(this,(MapConfig.__proto__||Object.getPrototypeOf(MapConfig)).apply(this,arguments))}return _inherits(MapConfig,Ge),v(MapConfig,[{key:"_reset",value:function _reset(){m(MapConfig.prototype.__proto__||Object.getPrototypeOf(MapConfig.prototype),"_reset",this).call(this),this.type=ze.CONFIG}}],[{key:"getName",value:function getName(){return"MapConfig"}},{key:"_isAbstract",value:function _isAbstract(){return!1}},{key:"_buildValidators",value:function _buildValidators(){m(MapConfig.__proto__||Object.getPrototypeOf(MapConfig),"_buildValidators",this).call(this),this._setPropertyValidator("type",new Ce(ze.CONFIG))}}]),MapConfig}(),We=function(e){function MapDae(){return _classCallCheck(this,MapDae),_possibleConstructorReturn(this,(MapDae.__proto__||Object.getPrototypeOf(MapDae)).apply(this,arguments))}return _inherits(MapDae,Ge),v(MapDae,[{key:"_reset",value:function _reset(){m(MapDae.prototype.__proto__||Object.getPrototypeOf(MapDae.prototype),"_reset",this).call(this),this.type=ze.DAE}}],[{key:"getName",value:function getName(){return"MapDae"}},{key:"_isAbstract",value:function _isAbstract(){return!1}},{key:"_buildValidators",value:function _buildValidators(){m(MapDae.__proto__||Object.getPrototypeOf(MapDae),"_buildValidators",this).call(this),this._setPropertyValidator("type",new Ce(ze.DAE))}}]),MapDae}(),qe=function(e){function MapAoDae(){return _classCallCheck(this,MapAoDae),_possibleConstructorReturn(this,(MapAoDae.__proto__||Object.getPrototypeOf(MapAoDae)).apply(this,arguments))}return _inherits(MapAoDae,Ge),v(MapAoDae,[{key:"_reset",value:function _reset(){m(MapAoDae.prototype.__proto__||Object.getPrototypeOf(MapAoDae.prototype),"_reset",this).call(this),this.type=ze.AO_DAE}}],[{key:"getName",value:function getName(){return"MapAoDae"}},{key:"_isAbstract",value:function _isAbstract(){return!1}},{key:"_buildValidators",value:function _buildValidators(){m(MapAoDae.__proto__||Object.getPrototypeOf(MapAoDae),"_buildValidators",this).call(this),this._setPropertyValidator("type",new Ce(ze.AO_DAE))}}]),MapAoDae}(),Xe=function(e){function MapLight(){return _classCallCheck(this,MapLight),_possibleConstructorReturn(this,(MapLight.__proto__||Object.getPrototypeOf(MapLight)).apply(this,arguments))}return _inherits(MapLight,Ge),v(MapLight,[{key:"_reset",value:function _reset(){m(MapLight.prototype.__proto__||Object.getPrototypeOf(MapLight.prototype),"_reset",this).call(this),this.type=ze.LIGHT}}],[{key:"getName",value:function getName(){return"MapLight"}},{key:"_isAbstract",value:function _isAbstract(){return!1}},{key:"_buildValidators",value:function _buildValidators(){m(MapLight.__proto__||Object.getPrototypeOf(MapLight),"_buildValidators",this).call(this),this._setPropertyValidator("type",new Ce(ze.LIGHT))}}]),MapLight}(),Ye=function(e){function MapHelper(){return _classCallCheck(this,MapHelper),_possibleConstructorReturn(this,(MapHelper.__proto__||Object.getPrototypeOf(MapHelper)).apply(this,arguments))}return _inherits(MapHelper,Ge),v(MapHelper,[{key:"_reset",value:function _reset(){m(MapHelper.prototype.__proto__||Object.getPrototypeOf(MapHelper.prototype),"_reset",this).call(this),this.type=ze.HELPER}}],[{key:"getName",value:function getName(){return"MapHelper"}},{key:"_isAbstract",value:function _isAbstract(){return!1}},{key:"_buildValidators",value:function _buildValidators(){m(MapHelper.__proto__||Object.getPrototypeOf(MapHelper),"_buildValidators",this).call(this),this._setPropertyValidator("type",new Ce(ze.HELPER))}}]),MapHelper}(),Je=function(e){function MapPath(){return _classCallCheck(this,MapPath),_possibleConstructorReturn(this,(MapPath.__proto__||Object.getPrototypeOf(MapPath)).apply(this,arguments))}return _inherits(MapPath,Ge),v(MapPath,[{key:"_reset",value:function _reset(){m(MapPath.prototype.__proto__||Object.getPrototypeOf(MapPath.prototype),"_reset",this).call(this),this.type=ze.PATH,this.paths=new Map}}],[{key:"getName",value:function getName(){return"MapPath"}},{key:"_isAbstract",value:function _isAbstract(){return!1}},{key:"_buildValidators",value:function _buildValidators(){m(MapPath.__proto__||Object.getPrototypeOf(MapPath),"_buildValidators",this).call(this),this._setPropertyValidator("type",new Ce(ze.PATH))}},{key:"keys",get:function get(){var e=m(MapPath.__proto__||Object.getPrototypeOf(MapPath),"keys",this);return e.push("paths"),e}}]),MapPath}(),Ze=function(e){function MapFileRepository(){return _classCallCheck(this,MapFileRepository),_possibleConstructorReturn(this,(MapFileRepository.__proto__||Object.getPrototypeOf(MapFileRepository)).apply(this,arguments))}return _inherits(MapFileRepository,de),v(MapFileRepository,null,[{key:"getEntityClass",value:function getEntityClass(){return Ge}},{key:"fromJSON",value:function fromJSON(e){if("object"!=(void 0===e?"undefined":y(e))||null===e)throw new TypeError("Expected an object");switch(e.type){case"config":return new He(e);case"dae":return new We(e);case"aoDae":return new qe(e);case"light":return new Xe(e);case"helper":return new Ye(e);case"path":return new Je(e);case"ive":case"osg":case"model":case"aoOsg":return null;default:throw new Error("Unable to parse MapFile "+e.type)}}},{key:"_endpoint",get:function get(){return"map"}}]),MapFileRepository}(),Ke=function(e){function StringValidator$1(){return _classCallCheck(this,StringValidator$1),_possibleConstructorReturn(this,(StringValidator$1.__proto__||Object.getPrototypeOf(StringValidator$1)).apply(this,arguments))}return _inherits(StringValidator$1,B),v(StringValidator$1,[{key:"isValid",value:function isValid(e,t,r){return"string"==typeof t[r]}}]),StringValidator$1}(),Qe=function HasDescriptionTrait(e){return function(t){function _class6(){return _classCallCheck(this,_class6),_possibleConstructorReturn(this,(_class6.__proto__||Object.getPrototypeOf(_class6)).apply(this,arguments))}return _inherits(_class6,e),v(_class6,[{key:"_reset",value:function _reset(){m(_class6.prototype.__proto__||Object.getPrototypeOf(_class6.prototype),"_reset",this).call(this),this.description=null}}],[{key:"_buildValidators",value:function _buildValidators(){m(_class6.__proto__||Object.getPrototypeOf(_class6),"_buildValidators",this).call(this),this._setPropertyValidator("description",new V([new U,new Ke]))}},{key:"keys",get:function get(){var e=m(_class6.__proto__||Object.getPrototypeOf(_class6),"keys",this);return e.push("description"),e}}]),_class6}()},$e=function HasSignatureTrait(e){return function(t){function _class7(){return _classCallCheck(this,_class7),_possibleConstructorReturn(this,(_class7.__proto__||Object.getPrototypeOf(_class7)).apply(this,arguments))}return _inherits(_class7,e),v(_class7,[{key:"_reset",value:function _reset(){m(_class7.prototype.__proto__||Object.getPrototypeOf(_class7.prototype),"_reset",this).call(this),this.signature=null}}],[{key:"keys",get:function get(){var e=m(_class7.__proto__||Object.getPrototypeOf(_class7),"keys",this);return e.push("signature"),e}}]),_class7}()},et=function HasClientIdTrait(e){return function(t){function _class8(){return _classCallCheck(this,_class8),_possibleConstructorReturn(this,(_class8.__proto__||Object.getPrototypeOf(_class8)).apply(this,arguments))}return _inherits(_class8,e),v(_class8,[{key:"_reset",value:function _reset(){m(_class8.prototype.__proto__||Object.getPrototypeOf(_class8.prototype),"_reset",this).call(this),this.client_id=null}}],[{key:"_buildValidators",value:function _buildValidators(){m(_class8.__proto__||Object.getPrototypeOf(_class8),"_buildValidators",this).call(this),this._setPropertyValidator("client_id",new V([new U,new ee]))}},{key:"keys",get:function get(){var e=m(_class8.__proto__||Object.getPrototypeOf(_class8),"keys",this);return e.push("client_id"),e}}]),_class8}()},tt=function(e){function CollectionValidator(){return _classCallCheck(this,CollectionValidator),_possibleConstructorReturn(this,(CollectionValidator.__proto__||Object.getPrototypeOf(CollectionValidator)).apply(this,arguments))}return _inherits(CollectionValidator,B),v(CollectionValidator,[{key:"isValid",value:function isValid(e,t,r){var n=t[r];if(!(n instanceof J))return!1;var i=!0;return n.forEach(function(t){if(null!==t){var r=new Y(n.classOf,t);me.isReference(e,r)&&!r.is(null)||(i=!1)}else i=!1}),i}}]),CollectionValidator}(),rt=function(e){function OrderedCollectionValidator(){return _classCallCheck(this,OrderedCollectionValidator),_possibleConstructorReturn(this,(OrderedCollectionValidator.__proto__||Object.getPrototypeOf(OrderedCollectionValidator)).apply(this,arguments))}return _inherits(OrderedCollectionValidator,B),v(OrderedCollectionValidator,[{key:"isValid",value:function isValid(e,t,r){var n=t[r];if(!(n instanceof Z))return!1;var i=!0;return n.forEach(function(t){if(null!==t){var r=new Y(n.classOf,t);me.isReference(e,r)&&!r.is(null)||(i=!1)}else i=!1}),i}}]),OrderedCollectionValidator}(),nt=function(e){function Media(){return _classCallCheck(this,Media),_possibleConstructorReturn(this,(Media.__proto__||Object.getPrototypeOf(Media)).apply(this,arguments))}return _inherits(Media,et($e(Ue(Qe(te($(re(Q)))))))),v(Media,[{key:"set",value:function set(e,t){return"start_at"!==e&&"end_at"!==e?m(Media.prototype.__proto__||Object.getPrototypeOf(Media.prototype),"set",this).call(this,e,t):(this[e]=Le.fromJSON(t),this)}},{key:"_reset",value:function _reset(){m(Media.prototype.__proto__||Object.getPrototypeOf(Media.prototype),"_reset",this).call(this),this.type=null,this.start_at=null,this.end_at=null,this.tags=new J("Tag"),this.playlists=new Z("Playlist"),this.pois=new J("Poi"),this.preview=new Y("File",null)}}],[{key:"getName",value:function getName(){return"Media"}},{key:"_buildValidators",value:function _buildValidators(){m(Media.__proto__||Object.getPrototypeOf(Media),"_buildValidators",this).call(this),this._setPropertyValidator("tags",new tt),this._setPropertyValidator("playlists",new rt),this._setPropertyValidator("pois",new tt),this._setPropertyValidator("preview",new me),this._setPropertyValidator("start_at",new V([new U,new ke])),this._setPropertyValidator("end_at",new V([new U,new ke]))}},{key:"keys",get:function get(){var e=m(Media.__proto__||Object.getPrototypeOf(Media),"keys",this);return e.push("type"),e.push("tags"),e.push("playlists"),e.push("pois"),e.push("preview"),e.push("start_at"),e.push("end_at"),e}}]),Media}(),it="image",ot="pdf",at="text",st="url",ct="video",ut="movie",lt=function(e){function MediaText(){return _classCallCheck(this,MediaText),_possibleConstructorReturn(this,(MediaText.__proto__||Object.getPrototypeOf(MediaText)).apply(this,arguments))}return _inherits(MediaText,nt),v(MediaText,[{key:"_reset",value:function _reset(){m(MediaText.prototype.__proto__||Object.getPrototypeOf(MediaText.prototype),"_reset",this).call(this),this.type=at,this.format=null,this.identifier=null,this.content=null}}],[{key:"getName",value:function getName(){return"MediaText"}},{key:"_isAbstract",value:function _isAbstract(){return!1}},{key:"_buildValidators",value:function _buildValidators(){m(MediaText.__proto__||Object.getPrototypeOf(MediaText),"_buildValidators",this).call(this),this._setPropertyValidator("type",new Ce(at)),this._setPropertyValidator("format",new V([new U,new ee])),this._setPropertyValidator("identifier",new V([new U,new ee])),this._setPropertyValidator("content",new V([new U,new ee]))}},{key:"keys",get:function get(){var e=m(MediaText.__proto__||Object.getPrototypeOf(MediaText),"keys",this);return e.push("format"),e.push("identifier"),e.push("content"),e}}]),MediaText}(),ht=function(e){function MediaImage(){return _classCallCheck(this,MediaImage),_possibleConstructorReturn(this,(MediaImage.__proto__||Object.getPrototypeOf(MediaImage)).apply(this,arguments))}return _inherits(MediaImage,Te(nt)),v(MediaImage,[{key:"_reset",value:function _reset(){m(MediaImage.prototype.__proto__||Object.getPrototypeOf(MediaImage.prototype),"_reset",this).call(this),this.type=it}}],[{key:"getName",value:function getName(){return"MediaImage"}},{key:"_isAbstract",value:function _isAbstract(){return!1}},{key:"_buildValidators",value:function _buildValidators(){m(MediaImage.__proto__||Object.getPrototypeOf(MediaImage),"_buildValidators",this).call(this),this._setPropertyValidator("type",new Ce(it))}}]),MediaImage}(),pt=function(e){function MediaPdf(){return _classCallCheck(this,MediaPdf),_possibleConstructorReturn(this,(MediaPdf.__proto__||Object.getPrototypeOf(MediaPdf)).apply(this,arguments))}return _inherits(MediaPdf,Te(nt)),v(MediaPdf,[{key:"_reset",value:function _reset(){m(MediaPdf.prototype.__proto__||Object.getPrototypeOf(MediaPdf.prototype),"_reset",this).call(this),this.type=ot}}],[{key:"getName",value:function getName(){return"MediaPdf"}},{key:"_isAbstract",value:function _isAbstract(){return!1}},{key:"_buildValidators",value:function _buildValidators(){m(MediaPdf.__proto__||Object.getPrototypeOf(MediaPdf),"_buildValidators",this).call(this),this._setPropertyValidator("type",new Ce(ot))}}]),MediaPdf}(),ft=function(e){function MediaUrl(){return _classCallCheck(this,MediaUrl),_possibleConstructorReturn(this,(MediaUrl.__proto__||Object.getPrototypeOf(MediaUrl)).apply(this,arguments))}return _inherits(MediaUrl,nt),v(MediaUrl,[{key:"_reset",value:function _reset(){m(MediaUrl.prototype.__proto__||Object.getPrototypeOf(MediaUrl.prototype),"_reset",this).call(this),this.type=st,this.link=null}}],[{key:"getName",value:function getName(){return"MediaUrl"}},{key:"_isAbstract",value:function _isAbstract(){return!1}},{key:"_buildValidators",value:function _buildValidators(){m(MediaUrl.__proto__||Object.getPrototypeOf(MediaUrl),"_buildValidators",this).call(this),this._setPropertyValidator("type",new Ce(st)),this._setPropertyValidator("link",new ee)}},{key:"keys",get:function get(){var e=m(MediaUrl.__proto__||Object.getPrototypeOf(MediaUrl),"keys",this);return e.push("link"),e}}]),MediaUrl}(),dt=function(e){function MediaVideo(){return _classCallCheck(this,MediaVideo),_possibleConstructorReturn(this,(MediaVideo.__proto__||Object.getPrototypeOf(MediaVideo)).apply(this,arguments))}return _inherits(MediaVideo,Te(nt)),v(MediaVideo,[{key:"_reset",value:function _reset(){m(MediaVideo.prototype.__proto__||Object.getPrototypeOf(MediaVideo.prototype),"_reset",this).call(this),this.type=ct}}],[{key:"getName",value:function getName(){return"MediaVideo"}},{key:"_isAbstract",value:function _isAbstract(){return!1}},{key:"_buildValidators",value:function _buildValidators(){m(MediaVideo.__proto__||Object.getPrototypeOf(MediaVideo),"_buildValidators",this).call(this),this._setPropertyValidator("type",new Ce(ct))}}]),MediaVideo}(),mt=function(e){function SetValidator(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return _classCallCheck(this,SetValidator),(e=_possibleConstructorReturn(this,(SetValidator.__proto__||Object.getPrototypeOf(SetValidator)).call(this))).validator=t,e}return _inherits(SetValidator,B),v(SetValidator,[{key:"isValid",value:function isValid(e,t,r){if(null===this.validator)return!0;if(!(t[r]instanceof Set))return!1;for(var n=Array.from(t[r]),i=0;i<n.length;i++)if(!this.validator.isValid(e,n,i))return!1;return!0}}]),SetValidator}(),gt=function(e){function Movie(){return _classCallCheck(this,Movie),_possibleConstructorReturn(this,(Movie.__proto__||Object.getPrototypeOf(Movie)).apply(this,arguments))}return _inherits(Movie,Te(nt)),v(Movie,[{key:"set",value:function set(e,t){if("coming_sessions"!==e)return m(Movie.prototype.__proto__||Object.getPrototypeOf(Movie.prototype),"set",this).call(this,e,t);var r=[];return t.forEach(function(e){var t=Le.fromJSON(e);r.push(t)}),q.set(this.coming_sessions,r),this}},{key:"_reset",value:function _reset(){m(Movie.prototype.__proto__||Object.getPrototypeOf(Movie.prototype),"_reset",this).call(this),this.type=ut,this.actors=new Set,this.coming_sessions=new Set,this.director=null,this.certification=null,this.duration=null}}],[{key:"getName",value:function getName(){return"Movie"}},{key:"_isAbstract",value:function _isAbstract(){return!1}},{key:"_buildValidators",value:function _buildValidators(){m(Movie.__proto__||Object.getPrototypeOf(Movie),"_buildValidators",this).call(this),this._setPropertyValidator("type",new Ce(ut)),this._setPropertyValidator("actors",new mt(new Ke)),this._setPropertyValidator("coming_sessions",new mt(new ke)),this._setPropertyValidator("director",new V([new U,new ee])),this._setPropertyValidator("certification",new V([new U,new ee]))}},{key:"keys",get:function get(){var e=m(Movie.__proto__||Object.getPrototypeOf(Movie),"keys",this);return e.push("actors"),e.push("coming_sessions"),e.push("director"),e.push("certification"),e.push("duration"),e}}]),Movie}(),yt=function(e){function MediaRepository(){return _classCallCheck(this,MediaRepository),_possibleConstructorReturn(this,(MediaRepository.__proto__||Object.getPrototypeOf(MediaRepository)).apply(this,arguments))}return _inherits(MediaRepository,de),v(MediaRepository,null,[{key:"getEntityClass",value:function getEntityClass(){return nt}},{key:"fromJSON",value:function fromJSON(e){if("object"!=(void 0===e?"undefined":y(e))||null===e)throw new TypeError("Expected an object");switch(e.type){case"text":return new lt(e);case"image":return new ht(e);case"pdf":return new pt(e);case"url":return new ft(e);case"video":return new dt(e);case"movie":return new gt(e);default:throw new Error("Unable to parse Media "+e.type)}}}]),MediaRepository}(),vt=function(e){function Poi(){return _classCallCheck(this,Poi),_possibleConstructorReturn(this,(Poi.__proto__||Object.getPrototypeOf(Poi)).apply(this,arguments))}return _inherits(Poi,Qe(te(Ue(re($e(et($(Q)))))))),v(Poi,[{key:"_reset",value:function _reset(){m(Poi.prototype.__proto__||Object.getPrototypeOf(Poi.prototype),"_reset",this).call(this),this.categories=new J("Category"),this.children=new Z("Poi"),this.custom_objects=new J("CustomObject"),this.logos=new Z("File"),this.medias=new Z("Media"),this.new=!0,this.parents=new J("Poi"),this.pictures=new Z("File"),this.places=new J("Place"),this.tags=new J("Tag"),this.type=null}}],[{key:"getName",value:function getName(){return"Poi"}},{key:"_buildValidators",value:function _buildValidators(){m(Poi.__proto__||Object.getPrototypeOf(Poi),"_buildValidators",this).call(this),this._setPropertyValidator("new",new _e),this._setPropertyValidator("categories",new tt),this._setPropertyValidator("custom_objects",new tt),this._setPropertyValidator("places",new tt),this._setPropertyValidator("tags",new tt),this._setPropertyValidator("parents",new tt),this._setPropertyValidator("children",new rt),this._setPropertyValidator("logos",new rt),this._setPropertyValidator("pictures",new rt),this._setPropertyValidator("medias",new rt)}},{key:"keys",get:function get(){var e=m(Poi.__proto__||Object.getPrototypeOf(Poi),"keys",this);return e.push("type"),e.push("new"),e.push("categories"),e.push("custom_objects"),e.push("places"),e.push("tags"),e.push("parents"),e.push("children"),e.push("logos"),e.push("pictures"),e.push("medias"),e}}]),Poi}(),_t="exhibitor",bt="person",wt="product",xt="room",Mt="service",St="store",Ct=function(e){function Exhibitor(){return _classCallCheck(this,Exhibitor),_possibleConstructorReturn(this,(Exhibitor.__proto__||Object.getPrototypeOf(Exhibitor)).apply(this,arguments))}return _inherits(Exhibitor,vt),v(Exhibitor,[{key:"_reset",value:function _reset(){m(Exhibitor.prototype.__proto__||Object.getPrototypeOf(Exhibitor.prototype),"_reset",this).call(this),this.type=_t,this.phone=null,this.url=null}}],[{key:"getName",value:function getName(){return"Exhibitor"}},{key:"_isAbstract",value:function _isAbstract(){return!1}},{key:"_buildValidators",value:function _buildValidators(){m(Exhibitor.__proto__||Object.getPrototypeOf(Exhibitor),"_buildValidators",this).call(this),this._setPropertyValidator("type",new Ce(_t)),this._setPropertyValidator("phone",new V([new U,new ee])),this._setPropertyValidator("url",new V([new U,new ee]))}},{key:"keys",get:function get(){var e=m(Exhibitor.__proto__||Object.getPrototypeOf(Exhibitor),"keys",this);return e.push("phone"),e.push("url"),e}}]),Exhibitor}(),Pt=function(e){function Person(){return _classCallCheck(this,Person),_possibleConstructorReturn(this,(Person.__proto__||Object.getPrototypeOf(Person)).apply(this,arguments))}return _inherits(Person,vt),v(Person,[{key:"_reset",value:function _reset(){m(Person.prototype.__proto__||Object.getPrototypeOf(Person.prototype),"_reset",this).call(this),this.type=bt,this.firstname=null,this.lastname=null,this.desk_phone=null,this.mobile_phone=null}}],[{key:"getName",value:function getName(){return"Person"}},{key:"_isAbstract",value:function _isAbstract(){return!1}},{key:"_buildValidators",value:function _buildValidators(){m(Person.__proto__||Object.getPrototypeOf(Person),"_buildValidators",this).call(this),this._setPropertyValidator("type",new Ce(bt)),this._setPropertyValidator("firstname",new V([new U,new ee])),this._setPropertyValidator("lastname",new V([new U,new ee])),this._setPropertyValidator("desk_phone",new V([new U,new ee])),this._setPropertyValidator("mobile_phone",new V([new U,new ee]))}},{key:"keys",get:function get(){var e=m(Person.__proto__||Object.getPrototypeOf(Person),"keys",this);return e.push("firstname"),e.push("lastname"),e.push("desk_phone"),e.push("mobile_phone"),e}}]),Person}(),Et=function(e){function Product(){return _classCallCheck(this,Product),_possibleConstructorReturn(this,(Product.__proto__||Object.getPrototypeOf(Product)).apply(this,arguments))}return _inherits(Product,vt),v(Product,[{key:"_reset",value:function _reset(){m(Product.prototype.__proto__||Object.getPrototypeOf(Product.prototype),"_reset",this).call(this),this.type=wt,this.brand_name=null,this.currency=null,this.description1=null,this.description2=null,this.discount_value=null,this.ean=null,this.full_description=null,this.full_name=null,this.price=null,this.priority=null,this.rating=null,this.rating_count=null,this.reference=null,this.remaining_quantity=null,this.status=null,this.url=null,this.values=new J("FeatureValue")}}],[{key:"getName",value:function getName(){return"Product"}},{key:"_isAbstract",value:function _isAbstract(){return!1}},{key:"_buildValidators",value:function _buildValidators(){m(Product.__proto__||Object.getPrototypeOf(Product),"_buildValidators",this).call(this),this._setPropertyValidator("type",new Ce(wt)),this._setPropertyValidator("priority",new V([new U,new z])),this._setPropertyValidator("reference",new V([new U,new ee])),this._setPropertyValidator("full_name",new V([new U,new ee])),this._setPropertyValidator("description1",new V([new U,new Ke])),this._setPropertyValidator("description2",new V([new U,new Ke])),this._setPropertyValidator("full_description",new V([new U,new Ke])),this._setPropertyValidator("brand_name",new V([new U,new ee])),this._setPropertyValidator("url",new V([new U,new ee])),this._setPropertyValidator("status",new V([new U,new ee])),this._setPropertyValidator("price",new V([new U,new ve])),this._setPropertyValidator("currency",new V([new U,new ee])),this._setPropertyValidator("rating",new V([new U,new ve])),this._setPropertyValidator("rating_count",new V([new U,new z])),this._setPropertyValidator("remaining_quantity",new V([new U,new z])),this._setPropertyValidator("discount_value",new V([new U,new z])),this._setPropertyValidator("ean",new V([new U,new Pe(/^[0-9]{8,13}$/)])),this._setPropertyValidator("values",new tt)}},{key:"keys",get:function get(){var e=m(Product.__proto__||Object.getPrototypeOf(Product),"keys",this);return e.push("priority"),e.push("reference"),e.push("full_name"),e.push("description1"),e.push("description2"),e.push("full_description"),e.push("brand_name"),e.push("url"),e.push("status"),e.push("price"),e.push("currency"),e.push("rating"),e.push("rating_count"),e.push("remaining_quantity"),e.push("discount_value"),e.push("ean"),e.push("values"),e}}]),Product}(),Tt=function(e){function Room(){return _classCallCheck(this,Room),_possibleConstructorReturn(this,(Room.__proto__||Object.getPrototypeOf(Room)).apply(this,arguments))}return _inherits(Room,vt),v(Room,[{key:"_reset",value:function _reset(){m(Room.prototype.__proto__||Object.getPrototypeOf(Room.prototype),"_reset",this).call(this),this.type=xt,this.reference=null,this.kind=null,this.capacity=null,this.phone=null}}],[{key:"getName",value:function getName(){return"Room"}},{key:"_isAbstract",value:function _isAbstract(){return!1}},{key:"_buildValidators",value:function _buildValidators(){m(Room.__proto__||Object.getPrototypeOf(Room),"_buildValidators",this).call(this),this._setPropertyValidator("type",new Ce(xt)),this._setPropertyValidator("reference",new V([new U,new ee])),this._setPropertyValidator("kind",new V([new U,new ee])),this._setPropertyValidator("capacity",new V([new U,new z])),this._setPropertyValidator("phone",new V([new U,new ee]))}},{key:"keys",get:function get(){var e=m(Room.__proto__||Object.getPrototypeOf(Room),"keys",this);return e.push("reference"),e.push("kind"),e.push("capacity"),e.push("phone"),e}}]),Room}(),Ot=function(e){function Service(){return _classCallCheck(this,Service),_possibleConstructorReturn(this,(Service.__proto__||Object.getPrototypeOf(Service)).apply(this,arguments))}return _inherits(Service,vt),v(Service,[{key:"_reset",value:function _reset(){m(Service.prototype.__proto__||Object.getPrototypeOf(Service.prototype),"_reset",this).call(this),this.type=Mt,this.schedule=new Map}}],[{key:"getName",value:function getName(){return"Service"}},{key:"_isAbstract",value:function _isAbstract(){return!1}},{key:"_buildValidators",value:function _buildValidators(){m(Service.__proto__||Object.getPrototypeOf(Service),"_buildValidators",this).call(this),this._setPropertyValidator("type",new Ce(Mt))}},{key:"keys",get:function get(){var e=m(Service.__proto__||Object.getPrototypeOf(Service),"keys",this);return e.push("schedule"),e}}]),Service}(),At=function(e){function Store(){return _classCallCheck(this,Store),_possibleConstructorReturn(this,(Store.__proto__||Object.getPrototypeOf(Store)).apply(this,arguments))}return _inherits(Store,vt),v(Store,[{key:"_reset",value:function _reset(){m(Store.prototype.__proto__||Object.getPrototypeOf(Store.prototype),"_reset",this).call(this),this.type=St,this.priority=0,this.opening_time=null,this.phone=null,this.url=null}}],[{key:"getName",value:function getName(){return"Store"}},{key:"_isAbstract",value:function _isAbstract(){return!1}},{key:"_buildValidators",value:function _buildValidators(){m(Store.__proto__||Object.getPrototypeOf(Store),"_buildValidators",this).call(this),this._setPropertyValidator("type",new Ce(St)),this._setPropertyValidator("priority",new z),this._setPropertyValidator("opening_time",new V([new U,new Ke])),this._setPropertyValidator("phone",new V([new U,new ee])),this._setPropertyValidator("url",new V([new U,new ee]))}},{key:"keys",get:function get(){var e=m(Store.__proto__||Object.getPrototypeOf(Store),"keys",this);return e.push("priority"),e.push("opening_time"),e.push("phone"),e.push("url"),e}}]),Store}(),Lt=function(e){function PoiRepository(){return _classCallCheck(this,PoiRepository),_possibleConstructorReturn(this,(PoiRepository.__proto__||Object.getPrototypeOf(PoiRepository)).apply(this,arguments))}return _inherits(PoiRepository,de),v(PoiRepository,[{key:"_switchType",value:function _switchType(e,t,r){if(null!==t.signature){var n=t.clone();n.signature=null,this._persist(n,r)}m(PoiRepository.prototype.__proto__||Object.getPrototypeOf(PoiRepository.prototype),"_switchType",this).call(this,e,t,r)}}],[{key:"getEntityClass",value:function getEntityClass(){return vt}},{key:"fromJSON",value:function fromJSON(e){if("object"!=(void 0===e?"undefined":y(e))||null===e)throw new TypeError("Expected an object");switch(e.type){case"exhibitor":return new Ct(e);case"person":return new Pt(e);case"product":return new Et(e);case"room":return new Tt(e);case"service":return new Ot(e);case"store":return new At(e);default:throw new Error("Unable to parse Poi "+e.type)}}}]),PoiRepository}(),kt=function HasLogoTrait(e){return function(t){function _class9(){return _classCallCheck(this,_class9),_possibleConstructorReturn(this,(_class9.__proto__||Object.getPrototypeOf(_class9)).apply(this,arguments))}return _inherits(_class9,e),v(_class9,[{key:"_reset",value:function _reset(){m(_class9.prototype.__proto__||Object.getPrototypeOf(_class9.prototype),"_reset",this).call(this),this.logo=new Y("File",null)}}],[{key:"_buildValidators",value:function _buildValidators(){m(_class9.__proto__||Object.getPrototypeOf(_class9),"_buildValidators",this).call(this),this._setPropertyValidator("logo",new me)}},{key:"keys",get:function get(){var e=m(_class9.__proto__||Object.getPrototypeOf(_class9),"keys",this);return e.push("logo"),e}}]),_class9}()},Rt=function(e){function Category(){return _classCallCheck(this,Category),_possibleConstructorReturn(this,(Category.__proto__||Object.getPrototypeOf(Category)).apply(this,arguments))}return _inherits(Category,$(Ue(re(kt(et($e(te(Q)))))))),v(Category,[{key:"_reset",value:function _reset(){m(Category.prototype.__proto__||Object.getPrototypeOf(Category.prototype),"_reset",this).call(this),this.color=null,this.rank=0,this.type=null,this.parameters=new Set,this.parents=new J("Category"),this.children=new Z("Category"),this.pois=new J("Poi"),this.tags=new J("Tag")}}],[{key:"getName",value:function getName(){return"Category"}},{key:"_isAbstract",value:function _isAbstract(){return!1}},{key:"_buildValidators",value:function _buildValidators(){m(Category.__proto__||Object.getPrototypeOf(Category),"_buildValidators",this).call(this),this._setPropertyValidator("color",new V([new U,new Pe(/^#([A-Fa-f0-9]{6}|[A-Fa-f0-9]{3})$/)])),this._setPropertyValidator("parameters",new mt(new Ke)),this._setPropertyValidator("parents",new tt),this._setPropertyValidator("children",new rt),this._setPropertyValidator("pois",new tt),this._setPropertyValidator("tags",new tt),this._setPropertyValidator("rank",new z),this._setPropertyValidator("type",new V([new ee,new U]))}},{key:"keys",get:function get(){var e=m(Category.__proto__||Object.getPrototypeOf(Category),"keys",this);return e.push("children"),e.push("color"),e.push("parameters"),e.push("parents"),e.push("pois"),e.push("rank"),e.push("type"),e.push("tags"),e}}]),Category}(),It=function(e){function CategoryRepository(){return _classCallCheck(this,CategoryRepository),_possibleConstructorReturn(this,(CategoryRepository.__proto__||Object.getPrototypeOf(CategoryRepository)).apply(this,arguments))}return _inherits(CategoryRepository,de),v(CategoryRepository,null,[{key:"getEntityClass",value:function getEntityClass(){return Rt}}]),CategoryRepository}(),Nt=function(e){function Feature(){return _classCallCheck(this,Feature),_possibleConstructorReturn(this,(Feature.__proto__||Object.getPrototypeOf(Feature)).apply(this,arguments))}return _inherits(Feature,$(re($e(et(te(Q)))))),v(Feature,[{key:"_reset",value:function _reset(){m(Feature.prototype.__proto__||Object.getPrototypeOf(Feature.prototype),"_reset",this).call(this),this.values=new J("FeatureValue"),this.parents=new J("Feature"),this.children=new Z("Feature")}}],[{key:"getName",value:function getName(){return"Feature"}},{key:"_isAbstract",value:function _isAbstract(){return!1}},{key:"_buildValidators",value:function _buildValidators(){m(Feature.__proto__||Object.getPrototypeOf(Feature),"_buildValidators",this).call(this),this._setPropertyValidator("values",new tt),this._setPropertyValidator("parents",new tt),this._setPropertyValidator("children",new rt)}},{key:"keys",get:function get(){var e=m(Feature.__proto__||Object.getPrototypeOf(Feature),"keys",this);return e.push("values"),e.push("parents"),e.push("children"),e}}]),Feature}(),Ft=function(e){function FeatureRepository(){return _classCallCheck(this,FeatureRepository),_possibleConstructorReturn(this,(FeatureRepository.__proto__||Object.getPrototypeOf(FeatureRepository)).apply(this,arguments))}return _inherits(FeatureRepository,de),v(FeatureRepository,null,[{key:"getEntityClass",value:function getEntityClass(){return Nt}}]),FeatureRepository}(),jt=function(e){function FeatureValue(){return _classCallCheck(this,FeatureValue),_possibleConstructorReturn(this,(FeatureValue.__proto__||Object.getPrototypeOf(FeatureValue)).apply(this,arguments))}return _inherits(FeatureValue,$e(et(te($(re(Q)))))),v(FeatureValue,[{key:"_reset",value:function _reset(){m(FeatureValue.prototype.__proto__||Object.getPrototypeOf(FeatureValue.prototype),"_reset",this).call(this),this.rank=0,this.unit=null,this.feature=new Y("Feature",null),this.products=new J("Product")}}],[{key:"getName",value:function getName(){return"FeatureValue"}},{key:"_isAbstract",value:function _isAbstract(){return!1}},{key:"_buildValidators",value:function _buildValidators(){m(FeatureValue.__proto__||Object.getPrototypeOf(FeatureValue),"_buildValidators",this).call(this),this._setPropertyValidator("feature",new me),this._setPropertyValidator("products",new tt),this._setPropertyValidator("rank",new z),this._setPropertyValidator("unit",new V([new U,new ee]))}},{key:"keys",get:function get(){var e=m(FeatureValue.__proto__||Object.getPrototypeOf(FeatureValue),"keys",this);return e.push("feature"),e.push("products"),e.push("rank"),e.push("unit"),e}}]),FeatureValue}(),Bt=function(e){function FeatureValueRepository(){return _classCallCheck(this,FeatureValueRepository),_possibleConstructorReturn(this,(FeatureValueRepository.__proto__||Object.getPrototypeOf(FeatureValueRepository)).apply(this,arguments))}return _inherits(FeatureValueRepository,de),v(FeatureValueRepository,null,[{key:"getEntityClass",value:function getEntityClass(){return jt}},{key:"_endpoint",get:function get(){return"feature-value"}}]),FeatureValueRepository}(),Vt=function(e){function FileRepositoryBase(){return _classCallCheck(this,FileRepositoryBase),_possibleConstructorReturn(this,(FileRepositoryBase.__proto__||Object.getPrototypeOf(FileRepositoryBase)).apply(this,arguments))}return _inherits(FileRepositoryBase,de),v(FileRepositoryBase,null,[{key:"getEntityClass",value:function getEntityClass(){return ce}}]),FileRepositoryBase}(),Dt=function(e){function FileRepository(){return _classCallCheck(this,FileRepository),_possibleConstructorReturn(this,(FileRepository.__proto__||Object.getPrototypeOf(FileRepository)).apply(this,arguments))}return _inherits(FileRepository,Vt),v(FileRepository,[{key:"_getCreateRequest",value:function _getCreateRequest(e){if(null===e.uri.match(/^blob/))return m(FileRepository.prototype.__proto__||Object.getPrototypeOf(FileRepository.prototype),"_getCreateRequest",this).call(this,e);var t=new FormData;t.set("name",e.name),t.set("context",e.context);var r=ce._getBlobFromUri(e.uri);t.set("file",r,r instanceof File?r.name:"blob"),t.set("site",e.site.value);var n=new pe;return n.method="POST",n.url=this.options.getEndpoint()+"/"+this.constructor._endpoint,n.data=t,n}},{key:"_getUpdateRequest",value:function _getUpdateRequest(e,t){if(-1===t.indexOf("uri")||null===ce._getBlobFromUri(e.uri))return m(FileRepository.prototype.__proto__||Object.getPrototypeOf(FileRepository.prototype),"_getUpdateRequest",this).call(this,e,t);var r=new FormData;-1!==t.indexOf("name")&&r.set("name",e.name),-1!==t.indexOf("context")&&r.set("context",e.context),r.set("file",ce._getBlobFromUri(e.uri)),-1!==t.indexOf("site")&&r.set("site",e.site.value);var n=new pe;return n.method="POST",n.url=this.options.getEndpoint()+"/"+this.constructor._endpoint+"/"+e.id,n.data=r,n}}]),FileRepository}(),Ut=function(e){function FloorCalibration(){return _classCallCheck(this,FloorCalibration),_possibleConstructorReturn(this,(FloorCalibration.__proto__||Object.getPrototypeOf(FloorCalibration)).apply(this,arguments))}return _inherits(FloorCalibration,$(re(Q))),v(FloorCalibration,[{key:"_reset",value:function _reset(){m(FloorCalibration.prototype.__proto__||Object.getPrototypeOf(FloorCalibration.prototype),"_reset",this).call(this),this.floor_id=null,this.eye=new N,this.target=new N,this.up=new N,this.zoom_max=null,this.zoom_min=null,this.site_calibration=new Y("SiteCalibration",null)}}],[{key:"getName",value:function getName(){return"FloorCalibration"}},{key:"_isAbstract",value:function _isAbstract(){return!1}},{key:"_buildValidators",value:function _buildValidators(){m(FloorCalibration.__proto__||Object.getPrototypeOf(FloorCalibration),"_buildValidators",this).call(this),this._setPropertyValidator("site_calibration",new ge),this._setPropertyValidator("floor_id",new z),this._setPropertyValidator("eye",new ye),this._setPropertyValidator("target",new ye),this._setPropertyValidator("up",new ye),this._setPropertyValidator("zoom_min",new V([new U,new ve])),this._setPropertyValidator("zoom_max",new V([new U,new ve]))}},{key:"keys",get:function get(){var e=m(FloorCalibration.__proto__||Object.getPrototypeOf(FloorCalibration),"keys",this);return e.push("site_calibration"),e.push("floor_id"),e.push("eye"),e.push("target"),e.push("up"),e.push("zoom_min"),e.push("zoom_max"),e}}]),FloorCalibration}(),Gt=function(e){function FloorCalibrationRepository(){return _classCallCheck(this,FloorCalibrationRepository),_possibleConstructorReturn(this,(FloorCalibrationRepository.__proto__||Object.getPrototypeOf(FloorCalibrationRepository)).apply(this,arguments))}return _inherits(FloorCalibrationRepository,de),v(FloorCalibrationRepository,null,[{key:"getEntityClass",value:function getEntityClass(){return Ut}}]),FloorCalibrationRepository}(),zt=function(e){function Place(){return _classCallCheck(this,Place),_possibleConstructorReturn(this,(Place.__proto__||Object.getPrototypeOf(Place)).apply(this,arguments))}return _inherits(Place,Ue($e(te($(re(Q)))))),v(Place,[{key:"_reset",value:function _reset(){m(Place.prototype.__proto__||Object.getPrototypeOf(Place.prototype),"_reset",this).call(this),this.building_id=null,this.floor_id=null,this.shape_id=null,this.position=new N,this.pois=new J("Poi"),this.custom_objects=new J("CustomObject")}}],[{key:"getName",value:function getName(){return"Place"}},{key:"_isAbstract",value:function _isAbstract(){return!1}},{key:"_buildValidators",value:function _buildValidators(){m(Place.__proto__||Object.getPrototypeOf(Place),"_buildValidators",this).call(this),this._setPropertyValidator("pois",new tt),this._setPropertyValidator("custom_objects",new tt),this._setPropertyValidator("building_id",new V([new U,new z])),this._setPropertyValidator("floor_id",new V([new U,new z])),this._setPropertyValidator("shape_id",new V([new U,new z])),this._setPropertyValidator("position",new ye)}},{key:"keys",get:function get(){var e=m(Place.__proto__||Object.getPrototypeOf(Place),"keys",this);return e.push("pois"),e.push("custom_objects"),e.push("building_id"),e.push("floor_id"),e.push("shape_id"),e.push("position"),e}}]),Place}(),Ht=function(e){function PlaceRepository(){return _classCallCheck(this,PlaceRepository),_possibleConstructorReturn(this,(PlaceRepository.__proto__||Object.getPrototypeOf(PlaceRepository)).apply(this,arguments))}return _inherits(PlaceRepository,de),v(PlaceRepository,null,[{key:"getEntityClass",value:function getEntityClass(){return zt}}]),PlaceRepository}(),Wt=function(e){function Playlist(){return _classCallCheck(this,Playlist),_possibleConstructorReturn(this,(Playlist.__proto__||Object.getPrototypeOf(Playlist)).apply(this,arguments))}return _inherits(Playlist,$(Ue($e(et(Qe(te(re(Q)))))))),v(Playlist,[{key:"_reset",value:function _reset(){m(Playlist.prototype.__proto__||Object.getPrototypeOf(Playlist.prototype),"_reset",this).call(this),this.tags=new J("Tag"),this.medias=new Z("Media"),this.parameters=new Set}}],[{key:"getName",value:function getName(){return"Playlist"}},{key:"_isAbstract",value:function _isAbstract(){return!1}},{key:"_buildValidators",value:function _buildValidators(){m(Playlist.__proto__||Object.getPrototypeOf(Playlist),"_buildValidators",this).call(this),this._setPropertyValidator("tags",new tt),this._setPropertyValidator("medias",new rt),this._setPropertyValidator("parameters",new mt(new Ke))}},{key:"keys",get:function get(){var e=m(Playlist.__proto__||Object.getPrototypeOf(Playlist),"keys",this);return e.push("tags"),e.push("medias"),e.push("parameters"),e}}]),Playlist}(),qt=function(e){function PlaylistRepository(){return _classCallCheck(this,PlaylistRepository),_possibleConstructorReturn(this,(PlaylistRepository.__proto__||Object.getPrototypeOf(PlaylistRepository)).apply(this,arguments))}return _inherits(PlaylistRepository,de),v(PlaylistRepository,null,[{key:"getEntityClass",value:function getEntityClass(){return Wt}}]),PlaylistRepository}(),Xt=function(e){function SiteCalibration(){return _classCallCheck(this,SiteCalibration),_possibleConstructorReturn(this,(SiteCalibration.__proto__||Object.getPrototypeOf(SiteCalibration)).apply(this,arguments))}return _inherits(SiteCalibration,$(re(Q))),v(SiteCalibration,[{key:"_reset",value:function _reset(){m(SiteCalibration.prototype.__proto__||Object.getPrototypeOf(SiteCalibration.prototype),"_reset",this).call(this),this.device=new Y("Device",null),this.floor_calibrations=new J("FloorCalibration"),this.start_floor=null,this.start_point_floor=null,this.start_point_position=new N}}],[{key:"getName",value:function getName(){return"SiteCalibration"}},{key:"_isAbstract",value:function _isAbstract(){return!1}},{key:"_buildValidators",value:function _buildValidators(){m(SiteCalibration.__proto__||Object.getPrototypeOf(SiteCalibration),"_buildValidators",this).call(this),this._setPropertyValidator("device",new ge),this._setPropertyValidator("floor_calibrations",new tt),this._setPropertyValidator("start_floor",new z),this._setPropertyValidator("start_point_floor",new V([new z,new U])),this._setPropertyValidator("start_point_position",new V([new ye,new U]))}},{key:"keys",get:function get(){var e=m(SiteCalibration.__proto__||Object.getPrototypeOf(SiteCalibration),"keys",this);return e.push("device"),e.push("floor_calibrations"),e.push("start_floor"),e.push("start_point_floor"),e.push("start_point_position"),e}}]),SiteCalibration}(),Yt=function(e){function SiteCalibrationRepository(){return _classCallCheck(this,SiteCalibrationRepository),_possibleConstructorReturn(this,(SiteCalibrationRepository.__proto__||Object.getPrototypeOf(SiteCalibrationRepository)).apply(this,arguments))}return _inherits(SiteCalibrationRepository,de),v(SiteCalibrationRepository,null,[{key:"getEntityClass",value:function getEntityClass(){return Xt}}]),SiteCalibrationRepository}(),Jt=function HasEmailTrait(e){return function(t){function _class10(){return _classCallCheck(this,_class10),_possibleConstructorReturn(this,(_class10.__proto__||Object.getPrototypeOf(_class10)).apply(this,arguments))}return _inherits(_class10,e),v(_class10,[{key:"_reset",value:function _reset(){m(_class10.prototype.__proto__||Object.getPrototypeOf(_class10.prototype),"_reset",this).call(this),this.email=null}}],[{key:"_buildValidators",value:function _buildValidators(){m(_class10.__proto__||Object.getPrototypeOf(_class10),"_buildValidators",this).call(this),this._setPropertyValidator("email",new V([new U,new ee]))}},{key:"keys",get:function get(){var e=m(_class10.__proto__||Object.getPrototypeOf(_class10),"keys",this);return e.push("email"),e}}]),_class10}()},Zt=function(e){function GpsPositionValidator(){return _classCallCheck(this,GpsPositionValidator),_possibleConstructorReturn(this,(GpsPositionValidator.__proto__||Object.getPrototypeOf(GpsPositionValidator)).apply(this,arguments))}return _inherits(GpsPositionValidator,B),v(GpsPositionValidator,[{key:"isValid",value:function isValid(e,t,r){var n=t[r];return"object"==(void 0===n?"undefined":y(n))&&null!==n&&Number.isFinite(n.x)&&Number.isFinite(n.y)&&Number.isFinite(n.z)&&Number.isFinite(n.latitude)&&Number.isFinite(n.longitude)&&Number.isFinite(n.altitude)}}]),GpsPositionValidator}(),Kt=function(e){function Site(){return _classCallCheck(this,Site),_possibleConstructorReturn(this,(Site.__proto__||Object.getPrototypeOf(Site)).apply(this,arguments))}return _inherits(Site,re(Ue(kt($e(et(Jt(Qe(te(Q))))))))),v(Site,[{key:"_reset",value:function _reset(){m(Site.prototype.__proto__||Object.getPrototypeOf(Site.prototype),"_reset",this).call(this),this.opening=null,this.direction=null,this.city=null,this.cp=null,this.address=null,this.phone=null,this.locale=null,this.languages=new Set,this.gps_positions=new Set,this.gps_transform=new Set,this.gps_translate=new Set,this.target_platforms=new Set}}],[{key:"getName",value:function getName(){return"Site"}},{key:"_isAbstract",value:function _isAbstract(){return!1}},{key:"_buildValidators",value:function _buildValidators(){m(Site.__proto__||Object.getPrototypeOf(Site),"_buildValidators",this).call(this),this._setPropertyValidator("opening",new V([new U,new Ke])),this._setPropertyValidator("direction",new V([new U,new Ke])),this._setPropertyValidator("city",new V([new U,new ee])),this._setPropertyValidator("cp",new V([new U,new ee])),this._setPropertyValidator("address",new V([new U,new ee])),this._setPropertyValidator("phone",new V([new U,new ee])),this._setPropertyValidator("locale",new V([new U,new ee])),this._setPropertyValidator("languages",new mt(new Ke)),this._setPropertyValidator("gps_positions",new mt(new Zt)),this._setPropertyValidator("gps_transform",new mt(new ve)),this._setPropertyValidator("gps_translate",new mt(new ve)),this._setPropertyValidator("target_platforms",new mt(new Ke))}},{key:"keys",get:function get(){var e=m(Site.__proto__||Object.getPrototypeOf(Site),"keys",this);return e.push("opening"),e.push("direction"),e.push("city"),e.push("cp"),e.push("address"),e.push("phone"),e.push("locale"),e.push("languages"),e.push("gps_positions"),e.push("gps_transform"),e.push("gps_translate"),e.push("target_platforms"),e}}]),Site}(),Qt=function(e){function SiteRepository(){return _classCallCheck(this,SiteRepository),_possibleConstructorReturn(this,(SiteRepository.__proto__||Object.getPrototypeOf(SiteRepository)).apply(this,arguments))}return _inherits(SiteRepository,de),v(SiteRepository,[{key:"getCurrent",value:function getCurrent(){return this.get(this.em.options.site)}},{key:"_getLoadRequest",value:function _getLoadRequest(){var e=new pe;return e.url=this.em.options.getEndpoint()+"/"+this.constructor._endpoint+"/"+this.em.options.site,e}},{key:"_loadFromApiIntoNewStorage",value:function _loadFromApiIntoNewStorage(){var e=this;return this.em._xhr(this._getLoadRequest(),200).then(function(t){var r=new fe;return r.store(e.constructor.fromJSON(t.data)),r})}}],[{key:"getEntityClass",value:function getEntityClass(){return Kt}}]),SiteRepository}(),$t=function(e){function Tag(){return _classCallCheck(this,Tag),_possibleConstructorReturn(this,(Tag.__proto__||Object.getPrototypeOf(Tag)).apply(this,arguments))}return _inherits(Tag,Ue($e(te($(re(Q)))))),v(Tag,[{key:"_reset",value:function _reset(){m(Tag.prototype.__proto__||Object.getPrototypeOf(Tag.prototype),"_reset",this).call(this),this.categories=new J("Category"),this.medias=new J("Media"),this.pois=new J("Poi"),this.playlists=new J("Playlist")}}],[{key:"getName",value:function getName(){return"Tag"}},{key:"_isAbstract",value:function _isAbstract(){return!1}},{key:"_buildValidators",value:function _buildValidators(){m(Tag.__proto__||Object.getPrototypeOf(Tag),"_buildValidators",this).call(this),this._setPropertyValidator("categories",new tt),this._setPropertyValidator("medias",new tt),this._setPropertyValidator("pois",new tt),this._setPropertyValidator("playlists",new tt)}},{key:"keys",get:function get(){var e=m(Tag.__proto__||Object.getPrototypeOf(Tag),"keys",this);return e.push("categories"),e.push("medias"),e.push("pois"),e.push("playlists"),e}}]),Tag}(),er=function(e){function TagRepository(){return _classCallCheck(this,TagRepository),_possibleConstructorReturn(this,(TagRepository.__proto__||Object.getPrototypeOf(TagRepository)).apply(this,arguments))}return _inherits(TagRepository,de),v(TagRepository,null,[{key:"getEntityClass",value:function getEntityClass(){return $t}}]),TagRepository}(),tr=function(){function AbstractListener(e){_classCallCheck(this,AbstractListener),this._init(e)}return v(AbstractListener,[{key:"_init",value:function _init(e){if(this.em=e,this.eventDispatcher=C,this.constructor===AbstractListener)throw new TypeError("Cannot construct AbstractListener instances directly");this._subscribe()}},{key:"_subscribe",value:function _subscribe(){var e=this.constructor.getEntityClass().getName(),t=this.em.getRepository(e);this.eventDispatcher.subscribe(t,P,this.onCreate.bind(this)),this.eventDispatcher.subscribe(t,E,this.onUpdate.bind(this)),this.eventDispatcher.subscribe(t,T,this.onRemove.bind(this))}},{key:"onCreate",value:function onCreate(e){}},{key:"onUpdate",value:function onUpdate(e){}},{key:"onRemove",value:function onRemove(e){}},{key:"_cascadeRemove",value:function _cascadeRemove(e,t,r){var n=this,i=this.em.getRepository(e[t].classOf);if(e[t]instanceof Y){var o=i.get(e[t]);this.constructor._isAssociatedTo(e,o,r)&&i._remove(o,!0)}e[t]instanceof J&&e[t].forEach(function(t){var o=i.get(t);n.constructor._isAssociatedTo(e,o,r)&&i._remove(o,!0)}),e[t]instanceof Z&&e[t].forEach(function(t){var o=t.id,a=i.get(o);n.constructor._isAssociatedTo(e,a,r)&&i._remove(a,!0)})}},{key:"_unsetFromInversed",value:function _unsetFromInversed(e,t,r){var n=this.em.getRepository(e[t].classOf);if(e[t]instanceof Y&&null!==e[t].value){var i=n.get(e[t]);if(null!==i){var o=i.clone();o[r]=null,n._persist(o,!0)}}e[t]instanceof J&&e[t].forEach(function(e){var t=n.get(e);if(null!==t){var i=t.clone();i[r]=null,n._persist(i,!0)}})}},{key:"_removeFromInversed",value:function _removeFromInversed(e,t,r){var n=this.em.getRepository(e[t].classOf);if(e[t]instanceof Y&&null!==e[t].value){var i=n.get(e[t]);if(null!==i){var o=i.clone();o[r].remove(e),n._persist(o,!0)}}e[t]instanceof J&&e[t].forEach(function(t){var i=n.get(t);if(null!==i){var o=i.clone();o[r].remove(e),n._persist(o,!0)}}),e[t]instanceof Z&&e[t].forEach(function(t){var i=t.id,o=n.get(i);if(null!==o){var a=o.clone();a[r].remove(e),n._persist(a,!0)}})}},{key:"_onManyToManyOrToLinkPropertyChange",value:function _onManyToManyOrToLinkPropertyChange(e,t,r,n,i,o){var a=this,s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,c=this.em.getRepository(e[r].classOf);e[r].forEach(function(i){null!==t&&t[r].has(i)||a.constructor._addToNewlyInversed(e,null,c,i,n,o)}),null!==t&&t[r].forEach(function(t){e[r].has(t)||(null!==s&&s(c.get(t),e),a.constructor._removeFromFormerInversed(e,c,t,n,i))})}},{key:"_onLinkToManyOrToLinkPropertyChange",value:function _onLinkToManyOrToLinkPropertyChange(e,t,r,n,i,o){var a=this,s=this.em.getRepository(e[r].classOf);e[r].forEach(function(i){var c=i.id,u=i.position;null!==t&&t[r].has(c)&&t[r].getPositionOf(c)===u||a.constructor._addToNewlyInversed(e,u,s,c,n,o)}),null!==t&&t[r].forEach(function(t){var o=t.id;e[r].has(o)||a.constructor._removeFromFormerInversed(e,s,o,n,i)})}},{key:"_onOneToManyPropertyChange",value:function _onOneToManyPropertyChange(e,t,r,n,i,o){var a=this,s=this.em.getRepository(e[r].classOf);e[r].forEach(function(i){null!==t&&t[r].has(i)||a.constructor._setToNewlyInversed(e,s,i,n,o)}),null!==t&&t[r].forEach(function(t){!e[r].has(t)&&a.constructor._isAssociatedTo(e,s.get(t),n)&&a.constructor._unsetFromFormerInversed(e,s,t,n,i)})}},{key:"_onManyToOnePropertyChange",value:function _onManyToOnePropertyChange(e,t,r,n,i,o){var a=this.em.getRepository(e[r].classOf);this.constructor._addToNewlyInversed(e,null,a,e[r],n,o),null!==t&&this.constructor._removeFromFormerInversed(e,a,t[r],n,i)}},{key:"_onOneToOnePropertyChange",value:function _onOneToOnePropertyChange(e,t,r,n,i,o){var a=this.em.getRepository(e[r].classOf);n&&this.constructor._setToNewlyInversed(e,a,e[r],n,o),null!==t&&this.constructor._unsetFromFormerInversed(e,a,t[r],n,i)}}],[{key:"getEntityClass",value:function getEntityClass(){throw new TypeError("You need to implement static getEntityClass in AbstractListener inheritance")}},{key:"_isAssociatedTo",value:function _isAssociatedTo(e,t,r){return null===r||null===t?Boolean(t):t[r]instanceof Y&&t[r].is(e)?t[r].is(e):(t[r]instanceof J||t[r]instanceof Z)&&t[r].has(e)}},{key:"_isPropertyChanged",value:function _isPropertyChanged(e,t,r,n){return!!t.constructor.keys.includes(e)&&(null===r||-1!==n.indexOf(e))}},{key:"_addToNewlyInversed",value:function _addToNewlyInversed(e,t,r,n,i,o){if(i||o){var a=r.get(n);if(null!==a){var s=a.clone();i&&s[i].add(e,t),o&&o(s),r._persist(s,!0)}}}},{key:"_removeFromFormerInversed",value:function _removeFromFormerInversed(e,t,r,n,i){if(n){var o=t.get(r);if(null!==o&&this._isAssociatedTo(e,o,n)){var a=o.clone();a[n].remove(e),i&&0===a[n].size?t._remove(a,!0):t._persist(a,!0)}}}},{key:"_setToNewlyInversed",value:function _setToNewlyInversed(e,t,r,n,i){if(n||i){var o=t.get(r);if(null!==o){var a=o.clone();n&&(a[n]=e),i&&i(a),t._persist(a,!0)}}}},{key:"_unsetFromFormerInversed",value:function _unsetFromFormerInversed(e,t,r,n,i){if(n||i){var o=t.get(r);if(null!==o&&this._isAssociatedTo(e,o,n)){var a=o.clone();i?t._remove(a,!0):(a[n]=null,t._persist(a,!0))}}}}]),AbstractListener}(),rr=function(e){function CustomObjectListener(){return _classCallCheck(this,CustomObjectListener),_possibleConstructorReturn(this,(CustomObjectListener.__proto__||Object.getPrototypeOf(CustomObjectListener)).apply(this,arguments))}return _inherits(CustomObjectListener,tr),v(CustomObjectListener,[{key:"onCreate",value:function onCreate(e){this._onChange(e,null)}},{key:"onUpdate",value:function onUpdate(e){this._onChange(e.current,e.previous,e.changes)}},{key:"onRemove",value:function onRemove(e){this._removeFromInversed(e,"place","custom_objects"),this._removeFromInversed(e,"poi","custom_objects"),e instanceof Oe&&this._cascadeRemove(e,"file",null)}},{key:"_onChange",value:function _onChange(e,t,r){this.constructor._isPropertyChanged("place",e,t,r)&&this._onManyToOnePropertyChange(e,t,"place","custom_objects"),this.constructor._isPropertyChanged("poi",e,t,r)&&this._onManyToOnePropertyChange(e,t,"poi","custom_objects"),this.constructor._isPropertyChanged("file",e,t,r)&&this._onManyToOnePropertyChange(e,t,"file",null,!0,this.constructor._onNewFile)}}],[{key:"getEntityClass",value:function getEntityClass(){return we}},{key:"_onNewFile",value:function _onNewFile(e){e.context=ie.PICTO}}]),CustomObjectListener}(),nr=function(e){function DeviceListener(){return _classCallCheck(this,DeviceListener),_possibleConstructorReturn(this,(DeviceListener.__proto__||Object.getPrototypeOf(DeviceListener)).apply(this,arguments))}return _inherits(DeviceListener,tr),v(DeviceListener,[{key:"onCreate",value:function onCreate(e){this._onChange(e,null)}},{key:"onUpdate",value:function onUpdate(e){this._onChange(e.current,e.previous,e.changes)}},{key:"onRemove",value:function onRemove(e){this._cascadeRemove(e,"site_calibration","device")}},{key:"_onChange",value:function _onChange(e,t,r){this.constructor._isPropertyChanged("site_calibration",e,t,r)&&this._onOneToOnePropertyChange(e,t,"site_calibration","device",!0)}}],[{key:"getEntityClass",value:function getEntityClass(){return Re}}]),DeviceListener}(),ir=function(e){function MapFileListener(){return _classCallCheck(this,MapFileListener),_possibleConstructorReturn(this,(MapFileListener.__proto__||Object.getPrototypeOf(MapFileListener)).apply(this,arguments))}return _inherits(MapFileListener,tr),v(MapFileListener,[{key:"onCreate",value:function onCreate(e){this._onChange(e,null)}},{key:"onUpdate",value:function onUpdate(e){this._onChange(e.current,e.previous,e.changes)}},{key:"onRemove",value:function onRemove(e){this._cascadeRemove(e,"file",null)}},{key:"_onChange",value:function _onChange(e,t,r){this.constructor._isPropertyChanged("file",e,t,r)&&this._onManyToOnePropertyChange(e,t,"file",null,!0,this.constructor._onNewFile)}}],[{key:"getEntityClass",value:function getEntityClass(){return Ge}},{key:"_onNewFile",value:function _onNewFile(e){null!==e&&(e.context="map")}}]),MapFileListener}(),or=function(e){function MediaListener(){return _classCallCheck(this,MediaListener),_possibleConstructorReturn(this,(MediaListener.__proto__||Object.getPrototypeOf(MediaListener)).apply(this,arguments))}return _inherits(MediaListener,tr),v(MediaListener,[{key:"onCreate",value:function onCreate(e){this._onChange(e,null)}},{key:"onUpdate",value:function onUpdate(e){this._onChange(e.current,e.previous,e.changes)}},{key:"onRemove",value:function onRemove(e){this._removeFromInversed(e,"tags","medias"),this._removeFromInversed(e,"playlists","medias"),this._removeFromInversed(e,"pois","medias"),(e instanceof ht||e instanceof dt||e instanceof pt||e instanceof gt)&&this._cascadeRemove(e,"file",null),this._cascadeRemove(e,"preview",null)}},{key:"_onChange",value:function _onChange(e,t,r){this.constructor._isPropertyChanged("tags",e,t,r)&&this._onManyToManyOrToLinkPropertyChange(e,t,"tags","medias"),this.constructor._isPropertyChanged("playlists",e,t,r)&&this._onLinkToManyOrToLinkPropertyChange(e,t,"playlists","medias"),this.constructor._isPropertyChanged("pois",e,t,r)&&this._onManyToManyOrToLinkPropertyChange(e,t,"pois","medias"),this.constructor._isPropertyChanged("preview",e,t,r)&&this._onManyToOnePropertyChange(e,t,"preview",null,!0,this.constructor._onNewPreview),this.constructor._isPropertyChanged("file",e,t,r)&&this._onManyToOnePropertyChange(e,t,"file",null,!0,this.constructor._onNewFile)}}],[{key:"getEntityClass",value:function getEntityClass(){return nt}},{key:"_onNewPreview",value:function _onNewPreview(e){e.context="media_preview"}},{key:"_onNewFile",value:function _onNewFile(e){e.context="media_file"}}]),MediaListener}(),ar=function(e){function PoiListenerBase(){return _classCallCheck(this,PoiListenerBase),_possibleConstructorReturn(this,(PoiListenerBase.__proto__||Object.getPrototypeOf(PoiListenerBase)).apply(this,arguments))}return _inherits(PoiListenerBase,tr),v(PoiListenerBase,[{key:"onCreate",value:function onCreate(e){this._onChange(e,null)}},{key:"onUpdate",value:function onUpdate(e){this._onChange(e.current,e.previous,e.changes)}},{key:"onRemove",value:function onRemove(e){this._removeFromInversed(e,"parents","children"),this._removeFromInversed(e,"children","parents"),this._removeFromInversed(e,"categories","pois"),this._removeFromInversed(e,"tags","pois"),this._removeFromInversed(e,"medias","pois"),this._removeFromInversed(e,"places","pois"),this._cascadeRemove(e,"custom_objects","poi"),e instanceof Et&&this._removeFromInversed(e,"values","products")}},{key:"_onChange",value:function _onChange(e,t,r){this.constructor._isPropertyChanged("name",e,t,r)&&this._onNameUpdated(e),this.constructor._isPropertyChanged("parents",e,t,r)&&this._onManyToManyOrToLinkPropertyChange(e,t,"parents","children"),this.constructor._isPropertyChanged("children",e,t,r)&&this._onLinkToManyOrToLinkPropertyChange(e,t,"children","parents"),this.constructor._isPropertyChanged("categories",e,t,r)&&this._onManyToManyOrToLinkPropertyChange(e,t,"categories","pois"),this.constructor._isPropertyChanged("tags",e,t,r)&&this._onManyToManyOrToLinkPropertyChange(e,t,"tags","pois"),this.constructor._isPropertyChanged("medias",e,t,r)&&this._onLinkToManyOrToLinkPropertyChange(e,t,"medias","pois"),this.constructor._isPropertyChanged("places",e,t,r)&&this._onManyToManyOrToLinkPropertyChange(e,t,"places","pois",!1,null,this._onPlaceRemoved.bind(this)),this.constructor._isPropertyChanged("custom_objects",e,t,r)&&this._onOneToManyPropertyChange(e,t,"custom_objects","poi",!1,this._onNewCustomObject.bind(this)),this.constructor._isPropertyChanged("logos",e,t,r)&&(this._onLinkToManyOrToLinkPropertyChange(e,t,"logos",null,!0,this.constructor._onNewLogo),this.constructor._onLogoUpdated(e,this.em)),this.constructor._isPropertyChanged("pictures",e,t,r)&&this._onLinkToManyOrToLinkPropertyChange(e,t,"pictures",null,!0,this.constructor._onNewPicture),this.constructor._isPropertyChanged("values",e,t,r)&&this._onManyToManyOrToLinkPropertyChange(e,t,"values","products")}},{key:"_onNameUpdated",value:function _onNameUpdated(e){var t=this;this.em.getRepository(e.custom_objects.classOf).getList(e.custom_objects).forEach(function(r){r instanceof Ee&&t._updateLabelNameFromPoi(r,e)})}},{key:"_onPlaceRemoved",value:function _onPlaceRemoved(e,t){var r=this.em.getRepository(t.custom_objects.classOf);r.getList(t.custom_objects).forEach(function(t){null!==t&&t.place.is(e)&&r._remove(t,!0)})}},{key:"_onNewCustomObject",value:function _onNewCustomObject(e){var t=this.em.getRepository("Poi").get(e.poi);if(e instanceof Ee&&this._updateLabelNameFromPoi(e,t),e instanceof Oe){var r=this.constructor._getFirstPoiLogo(t,this.em);this.constructor._updatePictoFileFromPoiLogo(e,r,this.em)}}},{key:"_updateLabelNameFromPoi",value:function _updateLabelNameFromPoi(e,t){if(e.label!==t.name){var r=e.clone();r.label=t.name,this.em.getRepository("CustomObject")._persist(r,!0)}}}],[{key:"getEntityClass",value:function getEntityClass(){return vt}},{key:"_onNewLogo",value:function _onNewLogo(e){e.context="poi"}},{key:"_onNewPicture",value:function _onNewPicture(e){e.context="poi"}},{key:"_onLogoUpdated",value:function _onLogoUpdated(e,t){var r=this,n=t.getRepository(e.custom_objects.classOf).getList(e.custom_objects),i=this._getFirstPoiLogo(e,t);n.forEach(function(e){e instanceof Oe&&r._updatePictoFileFromPoiLogo(e,i,t)})}},{key:"_isFirstLogo",value:function _isFirstLogo(e,t){return e.logos.size>0&&e.logos.values[0].id===t.id}},{key:"_getFirstPoiLogo",value:function _getFirstPoiLogo(e,t){var r=t.getRepository(e.logos.classOf).getList(e.logos);return 0===r.length?null:r[0]}},{key:"_updatePictoFileFromPoiLogo",value:function _updatePictoFileFromPoiLogo(e,t,r){return null===t?(r.getRepository("CustomObject")._remove(e,!0),!1):null===t.content_hash?(r.logger.debug("PoiListener#_updatePictoFileFromPoiLogo: logo content hash is not computed, skipping"),!1):e.original_md5!==t.content_hash}}]),PoiListenerBase}(),sr=function(){function ImageResizerBase(e){_classCallCheck(this,ImageResizerBase),this.src={uri:e,image:null,width:null,height:null},this.target={uri:null,image:null,width:null,height:null,offset:{x:0,y:0}}}return v(ImageResizerBase,[{key:"init",value:function init(){return Promise.reject(new Error("ImageResizer is not available on NodeJS"))}},{key:"isSrcPowerOfTwo",value:function isSrcPowerOfTwo(){return this.isPowerOfTwoNumber(this.src.width)&&this.isPowerOfTwoNumber(this.src.height)}},{key:"isTargetPowerOfTwo",value:function isTargetPowerOfTwo(){return this.isPowerOfTwoNumber(this.target.width)&&this.isPowerOfTwoNumber(this.target.height)}},{key:"isPowerOfTwoNumber",value:function isPowerOfTwoNumber(e){return e>1&&0==(e&e-1)}},{key:"getNextPowerOfTwoNumber",value:function getNextPowerOfTwoNumber(e){for(var t=2;t<e;)t*=2;return t}},{key:"getWidthStretching",value:function getWidthStretching(){return this.target.width/(this.target.width-2*this.target.offset.x)}},{key:"getHeightStretching",value:function getHeightStretching(){return this.target.height/(this.target.height-2*this.target.offset.y)}},{key:"makePowerOfTwo",value:function makePowerOfTwo(){if(!this.isTargetPowerOfTwo()){var e=this.isPowerOfTwoNumber(this.target.width),t=this.isPowerOfTwoNumber(this.target.height),r=this.getNextPowerOfTwoNumber(this.target.width),n=this.getNextPowerOfTwoNumber(this.target.height);if(!t&&!e)return this.resize(Math.max(r,n),!0),void this.makePowerOfTwo();t?(this.target.offset.x=Math.round((r-this.target.width)/2),this.target.width=r):(this.target.offset.y=Math.round((n-this.target.height)/2),this.target.height=n),this.resize()}}},{key:"resize",value:function resize(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:512;if(!(!(arguments.length>1&&void 0!==arguments[1]&&arguments[1])&&this.target.width<e&&this.target.height<e)){var t;t=this.target.height>this.target.width?e/this.target.height:e/this.target.width,this.target.width=Math.round(this.target.width*t),this.target.height=Math.round(this.target.height*t),this.target.offset.x=Math.round(this.target.offset.x*t),this.target.offset.y=Math.round(this.target.offset.y*t)}}},{key:"save",value:function save(){return Promise.reject(new Error("ImageResizer is not available on NodeJS"))}}]),ImageResizerBase}(),cr=function(e){function ImageResizer(){return _classCallCheck(this,ImageResizer),_possibleConstructorReturn(this,(ImageResizer.__proto__||Object.getPrototypeOf(ImageResizer)).apply(this,arguments))}return _inherits(ImageResizer,sr),v(ImageResizer,[{key:"init",value:function init(){var e=this;return new Promise(function(t,r){try{var n=new Image;n.onload=function(){e.src.image=n,e.src.width=n.width,e.src.height=n.height,e.target.width=n.width,e.target.height=n.height,t()},n.onerror=function(e){r(e)},n.src=e.src.uri}catch(t){r(t)}})}},{key:"save",value:function save(){var e=this;return new Promise(function(t,r){try{var n=document.createElement("canvas");n.width=e.target.width,n.height=e.target.height,n.getContext("2d").drawImage(e.src.image,e.target.offset.x,e.target.offset.y,e.target.width/e.getWidthStretching(),e.target.height/e.getHeightStretching()),n.toBlob(function(r){var n=URL.createObjectURL(r);ce._addBlobUri(n,r),e.target.uri=n,t(n)})}catch(t){r(t)}})}}]),ImageResizer}(),ur=function(e){function PoiListener(){return _classCallCheck(this,PoiListener),_possibleConstructorReturn(this,(PoiListener.__proto__||Object.getPrototypeOf(PoiListener)).apply(this,arguments))}return _inherits(PoiListener,ar),v(PoiListener,null,[{key:"_updatePictoFileFromPoiLogo",value:function _updatePictoFileFromPoiLogo(e,t,r){var n=this;if(!m(PoiListener.__proto__||Object.getPrototypeOf(PoiListener),"_updatePictoFileFromPoiLogo",this).call(this,e,t,r)){var i=r.getRepository("Poi"),o=r.getRepository("CustomObject"),a=r.getRepository("File"),s=a.get(t);if(null!==s){var c=new cr(s.uri),u=c.init().then(function(){return c.makePowerOfTwo(),c.save()}).then(function(u){var l=o.get(e),h=i.get(l.poi);s=a.get(s);var p=a.get(l.file);if(null!==l&&null!==h&&null!==s&&n._isFirstLogo(h,s)){var f=l.clone();c.target.height/c.getHeightStretching()>c.target.width/c.getWidthStretching()?(f.height=Math.round(l.height*c.getHeightStretching()),f.width=Math.round(l.height*c.target.width/c.target.height)):(f.width=Math.round(l.width*c.getWidthStretching()),f.height=Math.round(l.width*c.target.height/c.target.width));var d=p.clone();d.uri=u,d.file_type=s.file_type,d.site=s.site;var m={resizer:{src:{width:c.src.width,height:c.src.height},target:{width:c.target.width,height:c.target.height}},picto:{src:{width:e.width,height:e.height},target:{width:f.width,height:f.height}}};r.logger.debug("PoiListener#_updatePictoFileFromPoiLogo: updating picto file",m),r.getRepository("File")._persist(d,!0),f.file=d,f.original_md5=t.content_hash,r.logger.debug("PoiListener#_updatePictoFileFromPoiLogo: updating picto",m),r.getRepository("CustomObject")._persist(f,!0)}}).catch(function(e){throw r.logger.warn("PoiListener#_updatePictoFileFromPoiLogo: Failed",{error:e}),e});r._waitFor(u)}}}}]),PoiListener}(),lr=function(e){function CategoryListener(){return _classCallCheck(this,CategoryListener),_possibleConstructorReturn(this,(CategoryListener.__proto__||Object.getPrototypeOf(CategoryListener)).apply(this,arguments))}return _inherits(CategoryListener,tr),v(CategoryListener,[{key:"onCreate",value:function onCreate(e){this._onChange(e,null)}},{key:"onUpdate",value:function onUpdate(e){this._onChange(e.current,e.previous,e.changes)}},{key:"onRemove",value:function onRemove(e){this._removeFromInversed(e,"parents","children"),this._removeFromInversed(e,"children","parents"),this._removeFromInversed(e,"pois","categories"),this._removeFromInversed(e,"tags","categories"),this._cascadeRemove(e,"logo",null)}},{key:"_onChange",value:function _onChange(e,t,r){this.constructor._isPropertyChanged("parents",e,t,r)&&this._onManyToManyOrToLinkPropertyChange(e,t,"parents","children"),this.constructor._isPropertyChanged("children",e,t,r)&&this._onLinkToManyOrToLinkPropertyChange(e,t,"children","parents"),this.constructor._isPropertyChanged("pois",e,t,r)&&this._onManyToManyOrToLinkPropertyChange(e,t,"pois","categories"),this.constructor._isPropertyChanged("tags",e,t,r)&&this._onManyToManyOrToLinkPropertyChange(e,t,"tags","categories"),this.constructor._isPropertyChanged("logo",e,t,r)&&this._onManyToOnePropertyChange(e,t,"logo",null,!0,this.constructor._onNewLogo)}}],[{key:"getEntityClass",value:function getEntityClass(){return Rt}},{key:"_onNewLogo",value:function _onNewLogo(e){null!==e&&(e.context=ie.CATEGORY)}}]),CategoryListener}(),hr=function(e){function FeatureListener(){return _classCallCheck(this,FeatureListener),_possibleConstructorReturn(this,(FeatureListener.__proto__||Object.getPrototypeOf(FeatureListener)).apply(this,arguments))}return _inherits(FeatureListener,tr),v(FeatureListener,[{key:"onCreate",value:function onCreate(e){this._onChange(e,null)}},{key:"onUpdate",value:function onUpdate(e){this._onChange(e.current,e.previous,e.changes)}},{key:"onRemove",value:function onRemove(e){this._removeFromInversed(e,"parents","children"),this._removeFromInversed(e,"children","parents"),this._cascadeRemove(e,"values","feature")}},{key:"_onChange",value:function _onChange(e,t,r){this.constructor._isPropertyChanged("parents",e,t,r)&&this._onManyToManyOrToLinkPropertyChange(e,t,"parents","children"),this.constructor._isPropertyChanged("children",e,t,r)&&this._onLinkToManyOrToLinkPropertyChange(e,t,"children","parents"),this.constructor._isPropertyChanged("values",e,t,r)&&this._onManyToOnePropertyChange(e,t,"values","feature",!0)}}],[{key:"getEntityClass",value:function getEntityClass(){return Nt}}]),FeatureListener}(),pr=function(e){function FeatureValueListener(){return _classCallCheck(this,FeatureValueListener),_possibleConstructorReturn(this,(FeatureValueListener.__proto__||Object.getPrototypeOf(FeatureValueListener)).apply(this,arguments))}return _inherits(FeatureValueListener,tr),v(FeatureValueListener,[{key:"onCreate",value:function onCreate(e){this._onChange(e,null)}},{key:"onUpdate",value:function onUpdate(e){this._onChange(e.current,e.previous,e.changes)}},{key:"onRemove",value:function onRemove(e){this._removeFromInversed(e,"products","values"),this._removeFromInversed(e,"feature","values")}},{key:"_onChange",value:function _onChange(e,t,r){this.constructor._isPropertyChanged("feature",e,t,r)&&this._onManyToOnePropertyChange(e,t,"feature","values"),this.constructor._isPropertyChanged("products",e,t,r)&&this._onManyToManyOrToLinkPropertyChange(e,t,"products","values")}}],[{key:"getEntityClass",value:function getEntityClass(){return jt}}]),FeatureValueListener}(),fr=function(e){function FileListenerBase(){return _classCallCheck(this,FileListenerBase),_possibleConstructorReturn(this,(FileListenerBase.__proto__||Object.getPrototypeOf(FileListenerBase)).apply(this,arguments))}return _inherits(FileListenerBase,tr),v(FileListenerBase,[{key:"onCreate",value:function onCreate(e){this._onChange(e,null)}},{key:"onUpdate",value:function onUpdate(e){this._onChange(e.current,e.previous,e.changes)}},{key:"onRemove",value:function onRemove(e){}},{key:"_onChange",value:function _onChange(e,t,r){this.constructor._isPropertyChanged("uri",e,t,r)&&this._onUriUpdated(e),this.constructor._isPropertyChanged("context",e,t,r)&&this._onContextUpdated(e),this.constructor._isPropertyChanged("content_hash",e,t,r)&&this._onContentHashUpdated(e)}},{key:"_onUriUpdated",value:function _onUriUpdated(e){e.context===ie.PICTO&&(this.em.logger.debug("FileListener#_onUriUpdated: make picto file pow2"),this._makePictoFilePow2(e)),this.em.logger.debug("FileListener#_onUriUpdated: force update content hash"),this._updateContentHash(e,!0)}},{key:"_onContentHashUpdated",value:function _onContentHashUpdated(e){if(e.context===ie.POI){var t=this.constructor._getPoiFromFile(e,this.em);null!==t&&ur._getFirstPoiLogo(t,this.em)===e&&(this.em.logger.debug("FileListener#_onContentHashUpdated: update associated picto"),ur._onLogoUpdated(t,this.em))}}},{key:"_onContextUpdated",value:function _onContextUpdated(e){e.context===ie.PICTO&&(this.em.logger.debug("FileListener#_onContextUpdated: make picto pow2"),this._makePictoFilePow2(e))}},{key:"_updateContentHash",value:function _updateContentHash(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(null===e.content_hash||r){var n=pe.getUriContentHash(e.uri).then(function(r){var n=t.em.getRepository("File"),i=n.get(e);if(null!==i&&i.uri===e.uri){var o=i.clone();o.content_hash=r,n._persist(o,!0)}else t.em.logger.debug("FileListener#_updateContentHash: File has been removed or binary has been updated while computing ==> Skip")}).catch(function(e){throw e});this.em._waitFor(n)}}},{key:"_makePictoFilePow2",value:function _makePictoFilePow2(e){return this.em.logger.warn("Cannot make an image Pow2 yet"),Promise.resolve(!1)}}],[{key:"getEntityClass",value:function getEntityClass(){return ce}},{key:"_getPictoFromFile",value:function _getPictoFromFile(e,t){var r=t.getRepository("CustomObject").findBy({type:xe.PICTO,file:function file(t){return t.is(e)}});return 0===r.length?null:r[0]}},{key:"_getPoiFromFile",value:function _getPoiFromFile(e,t){var r=t.getRepository("Poi").findBy({logos:function logos(t){return t.has(e)}});return 0===r.length?null:r[0]}}]),FileListenerBase}(),dr=function(e){function FileListener(){return _classCallCheck(this,FileListener),_possibleConstructorReturn(this,(FileListener.__proto__||Object.getPrototypeOf(FileListener)).apply(this,arguments))}return _inherits(FileListener,fr),v(FileListener,[{key:"_makePictoFilePow2",value:function _makePictoFilePow2(e){var t=this,r=new cr(e.uri),n=r.init().then(function(){return r.isSrcPowerOfTwo()?Promise.resolve(!0):(r.makePowerOfTwo(),r.save().then(function(n){var i=t.em.getRepository("File"),o=i.get(e);if(null!==o&&o.uri===e.uri&&o.context===ie.PICTO){var a=o.clone(),s=t.constructor._getPictoFromFile(o,t.em);if(null!==s){a.uri=n,a.content_hash=null;var c=s.clone();c.width=Math.round(s.width*r.getWidthStretching()),c.height=Math.round(s.height*r.getHeightStretching()),t.em.logger.debug("FileListener#_makePictoFilePow2: updating picto to fit new image",{src_picto:{width:s.width,height:s.height},target_picto:{width:c.width,height:c.height},src_file:{width:r.src.width,height:r.src.height},target_file:{width:r.target.width,height:r.target.height}}),t.em.getRepository("CustomObject")._persist(c,!0)}else a.context=ie.DEFAULT;t.em.logger.debug("FileListener#_makePictoFilePow2: updating picto file",{src_file:{width:r.src.width,height:r.src.height},target_file:{width:r.target.width,height:r.target.height}}),i._persist(a,!0)}}))}).catch(function(e){throw t.em.logger.warn("FileListener#_makePictoFilePow2: Failed",{error:e}),e});return this.em._waitFor(n),n}}],[{key:"_getPictoFromFile",value:function _getPictoFromFile(e,t){var r=t.getRepository("CustomObject").findBy({type:xe.PICTO,file:function file(t){return t.is(e)}});return 0===r.length?null:r[0]}},{key:"_getPoiFromFile",value:function _getPoiFromFile(e,t){var r=t.getRepository("Poi").findBy({logos:function logos(t){return t.has(e)}});return 0===r.length?null:r[0]}}]),FileListener}(),mr=function(e){function FloorCalibrationListener(){return _classCallCheck(this,FloorCalibrationListener),_possibleConstructorReturn(this,(FloorCalibrationListener.__proto__||Object.getPrototypeOf(FloorCalibrationListener)).apply(this,arguments))}return _inherits(FloorCalibrationListener,tr),v(FloorCalibrationListener,[{key:"onCreate",value:function onCreate(e){this._onChange(e,null)}},{key:"onUpdate",value:function onUpdate(e){this._onChange(e.current,e.previous,e.changes)}},{key:"onRemove",value:function onRemove(e){this._removeFromInversed(e,"site_calibration","floor_calibrations")}},{key:"_onChange",value:function _onChange(e,t,r){this.constructor._isPropertyChanged("site_calibration",e,t,r)&&this._onManyToOnePropertyChange(e,t,"site_calibration","floor_calibrations")}}],[{key:"getEntityClass",value:function getEntityClass(){return Ut}}]),FloorCalibrationListener}(),gr=function(e){function PlaceListener(){return _classCallCheck(this,PlaceListener),_possibleConstructorReturn(this,(PlaceListener.__proto__||Object.getPrototypeOf(PlaceListener)).apply(this,arguments))}return _inherits(PlaceListener,tr),v(PlaceListener,[{key:"onCreate",value:function onCreate(e){this._onChange(e,null)}},{key:"onUpdate",value:function onUpdate(e){this._onChange(e.current,e.previous,e.changes)}},{key:"onRemove",value:function onRemove(e){this._removeFromInversed(e,"pois","places"),this._cascadeRemove(e,"custom_objects","place")}},{key:"_onChange",value:function _onChange(e,t,r){this.constructor._isPropertyChanged("pois",e,t,r)&&this._onManyToManyOrToLinkPropertyChange(e,t,"pois","places"),this.constructor._isPropertyChanged("custom_objects",e,t,r)&&this._onOneToManyPropertyChange(e,t,"custom_objects","place",!0)}}],[{key:"getEntityClass",value:function getEntityClass(){return zt}}]),PlaceListener}(),yr=function(e){function PlaylistListener(){return _classCallCheck(this,PlaylistListener),_possibleConstructorReturn(this,(PlaylistListener.__proto__||Object.getPrototypeOf(PlaylistListener)).apply(this,arguments))}return _inherits(PlaylistListener,tr),v(PlaylistListener,[{key:"onCreate",value:function onCreate(e){this._onChange(e,null)}},{key:"onUpdate",value:function onUpdate(e){this._onChange(e.current,e.previous,e.changes)}},{key:"onRemove",value:function onRemove(e){this._removeFromInversed(e,"medias","playlists"),this._removeFromInversed(e,"tags","playlists")}},{key:"_onChange",value:function _onChange(e,t,r){this.constructor._isPropertyChanged("medias",e,t,r)&&this._onLinkToManyOrToLinkPropertyChange(e,t,"medias","playlists"),this.constructor._isPropertyChanged("tags",e,t,r)&&this._onManyToManyOrToLinkPropertyChange(e,t,"tags","playlists")}}],[{key:"getEntityClass",value:function getEntityClass(){return Wt}}]),PlaylistListener}(),vr=function(e){function SiteCalibrationListener(){return _classCallCheck(this,SiteCalibrationListener),_possibleConstructorReturn(this,(SiteCalibrationListener.__proto__||Object.getPrototypeOf(SiteCalibrationListener)).apply(this,arguments))}return _inherits(SiteCalibrationListener,tr),v(SiteCalibrationListener,[{key:"onCreate",value:function onCreate(e){this._onChange(e,null)}},{key:"onUpdate",value:function onUpdate(e){this._onChange(e.current,e.previous,e.changes)}},{key:"onRemove",value:function onRemove(e){this._unsetFromInversed(e,"device","site_calibration"),this._cascadeRemove(e,"floor_calibrations","site_calibration")}},{key:"_onChange",value:function _onChange(e,t,r){this.constructor._isPropertyChanged("floor_calibrations",e,t,r)&&this._onOneToManyPropertyChange(e,t,"floor_calibrations","site_calibration",!0),this.constructor._isPropertyChanged("device",e,t,r)&&this._onOneToOnePropertyChange(e,t,"device","site_calibration")}}],[{key:"getEntityClass",value:function getEntityClass(){return Xt}}]),SiteCalibrationListener}(),_r=function(e){function SiteListener(){return _classCallCheck(this,SiteListener),_possibleConstructorReturn(this,(SiteListener.__proto__||Object.getPrototypeOf(SiteListener)).apply(this,arguments))}return _inherits(SiteListener,tr),v(SiteListener,[{key:"onCreate",value:function onCreate(e){this._onChange(e,null)}},{key:"onUpdate",value:function onUpdate(e){this._onChange(e.current,e.previous,e.changes)}},{key:"onRemove",value:function onRemove(e){throw new TypeError("You cannot remove the Site !")}},{key:"_onChange",value:function _onChange(e,t,r){this.constructor._isPropertyChanged("logo",e,t,r)&&this._onManyToOnePropertyChange(e,t,"logo",null,!0,this.constructor._onNewLogo)}}],[{key:"getEntityClass",value:function getEntityClass(){return Kt}},{key:"_onNewLogo",value:function _onNewLogo(e){null!==e&&(e.context="site")}}]),SiteListener}(),br=function(e){function TagListener(){return _classCallCheck(this,TagListener),_possibleConstructorReturn(this,(TagListener.__proto__||Object.getPrototypeOf(TagListener)).apply(this,arguments))}return _inherits(TagListener,tr),v(TagListener,[{key:"onCreate",value:function onCreate(e){this._onChange(e,null)}},{key:"onUpdate",value:function onUpdate(e){this._onChange(e.current,e.previous,e.changes)}},{key:"onRemove",value:function onRemove(e){this._removeFromInversed(e,"categories","tags"),this._removeFromInversed(e,"pois","tags"),this._removeFromInversed(e,"playlists","tags"),this._removeFromInversed(e,"medias","tags")}},{key:"_onChange",value:function _onChange(e,t,r){this.constructor._isPropertyChanged("pois",e,t,r)&&this._onManyToManyOrToLinkPropertyChange(e,t,"pois","tags"),this.constructor._isPropertyChanged("categories",e,t,r)&&this._onManyToManyOrToLinkPropertyChange(e,t,"categories","tags"),this.constructor._isPropertyChanged("medias",e,t,r)&&this._onManyToManyOrToLinkPropertyChange(e,t,"medias","tags"),this.constructor._isPropertyChanged("playlists",e,t,r)&&this._onManyToManyOrToLinkPropertyChange(e,t,"playlists","tags")}}],[{key:"getEntityClass",value:function getEntityClass(){return $t}}]),TagListener}(),wr=function(){function UnitOfWork(e){_classCallCheck(this,UnitOfWork),this.em=e,this.em.logger.debug("UnitOfWork: instantiate"),this._reset()}return v(UnitOfWork,[{key:"flush",value:function flush(){var e=this;this.em.logger.debug("UnitOfWork: flush start"),this._prepare();var t=new Set(this.commits)[Symbol.iterator]();return this._flushCommits(t).then(function(){return e._finish()})}},{key:"_reset",value:function _reset(){this.em.logger.debug("UnitOfWork: reset"),this.commits=new Set,this._symbolToId=new Map,this._symbolToRepository=new Map}},{key:"_prepare",value:function _prepare(){this.em.logger.debug("UnitOfWork: prepare"),this._mergeConsecutiveCommits()}},{key:"_mergeConsecutiveCommits",value:function _mergeConsecutiveCommits(){var e=this;this.em.logger.debug("UnitOfWork: merge commits");var t=new Set,r=null;this.commits.forEach(function(n){var i,o=e.constructor._mergeTwoConsecutiveCommits(r,n);switch(e.em.logger.debug("UnitOfWork: merge two consecutive commits",{previous:r,commit:n,merged:o}),o.length){case 0:r=null;break;case 1:var a=g(o,1);r=a[0];break;case 2:t.add(o[0]),i=g(o,2),r=i[1];break;default:throw new Error("Unexpected")}}),null!==r&&t.add(r),this.commits=t}},{key:"_finish",value:function _finish(){var e=this;this.em.logger.debug("UnitOfWork: finish");var t=new Set;return this._symbolToId.entries().forEach(function(r){var n=g(r,2),i=n[0],o=n[1],a=e._symbolToRepository.get(i);t.add({id:o,symbol:i,repository:a})}),this._reset(),t}},{key:"_replaceFileReferenceSymbolToId",value:function _replaceFileReferenceSymbolToId(e){"symbol"==y(e.value)&&(e.value=this._symbolToId.get(e.value))}},{key:"_replaceFileCollectionSymbolToId",value:function _replaceFileCollectionSymbolToId(e){var t=this;e.forEach(function(r){"symbol"==(void 0===r?"undefined":y(r))&&(e.add(t._symbolToId.get(r)),e.remove(r))})}},{key:"_replaceFileOrderedCollectionSymbolToId",value:function _replaceFileOrderedCollectionSymbolToId(e){var t=this;e.forEach(function(r){var n=g(r,2),i=n[0],o=n[1];"symbol"==(void 0===i?"undefined":y(i))&&(e.add(t._symbolToId.get(i),o),e.remove(i))})}},{key:"_flushCommits",value:function _flushCommits(e){var t=this,r=e.next(),n=r.value;return r.done?Promise.resolve():(this.em.logger.info("UnitOfWork: "+this.commits.size+" request to send"),this.em.logger.debug("UnitOfWork: flush commits start",{commit:n}),this._flushCommit(n).then(function(){return t.em.logger.debug("UnitOfWork: flush commits next",{commit:n}),t.commits.delete(n),t._flushCommits(e)}))}},{key:"_flushCommit",value:function _flushCommit(e){var t=g(e,3),r=t[0],n=t[1],i=t[2];switch(n){case P:return this._flushCreateCommit(r,i);case E:return this._flushUpdateCommit(r,i.current,i.changes);case T:return this._flushRemoveCommit(r,i);default:return Promise.reject(new Error("UOW: Unhandled event "+n))}}},{key:"_flushCreateCommit",value:function _flushCreateCommit(e,t){var r=this;this._replaceAssociatedSymbolToId(t);var n=e._getCreateRequest(t);return this.em._xhr(n,200).then(function(n){var i=n.data;return r._symbolToId.set(t.id,i.id),r._symbolToRepository.set(t.id,e),r.em.logger.debug("UnitOfWork: retrieved identifier",{symbol:t.id,id:i.id}),i.id})}},{key:"_flushUpdateCommit",value:function _flushUpdateCommit(e,t,r){this._replaceAssociatedSymbolToId(t);var n=e._getUpdateRequest(t,r);return this.em._xhr(n,204)}},{key:"_flushRemoveCommit",value:function _flushRemoveCommit(e,t){var r=this;t.forEach(function(e){r._replaceAssociatedSymbolToId(e)});for(var n=[],i=function _loop(i){var o=t.slice(i,i+50),a=e._getRemoveRequest(o);n.push(r.em._xhr(a,204).catch(function(t){if(t instanceof Error)return Promise.reject(t);var n=t.data;if(!n.hasOwnProperty("errors"))return Promise.reject(new Error("Server error"));var i=n.errors;if(t.status>=500)return Promise.reject(i);r.em.logger.warn("UnitOfWork: flush remove commit invalid data supplied",{json:n});var a=Object.keys(i);if(1!==a.length||!a.includes("id"))return Promise.reject(i);for(var s=Object.keys(i.id).map(function(e){return parseInt(e.replace("#",""),10)}),c=[],u=0;u<o.length;u++)s.includes(u)||c.push(o[u]);return 0===c.length?Promise.resolve():r._flushRemoveCommit(e,c)}))},o=0;o<t.length;o+=50)i(o);return Promise.all(n)}},{key:"_replaceAssociatedSymbolToId",value:function _replaceAssociatedSymbolToId(e){var t=this;this.em.logger.debug("UnitOfWork: replace associated symbol to id",{entity:e}),"symbol"==y(e.id)&&this._symbolToId.has(e.id)&&(e.id=this._symbolToId.get(e.id),this.em.logger.debug("UnitOfWork: replace associated symbol to id (own id replaced)",{entity:e})),e.constructor.keys.forEach(function(r){e[r]instanceof Y&&t._replaceReferenceAssociatedSymbol(r,e),e[r]instanceof J&&t._replaceCollectionAssociatedSymbol(r,e),e[r]instanceof Z&&t._replaceOrderedCollectionAssociatedSymbol(r,e)})}},{key:"_replaceReferenceAssociatedSymbol",value:function _replaceReferenceAssociatedSymbol(e,t){var r=t[e].value;if("symbol"==(void 0===r?"undefined":y(r))){if(!this._symbolToId.has(r))throw this.em.logger.error("UnitOfWork: replace associated symbol to id (reference id not found)",{key:e}),new Error("Unable to find Symbol <--\x3e Id matching");this.em.logger.debug("UnitOfWork: replace associated symbol to id (reference id replaced)",{key:e}),t[e]=this._symbolToId.get(r)}}},{key:"_replaceCollectionAssociatedSymbol",value:function _replaceCollectionAssociatedSymbol(e,t){var r=this,n=[];t[e].forEach(function(t){if("symbol"!=(void 0===t?"undefined":y(t)))n.push(t);else{if(!r._symbolToId.has(t))throw r.em.logger.error("UnitOfWork: replace associated symbol to id (collection item id not found)",{key:e}),new Error("Unable to find Symbol <--\x3e Id matching");r.em.logger.debug("UnitOfWork: replace associated symbol to id (collection item id replaced)",{key:e}),n.push(r._symbolToId.get(t))}}),t[e]=n}},{key:"_replaceOrderedCollectionAssociatedSymbol",value:function _replaceOrderedCollectionAssociatedSymbol(e,t){var r=this,n=[];t[e].forEach(function(t){var i=t.id,o=t.position;if("symbol"!=(void 0===i?"undefined":y(i)))n.push({id:i,position:o});else{if(!r._symbolToId.has(i))throw r.em.logger.error("UnitOfWork: replace associated symbol to id (ordered collection item id not found)",{key:e}),new Error("Unable to find Symbol <--\x3e Id matching");r.em.logger.debug("UnitOfWork: replace associated symbol to id (ordered collection item id replaced)",{key:e}),n.push({id:r._symbolToId.get(i),position:o})}}),t[e]=n}},{key:"_hasPendingChanges",get:function get(){return this._mergeConsecutiveCommits(),0!==this.commits.size}}],[{key:"_mergeTwoConsecutiveCommits",value:function _mergeTwoConsecutiveCommits(e,t){if(null===e)return[t];var r=g(e,3),n=r[0],i=r[1],o=r[2],a=g(t,3),s=a[0],c=a[1],u=a[2];if(n!==s)return[e,t];switch(i){case E:if(c===E&&o.current===u.previous){var l=o.previous,h=u.current,p=n.constructor._compare(l,h);return 0===p.length?[]:[[n,E,{current:h,previous:l,changes:p}]]}break;case P:if(c===T&&u.includes(o))return[];if(c===E&&o===u.previous)return[[n,P,u.current]];break;case T:if(c===T&&n===s)return[[n,T,[].concat(_toConsumableArray(o),_toConsumableArray(u))]];break;default:throw new Error("Unexpected")}return[e,t]}}]),UnitOfWork}(),xr=[Qt,Ze,Dt,It,Lt,Ft,Bt,Ht,Ae,qt,yt,De,Yt,Gt,er],Mr=[_r,ir,dr,lr,ur,hr,pr,gr,rr,yr,or,nr,vr,mr,br],Sr=function(){function EntityManager(e){_classCallCheck(this,EntityManager),this.options=null,this.logger=null,this._repositories=new Map,this._listeners=new Map,this.locale=null,this._uow=null,this.locked=!1,this._waiting=new Set,this._init(new w(e))}return v(EntityManager,null,[{key:"generateNonce",value:function generateNonce(){var e=Date.now()*Math.random();return l()(e.toString(),1)}},{key:"now",value:function now(){return Math.round(Date.now()/1e3).toString()}}]),v(EntityManager,[{key:"_init",value:function _init(e){e.validate(),this.options=e,this.logger=this.options.logger,this.logger.info("EntityManager: instantiate",{options:e}),this._uow=new wr(this);for(var t=0;t<xr.length;t++)this._repositories.set(xr[t].getName(),new xr[t](this));for(var r=0;r<Mr.length;r++)this._listeners.set(Mr[r].getEntityClass().getName(),new Mr[r](this));this.locale=this.options.locale}},{key:"_lock",value:function _lock(){this.logger.info("EntityManager: locked"),this.locked=!0}},{key:"_unlock",value:function _unlock(){this.logger.info("EntityManager: unlocked"),this.locked=!1}},{key:"hasPendingChanges",value:function hasPendingChanges(){return this._uow._hasPendingChanges}},{key:"isFullyLoaded",value:function isFullyLoaded(){for(var e=this.getRepositories(),t=0;t<e.length;t++)if(e[t]._status!==R)return!1;return!0}},{key:"getRepository",value:function getRepository(e){return this._repositories.has(e)?this._repositories.get(e):null}},{key:"getRepositoryNames",value:function getRepositoryNames(){return Array.from(this._repositories.keys())}},{key:"getRepositories",value:function getRepositories(){return Array.from(this._repositories.values())}},{key:"load",value:function load(){var e=this,t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return new Promise(function(r,n){e.logger.info("EntityManager: loading start");var i=[];e.getRepositories().forEach(function(e){i.push(e.load(t))}),Promise.all(i).then(function(){e.logger.info("EntityManager: loading success"),r()},function(t){e.logger.error("EntityManager: loading failed",{error:t}),n(t)})})}},{key:"loadFromCache",value:function loadFromCache(){var e=this,t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return new Promise(function(r,n){e.logger.info("EntityManager: loading start");var i=[];e.getRepositories().forEach(function(e){i.push(e.loadFromCache(t))}),Promise.all(i).then(function(){e.logger.info("EntityManager: loading success"),r()},function(){for(var t=arguments.length,r=Array(t),i=0;i<t;i++)r[i]=arguments[i];e.logger.error("EntityManager: loading failed",{error:r}),n.apply(void 0,r)})})}},{key:"flush",value:function flush(){var e=this;return new Promise(function(t,r){e.options.state===b&&e.logger.warn("EntityManager: your are about to flush into PUBLISHED state"),e.logger.info("EntityManager: flush start"),e._assertIsNotLocked(),e._assertIsFullyLoaded(),e.logger.info("EntityManager: waiting listeners to be completed before send data"),e._wait().then(t,r)}).then(function(){return e._lock(),e._uow.flush()}).then(function(t){return e._unlock(),t.forEach(function(e){C.publish(e.repository,O,[e.id,e.symbol])}),e.pull().then(function(){t.forEach(function(e){C.publish(e.repository,A,[e.id,e.symbol])})})}).catch(function(t){throw e.logger.error("EntityManager: flush failed",{error:t}),e._unlock(),t})}},{key:"pull",value:function pull(){var e=this;if(this.logger.info("EntityManager: pull start"),this.hasPendingChanges())throw this.logger.error("EntityManager: pull failed (pending changes)."),new Error("You cannot pull while there is unsaved modifications");this._lock();var t=[];return this.getRepositories().forEach(function(e){t.push(e._loadIntoNewStorage(!1).then(function(t){var r=e._replaceStorage(t);return[e,r]}))}),Promise.all(t).then(function(e){e.forEach(function(e){var t=g(e,2),r=t[0];t[1][T].forEach(function(e){C.publish(r,T,e)})}),e.forEach(function(e){var t=g(e,2),r=t[0];t[1][P].forEach(function(e){C.publish(r,P,e)})}),e.forEach(function(e){var t=g(e,2),r=t[0];t[1][E].forEach(function(e){C.publish(r,E,e)})})}).then(function(){e._unlock()}).catch(function(t){return e._unlock(),Promise.reject(t)})}},{key:"_assertIsFullyLoaded",value:function _assertIsFullyLoaded(){if(!this.isFullyLoaded())throw this.logger.error("EntityManager: not fully failed."),new TypeError("You need to fully load EntityManager to use write features")}},{key:"_assertIsNotLocked",value:function _assertIsNotLocked(){if(this.locked)throw this.logger.error("EntityManager: locked."),new Error("The EntityManager is locked, readonly operations are permitted")}},{key:"_xhr",value:function _xhr(e,t){var r=this;return e.addParameter("site",this.options.site),e.addHeaders(this.constructor.getHeaders(this.options.username,this.options.key,this.options.locale,this.options.state)),e.validateStatus=function(e){return e===t},pe.sendRequest(e).then(function(n){if(n.status!==t){var i="Unexpected status while requesting API\n\n                Got "+n.status+" instead of "+t+" on route "+e.formattedUrl();return r.logger.error(i,{response:n,request:e,expectedStatus:t}),Promise.reject(n)}return n}).catch(function(t){return r._onRequestError(t,e)})}},{key:"_onRequestError",value:function _onRequestError(e,t){var r=pe.formatApiError(e,t),n=r.message,i=r.context;return this.logger.error(n,i),Promise.reject(new Error(n))}},{key:"_waitFor",value:function _waitFor(e){this._waiting.add(e.catch(function(){}))}},{key:"_wait",value:function _wait(){var e=this,t=this._waiting;return this._waiting=new Set,0===t.size?Promise.resolve():Promise.all(t).then(function(){return e._wait()})}},{key:"wait",value:function wait(){return this._wait()}}],[{key:"getHeaders",value:function getHeaders(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,i={Authorization:'WSSE profile="UsernameToken"',"X-WSSE":this.getWsseHeader(e,t),"X-API-MODE":"get"};return null!==n&&(i["X-API-STATE"]=n),null!==r&&(i["X-API-LOCALE"]=r),i}},{key:"getWsseHeader",value:function getWsseHeader(e,t){var r=this.generateNonce(),n=this.now();return'UsernameToken Username="'+e+'", PasswordDigest="'+d()(r+n+t,1)+'", Nonce="'+r+'", Created="'+n+'"'}}]),EntityManager}(),Cr=function(e){function CacheOptions(){return _classCallCheck(this,CacheOptions),_possibleConstructorReturn(this,(CacheOptions.__proto__||Object.getPrototypeOf(CacheOptions)).apply(this,arguments))}return _inherits(CacheOptions,n["a"]),v(CacheOptions,[{key:"reset",value:function reset(){m(CacheOptions.prototype.__proto__||Object.getPrototypeOf(CacheOptions.prototype),"reset",this).call(this),this.endpoint=null,this.username=null,this.key=null,this.additionalLocales=null,this.state=b,this.binDownloadPolicy={ignoredContexts:[ie.TEXTURE_LOW,ie.TEXTURE_HELPER,ie.TEXTURE_MODEL],ignoredIds:[],ignoredFileType:[]}}},{key:"areSameAdditionalLocales",value:function areSameAdditionalLocales(e){return e===this.additionalLocales||null!==e&&null!==this.additionalLocales&&this.constructor._areSameArrays(e,this.additionalLocales)}},{key:"areSameBinDownloadPolicy",value:function areSameBinDownloadPolicy(e){return!!e&&(!!this.constructor._areSameArrays(e.ignoredContexts,this.binDownloadPolicy.ignoredContexts)&&!!this.constructor._areSameArrays(e.ignoredIds,this.binDownloadPolicy.ignoredIds)&&this.constructor._areSameArrays(e.ignoredFileType,this.binDownloadPolicy.ignoredFileType))}}],[{key:"_areSameArrays",value:function _areSameArrays(e,t){if(e.length!==t.length)return!1;var r=!0;return e.forEach(function(e){r&&!t.includes(e)&&(r=!1)}),r}}]),CacheOptions}(),Pr=function(){function CacheManager(e){_classCallCheck(this,CacheManager),this.directory=e,this.runningUpdates=new Map,this.runningClean=null,this.logger=new i.c}return v(CacheManager,null,[{key:"getTranslatableRepositories",value:function getTranslatableRepositories(){return[Kt.getName(),Rt.getName(),we.getName(),Nt.getName(),jt.getName(),nt.getName(),Wt.getName(),vt.getName(),$t.getName()]}}]),v(CacheManager,[{key:"getLastPublishDate",value:function getLastPublishDate(e,t){var r=this;if(t.state!==b)return Promise.resolve(new Date);var n=w.formatApiEndpoint(t.endpoint),i=new pe;return i.url=n+"/published-version/last/"+e,i.addHeaders(Sr.getHeaders(t.username,t.key)),pe.sendRequest(i).then(function(e){var t=e.data;return new Date(t.date)}).catch(function(e){if(!e.response)return null;if(e.response)switch(e.response.status){case 400:case 404:return new Date;case 503:return null}var t=pe.formatApiError(e,i),n=t.message,o=t.context;return r.logger.error(n,o),Promise.reject(new Error(n))})}},{key:"getCacheMetadata",value:function getCacheMetadata(e){return this._readFile(this._getSiteCacheDirector(e)+"/metadata.json").then(function(e){return JSON.parse(e)}).catch(function(){return null})}},{key:"clean",value:function clean(){var e=this,t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return null!==this.runningClean?this.runningClean:t&&this.runningUpdates.size>0?Promise.all(Array.from(this.runningUpdates.values())).then(function(){return e.clean()}):(this.runningClean=Promise.all([this._getBinRegistry(),this._readdir(this._getBinCacheDirector())]).then(function(t){var r=g(t,2),n=r[0],i=r[1],o=[];Object.keys(n).forEach(function(e){n[e].forEach(function(e){o.includes(e)||o.push(e)})});var a=[];return i.forEach(function(t){o.includes(t)||a.push(e._rmrf(e._getBinCacheDirector()+"/"+t))}),Promise.all(a).then(function(){e.runningClean=null})}),this.runningClean)}},{key:"_cleanUnusedBins",value:function _cleanUnusedBins(e,t){var r=this;return this._getBinRegistry().then(function(n){return n[e]=t,r._writeFile(r.directory+"/binRegistry.json",JSON.stringify(n))}).then(function(){return r.clean(!1)})}},{key:"_getBinRegistry",value:function _getBinRegistry(){return this._readFile(this.directory+"/binRegistry.json").then(function(e){return JSON.parse(e)}).catch(function(){return{}})}},{key:"update",value:function update(e,t){var r=this;if(this.runningUpdates.has(e))return this.runningUpdates.get(e);if(null!==this.runningClean)return this.runningClean.then(function(){return r.update(e,t)});var n=new Cr(t),i=this.needsUpdate(e,n).then(function(t){var i=t.needsUpdate,o=t.hasCache;return t.hasInternetConnexion?i?(console.log("Will update"),r._doUpdate(e,n)):(console.log("Skip update as it's valid"),!0):o?(console.warn("No Internet connexion"),!1):Promise.reject(new Error("No Internet connexion and no cache"))});return this.runningUpdates.set(e,i),i.then(function(){r.runningUpdates.delete(e)}),i}},{key:"needsUpdate",value:function needsUpdate(e,t){var r=new Cr(t);return Promise.all([this.getCacheMetadata(e),this.getLastPublishDate(e,r)]).then(function(e){var t=g(e,2),n=t[0],i=t[1],o=null!==n,a=null!==i,s=o?new Date(n.date):null;if(!a)return{needsUpdate:!o,lastPublishedDate:i,hasCache:o,hasInternetConnexion:a,lastCacheUpdateDate:s};var c=!1;return o?n.apiVersion!==w.getApiVersion()?c=!0:n.endpoint!==r.endpoint?c=!0:n.state!==r.state?c=!0:s<=i?c=!0:r.areSameAdditionalLocales(n.additionalLocales)&&r.areSameBinDownloadPolicy(n.binDownloadPolicy)||(c=!0):c=!0,{needsUpdate:c,lastPublishedDate:i,hasCache:o,hasInternetConnexion:a,lastCacheUpdateDate:s}})}},{key:"_getSiteCacheDirector",value:function _getSiteCacheDirector(e){return this.directory+"/"+e}},{key:"_getBinCacheDirector",value:function _getBinCacheDirector(){return this.directory+"/bin"}},{key:"get",value:function get(e,t){var r=this,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=new w(t);return this.getCacheMetadata(i.site).then(function(e){if(null===e)return Promise.reject(new Error("CacheManager: no cache"));if(e.apiVersion!==w.getApiVersion())return Promise.reject(new Error("CacheManager: cache was created from another api version, please update it"));if(e.endpoint!==i.endpoint)return Promise.reject(new Error("CacheManager: cache was created from another endpoint, please update it"));if(e.state!==i.state)return Promise.reject(new Error("CacheManager: cache was created from state, please update it"));var t=null===i.locale||i===e.defaultLocale;return t||e.availableLocales.includes(i.locale)?n?t:r.getLastPublishDate(i.site,i).then(function(r){return null===r||r>new Date(e.date)?Promise.reject(new Error("CacheManger: is outdated")):t}):Promise.reject(new Error("CacheManager: requested locale is not in the cache"))}).then(function(t){var n;n=t||!r.constructor.getTranslatableRepositories().includes(e)?r._getSiteCacheDirector(i.site)+"/"+e+".json":r._getSiteCacheDirector(i.site)+"/"+i.locale+"/"+e+".json";var o=null;return e===ce.getName()&&(o=r._getBinRegistry()),Promise.all([r._readFile(n).then(function(e){return JSON.parse(e)}),o])}).then(function(t){var n=g(t,2),o=n[0],a=n[1];if(e===ce.getName()){var s=a[i.site];o.forEach(function(e){s.includes(e.reference)&&(e.uri=r._getBinCacheDirector()+"/"+e.reference)})}return o})}},{key:"_doUpdate",value:function _doUpdate(e,t){var r=this,n=this._createEm(e,null,t),i=[],o=this._getSiteCacheDirector(e);return n.load().then(function(){var o=n.getRepository("Site").getCurrent();null===n.locale&&(n.locale=o.locale);var a=null;null===t.additionalLocales?(a=[],o.languages.forEach(function(e){e!==o.locale&&a.push(e)})):a=t.additionalLocales;var s=[];return a.forEach(function(n){var o=r._createEm(e,n,t);i.push(o),r.constructor.getTranslatableRepositories().forEach(function(e){s.push(o.getRepository(e).load())})}),Promise.all(s)}).then(function(){return console.log("Cleaning"),r._rmrf(o)}).then(function(){console.log("Creating dirs");var e=[r._mkdirp(o),r._mkdirp(r._getBinCacheDirector())];return i.forEach(function(t){e.push(r._mkdirp(o+"/"+t.locale))}),console.log("Creating dir"),Promise.all(e)}).then(function(){var e,i={ignoredContexts:t.binDownloadPolicy.ignoredContexts,ignoredIds:[].concat(_toConsumableArray(t.binDownloadPolicy.ignoredIds)),ignoredFileType:t.binDownloadPolicy.ignoredFileType},o=n.getRepository("MapFile").findBy({type:function type(e){return[ze.PATH,ze.CONFIG,ze.HELPER,ze.IVE,ze.LIGHT,ze.OSG].includes(e)}}).map(function(e){return e.file.value});return(e=i.ignoredIds).push.apply(e,_toConsumableArray(o)),r._downloadFiles(n,i)}).then(function(e){console.log("Saving");var t=[];return n.getRepositories().forEach(function(e){e.isLoaded()&&t.push(r._writeFile(o+"/"+e.constructor.getName()+".json",JSON.stringify(e.getAll())))}),i.forEach(function(e){e.getRepositories().forEach(function(n){n.isLoaded()&&t.push(r._writeFile(o+"/"+e.locale+"/"+n.constructor.getName()+".json",JSON.stringify(n.getAll())))})}),Promise.all(t).then(function(){return e})}).then(function(t){return r._cleanUnusedBins(e,t)}).then(function(){var e=n.getRepository("Site").getCurrent(),i={endpoint:t.endpoint,state:t.state,date:new Date,additionalLocales:t.additionalLocales,defaultLocale:e.default,availableLocales:Array.from(e.languages),binDownloadPolicy:t.binDownloadPolicy,apiVersion:w.getApiVersion()};return r._writeFile(o+"/metadata.json",JSON.stringify(i))})}},{key:"_downloadFiles",value:function _downloadFiles(e,t){var r=this,n=[];if(e.getRepository("File").getAll().forEach(function(e){t.ignoredContexts.includes(e.context)||t.ignoredIds.includes(e.id)||t.ignoredFileType.includes(e.file_type)||n.push(e)}),0===n.length)return Promise.resolve([]);var i=[];n.forEach(function(e){i.includes(e.reference)||i.push(e.reference)});for(var o=[],a=0;a<10;a++)o.push(Promise.resolve());for(var s=function _loop2(e){var t=e%10;o[t]=o[t].then(function(){return r._downloadFile(n[e])})},c=0;c<n.length;c++)s(c);return Promise.all(o).then(function(){return i})}},{key:"_createEm",value:function _createEm(e,t,r){return new Sr(new w({site:e,endpoint:r.endpoint,username:r.username,key:r.key,state:r.state,locale:t}))}},{key:"_downloadFile",value:function _downloadFile(e){return Promise.reject(new Error("Not implemented"))}},{key:"_exists",value:function _exists(e){return Promise.reject(new Error("Not implemented"))}},{key:"_mkdirp",value:function _mkdirp(e){return Promise.reject(new Error("Not implemented"))}},{key:"_readFile",value:function _readFile(e){return Promise.reject(new Error("Not implemented"))}},{key:"_writeFile",value:function _writeFile(e,t){return Promise.reject(new Error("Not implemented"))}},{key:"_rmrf",value:function _rmrf(e){return Promise.reject(new Error("Not implemented"))}},{key:"_readdir",value:function _readdir(e){return Promise.reject(new Error("Not implemented"))}}]),CacheManager}(),Er=(function(e){function LocalCacheManager(){throw _classCallCheck(this,LocalCacheManager),_possibleConstructorReturn(this,(LocalCacheManager.__proto__||Object.getPrototypeOf(LocalCacheManager)).call(this,"")),new Error("Not supported in browser")}_inherits(LocalCacheManager,Pr)}(),function(e){function DistCacheManager(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"//localhost:8080/adsum/cache";return _classCallCheck(this,DistCacheManager),_possibleConstructorReturn(this,(DistCacheManager.__proto__||Object.getPrototypeOf(DistCacheManager)).call(this,e))}return _inherits(DistCacheManager,Pr),v(DistCacheManager,[{key:"update",value:function update(e,t){return Promise.reject(new Error("Not supported"))}},{key:"clean",value:function clean(e,t){return Promise.reject(new Error("Not supported"))}},{key:"_readFile",value:function _readFile(e){return c.a.get(e).then(function(e){return"object"==y(e.data)?JSON.stringify(e.data):e.data})}}]),DistCacheManager}())},function(e,t,r){"use strict";(function(t){var n=r(18),i=r(355),o={"Content-Type":"application/x-www-form-urlencoded"};function setContentTypeIfUnset(e,t){!n.isUndefined(e)&&n.isUndefined(e["Content-Type"])&&(e["Content-Type"]=t)}var a={adapter:function getDefaultAdapter(){var e;return"undefined"!=typeof XMLHttpRequest?e=r(137):void 0!==t&&(e=r(137)),e}(),transformRequest:[function transformRequest(e,t){return i(t,"Content-Type"),n.isFormData(e)||n.isArrayBuffer(e)||n.isBuffer(e)||n.isStream(e)||n.isFile(e)||n.isBlob(e)?e:n.isArrayBufferView(e)?e.buffer:n.isURLSearchParams(e)?(setContentTypeIfUnset(t,"application/x-www-form-urlencoded;charset=utf-8"),e.toString()):n.isObject(e)?(setContentTypeIfUnset(t,"application/json;charset=utf-8"),JSON.stringify(e)):e}],transformResponse:[function transformResponse(e){if("string"==typeof e)try{e=JSON.parse(e)}catch(e){}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,validateStatus:function validateStatus(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*"}}};n.forEach(["delete","get","head"],function forEachMethodNoData(e){a.headers[e]={}}),n.forEach(["post","put","patch"],function forEachMethodWithData(e){a.headers[e]=n.merge(o)}),e.exports=a}).call(t,r(136))},function(e,t,r){"use strict";var n={mouseManager:{_handleWebClickEvent:{module:"adsumNativeMap.mouseManager",method:"_handleWebClickEvent"},_handleWebDblClickEvent:{module:"adsumNativeMap.mouseManager",method:"_handleWebDblClickEvent"}},sceneManager:{_handleWebFloorDidChanged:{module:"adsumNativeMap.sceneManager",method:"_handleWebFloorDidChanged"}},wayfindingManager:{_handleWebUserPositionDidChanged:{module:"adsumNativeMap.wayfindingManager",method:"_handleWebUserPositionDidChanged"}}};t.a=n},function(e,t,r){"use strict";var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},i=function s(){var e=0;return{next:function next(){return--e}}}(),o=new Map,a=new Map,s={serialize:function serialize(e){if("symbol"!==(void 0===e?"undefined":n(e)))return e;if(o.has(e))return o.get(e);var t=i.next();return o.set(e,t),a.set(t,e),t},deserialize:function deserialize(e){return a.has(e)?a.get(e):e}};t.a=s},function(e,t,r){"use strict";var n=r(49),i=function(){function defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(e,t,r){return t&&defineProperties(e.prototype,t),r&&defineProperties(e,r),e}}();var o=function(e){function LabelObjectDelegate(){return function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,LabelObjectDelegate),function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(LabelObjectDelegate.__proto__||Object.getPrototypeOf(LabelObjectDelegate)).apply(this,arguments))}return function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(LabelObjectDelegate,n["a"]),i(LabelObjectDelegate,[{key:"getParent",value:function getParent(e){return this.objectManagerProxy.serializeAdsumObject3D(this._getInstance(e).parent)}},{key:"getOrientationMode",value:function getOrientationMode(e){return this._getInstance(e).orientationMode}},{key:"isAutoScale",value:function isAutoScale(e){return this._getInstance(e).autoScale}}]),LabelObjectDelegate}();t.a=o},function(e,t,r){e.exports=!r(6)&&!r(3)(function(){return 7!=Object.defineProperty(r(70)("div"),"a",{get:function get(){return 7}}).a})},function(e,t,r){t.f=r(5)},function(e,t,r){var n=r(14),i=r(15),o=r(54)(!1),a=r(72)("IE_PROTO");e.exports=function(e,t){var r,s=i(e),c=0,u=[];for(r in s)r!=a&&n(s,r)&&u.push(r);for(;t.length>c;)n(s,r=t[c++])&&(~o(u,r)||u.push(r));return u}},function(e,t,r){var n=r(7),i=r(1),o=r(35);e.exports=r(6)?Object.defineProperties:function defineProperties(e,t){i(e);for(var r,a=o(t),s=a.length,c=0;s>c;)n.f(e,r=a[c++],t[r]);return e}},function(e,t,r){var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},i=r(15),o=r(38).f,a={}.toString,s="object"==("undefined"==typeof window?"undefined":n(window))&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];e.exports.f=function getOwnPropertyNames(e){return s&&"[object Window]"==a.call(e)?function getWindowNames(e){try{return o(e)}catch(e){return s.slice()}}(e):o(i(e))}},function(e,t,r){"use strict";var n=r(35),i=r(55),o=r(51),a=r(9),s=r(50),c=Object.assign;e.exports=!c||r(3)(function(){var e={},t={},r=Symbol(),n="abcdefghijklmnopqrst";return e[r]=7,n.split("").forEach(function(e){t[e]=e}),7!=c({},e)[r]||Object.keys(c({},t)).join("")!=n})?function assign(e,t){for(var r=a(e),c=arguments.length,u=1,l=i.f,h=o.f;c>u;)for(var p,f=s(arguments[u++]),d=l?n(f).concat(l(f)):n(f),m=d.length,g=0;m>g;)h.call(f,p=d[g++])&&(r[p]=f[p]);return r}:c},function(e,t,r){"use strict";var n=r(10),i=r(4),o=r(108),a=[].slice,s={};e.exports=Function.bind||function bind(e){var t=n(this),r=a.call(arguments,1),c=function bound(){var n=r.concat(a.call(arguments));return this instanceof bound?function construct(e,t,r){if(!(t in s)){for(var n=[],i=0;i<t;i++)n[i]="a["+i+"]";s[t]=Function("F,a","return new F("+n.join(",")+")")}return s[t](e,r)}(t,n.length,n):o(t,n,e)};return i(t.prototype)&&(c.prototype=t.prototype),c}},function(e,t){e.exports=function(e,t,r){var n=void 0===r;switch(t.length){case 0:return n?e():e.call(r);case 1:return n?e(t[0]):e.call(r,t[0]);case 2:return n?e(t[0],t[1]):e.call(r,t[0],t[1]);case 3:return n?e(t[0],t[1],t[2]):e.call(r,t[0],t[1],t[2]);case 4:return n?e(t[0],t[1],t[2],t[3]):e.call(r,t[0],t[1],t[2],t[3])}return e.apply(r,t)}},function(e,t,r){var n=r(2).parseInt,i=r(45).trim,o=r(76),a=/^[-+]?0[xX]/;e.exports=8!==n(o+"08")||22!==n(o+"0x16")?function parseInt(e,t){var r=i(String(e),3);return n(r,t>>>0||(a.test(r)?16:10))}:n},function(e,t,r){var n=r(2).parseFloat,i=r(45).trim;e.exports=1/n(r(76)+"-0")!=-1/0?function parseFloat(e){var t=i(String(e),3),r=n(t);return 0===r&&"-"==t.charAt(0)?-0:r}:n},function(e,t,r){var n=r(21);e.exports=function(e,t){if("number"!=typeof e&&"Number"!=n(e))throw TypeError(t);return+e}},function(e,t,r){var n=r(4),i=Math.floor;e.exports=function isInteger(e){return!n(e)&&isFinite(e)&&i(e)===e}},function(e,t){e.exports=Math.log1p||function log1p(e){return(e=+e)>-1e-8&&e<1e-8?e-e*e/2:Math.log(1+e)}},function(e,t,r){var n=r(79),i=Math.pow,o=i(2,-52),a=i(2,-23),s=i(2,127)*(2-a),c=i(2,-126);e.exports=Math.fround||function fround(e){var t,r,i=Math.abs(e),u=n(e);return i<c?u*function roundTiesToEven(e){return e+1/o-1/o}(i/c/a)*c*a:(r=(t=(1+a/o)*i)-(t-i))>s||r!=r?u*(1/0):u*r}},function(e,t,r){var n=r(1);e.exports=function(e,t,r,i){try{return i?t(n(r)[0],r[1]):t(r)}catch(t){var o=e.return;throw void 0!==o&&n(o.call(e)),t}}},function(e,t,r){var n=r(10),i=r(9),o=r(50),a=r(8);e.exports=function(e,t,r,s,c){n(t);var u=i(e),l=o(u),h=a(u.length),p=c?h-1:0,f=c?-1:1;if(r<2)for(;;){if(p in l){s=l[p],p+=f;break}if(p+=f,c?p<0:h<=p)throw TypeError("Reduce of empty array with no initial value")}for(;c?p>=0:h>p;p+=f)p in l&&(s=t(s,l[p],p,u));return s}},function(e,t,r){"use strict";var n=r(9),i=r(36),o=r(8);e.exports=[].copyWithin||function copyWithin(e,t){var r=n(this),a=o(r.length),s=i(e,a),c=i(t,a),u=arguments.length>2?arguments[2]:void 0,l=Math.min((void 0===u?a:i(u,a))-c,a-s),h=1;for(c<s&&s<c+l&&(h=-1,c+=l-1,s+=l-1);l-- >0;)c in r?r[s]=r[c]:delete r[s],s+=h,c+=h;return r}},function(e,t){e.exports=function(e,t){return{value:t,done:!!e}}},function(e,t,r){r(6)&&"g"!=/./g.flags&&r(7).f(RegExp.prototype,"flags",{configurable:!0,get:r(59)})},function(e,t){e.exports=function(e){try{return{e:!1,v:e()}}catch(e){return{e:!0,v:e}}}},function(e,t,r){var n=r(1),i=r(4),o=r(94);e.exports=function(e,t){if(n(e),i(t)&&t.constructor===e)return t;var r=o.f(e);return(0,r.resolve)(t),r.promise}},function(e,t,r){"use strict";var n=r(123),i=r(47);e.exports=r(63)("Map",function(e){return function Map(){return e(this,arguments.length>0?arguments[0]:void 0)}},{get:function get(e){var t=n.getEntry(i(this,"Map"),e);return t&&t.v},set:function set(e,t){return n.def(i(this,"Map"),0===e?0:e,t)}},n,!0)},function(e,t,r){"use strict";var n=r(7).f,i=r(37),o=r(42),a=r(20),s=r(40),c=r(41),u=r(82),l=r(118),h=r(39),p=r(6),f=r(30).fastKey,d=r(47),m=p?"_s":"size",g=function getEntry(e,t){var r,n=f(t);if("F"!==n)return e._i[n];for(r=e._f;r;r=r.n)if(r.k==t)return r};e.exports={getConstructor:function getConstructor(e,t,r,u){var l=e(function(e,n){s(e,l,t,"_i"),e._t=t,e._i=i(null),e._f=void 0,e._l=void 0,e[m]=0,void 0!=n&&c(n,r,e[u],e)});return o(l.prototype,{clear:function clear(){for(var e=d(this,t),r=e._i,n=e._f;n;n=n.n)n.r=!0,n.p&&(n.p=n.p.n=void 0),delete r[n.i];e._f=e._l=void 0,e[m]=0},delete:function _delete(e){var r=d(this,t),n=g(r,e);if(n){var i=n.n,o=n.p;delete r._i[n.i],n.r=!0,o&&(o.n=i),i&&(i.p=o),r._f==n&&(r._f=i),r._l==n&&(r._l=o),r[m]--}return!!n},forEach:function forEach(e){d(this,t);for(var r,n=a(e,arguments.length>1?arguments[1]:void 0,3);r=r?r.n:this._f;)for(n(r.v,r.k,this);r&&r.r;)r=r.p},has:function has(e){return!!g(d(this,t),e)}}),p&&n(l.prototype,"size",{get:function get(){return d(this,t)[m]}}),l},def:function def(e,t,r){var n,i,o=g(e,t);return o?o.v=r:(e._l=o={i:i=f(t,!0),k:t,v:r,p:n=e._l,n:void 0,r:!1},e._f||(e._f=o),n&&(n.n=o),e[m]++,"F"!==i&&(e._i[i]=o)),e},getEntry:g,setStrong:function setStrong(e,t,r){u(e,t,function(e,r){this._t=d(e,t),this._k=r,this._l=void 0},function(){for(var e=this._k,t=this._l;t&&t.r;)t=t.p;return this._t&&(this._l=t=t?t.n:this._t._f)?l(0,"keys"==e?t.k:"values"==e?t.v:[t.k,t.v]):(this._t=void 0,l(1))},r?"entries":"values",!r,!0),h(t)}}},function(e,t,r){"use strict";var n=r(123),i=r(47);e.exports=r(63)("Set",function(e){return function Set(){return e(this,arguments.length>0?arguments[0]:void 0)}},{add:function add(e){return n.def(i(this,"Set"),e=0===e?0:e,e)}},n)},function(e,t,r){"use strict";var n,i=r(27)(0),o=r(12),a=r(30),s=r(106),c=r(126),u=r(4),l=r(3),h=r(47),p=a.getWeak,f=Object.isExtensible,d=c.ufstore,m={},g=function wrapper(e){return function WeakMap(){return e(this,arguments.length>0?arguments[0]:void 0)}},y={get:function get(e){if(u(e)){var t=p(e);return!0===t?d(h(this,"WeakMap")).get(e):t?t[this._i]:void 0}},set:function set(e,t){return c.def(h(this,"WeakMap"),e,t)}},v=e.exports=r(63)("WeakMap",g,y,c,!0,!0);l(function(){return 7!=(new v).set((Object.freeze||Object)(m),7).get(m)})&&(s((n=c.getConstructor(g,"WeakMap")).prototype,y),a.NEED=!0,i(["delete","has","get","set"],function(e){var t=v.prototype,r=t[e];o(t,e,function(t,i){if(u(t)&&!f(t)){this._f||(this._f=new n);var o=this._f[e](t,i);return"set"==e?this:o}return r.call(this,t,i)})}))},function(e,t,r){"use strict";var n=r(42),i=r(30).getWeak,o=r(1),a=r(4),s=r(40),c=r(41),u=r(27),l=r(14),h=r(47),p=u(5),f=u(6),d=0,m=function uncaughtFrozenStore(e){return e._l||(e._l=new g)},g=function UncaughtFrozenStore(){this.a=[]},y=function findUncaughtFrozen(e,t){return p(e.a,function(e){return e[0]===t})};g.prototype={get:function get(e){var t=y(this,e);if(t)return t[1]},has:function has(e){return!!y(this,e)},set:function set(e,t){var r=y(this,e);r?r[1]=t:this.a.push([e,t])},delete:function _delete(e){var t=f(this.a,function(t){return t[0]===e});return~t&&this.a.splice(t,1),!!~t}},e.exports={getConstructor:function getConstructor(e,t,r,o){var u=e(function(e,n){s(e,u,t,"_i"),e._t=t,e._i=d++,e._l=void 0,void 0!=n&&c(n,r,e[o],e)});return n(u.prototype,{delete:function _delete(e){if(!a(e))return!1;var r=i(e);return!0===r?m(h(this,t)).delete(e):r&&l(r,this._i)&&delete r[this._i]},has:function has(e){if(!a(e))return!1;var r=i(e);return!0===r?m(h(this,t)).has(e):r&&l(r,this._i)}}),u},def:function def(e,t,r){var n=i(o(t),!0);return!0===n?m(e).set(t,r):n[e._i]=r,e},ufstore:m}},function(e,t,r){var n=r(25),i=r(8);e.exports=function(e){if(void 0===e)return 0;var t=n(e),r=i(t);if(t!==r)throw RangeError("Wrong length!");return r}},function(e,t,r){var n=r(38),i=r(55),o=r(1),a=r(2).Reflect;e.exports=a&&a.ownKeys||function ownKeys(e){var t=n.f(o(e)),r=i.f;return r?t.concat(r(e)):t}},function(e,t,r){"use strict";var n=r(56),i=r(4),o=r(8),a=r(20),s=r(5)("isConcatSpreadable");e.exports=function flattenIntoArray(e,t,r,c,u,l,h,p){for(var f,d,m=u,g=0,y=!!h&&a(h,p,3);g<c;){if(g in r){if(f=y?y(r[g],g,t):r[g],d=!1,i(f)&&(d=void 0!==(d=f[s])?!!d:n(f)),d&&l>0)m=flattenIntoArray(e,t,f,o(f.length),m,l-1)-1;else{if(m>=9007199254740991)throw TypeError();e[m]=f}m++}g++}return m}},function(e,t,r){var n=r(8),i=r(78),o=r(24);e.exports=function(e,t,r,a){var s=String(o(e)),c=s.length,u=void 0===r?" ":String(r),l=n(t);if(l<=c||""==u)return s;var h=l-c,p=i.call(u,Math.ceil(h/u.length));return p.length>h&&(p=p.slice(0,h)),a?p+s:s+p}},function(e,t,r){var n=r(35),i=r(15),o=r(51).f;e.exports=function(e){return function(t){for(var r,a=i(t),s=n(a),c=s.length,u=0,l=[];c>u;)o.call(a,r=s[u++])&&l.push(e?[r,a[r]]:a[r]);return l}}},function(e,t,r){var n=r(52),i=r(133);e.exports=function(e){return function toJSON(){if(n(this)!=e)throw TypeError(e+"#toJSON isn't generic");return i(this)}}},function(e,t,r){var n=r(41);e.exports=function(e,t){var r=[];return n(e,!1,r.push,r,t),r}},function(e,t){e.exports=Math.scale||function scale(e,t,r,n,i){return 0===arguments.length||e!=e||t!=t||r!=r||n!=n||i!=i?NaN:e===1/0||e===-1/0?e:(e-t)*(i-n)/(r-t)+n}},function(e,t,r){"use strict";e.exports=function bind(e,t){return function wrap(){for(var r=new Array(arguments.length),n=0;n<r.length;n++)r[n]=arguments[n];return e.apply(t,r)}}},function(e,t){var r,n,i=e.exports={};function defaultSetTimout(){throw new Error("setTimeout has not been defined")}function defaultClearTimeout(){throw new Error("clearTimeout has not been defined")}function runTimeout(e){if(r===setTimeout)return setTimeout(e,0);if((r===defaultSetTimout||!r)&&setTimeout)return r=setTimeout,setTimeout(e,0);try{return r(e,0)}catch(t){try{return r.call(null,e,0)}catch(t){return r.call(this,e,0)}}}!function(){try{r="function"==typeof setTimeout?setTimeout:defaultSetTimout}catch(e){r=defaultSetTimout}try{n="function"==typeof clearTimeout?clearTimeout:defaultClearTimeout}catch(e){n=defaultClearTimeout}}();var o,a=[],s=!1,c=-1;function cleanUpNextTick(){s&&o&&(s=!1,o.length?a=o.concat(a):c=-1,a.length&&drainQueue())}function drainQueue(){if(!s){var e=runTimeout(cleanUpNextTick);s=!0;for(var t=a.length;t;){for(o=a,a=[];++c<t;)o&&o[c].run();c=-1,t=a.length}o=null,s=!1,function runClearTimeout(e){if(n===clearTimeout)return clearTimeout(e);if((n===defaultClearTimeout||!n)&&clearTimeout)return n=clearTimeout,clearTimeout(e);try{return n(e)}catch(t){try{return n.call(null,e)}catch(t){return n.call(this,e)}}}(e)}}function Item(e,t){this.fun=e,this.array=t}function noop(){}i.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)t[r-1]=arguments[r];a.push(new Item(e,t)),1!==a.length||s||runTimeout(drainQueue)},Item.prototype.run=function(){this.fun.apply(null,this.array)},i.title="browser",i.browser=!0,i.env={},i.argv=[],i.version="",i.versions={},i.on=noop,i.addListener=noop,i.once=noop,i.off=noop,i.removeListener=noop,i.removeAllListeners=noop,i.emit=noop,i.prependListener=noop,i.prependOnceListener=noop,i.listeners=function(e){return[]},i.binding=function(e){throw new Error("process.binding is not supported")},i.cwd=function(){return"/"},i.chdir=function(e){throw new Error("process.chdir is not supported")},i.umask=function(){return 0}},function(e,t,r){"use strict";var n=r(18),i=r(356),o=r(358),a=r(359),s=r(360),c=r(138),u="undefined"!=typeof window&&window.btoa&&window.btoa.bind(window)||r(361);e.exports=function xhrAdapter(e){return new Promise(function dispatchXhrRequest(t,l){var h=e.data,p=e.headers;n.isFormData(h)&&delete p["Content-Type"];var f=new XMLHttpRequest,d="onreadystatechange",m=!1;if("undefined"==typeof window||!window.XDomainRequest||"withCredentials"in f||s(e.url)||(f=new window.XDomainRequest,d="onload",m=!0,f.onprogress=function handleProgress(){},f.ontimeout=function handleTimeout(){}),e.auth){var g=e.auth.username||"",y=e.auth.password||"";p.Authorization="Basic "+u(g+":"+y)}if(f.open(e.method.toUpperCase(),o(e.url,e.params,e.paramsSerializer),!0),f.timeout=e.timeout,f[d]=function handleLoad(){if(f&&(4===f.readyState||m)&&(0!==f.status||f.responseURL&&0===f.responseURL.indexOf("file:"))){var r="getAllResponseHeaders"in f?a(f.getAllResponseHeaders()):null,n={data:e.responseType&&"text"!==e.responseType?f.response:f.responseText,status:1223===f.status?204:f.status,statusText:1223===f.status?"No Content":f.statusText,headers:r,config:e,request:f};i(t,l,n),f=null}},f.onerror=function handleError(){l(c("Network Error",e,null,f)),f=null},f.ontimeout=function handleTimeout(){l(c("timeout of "+e.timeout+"ms exceeded",e,"ECONNABORTED",f)),f=null},n.isStandardBrowserEnv()){var v=r(362),_=(e.withCredentials||s(e.url))&&e.xsrfCookieName?v.read(e.xsrfCookieName):void 0;_&&(p[e.xsrfHeaderName]=_)}if("setRequestHeader"in f&&n.forEach(p,function setRequestHeader(e,t){void 0===h&&"content-type"===t.toLowerCase()?delete p[t]:f.setRequestHeader(t,e)}),e.withCredentials&&(f.withCredentials=!0),e.responseType)try{f.responseType=e.responseType}catch(t){if("json"!==e.responseType)throw t}"function"==typeof e.onDownloadProgress&&f.addEventListener("progress",e.onDownloadProgress),"function"==typeof e.onUploadProgress&&f.upload&&f.upload.addEventListener("progress",e.onUploadProgress),e.cancelToken&&e.cancelToken.promise.then(function onCanceled(e){f&&(f.abort(),l(e),f=null)}),void 0===h&&(h=null),f.send(h)})}},function(e,t,r){"use strict";var n=r(357);e.exports=function createError(e,t,r,i,o){var a=new Error(e);return n(a,t,r,i,o)}},function(e,t,r){"use strict";e.exports=function isCancel(e){return!(!e||!e.__CANCEL__)}},function(e,t,r){"use strict";function Cancel(e){this.message=e}Cancel.prototype.toString=function toString(){return"Cancel"+(this.message?": "+this.message:"")},Cancel.prototype.__CANCEL__=!0,e.exports=Cancel},function(e,t,r){"use strict";t.a={init:{will:"init.will",did:"init.did",error:"init.error"},start:{will:"start.will",did:"start.did",error:"start.error"}}},function(e,t,r){e.exports=r(143)},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(144),i=(r.n(n),r(347));r.d(t,"AdsumWebMapProxy",function(){return i.a});var o=r(141);r.d(t,"AdsumWebMapProxyEvents",function(){return o.a})},function(e,t,r){"use strict";(function(e){if(r(145),r(342),r(344),e._babelPolyfill)throw new Error("only one instance of babel-polyfill is allowed");e._babelPolyfill=!0;var t="defineProperty";function define(e,r,n){e[r]||Object[t](e,r,{writable:!0,configurable:!0,value:n})}define(String.prototype,"padLeft","".padStart),define(String.prototype,"padRight","".padEnd),"pop,reverse,shift,keys,values,entries,indexOf,every,some,forEach,map,filter,find,findIndex,includes,join,slice,concat,push,splice,unshift,sort,lastIndexOf,reduce,reduceRight,copyWithin,fill".split(",").forEach(function(e){[][e]&&define(Array,e,Function.call.bind([][e]))})}).call(t,r(69))},function(e,t,r){r(146),r(148),r(149),r(150),r(151),r(152),r(153),r(154),r(155),r(156),r(157),r(158),r(159),r(160),r(161),r(162),r(164),r(165),r(166),r(167),r(168),r(169),r(170),r(171),r(172),r(173),r(174),r(175),r(176),r(177),r(178),r(179),r(180),r(181),r(182),r(183),r(184),r(185),r(186),r(187),r(188),r(189),r(190),r(191),r(192),r(193),r(194),r(195),r(196),r(197),r(198),r(199),r(200),r(201),r(202),r(203),r(204),r(205),r(206),r(207),r(208),r(209),r(210),r(211),r(212),r(213),r(214),r(215),r(216),r(217),r(218),r(219),r(220),r(221),r(222),r(223),r(224),r(226),r(227),r(229),r(230),r(231),r(232),r(233),r(234),r(235),r(237),r(238),r(239),r(240),r(241),r(242),r(243),r(244),r(245),r(246),r(247),r(248),r(249),r(91),r(250),r(251),r(119),r(252),r(253),r(254),r(255),r(256),r(122),r(124),r(125),r(257),r(258),r(259),r(260),r(261),r(262),r(263),r(264),r(265),r(266),r(267),r(268),r(269),r(270),r(271),r(272),r(273),r(274),r(275),r(276),r(277),r(278),r(279),r(280),r(281),r(282),r(283),r(284),r(285),r(286),r(287),r(288),r(289),r(290),r(291),r(292),r(293),r(294),r(295),r(296),r(297),r(298),r(299),r(300),r(301),r(302),r(303),r(304),r(305),r(306),r(307),r(308),r(309),r(310),r(311),r(312),r(313),r(314),r(315),r(316),r(317),r(318),r(319),r(320),r(321),r(322),r(323),r(324),r(325),r(326),r(327),r(328),r(329),r(330),r(331),r(332),r(333),r(334),r(335),r(336),r(337),r(338),r(339),r(340),r(341),e.exports=r(19)},function(e,t,r){"use strict";var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},i=r(2),o=r(14),a=r(6),s=r(0),c=r(12),u=r(30).KEY,l=r(3),h=r(53),p=r(44),f=r(34),d=r(5),m=r(102),g=r(71),y=r(147),v=r(56),_=r(1),b=r(4),w=r(15),x=r(23),M=r(33),S=r(37),C=r(105),P=r(16),E=r(7),T=r(35),O=P.f,A=E.f,L=C.f,k=i.Symbol,R=i.JSON,I=R&&R.stringify,N=d("_hidden"),F=d("toPrimitive"),j={}.propertyIsEnumerable,B=h("symbol-registry"),V=h("symbols"),D=h("op-symbols"),U=Object.prototype,G="function"==typeof k,z=i.QObject,H=!z||!z.prototype||!z.prototype.findChild,W=a&&l(function(){return 7!=S(A({},"a",{get:function get(){return A(this,"a",{value:7}).a}})).a})?function(e,t,r){var n=O(U,t);n&&delete U[t],A(e,t,r),n&&e!==U&&A(U,t,n)}:A,q=function wrap(e){var t=V[e]=S(k.prototype);return t._k=e,t},X=G&&"symbol"==n(k.iterator)?function(e){return"symbol"==(void 0===e?"undefined":n(e))}:function(e){return e instanceof k},Y=function defineProperty(e,t,r){return e===U&&Y(D,t,r),_(e),t=x(t,!0),_(r),o(V,t)?(r.enumerable?(o(e,N)&&e[N][t]&&(e[N][t]=!1),r=S(r,{enumerable:M(0,!1)})):(o(e,N)||A(e,N,M(1,{})),e[N][t]=!0),W(e,t,r)):A(e,t,r)},J=function defineProperties(e,t){_(e);for(var r,n=y(t=w(t)),i=0,o=n.length;o>i;)Y(e,r=n[i++],t[r]);return e},Z=function propertyIsEnumerable(e){var t=j.call(this,e=x(e,!0));return!(this===U&&o(V,e)&&!o(D,e))&&(!(t||!o(this,e)||!o(V,e)||o(this,N)&&this[N][e])||t)},K=function getOwnPropertyDescriptor(e,t){if(e=w(e),t=x(t,!0),e!==U||!o(V,t)||o(D,t)){var r=O(e,t);return!r||!o(V,t)||o(e,N)&&e[N][t]||(r.enumerable=!0),r}},Q=function getOwnPropertyNames(e){for(var t,r=L(w(e)),n=[],i=0;r.length>i;)o(V,t=r[i++])||t==N||t==u||n.push(t);return n},$=function getOwnPropertySymbols(e){for(var t,r=e===U,n=L(r?D:w(e)),i=[],a=0;n.length>a;)!o(V,t=n[a++])||r&&!o(U,t)||i.push(V[t]);return i};G||(c((k=function _Symbol(){if(this instanceof k)throw TypeError("Symbol is not a constructor!");var e=f(arguments.length>0?arguments[0]:void 0);return a&&H&&W(U,e,{configurable:!0,set:function $set(t){this===U&&$set.call(D,t),o(this,N)&&o(this[N],e)&&(this[N][e]=!1),W(this,e,M(1,t))}}),q(e)}).prototype,"toString",function toString(){return this._k}),P.f=K,E.f=Y,r(38).f=C.f=Q,r(51).f=Z,r(55).f=$,a&&!r(31)&&c(U,"propertyIsEnumerable",Z,!0),m.f=function(e){return q(d(e))}),s(s.G+s.W+s.F*!G,{Symbol:k});for(var ee="hasInstance,isConcatSpreadable,iterator,match,replace,search,species,split,toPrimitive,toStringTag,unscopables".split(","),te=0;ee.length>te;)d(ee[te++]);for(var re=T(d.store),ne=0;re.length>ne;)g(re[ne++]);s(s.S+s.F*!G,"Symbol",{for:function _for(e){return o(B,e+="")?B[e]:B[e]=k(e)},keyFor:function keyFor(e){if(!X(e))throw TypeError(e+" is not a symbol!");for(var t in B)if(B[t]===e)return t},useSetter:function useSetter(){H=!0},useSimple:function useSimple(){H=!1}}),s(s.S+s.F*!G,"Object",{create:function create(e,t){return void 0===t?S(e):J(S(e),t)},defineProperty:Y,defineProperties:J,getOwnPropertyDescriptor:K,getOwnPropertyNames:Q,getOwnPropertySymbols:$}),R&&s(s.S+s.F*(!G||l(function(){var e=k();return"[null]"!=I([e])||"{}"!=I({a:e})||"{}"!=I(Object(e))})),"JSON",{stringify:function stringify(e){for(var t,r,n=[e],i=1;arguments.length>i;)n.push(arguments[i++]);if(r=t=n[1],(b(t)||void 0!==e)&&!X(e))return v(t)||(t=function replacer(e,t){if("function"==typeof r&&(t=r.call(this,e,t)),!X(t))return t}),n[1]=t,I.apply(R,n)}}),k.prototype[F]||r(11)(k.prototype,F,k.prototype.valueOf),p(k,"Symbol"),p(Math,"Math",!0),p(i.JSON,"JSON",!0)},function(e,t,r){var n=r(35),i=r(55),o=r(51);e.exports=function(e){var t=n(e),r=i.f;if(r)for(var a,s=r(e),c=o.f,u=0;s.length>u;)c.call(e,a=s[u++])&&t.push(a);return t}},function(e,t,r){var n=r(0);n(n.S,"Object",{create:r(37)})},function(e,t,r){var n=r(0);n(n.S+n.F*!r(6),"Object",{defineProperty:r(7).f})},function(e,t,r){var n=r(0);n(n.S+n.F*!r(6),"Object",{defineProperties:r(104)})},function(e,t,r){var n=r(15),i=r(16).f;r(26)("getOwnPropertyDescriptor",function(){return function getOwnPropertyDescriptor(e,t){return i(n(e),t)}})},function(e,t,r){var n=r(9),i=r(17);r(26)("getPrototypeOf",function(){return function getPrototypeOf(e){return i(n(e))}})},function(e,t,r){var n=r(9),i=r(35);r(26)("keys",function(){return function keys(e){return i(n(e))}})},function(e,t,r){r(26)("getOwnPropertyNames",function(){return r(105).f})},function(e,t,r){var n=r(4),i=r(30).onFreeze;r(26)("freeze",function(e){return function freeze(t){return e&&n(t)?e(i(t)):t}})},function(e,t,r){var n=r(4),i=r(30).onFreeze;r(26)("seal",function(e){return function seal(t){return e&&n(t)?e(i(t)):t}})},function(e,t,r){var n=r(4),i=r(30).onFreeze;r(26)("preventExtensions",function(e){return function preventExtensions(t){return e&&n(t)?e(i(t)):t}})},function(e,t,r){var n=r(4);r(26)("isFrozen",function(e){return function isFrozen(t){return!n(t)||!!e&&e(t)}})},function(e,t,r){var n=r(4);r(26)("isSealed",function(e){return function isSealed(t){return!n(t)||!!e&&e(t)}})},function(e,t,r){var n=r(4);r(26)("isExtensible",function(e){return function isExtensible(t){return!!n(t)&&(!e||e(t))}})},function(e,t,r){var n=r(0);n(n.S+n.F,"Object",{assign:r(106)})},function(e,t,r){var n=r(0);n(n.S,"Object",{is:r(163)})},function(e,t){e.exports=Object.is||function is(e,t){return e===t?0!==e||1/e==1/t:e!=e&&t!=t}},function(e,t,r){var n=r(0);n(n.S,"Object",{setPrototypeOf:r(75).set})},function(e,t,r){"use strict";var n=r(52),i={};i[r(5)("toStringTag")]="z",i+""!="[object z]"&&r(12)(Object.prototype,"toString",function toString(){return"[object "+n(this)+"]"},!0)},function(e,t,r){var n=r(0);n(n.P,"Function",{bind:r(107)})},function(e,t,r){var n=r(7).f,i=Function.prototype,o=/^\s*function ([^ (]*)/;"name"in i||r(6)&&n(i,"name",{configurable:!0,get:function get(){try{return(""+this).match(o)[1]}catch(e){return""}}})},function(e,t,r){"use strict";var n=r(4),i=r(17),o=r(5)("hasInstance"),a=Function.prototype;o in a||r(7).f(a,o,{value:function value(e){if("function"!=typeof this||!n(e))return!1;if(!n(this.prototype))return e instanceof this;for(;e=i(e);)if(this.prototype===e)return!0;return!1}})},function(e,t,r){var n=r(0),i=r(109);n(n.G+n.F*(parseInt!=i),{parseInt:i})},function(e,t,r){var n=r(0),i=r(110);n(n.G+n.F*(parseFloat!=i),{parseFloat:i})},function(e,t,r){"use strict";var n=r(2),i=r(14),o=r(21),a=r(77),s=r(23),c=r(3),u=r(38).f,l=r(16).f,h=r(7).f,p=r(45).trim,f=n.Number,d=f,m=f.prototype,g="Number"==o(r(37)(m)),y="trim"in String.prototype,v=function toNumber(e){var t=s(e,!1);if("string"==typeof t&&t.length>2){var r,n,i,o=(t=y?t.trim():p(t,3)).charCodeAt(0);if(43===o||45===o){if(88===(r=t.charCodeAt(2))||120===r)return NaN}else if(48===o){switch(t.charCodeAt(1)){case 66:case 98:n=2,i=49;break;case 79:case 111:n=8,i=55;break;default:return+t}for(var a,c=t.slice(2),u=0,l=c.length;u<l;u++)if((a=c.charCodeAt(u))<48||a>i)return NaN;return parseInt(c,n)}}return+t};if(!f(" 0o1")||!f("0b1")||f("+0x1")){f=function Number(e){var t=arguments.length<1?0:e,r=this;return r instanceof f&&(g?c(function(){m.valueOf.call(r)}):"Number"!=o(r))?a(new d(v(t)),r,f):v(t)};for(var _,b=r(6)?u(d):"MAX_VALUE,MIN_VALUE,NaN,NEGATIVE_INFINITY,POSITIVE_INFINITY,EPSILON,isFinite,isInteger,isNaN,isSafeInteger,MAX_SAFE_INTEGER,MIN_SAFE_INTEGER,parseFloat,parseInt,isInteger".split(","),w=0;b.length>w;w++)i(d,_=b[w])&&!i(f,_)&&h(f,_,l(d,_));f.prototype=m,m.constructor=f,r(12)(n,"Number",f)}},function(e,t,r){"use strict";var n=r(0),i=r(25),o=r(111),a=r(78),s=1..toFixed,c=Math.floor,u=[0,0,0,0,0,0],l="Number.toFixed: incorrect invocation!",h=function multiply(e,t){for(var r=-1,n=t;++r<6;)n+=e*u[r],u[r]=n%1e7,n=c(n/1e7)},p=function divide(e){for(var t=6,r=0;--t>=0;)r+=u[t],u[t]=c(r/e),r=r%e*1e7},f=function numToString(){for(var e=6,t="";--e>=0;)if(""!==t||0===e||0!==u[e]){var r=String(u[e]);t=""===t?r:t+a.call("0",7-r.length)+r}return t},d=function pow(e,t,r){return 0===t?r:t%2==1?pow(e,t-1,r*e):pow(e*e,t/2,r)};n(n.P+n.F*(!!s&&("0.000"!==8e-5.toFixed(3)||"1"!==.9.toFixed(0)||"1.25"!==1.255.toFixed(2)||"1000000000000000128"!==(0xde0b6b3a7640080).toFixed(0))||!r(3)(function(){s.call({})})),"Number",{toFixed:function toFixed(e){var t,r,n,s,c=o(this,l),u=i(e),m="",g="0";if(u<0||u>20)throw RangeError(l);if(c!=c)return"NaN";if(c<=-1e21||c>=1e21)return String(c);if(c<0&&(m="-",c=-c),c>1e-21)if(r=(t=function log(e){for(var t=0,r=e;r>=4096;)t+=12,r/=4096;for(;r>=2;)t+=1,r/=2;return t}(c*d(2,69,1))-69)<0?c*d(2,-t,1):c/d(2,t,1),r*=4503599627370496,(t=52-t)>0){for(h(0,r),n=u;n>=7;)h(1e7,0),n-=7;for(h(d(10,n,1),0),n=t-1;n>=23;)p(1<<23),n-=23;p(1<<n),h(1,1),p(2),g=f()}else h(0,r),h(1<<-t,0),g=f()+a.call("0",u);return g=u>0?m+((s=g.length)<=u?"0."+a.call("0",u-s)+g:g.slice(0,s-u)+"."+g.slice(s-u)):m+g}})},function(e,t,r){"use strict";var n=r(0),i=r(3),o=r(111),a=1..toPrecision;n(n.P+n.F*(i(function(){return"1"!==a.call(1,void 0)})||!i(function(){a.call({})})),"Number",{toPrecision:function toPrecision(e){var t=o(this,"Number#toPrecision: incorrect invocation!");return void 0===e?a.call(t):a.call(t,e)}})},function(e,t,r){var n=r(0);n(n.S,"Number",{EPSILON:Math.pow(2,-52)})},function(e,t,r){var n=r(0),i=r(2).isFinite;n(n.S,"Number",{isFinite:function isFinite(e){return"number"==typeof e&&i(e)}})},function(e,t,r){var n=r(0);n(n.S,"Number",{isInteger:r(112)})},function(e,t,r){var n=r(0);n(n.S,"Number",{isNaN:function isNaN(e){return e!=e}})},function(e,t,r){var n=r(0),i=r(112),o=Math.abs;n(n.S,"Number",{isSafeInteger:function isSafeInteger(e){return i(e)&&o(e)<=9007199254740991}})},function(e,t,r){var n=r(0);n(n.S,"Number",{MAX_SAFE_INTEGER:9007199254740991})},function(e,t,r){var n=r(0);n(n.S,"Number",{MIN_SAFE_INTEGER:-9007199254740991})},function(e,t,r){var n=r(0),i=r(110);n(n.S+n.F*(Number.parseFloat!=i),"Number",{parseFloat:i})},function(e,t,r){var n=r(0),i=r(109);n(n.S+n.F*(Number.parseInt!=i),"Number",{parseInt:i})},function(e,t,r){var n=r(0),i=r(113),o=Math.sqrt,a=Math.acosh;n(n.S+n.F*!(a&&710==Math.floor(a(Number.MAX_VALUE))&&a(1/0)==1/0),"Math",{acosh:function acosh(e){return(e=+e)<1?NaN:e>94906265.62425156?Math.log(e)+Math.LN2:i(e-1+o(e-1)*o(e+1))}})},function(e,t,r){var n=r(0),i=Math.asinh;n(n.S+n.F*!(i&&1/i(0)>0),"Math",{asinh:function asinh(e){return isFinite(e=+e)&&0!=e?e<0?-asinh(-e):Math.log(e+Math.sqrt(e*e+1)):e}})},function(e,t,r){var n=r(0),i=Math.atanh;n(n.S+n.F*!(i&&1/i(-0)<0),"Math",{atanh:function atanh(e){return 0==(e=+e)?e:Math.log((1+e)/(1-e))/2}})},function(e,t,r){var n=r(0),i=r(79);n(n.S,"Math",{cbrt:function cbrt(e){return i(e=+e)*Math.pow(Math.abs(e),1/3)}})},function(e,t,r){var n=r(0);n(n.S,"Math",{clz32:function clz32(e){return(e>>>=0)?31-Math.floor(Math.log(e+.5)*Math.LOG2E):32}})},function(e,t,r){var n=r(0),i=Math.exp;n(n.S,"Math",{cosh:function cosh(e){return(i(e=+e)+i(-e))/2}})},function(e,t,r){var n=r(0),i=r(80);n(n.S+n.F*(i!=Math.expm1),"Math",{expm1:i})},function(e,t,r){var n=r(0);n(n.S,"Math",{fround:r(114)})},function(e,t,r){var n=r(0),i=Math.abs;n(n.S,"Math",{hypot:function hypot(e,t){for(var r,n,o=0,a=0,s=arguments.length,c=0;a<s;)c<(r=i(arguments[a++]))?(o=o*(n=c/r)*n+1,c=r):o+=r>0?(n=r/c)*n:r;return c===1/0?1/0:c*Math.sqrt(o)}})},function(e,t,r){var n=r(0),i=Math.imul;n(n.S+n.F*r(3)(function(){return-5!=i(4294967295,5)||2!=i.length}),"Math",{imul:function imul(e,t){var r=+e,n=+t,i=65535&r,o=65535&n;return 0|i*o+((65535&r>>>16)*o+i*(65535&n>>>16)<<16>>>0)}})},function(e,t,r){var n=r(0);n(n.S,"Math",{log10:function log10(e){return Math.log(e)*Math.LOG10E}})},function(e,t,r){var n=r(0);n(n.S,"Math",{log1p:r(113)})},function(e,t,r){var n=r(0);n(n.S,"Math",{log2:function log2(e){return Math.log(e)/Math.LN2}})},function(e,t,r){var n=r(0);n(n.S,"Math",{sign:r(79)})},function(e,t,r){var n=r(0),i=r(80),o=Math.exp;n(n.S+n.F*r(3)(function(){return-2e-17!=!Math.sinh(-2e-17)}),"Math",{sinh:function sinh(e){return Math.abs(e=+e)<1?(i(e)-i(-e))/2:(o(e-1)-o(-e-1))*(Math.E/2)}})},function(e,t,r){var n=r(0),i=r(80),o=Math.exp;n(n.S,"Math",{tanh:function tanh(e){var t=i(e=+e),r=i(-e);return t==1/0?1:r==1/0?-1:(t-r)/(o(e)+o(-e))}})},function(e,t,r){var n=r(0);n(n.S,"Math",{trunc:function trunc(e){return(e>0?Math.floor:Math.ceil)(e)}})},function(e,t,r){var n=r(0),i=r(36),o=String.fromCharCode,a=String.fromCodePoint;n(n.S+n.F*(!!a&&1!=a.length),"String",{fromCodePoint:function fromCodePoint(e){for(var t,r=[],n=arguments.length,a=0;n>a;){if(t=+arguments[a++],i(t,1114111)!==t)throw RangeError(t+" is not a valid code point");r.push(t<65536?o(t):o(55296+((t-=65536)>>10),t%1024+56320))}return r.join("")}})},function(e,t,r){var n=r(0),i=r(15),o=r(8);n(n.S,"String",{raw:function raw(e){for(var t=i(e.raw),r=o(t.length),n=arguments.length,a=[],s=0;r>s;)a.push(String(t[s++])),s<n&&a.push(String(arguments[s]));return a.join("")}})},function(e,t,r){"use strict";r(45)("trim",function(e){return function trim(){return e(this,3)}})},function(e,t,r){"use strict";var n=r(81)(!0);r(82)(String,"String",function(e){this._t=String(e),this._i=0},function(){var e,t=this._t,r=this._i;return r>=t.length?{value:void 0,done:!0}:(e=n(t,r),this._i+=e.length,{value:e,done:!1})})},function(e,t,r){"use strict";var n=r(0),i=r(81)(!1);n(n.P,"String",{codePointAt:function codePointAt(e){return i(this,e)}})},function(e,t,r){"use strict";var n=r(0),i=r(8),o=r(84),a="".endsWith;n(n.P+n.F*r(85)("endsWith"),"String",{endsWith:function endsWith(e){var t=o(this,e,"endsWith"),r=arguments.length>1?arguments[1]:void 0,n=i(t.length),s=void 0===r?n:Math.min(i(r),n),c=String(e);return a?a.call(t,c,s):t.slice(s-c.length,s)===c}})},function(e,t,r){"use strict";var n=r(0),i=r(84);n(n.P+n.F*r(85)("includes"),"String",{includes:function includes(e){return!!~i(this,e,"includes").indexOf(e,arguments.length>1?arguments[1]:void 0)}})},function(e,t,r){var n=r(0);n(n.P,"String",{repeat:r(78)})},function(e,t,r){"use strict";var n=r(0),i=r(8),o=r(84),a="".startsWith;n(n.P+n.F*r(85)("startsWith"),"String",{startsWith:function startsWith(e){var t=o(this,e,"startsWith"),r=i(Math.min(arguments.length>1?arguments[1]:void 0,t.length)),n=String(e);return a?a.call(t,n,r):t.slice(r,r+n.length)===n}})},function(e,t,r){"use strict";r(13)("anchor",function(e){return function anchor(t){return e(this,"a","name",t)}})},function(e,t,r){"use strict";r(13)("big",function(e){return function big(){return e(this,"big","","")}})},function(e,t,r){"use strict";r(13)("blink",function(e){return function blink(){return e(this,"blink","","")}})},function(e,t,r){"use strict";r(13)("bold",function(e){return function bold(){return e(this,"b","","")}})},function(e,t,r){"use strict";r(13)("fixed",function(e){return function fixed(){return e(this,"tt","","")}})},function(e,t,r){"use strict";r(13)("fontcolor",function(e){return function fontcolor(t){return e(this,"font","color",t)}})},function(e,t,r){"use strict";r(13)("fontsize",function(e){return function fontsize(t){return e(this,"font","size",t)}})},function(e,t,r){"use strict";r(13)("italics",function(e){return function italics(){return e(this,"i","","")}})},function(e,t,r){"use strict";r(13)("link",function(e){return function link(t){return e(this,"a","href",t)}})},function(e,t,r){"use strict";r(13)("small",function(e){return function small(){return e(this,"small","","")}})},function(e,t,r){"use strict";r(13)("strike",function(e){return function strike(){return e(this,"strike","","")}})},function(e,t,r){"use strict";r(13)("sub",function(e){return function sub(){return e(this,"sub","","")}})},function(e,t,r){"use strict";r(13)("sup",function(e){return function sup(){return e(this,"sup","","")}})},function(e,t,r){var n=r(0);n(n.S,"Date",{now:function now(){return(new Date).getTime()}})},function(e,t,r){"use strict";var n=r(0),i=r(9),o=r(23);n(n.P+n.F*r(3)(function(){return null!==new Date(NaN).toJSON()||1!==Date.prototype.toJSON.call({toISOString:function toISOString(){return 1}})}),"Date",{toJSON:function toJSON(e){var t=i(this),r=o(t);return"number"!=typeof r||isFinite(r)?t.toISOString():null}})},function(e,t,r){var n=r(0),i=r(225);n(n.P+n.F*(Date.prototype.toISOString!==i),"Date",{toISOString:i})},function(e,t,r){"use strict";var n=r(3),i=Date.prototype.getTime,o=Date.prototype.toISOString,a=function lz(e){return e>9?e:"0"+e};e.exports=n(function(){return"0385-07-25T07:06:39.999Z"!=o.call(new Date(-5e13-1))})||!n(function(){o.call(new Date(NaN))})?function toISOString(){if(!isFinite(i.call(this)))throw RangeError("Invalid time value");var e=this,t=e.getUTCFullYear(),r=e.getUTCMilliseconds(),n=t<0?"-":t>9999?"+":"";return n+("00000"+Math.abs(t)).slice(n?-6:-4)+"-"+a(e.getUTCMonth()+1)+"-"+a(e.getUTCDate())+"T"+a(e.getUTCHours())+":"+a(e.getUTCMinutes())+":"+a(e.getUTCSeconds())+"."+(r>99?r:"0"+a(r))+"Z"}:o},function(e,t,r){var n=Date.prototype,i=n.toString,o=n.getTime;new Date(NaN)+""!="Invalid Date"&&r(12)(n,"toString",function toString(){var e=o.call(this);return e==e?i.call(this):"Invalid Date"})},function(e,t,r){var n=r(5)("toPrimitive"),i=Date.prototype;n in i||r(11)(i,n,r(228))},function(e,t,r){"use strict";var n=r(1),i=r(23);e.exports=function(e){if("string"!==e&&"number"!==e&&"default"!==e)throw TypeError("Incorrect hint");return i(n(this),"number"!=e)}},function(e,t,r){var n=r(0);n(n.S,"Array",{isArray:r(56)})},function(e,t,r){"use strict";var n=r(20),i=r(0),o=r(9),a=r(115),s=r(86),c=r(8),u=r(87),l=r(88);i(i.S+i.F*!r(58)(function(e){Array.from(e)}),"Array",{from:function from(e){var t,r,i,h,p=o(e),f="function"==typeof this?this:Array,d=arguments.length,m=d>1?arguments[1]:void 0,g=void 0!==m,y=0,v=l(p);if(g&&(m=n(m,d>2?arguments[2]:void 0,2)),void 0==v||f==Array&&s(v))for(r=new f(t=c(p.length));t>y;y++)u(r,y,g?m(p[y],y):p[y]);else for(h=v.call(p),r=new f;!(i=h.next()).done;y++)u(r,y,g?a(h,m,[i.value,y],!0):i.value);return r.length=y,r}})},function(e,t,r){"use strict";var n=r(0),i=r(87);n(n.S+n.F*r(3)(function(){function F(){}return!(Array.of.call(F)instanceof F)}),"Array",{of:function of(){for(var e=0,t=arguments.length,r=new("function"==typeof this?this:Array)(t);t>e;)i(r,e,arguments[e++]);return r.length=t,r}})},function(e,t,r){"use strict";var n=r(0),i=r(15),o=[].join;n(n.P+n.F*(r(50)!=Object||!r(22)(o)),"Array",{join:function join(e){return o.call(i(this),void 0===e?",":e)}})},function(e,t,r){"use strict";var n=r(0),i=r(74),o=r(21),a=r(36),s=r(8),c=[].slice;n(n.P+n.F*r(3)(function(){i&&c.call(i)}),"Array",{slice:function slice(e,t){var r=s(this.length),n=o(this);if(t=void 0===t?r:t,"Array"==n)return c.call(this,e,t);for(var i=a(e,r),u=a(t,r),l=s(u-i),h=new Array(l),p=0;p<l;p++)h[p]="String"==n?this.charAt(i+p):this[i+p];return h}})},function(e,t,r){"use strict";var n=r(0),i=r(10),o=r(9),a=r(3),s=[].sort,c=[1,2,3];n(n.P+n.F*(a(function(){c.sort(void 0)})||!a(function(){c.sort(null)})||!r(22)(s)),"Array",{sort:function sort(e){return void 0===e?s.call(o(this)):s.call(o(this),i(e))}})},function(e,t,r){"use strict";var n=r(0),i=r(27)(0),o=r(22)([].forEach,!0);n(n.P+n.F*!o,"Array",{forEach:function forEach(e){return i(this,e,arguments[1])}})},function(e,t,r){var n=r(4),i=r(56),o=r(5)("species");e.exports=function(e){var t;return i(e)&&("function"!=typeof(t=e.constructor)||t!==Array&&!i(t.prototype)||(t=void 0),n(t)&&null===(t=t[o])&&(t=void 0)),void 0===t?Array:t}},function(e,t,r){"use strict";var n=r(0),i=r(27)(1);n(n.P+n.F*!r(22)([].map,!0),"Array",{map:function map(e){return i(this,e,arguments[1])}})},function(e,t,r){"use strict";var n=r(0),i=r(27)(2);n(n.P+n.F*!r(22)([].filter,!0),"Array",{filter:function filter(e){return i(this,e,arguments[1])}})},function(e,t,r){"use strict";var n=r(0),i=r(27)(3);n(n.P+n.F*!r(22)([].some,!0),"Array",{some:function some(e){return i(this,e,arguments[1])}})},function(e,t,r){"use strict";var n=r(0),i=r(27)(4);n(n.P+n.F*!r(22)([].every,!0),"Array",{every:function every(e){return i(this,e,arguments[1])}})},function(e,t,r){"use strict";var n=r(0),i=r(116);n(n.P+n.F*!r(22)([].reduce,!0),"Array",{reduce:function reduce(e){return i(this,e,arguments.length,arguments[1],!1)}})},function(e,t,r){"use strict";var n=r(0),i=r(116);n(n.P+n.F*!r(22)([].reduceRight,!0),"Array",{reduceRight:function reduceRight(e){return i(this,e,arguments.length,arguments[1],!0)}})},function(e,t,r){"use strict";var n=r(0),i=r(54)(!1),o=[].indexOf,a=!!o&&1/[1].indexOf(1,-0)<0;n(n.P+n.F*(a||!r(22)(o)),"Array",{indexOf:function indexOf(e){return a?o.apply(this,arguments)||0:i(this,e,arguments[1])}})},function(e,t,r){"use strict";var n=r(0),i=r(15),o=r(25),a=r(8),s=[].lastIndexOf,c=!!s&&1/[1].lastIndexOf(1,-0)<0;n(n.P+n.F*(c||!r(22)(s)),"Array",{lastIndexOf:function lastIndexOf(e){if(c)return s.apply(this,arguments)||0;var t=i(this),r=a(t.length),n=r-1;for(arguments.length>1&&(n=Math.min(n,o(arguments[1]))),n<0&&(n=r+n);n>=0;n--)if(n in t&&t[n]===e)return n||0;return-1}})},function(e,t,r){var n=r(0);n(n.P,"Array",{copyWithin:r(117)}),r(32)("copyWithin")},function(e,t,r){var n=r(0);n(n.P,"Array",{fill:r(90)}),r(32)("fill")},function(e,t,r){"use strict";var n=r(0),i=r(27)(5),o=!0;"find"in[]&&Array(1).find(function(){o=!1}),n(n.P+n.F*o,"Array",{find:function find(e){return i(this,e,arguments.length>1?arguments[1]:void 0)}}),r(32)("find")},function(e,t,r){"use strict";var n=r(0),i=r(27)(6),o="findIndex",a=!0;o in[]&&Array(1)[o](function(){a=!1}),n(n.P+n.F*a,"Array",{findIndex:function findIndex(e){return i(this,e,arguments.length>1?arguments[1]:void 0)}}),r(32)(o)},function(e,t,r){r(39)("Array")},function(e,t,r){var n=r(2),i=r(77),o=r(7).f,a=r(38).f,s=r(57),c=r(59),u=n.RegExp,l=u,h=u.prototype,p=/a/g,f=/a/g,d=new u(p)!==p;if(r(6)&&(!d||r(3)(function(){return f[r(5)("match")]=!1,u(p)!=p||u(f)==f||"/a/i"!=u(p,"i")}))){u=function RegExp(e,t){var r=this instanceof u,n=s(e),o=void 0===t;return!r&&n&&e.constructor===u&&o?e:i(d?new l(n&&!o?e.source:e,t):l((n=e instanceof u)?e.source:e,n&&o?c.call(e):t),r?this:h,u)};for(var m=function proxy(e){e in u||o(u,e,{configurable:!0,get:function get(){return l[e]},set:function set(t){l[e]=t}})},g=a(l),y=0;g.length>y;)m(g[y++]);h.constructor=u,u.prototype=h,r(12)(n,"RegExp",u)}r(39)("RegExp")},function(e,t,r){"use strict";r(119);var n=r(1),i=r(59),o=r(6),a=/./.toString,s=function define(e){r(12)(RegExp.prototype,"toString",e,!0)};r(3)(function(){return"/a/b"!=a.call({source:"a",flags:"b"})})?s(function toString(){var e=n(this);return"/".concat(e.source,"/","flags"in e?e.flags:!o&&e instanceof RegExp?i.call(e):void 0)}):"toString"!=a.name&&s(function toString(){return a.call(this)})},function(e,t,r){r(60)("match",1,function(e,t,r){return[function match(r){"use strict";var n=e(this),i=void 0==r?void 0:r[t];return void 0!==i?i.call(r,n):new RegExp(r)[t](String(n))},r]})},function(e,t,r){r(60)("replace",2,function(e,t,r){return[function replace(n,i){"use strict";var o=e(this),a=void 0==n?void 0:n[t];return void 0!==a?a.call(n,o,i):r.call(String(o),n,i)},r]})},function(e,t,r){r(60)("search",1,function(e,t,r){return[function search(r){"use strict";var n=e(this),i=void 0==r?void 0:r[t];return void 0!==i?i.call(r,n):new RegExp(r)[t](String(n))},r]})},function(e,t,r){r(60)("split",2,function(e,t,n){"use strict";var i=r(57),o=n,a=[].push;if("c"=="abbc".split(/(b)*/)[1]||4!="test".split(/(?:)/,-1).length||2!="ab".split(/(?:ab)*/).length||4!=".".split(/(.?)(.?)/).length||".".split(/()()/).length>1||"".split(/.?/).length){var s=void 0===/()??/.exec("")[1];n=function $split(e,t){var r=String(this);if(void 0===e&&0===t)return[];if(!i(e))return o.call(r,e,t);var n,c,u,l,h,p=[],f=(e.ignoreCase?"i":"")+(e.multiline?"m":"")+(e.unicode?"u":"")+(e.sticky?"y":""),d=0,m=void 0===t?4294967295:t>>>0,g=new RegExp(e.source,f+"g");for(s||(n=new RegExp("^"+g.source+"$(?!\\s)",f));(c=g.exec(r))&&!((u=c.index+c[0].length)>d&&(p.push(r.slice(d,c.index)),!s&&c.length>1&&c[0].replace(n,function(){for(h=1;h<arguments.length-2;h++)void 0===arguments[h]&&(c[h]=void 0)}),c.length>1&&c.index<r.length&&a.apply(p,c.slice(1)),l=c[0].length,d=u,p.length>=m));)g.lastIndex===c.index&&g.lastIndex++;return d===r.length?!l&&g.test("")||p.push(""):p.push(r.slice(d)),p.length>m?p.slice(0,m):p}}else"0".split(void 0,0).length&&(n=function $split(e,t){return void 0===e&&0===t?[]:o.call(this,e,t)});return[function split(r,i){var o=e(this),a=void 0==r?void 0:r[t];return void 0!==a?a.call(r,o,i):n.call(String(o),r,i)},n]})},function(e,t,r){"use strict";var n,i,o,a,s=r(31),c=r(2),u=r(20),l=r(52),h=r(0),p=r(4),f=r(10),d=r(40),m=r(41),g=r(61),y=r(92).set,v=r(93)(),_=r(94),b=r(120),w=r(62),x=r(121),M=c.TypeError,S=c.process,C=S&&S.versions,P=C&&C.v8||"",E=c.Promise,T="process"==l(S),O=function empty(){},A=i=_.f,L=!!function(){try{var e=E.resolve(1),t=(e.constructor={})[r(5)("species")]=function(e){e(O,O)};return(T||"function"==typeof PromiseRejectionEvent)&&e.then(O)instanceof t&&0!==P.indexOf("6.6")&&-1===w.indexOf("Chrome/66")}catch(e){}}(),k=function isThenable(e){var t;return!(!p(e)||"function"!=typeof(t=e.then))&&t},R=function notify(e,t){if(!e._n){e._n=!0;var r=e._c;v(function(){for(var n=e._v,i=1==e._s,o=0,a=function run(t){var r,o,a,s=i?t.ok:t.fail,c=t.resolve,u=t.reject,l=t.domain;try{s?(i||(2==e._h&&F(e),e._h=1),!0===s?r=n:(l&&l.enter(),r=s(n),l&&(l.exit(),a=!0)),r===t.promise?u(M("Promise-chain cycle")):(o=k(r))?o.call(r,c,u):c(r)):u(n)}catch(e){l&&!a&&l.exit(),u(e)}};r.length>o;)a(r[o++]);e._c=[],e._n=!1,t&&!e._h&&I(e)})}},I=function onUnhandled(e){y.call(c,function(){var t,r,n,i=e._v,o=N(e);if(o&&(t=b(function(){T?S.emit("unhandledRejection",i,e):(r=c.onunhandledrejection)?r({promise:e,reason:i}):(n=c.console)&&n.error&&n.error("Unhandled promise rejection",i)}),e._h=T||N(e)?2:1),e._a=void 0,o&&t.e)throw t.v})},N=function isUnhandled(e){return 1!==e._h&&0===(e._a||e._c).length},F=function onHandleUnhandled(e){y.call(c,function(){var t;T?S.emit("rejectionHandled",e):(t=c.onrejectionhandled)&&t({promise:e,reason:e._v})})},j=function $reject(e){var t=this;t._d||(t._d=!0,(t=t._w||t)._v=e,t._s=2,t._a||(t._a=t._c.slice()),R(t,!0))},B=function $resolve(e){var t,r=this;if(!r._d){r._d=!0,r=r._w||r;try{if(r===e)throw M("Promise can't be resolved itself");(t=k(e))?v(function(){var n={_w:r,_d:!1};try{t.call(e,u($resolve,n,1),u(j,n,1))}catch(e){j.call(n,e)}}):(r._v=e,r._s=1,R(r,!1))}catch(e){j.call({_w:r,_d:!1},e)}}};L||(E=function Promise(e){d(this,E,"Promise","_h"),f(e),n.call(this);try{e(u(B,this,1),u(j,this,1))}catch(e){j.call(this,e)}},(n=function Promise(e){this._c=[],this._a=void 0,this._s=0,this._d=!1,this._v=void 0,this._h=0,this._n=!1}).prototype=r(42)(E.prototype,{then:function then(e,t){var r=A(g(this,E));return r.ok="function"!=typeof e||e,r.fail="function"==typeof t&&t,r.domain=T?S.domain:void 0,this._c.push(r),this._a&&this._a.push(r),this._s&&R(this,!1),r.promise},catch:function _catch(e){return this.then(void 0,e)}}),o=function OwnPromiseCapability(){var e=new n;this.promise=e,this.resolve=u(B,e,1),this.reject=u(j,e,1)},_.f=A=function newPromiseCapability(e){return e===E||e===a?new o(e):i(e)}),h(h.G+h.W+h.F*!L,{Promise:E}),r(44)(E,"Promise"),r(39)("Promise"),a=r(19).Promise,h(h.S+h.F*!L,"Promise",{reject:function reject(e){var t=A(this);return(0,t.reject)(e),t.promise}}),h(h.S+h.F*(s||!L),"Promise",{resolve:function resolve(e){return x(s&&this===a?E:this,e)}}),h(h.S+h.F*!(L&&r(58)(function(e){E.all(e).catch(O)})),"Promise",{all:function all(e){var t=this,r=A(t),n=r.resolve,i=r.reject,o=b(function(){var r=[],o=0,a=1;m(e,!1,function(e){var s=o++,c=!1;r.push(void 0),a++,t.resolve(e).then(function(e){c||(c=!0,r[s]=e,--a||n(r))},i)}),--a||n(r)});return o.e&&i(o.v),r.promise},race:function race(e){var t=this,r=A(t),n=r.reject,i=b(function(){m(e,!1,function(e){t.resolve(e).then(r.resolve,n)})});return i.e&&n(i.v),r.promise}})},function(e,t,r){"use strict";var n=r(126),i=r(47);r(63)("WeakSet",function(e){return function WeakSet(){return e(this,arguments.length>0?arguments[0]:void 0)}},{add:function add(e){return n.def(i(this,"WeakSet"),e,!0)}},n,!1,!0)},function(e,t,r){"use strict";var n=r(0),i=r(64),o=r(95),a=r(1),s=r(36),c=r(8),u=r(4),l=r(2).ArrayBuffer,h=r(61),p=o.ArrayBuffer,f=o.DataView,d=i.ABV&&l.isView,m=p.prototype.slice,g=i.VIEW;n(n.G+n.W+n.F*(l!==p),{ArrayBuffer:p}),n(n.S+n.F*!i.CONSTR,"ArrayBuffer",{isView:function isView(e){return d&&d(e)||u(e)&&g in e}}),n(n.P+n.U+n.F*r(3)(function(){return!new p(2).slice(1,void 0).byteLength}),"ArrayBuffer",{slice:function slice(e,t){if(void 0!==m&&void 0===t)return m.call(a(this),e);for(var r=a(this).byteLength,n=s(e,r),i=s(void 0===t?r:t,r),o=new(h(this,p))(c(i-n)),u=new f(this),l=new f(o),d=0;n<i;)l.setUint8(d++,u.getUint8(n++));return o}}),r(39)("ArrayBuffer")},function(e,t,r){var n=r(0);n(n.G+n.W+n.F*!r(64).ABV,{DataView:r(95).DataView})},function(e,t,r){r(28)("Int8",1,function(e){return function Int8Array(t,r,n){return e(this,t,r,n)}})},function(e,t,r){r(28)("Uint8",1,function(e){return function Uint8Array(t,r,n){return e(this,t,r,n)}})},function(e,t,r){r(28)("Uint8",1,function(e){return function Uint8ClampedArray(t,r,n){return e(this,t,r,n)}},!0)},function(e,t,r){r(28)("Int16",2,function(e){return function Int16Array(t,r,n){return e(this,t,r,n)}})},function(e,t,r){r(28)("Uint16",2,function(e){return function Uint16Array(t,r,n){return e(this,t,r,n)}})},function(e,t,r){r(28)("Int32",4,function(e){return function Int32Array(t,r,n){return e(this,t,r,n)}})},function(e,t,r){r(28)("Uint32",4,function(e){return function Uint32Array(t,r,n){return e(this,t,r,n)}})},function(e,t,r){r(28)("Float32",4,function(e){return function Float32Array(t,r,n){return e(this,t,r,n)}})},function(e,t,r){r(28)("Float64",8,function(e){return function Float64Array(t,r,n){return e(this,t,r,n)}})},function(e,t,r){var n=r(0),i=r(10),o=r(1),a=(r(2).Reflect||{}).apply,s=Function.apply;n(n.S+n.F*!r(3)(function(){a(function(){})}),"Reflect",{apply:function apply(e,t,r){var n=i(e),c=o(r);return a?a(n,t,c):s.call(n,t,c)}})},function(e,t,r){var n=r(0),i=r(37),o=r(10),a=r(1),s=r(4),c=r(3),u=r(107),l=(r(2).Reflect||{}).construct,h=c(function(){function F(){}return!(l(function(){},[],F)instanceof F)}),p=!c(function(){l(function(){})});n(n.S+n.F*(h||p),"Reflect",{construct:function construct(e,t){o(e),a(t);var r=arguments.length<3?e:o(arguments[2]);if(p&&!h)return l(e,t,r);if(e==r){switch(t.length){case 0:return new e;case 1:return new e(t[0]);case 2:return new e(t[0],t[1]);case 3:return new e(t[0],t[1],t[2]);case 4:return new e(t[0],t[1],t[2],t[3])}var n=[null];return n.push.apply(n,t),new(u.apply(e,n))}var c=r.prototype,f=i(s(c)?c:Object.prototype),d=Function.apply.call(e,f,t);return s(d)?d:f}})},function(e,t,r){var n=r(7),i=r(0),o=r(1),a=r(23);i(i.S+i.F*r(3)(function(){Reflect.defineProperty(n.f({},1,{value:1}),1,{value:2})}),"Reflect",{defineProperty:function defineProperty(e,t,r){o(e),t=a(t,!0),o(r);try{return n.f(e,t,r),!0}catch(e){return!1}}})},function(e,t,r){var n=r(0),i=r(16).f,o=r(1);n(n.S,"Reflect",{deleteProperty:function deleteProperty(e,t){var r=i(o(e),t);return!(r&&!r.configurable)&&delete e[t]}})},function(e,t,r){"use strict";var n=r(0),i=r(1),o=function Enumerate(e){this._t=i(e),this._i=0;var t,r=this._k=[];for(t in e)r.push(t)};r(83)(o,"Object",function(){var e,t=this._k;do{if(this._i>=t.length)return{value:void 0,done:!0}}while(!((e=t[this._i++])in this._t));return{value:e,done:!1}}),n(n.S,"Reflect",{enumerate:function enumerate(e){return new o(e)}})},function(e,t,r){var n=r(16),i=r(17),o=r(14),a=r(0),s=r(4),c=r(1);a(a.S,"Reflect",{get:function get(e,t){var r,a,u=arguments.length<3?e:arguments[2];return c(e)===u?e[t]:(r=n.f(e,t))?o(r,"value")?r.value:void 0!==r.get?r.get.call(u):void 0:s(a=i(e))?get(a,t,u):void 0}})},function(e,t,r){var n=r(16),i=r(0),o=r(1);i(i.S,"Reflect",{getOwnPropertyDescriptor:function getOwnPropertyDescriptor(e,t){return n.f(o(e),t)}})},function(e,t,r){var n=r(0),i=r(17),o=r(1);n(n.S,"Reflect",{getPrototypeOf:function getPrototypeOf(e){return i(o(e))}})},function(e,t,r){var n=r(0);n(n.S,"Reflect",{has:function has(e,t){return t in e}})},function(e,t,r){var n=r(0),i=r(1),o=Object.isExtensible;n(n.S,"Reflect",{isExtensible:function isExtensible(e){return i(e),!o||o(e)}})},function(e,t,r){var n=r(0);n(n.S,"Reflect",{ownKeys:r(128)})},function(e,t,r){var n=r(0),i=r(1),o=Object.preventExtensions;n(n.S,"Reflect",{preventExtensions:function preventExtensions(e){i(e);try{return o&&o(e),!0}catch(e){return!1}}})},function(e,t,r){var n=r(7),i=r(16),o=r(17),a=r(14),s=r(0),c=r(33),u=r(1),l=r(4);s(s.S,"Reflect",{set:function set(e,t,r){var s,h,p=arguments.length<4?e:arguments[3],f=i.f(u(e),t);if(!f){if(l(h=o(e)))return set(h,t,r,p);f=c(0)}if(a(f,"value")){if(!1===f.writable||!l(p))return!1;if(s=i.f(p,t)){if(s.get||s.set||!1===s.writable)return!1;s.value=r,n.f(p,t,s)}else n.f(p,t,c(0,r));return!0}return void 0!==f.set&&(f.set.call(p,r),!0)}})},function(e,t,r){var n=r(0),i=r(75);i&&n(n.S,"Reflect",{setPrototypeOf:function setPrototypeOf(e,t){i.check(e,t);try{return i.set(e,t),!0}catch(e){return!1}}})},function(e,t,r){"use strict";var n=r(0),i=r(54)(!0);n(n.P,"Array",{includes:function includes(e){return i(this,e,arguments.length>1?arguments[1]:void 0)}}),r(32)("includes")},function(e,t,r){"use strict";var n=r(0),i=r(129),o=r(9),a=r(8),s=r(10),c=r(89);n(n.P,"Array",{flatMap:function flatMap(e){var t,r,n=o(this);return s(e),t=a(n.length),r=c(n,0),i(r,n,n,t,0,1,e,arguments[1]),r}}),r(32)("flatMap")},function(e,t,r){"use strict";var n=r(0),i=r(129),o=r(9),a=r(8),s=r(25),c=r(89);n(n.P,"Array",{flatten:function flatten(){var e=arguments[0],t=o(this),r=a(t.length),n=c(t,0);return i(n,t,t,r,0,void 0===e?1:s(e)),n}}),r(32)("flatten")},function(e,t,r){"use strict";var n=r(0),i=r(81)(!0);n(n.P,"String",{at:function at(e){return i(this,e)}})},function(e,t,r){"use strict";var n=r(0),i=r(130),o=r(62);n(n.P+n.F*/Version\/10\.\d+(\.\d+)? Safari\//.test(o),"String",{padStart:function padStart(e){return i(this,e,arguments.length>1?arguments[1]:void 0,!0)}})},function(e,t,r){"use strict";var n=r(0),i=r(130),o=r(62);n(n.P+n.F*/Version\/10\.\d+(\.\d+)? Safari\//.test(o),"String",{padEnd:function padEnd(e){return i(this,e,arguments.length>1?arguments[1]:void 0,!1)}})},function(e,t,r){"use strict";r(45)("trimLeft",function(e){return function trimLeft(){return e(this,1)}},"trimStart")},function(e,t,r){"use strict";r(45)("trimRight",function(e){return function trimRight(){return e(this,2)}},"trimEnd")},function(e,t,r){"use strict";var n=r(0),i=r(24),o=r(8),a=r(57),s=r(59),c=RegExp.prototype,u=function $RegExpStringIterator(e,t){this._r=e,this._s=t};r(83)(u,"RegExp String",function next(){var e=this._r.exec(this._s);return{value:e,done:null===e}}),n(n.P,"String",{matchAll:function matchAll(e){if(i(this),!a(e))throw TypeError(e+" is not a regexp!");var t=String(this),r="flags"in c?String(e.flags):s.call(e),n=new RegExp(e.source,~r.indexOf("g")?r:"g"+r);return n.lastIndex=o(e.lastIndex),new u(n,t)}})},function(e,t,r){r(71)("asyncIterator")},function(e,t,r){r(71)("observable")},function(e,t,r){var n=r(0),i=r(128),o=r(15),a=r(16),s=r(87);n(n.S,"Object",{getOwnPropertyDescriptors:function getOwnPropertyDescriptors(e){for(var t,r,n=o(e),c=a.f,u=i(n),l={},h=0;u.length>h;)void 0!==(r=c(n,t=u[h++]))&&s(l,t,r);return l}})},function(e,t,r){var n=r(0),i=r(131)(!1);n(n.S,"Object",{values:function values(e){return i(e)}})},function(e,t,r){var n=r(0),i=r(131)(!0);n(n.S,"Object",{entries:function entries(e){return i(e)}})},function(e,t,r){"use strict";var n=r(0),i=r(9),o=r(10),a=r(7);r(6)&&n(n.P+r(65),"Object",{__defineGetter__:function __defineGetter__(e,t){a.f(i(this),e,{get:o(t),enumerable:!0,configurable:!0})}})},function(e,t,r){"use strict";var n=r(0),i=r(9),o=r(10),a=r(7);r(6)&&n(n.P+r(65),"Object",{__defineSetter__:function __defineSetter__(e,t){a.f(i(this),e,{set:o(t),enumerable:!0,configurable:!0})}})},function(e,t,r){"use strict";var n=r(0),i=r(9),o=r(23),a=r(17),s=r(16).f;r(6)&&n(n.P+r(65),"Object",{__lookupGetter__:function __lookupGetter__(e){var t,r=i(this),n=o(e,!0);do{if(t=s(r,n))return t.get}while(r=a(r))}})},function(e,t,r){"use strict";var n=r(0),i=r(9),o=r(23),a=r(17),s=r(16).f;r(6)&&n(n.P+r(65),"Object",{__lookupSetter__:function __lookupSetter__(e){var t,r=i(this),n=o(e,!0);do{if(t=s(r,n))return t.set}while(r=a(r))}})},function(e,t,r){var n=r(0);n(n.P+n.R,"Map",{toJSON:r(132)("Map")})},function(e,t,r){var n=r(0);n(n.P+n.R,"Set",{toJSON:r(132)("Set")})},function(e,t,r){r(66)("Map")},function(e,t,r){r(66)("Set")},function(e,t,r){r(66)("WeakMap")},function(e,t,r){r(66)("WeakSet")},function(e,t,r){r(67)("Map")},function(e,t,r){r(67)("Set")},function(e,t,r){r(67)("WeakMap")},function(e,t,r){r(67)("WeakSet")},function(e,t,r){var n=r(0);n(n.G,{global:r(2)})},function(e,t,r){var n=r(0);n(n.S,"System",{global:r(2)})},function(e,t,r){var n=r(0),i=r(21);n(n.S,"Error",{isError:function isError(e){return"Error"===i(e)}})},function(e,t,r){var n=r(0);n(n.S,"Math",{clamp:function clamp(e,t,r){return Math.min(r,Math.max(t,e))}})},function(e,t,r){var n=r(0);n(n.S,"Math",{DEG_PER_RAD:Math.PI/180})},function(e,t,r){var n=r(0),i=180/Math.PI;n(n.S,"Math",{degrees:function degrees(e){return e*i}})},function(e,t,r){var n=r(0),i=r(134),o=r(114);n(n.S,"Math",{fscale:function fscale(e,t,r,n,a){return o(i(e,t,r,n,a))}})},function(e,t,r){var n=r(0);n(n.S,"Math",{iaddh:function iaddh(e,t,r,n){var i=e>>>0,o=r>>>0;return(t>>>0)+(n>>>0)+((i&o|(i|o)&~(i+o>>>0))>>>31)|0}})},function(e,t,r){var n=r(0);n(n.S,"Math",{isubh:function isubh(e,t,r,n){var i=e>>>0,o=r>>>0;return(t>>>0)-(n>>>0)-((~i&o|~(i^o)&i-o>>>0)>>>31)|0}})},function(e,t,r){var n=r(0);n(n.S,"Math",{imulh:function imulh(e,t){var r=+e,n=+t,i=65535&r,o=65535&n,a=r>>16,s=n>>16,c=(a*o>>>0)+(i*o>>>16);return a*s+(c>>16)+((i*s>>>0)+(65535&c)>>16)}})},function(e,t,r){var n=r(0);n(n.S,"Math",{RAD_PER_DEG:180/Math.PI})},function(e,t,r){var n=r(0),i=Math.PI/180;n(n.S,"Math",{radians:function radians(e){return e*i}})},function(e,t,r){var n=r(0);n(n.S,"Math",{scale:r(134)})},function(e,t,r){var n=r(0);n(n.S,"Math",{umulh:function umulh(e,t){var r=+e,n=+t,i=65535&r,o=65535&n,a=r>>>16,s=n>>>16,c=(a*o>>>0)+(i*o>>>16);return a*s+(c>>>16)+((i*s>>>0)+(65535&c)>>>16)}})},function(e,t,r){var n=r(0);n(n.S,"Math",{signbit:function signbit(e){return(e=+e)!=e?e:0==e?1/e==1/0:e>0}})},function(e,t,r){"use strict";var n=r(0),i=r(19),o=r(2),a=r(61),s=r(121);n(n.P+n.R,"Promise",{finally:function _finally(e){var t=a(this,i.Promise||o.Promise),r="function"==typeof e;return this.then(r?function(r){return s(t,e()).then(function(){return r})}:e,r?function(r){return s(t,e()).then(function(){throw r})}:e)}})},function(e,t,r){"use strict";var n=r(0),i=r(94),o=r(120);n(n.S,"Promise",{try:function _try(e){var t=i.f(this),r=o(e);return(r.e?t.reject:t.resolve)(r.v),t.promise}})},function(e,t,r){var n=r(29),i=r(1),o=n.key,a=n.set;n.exp({defineMetadata:function defineMetadata(e,t,r,n){a(e,t,i(r),o(n))}})},function(e,t,r){var n=r(29),i=r(1),o=n.key,a=n.map,s=n.store;n.exp({deleteMetadata:function deleteMetadata(e,t){var r=arguments.length<3?void 0:o(arguments[2]),n=a(i(t),r,!1);if(void 0===n||!n.delete(e))return!1;if(n.size)return!0;var c=s.get(t);return c.delete(r),!!c.size||s.delete(t)}})},function(e,t,r){var n=r(29),i=r(1),o=r(17),a=n.has,s=n.get,c=n.key;n.exp({getMetadata:function getMetadata(e,t){return function ordinaryGetMetadata(e,t,r){if(a(e,t,r))return s(e,t,r);var n=o(t);return null!==n?ordinaryGetMetadata(e,n,r):void 0}(e,i(t),arguments.length<3?void 0:c(arguments[2]))}})},function(e,t,r){var n=r(124),i=r(133),o=r(29),a=r(1),s=r(17),c=o.keys,u=o.key;o.exp({getMetadataKeys:function getMetadataKeys(e){return function ordinaryMetadataKeys(e,t){var r=c(e,t),o=s(e);if(null===o)return r;var a=ordinaryMetadataKeys(o,t);return a.length?r.length?i(new n(r.concat(a))):a:r}(a(e),arguments.length<2?void 0:u(arguments[1]))}})},function(e,t,r){var n=r(29),i=r(1),o=n.get,a=n.key;n.exp({getOwnMetadata:function getOwnMetadata(e,t){return o(e,i(t),arguments.length<3?void 0:a(arguments[2]))}})},function(e,t,r){var n=r(29),i=r(1),o=n.keys,a=n.key;n.exp({getOwnMetadataKeys:function getOwnMetadataKeys(e){return o(i(e),arguments.length<2?void 0:a(arguments[1]))}})},function(e,t,r){var n=r(29),i=r(1),o=r(17),a=n.has,s=n.key;n.exp({hasMetadata:function hasMetadata(e,t){return function ordinaryHasMetadata(e,t,r){if(a(e,t,r))return!0;var n=o(t);return null!==n&&ordinaryHasMetadata(e,n,r)}(e,i(t),arguments.length<3?void 0:s(arguments[2]))}})},function(e,t,r){var n=r(29),i=r(1),o=n.has,a=n.key;n.exp({hasOwnMetadata:function hasOwnMetadata(e,t){return o(e,i(t),arguments.length<3?void 0:a(arguments[2]))}})},function(e,t,r){var n=r(29),i=r(1),o=r(10),a=n.key,s=n.set;n.exp({metadata:function metadata(e,t){return function decorator(r,n){s(e,t,(void 0!==n?i:o)(r),a(n))}}})},function(e,t,r){var n=r(0),i=r(93)(),o=r(2).process,a="process"==r(21)(o);n(n.G,{asap:function asap(e){var t=a&&o.domain;i(t?t.bind(e):e)}})},function(e,t,r){"use strict";var n=r(0),i=r(2),o=r(19),a=r(93)(),s=r(5)("observable"),c=r(10),u=r(1),l=r(40),h=r(42),p=r(11),f=r(41),d=f.RETURN,m=function getMethod(e){return null==e?void 0:c(e)},g=function cleanupSubscription(e){var t=e._c;t&&(e._c=void 0,t())},y=function subscriptionClosed(e){return void 0===e._o},v=function closeSubscription(e){y(e)||(e._o=void 0,g(e))},_=function Subscription(e,t){u(e),this._c=void 0,this._o=e,e=new b(this);try{var r=t(e),n=r;null!=r&&("function"==typeof r.unsubscribe?r=function cleanup(){n.unsubscribe()}:c(r),this._c=r)}catch(t){return void e.error(t)}y(this)&&g(this)};_.prototype=h({},{unsubscribe:function unsubscribe(){v(this)}});var b=function SubscriptionObserver(e){this._s=e};b.prototype=h({},{next:function next(e){var t=this._s;if(!y(t)){var r=t._o;try{var n=m(r.next);if(n)return n.call(r,e)}catch(e){try{v(t)}finally{throw e}}}},error:function error(e){var t=this._s;if(y(t))throw e;var r=t._o;t._o=void 0;try{var n=m(r.error);if(!n)throw e;e=n.call(r,e)}catch(e){try{g(t)}finally{throw e}}return g(t),e},complete:function complete(e){var t=this._s;if(!y(t)){var r=t._o;t._o=void 0;try{var n=m(r.complete);e=n?n.call(r,e):void 0}catch(e){try{g(t)}finally{throw e}}return g(t),e}}});var w=function Observable(e){l(this,w,"Observable","_f")._f=c(e)};h(w.prototype,{subscribe:function subscribe(e){return new _(e,this._f)},forEach:function forEach(e){var t=this;return new(o.Promise||i.Promise)(function(r,n){c(e);var i=t.subscribe({next:function next(t){try{return e(t)}catch(e){n(e),i.unsubscribe()}},error:n,complete:r})})}}),h(w,{from:function from(e){var t="function"==typeof this?this:w,r=m(u(e)[s]);if(r){var n=u(r.call(e));return n.constructor===t?n:new t(function(e){return n.subscribe(e)})}return new t(function(t){var r=!1;return a(function(){if(!r){try{if(f(e,!1,function(e){if(t.next(e),r)return d})===d)return}catch(e){if(r)throw e;return void t.error(e)}t.complete()}}),function(){r=!0}})},of:function of(){for(var e=0,t=arguments.length,r=new Array(t);e<t;)r[e]=arguments[e++];return new("function"==typeof this?this:w)(function(e){var t=!1;return a(function(){if(!t){for(var n=0;n<r.length;++n)if(e.next(r[n]),t)return;e.complete()}}),function(){t=!0}})}}),p(w.prototype,s,function(){return this}),n(n.G,{Observable:w}),r(39)("Observable")},function(e,t,r){var n=r(2),i=r(0),o=r(62),a=[].slice,s=/MSIE .\./.test(o),c=function wrap(e){return function(t,r){var n=arguments.length>2,i=!!n&&a.call(arguments,2);return e(n?function(){("function"==typeof t?t:Function(t)).apply(this,i)}:t,r)}};i(i.G+i.B+i.F*s,{setTimeout:c(n.setTimeout),setInterval:c(n.setInterval)})},function(e,t,r){var n=r(0),i=r(92);n(n.G+n.B,{setImmediate:i.set,clearImmediate:i.clear})},function(e,t,r){for(var n=r(91),i=r(35),o=r(12),a=r(2),s=r(11),c=r(46),u=r(5),l=u("iterator"),h=u("toStringTag"),p=c.Array,f={CSSRuleList:!0,CSSStyleDeclaration:!1,CSSValueList:!1,ClientRectList:!1,DOMRectList:!1,DOMStringList:!1,DOMTokenList:!0,DataTransferItemList:!1,FileList:!1,HTMLAllCollection:!1,HTMLCollection:!1,HTMLFormElement:!1,HTMLSelectElement:!1,MediaList:!0,MimeTypeArray:!1,NamedNodeMap:!1,NodeList:!0,PaintRequestList:!1,Plugin:!1,PluginArray:!1,SVGLengthList:!1,SVGNumberList:!1,SVGPathSegList:!1,SVGPointList:!1,SVGStringList:!1,SVGTransformList:!1,SourceBufferList:!1,StyleSheetList:!0,TextTrackCueList:!1,TextTrackList:!1,TouchList:!1},d=i(f),m=0;m<d.length;m++){var g,y=d[m],v=f[y],_=a[y],b=_&&_.prototype;if(b&&(b[l]||s(b,l,p),b[h]||s(b,h,y),c[y]=p,v))for(g in n)b[g]||o(b,g,n[g],!0)}},function(e,t,r){(function(e,t){var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};!function(e){"use strict";var n,i=Object.prototype,o=i.hasOwnProperty,a="function"==typeof Symbol?Symbol:{},s=a.iterator||"@@iterator",c=a.asyncIterator||"@@asyncIterator",u=a.toStringTag||"@@toStringTag",l="object"===r(t),h=e.regeneratorRuntime;if(h)l&&(t.exports=h);else{(h=e.regeneratorRuntime=l?t.exports:{}).wrap=wrap;var p="suspendedStart",f="suspendedYield",d="executing",m="completed",g={},y={};y[s]=function(){return this};var v=Object.getPrototypeOf,_=v&&v(v(values([])));_&&_!==i&&o.call(_,s)&&(y=_);var b=GeneratorFunctionPrototype.prototype=Generator.prototype=Object.create(y);GeneratorFunction.prototype=b.constructor=GeneratorFunctionPrototype,GeneratorFunctionPrototype.constructor=GeneratorFunction,GeneratorFunctionPrototype[u]=GeneratorFunction.displayName="GeneratorFunction",h.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===GeneratorFunction||"GeneratorFunction"===(t.displayName||t.name))},h.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,GeneratorFunctionPrototype):(e.__proto__=GeneratorFunctionPrototype,u in e||(e[u]="GeneratorFunction")),e.prototype=Object.create(b),e},h.awrap=function(e){return{__await:e}},defineIteratorMethods(AsyncIterator.prototype),AsyncIterator.prototype[c]=function(){return this},h.AsyncIterator=AsyncIterator,h.async=function(e,t,r,n){var i=new AsyncIterator(wrap(e,t,r,n));return h.isGeneratorFunction(t)?i:i.next().then(function(e){return e.done?e.value:i.next()})},defineIteratorMethods(b),b[u]="Generator",b[s]=function(){return this},b.toString=function(){return"[object Generator]"},h.keys=function(e){var t=[];for(var r in e)t.push(r);return t.reverse(),function next(){for(;t.length;){var r=t.pop();if(r in e)return next.value=r,next.done=!1,next}return next.done=!0,next}},h.values=values,Context.prototype={constructor:Context,reset:function reset(e){if(this.prev=0,this.next=0,this.sent=this._sent=n,this.done=!1,this.delegate=null,this.method="next",this.arg=n,this.tryEntries.forEach(resetTryEntry),!e)for(var t in this)"t"===t.charAt(0)&&o.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=n)},stop:function stop(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function dispatchException(e){if(this.done)throw e;var t=this;function handle(r,i){return a.type="throw",a.arg=e,t.next=r,i&&(t.method="next",t.arg=n),!!i}for(var r=this.tryEntries.length-1;r>=0;--r){var i=this.tryEntries[r],a=i.completion;if("root"===i.tryLoc)return handle("end");if(i.tryLoc<=this.prev){var s=o.call(i,"catchLoc"),c=o.call(i,"finallyLoc");if(s&&c){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0);if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}else if(s){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}}}},abrupt:function abrupt(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var n=this.tryEntries[r];if(n.tryLoc<=this.prev&&o.call(n,"finallyLoc")&&this.prev<n.finallyLoc){var i=n;break}}i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=e,a.arg=t,i?(this.method="next",this.next=i.finallyLoc,g):this.complete(a)},complete:function complete(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),g},finish:function finish(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),resetTryEntry(r),g}},catch:function _catch(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var i=n.arg;resetTryEntry(r)}return i}}throw new Error("illegal catch attempt")},delegateYield:function delegateYield(e,t,r){return this.delegate={iterator:values(e),resultName:t,nextLoc:r},"next"===this.method&&(this.arg=n),g}}}function wrap(e,t,r,n){var i=t&&t.prototype instanceof Generator?t:Generator,o=Object.create(i.prototype),a=new Context(n||[]);return o._invoke=function makeInvokeMethod(e,t,r){var n=p;return function invoke(i,o){if(n===d)throw new Error("Generator is already running");if(n===m){if("throw"===i)throw o;return doneResult()}for(r.method=i,r.arg=o;;){var a=r.delegate;if(a){var s=maybeInvokeDelegate(a,r);if(s){if(s===g)continue;return s}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if(n===p)throw n=m,r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n=d;var c=tryCatch(e,t,r);if("normal"===c.type){if(n=r.done?m:f,c.arg===g)continue;return{value:c.arg,done:r.done}}"throw"===c.type&&(n=m,r.method="throw",r.arg=c.arg)}}}(e,r,a),o}function tryCatch(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}function Generator(){}function GeneratorFunction(){}function GeneratorFunctionPrototype(){}function defineIteratorMethods(e){["next","throw","return"].forEach(function(t){e[t]=function(e){return this._invoke(t,e)}})}function AsyncIterator(t){function invoke(e,n,i,a){var s=tryCatch(t[e],t,n);if("throw"!==s.type){var c=s.arg,u=c.value;return u&&"object"===(void 0===u?"undefined":r(u))&&o.call(u,"__await")?Promise.resolve(u.__await).then(function(e){invoke("next",e,i,a)},function(e){invoke("throw",e,i,a)}):Promise.resolve(u).then(function(e){c.value=e,i(c)},a)}a(s.arg)}var n;"object"===r(e.process)&&e.process.domain&&(invoke=e.process.domain.bind(invoke)),this._invoke=function enqueue(e,t){function callInvokeWithMethodAndArg(){return new Promise(function(r,n){invoke(e,t,r,n)})}return n=n?n.then(callInvokeWithMethodAndArg,callInvokeWithMethodAndArg):callInvokeWithMethodAndArg()}}function maybeInvokeDelegate(e,t){var r=e.iterator[t.method];if(r===n){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=n,maybeInvokeDelegate(e,t),"throw"===t.method))return g;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return g}var i=tryCatch(r,e.iterator,t.arg);if("throw"===i.type)return t.method="throw",t.arg=i.arg,t.delegate=null,g;var o=i.arg;return o?o.done?(t[e.resultName]=o.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=n),t.delegate=null,g):o:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,g)}function pushTryEntry(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function resetTryEntry(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function Context(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(pushTryEntry,this),this.reset(!0)}function values(e){if(e){var t=e[s];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var r=-1,i=function next(){for(;++r<e.length;)if(o.call(e,r))return next.value=e[r],next.done=!1,next;return next.value=n,next.done=!0,next};return i.next=i}}return{next:doneResult}}function doneResult(){return{value:n,done:!0}}}("object"===(void 0===e?"undefined":r(e))?e:"object"===("undefined"==typeof window?"undefined":r(window))?window:"object"===("undefined"==typeof self?"undefined":r(self))?self:this)}).call(t,r(69),r(343)(e))},function(e,t){e.exports=function(e){return e.webpackPolyfill||(e.deprecate=function(){},e.paths=[],e.children||(e.children=[]),Object.defineProperty(e,"loaded",{enumerable:!0,get:function get(){return e.l}}),Object.defineProperty(e,"id",{enumerable:!0,get:function get(){return e.i}}),e.webpackPolyfill=1),e}},function(e,t,r){r(345),e.exports=r(19).RegExp.escape},function(e,t,r){var n=r(0),i=r(346)(/[\\^$*+?.()|[\]{}]/g,"\\$&");n(n.S,"RegExp",{escape:function escape(e){return i(e)}})},function(e,t){e.exports=function(e,t){var r=t===Object(t)?function(e){return t[e]}:t;return function(t){return String(t).replace(e,r)}}},function(e,t,r){"use strict";var n=r(348),i=r(96),o=r(43),a=r(141),s=r(377),c=r(378),u=r(380),l=r(381),h=r(382),p=r(389),f=r(390),d=function(){return function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function sliceIterator(e,t){var r=[],n=!0,i=!1,o=void 0;try{for(var a,s=e[Symbol.iterator]();!(n=(a=s.next()).done)&&(r.push(a.value),!t||r.length!==t);n=!0);}catch(e){i=!0,o=e}finally{try{!n&&s.return&&s.return()}finally{if(i)throw o}}return r}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),m=function(){function defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(e,t,r){return t&&defineProperties(e.prototype,t),r&&defineProperties(e,r),e}}();var g=function(e){function AdsumWebMapProxy(e){!function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,AdsumWebMapProxy);var t=function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(AdsumWebMapProxy.__proto__||Object.getPrototypeOf(AdsumWebMapProxy)).call(this));return t._bridge=new c.a({adsumWebMapProxy:t},e),t.adsumWebMap=null,t.objectManagerProxy=new h.a(t),t.sceneManagerProxy=new p.a(t,t._bridge),t.cameraManagerProxy=new u.a(t),t.mouseManagerProxy=new l.a(t,t._bridge),t.wayfindingManagerProxy=new f.a(t,t._bridge),t}return function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(AdsumWebMapProxy,n["a"]),m(AdsumWebMapProxy,[{key:"init",value:function init(e){var t=this;this.dispatchEvent({type:a.a.init.will,options:e});var r=null;try{var n=new s.a(e),c=null!==n.cachePublicUrl;r=new i.d(n.client),c&&(r.options.cacheManager=new i.c(n.cachePublicUrl,n.cachePublicUrl),r.loadFromCache(!0));var u=n.map.loader||{};u.entityManager=r,n.map.loader=new o.b(u),this.adsumWebMap=new o.c(n.map)}catch(e){return this.dispatchEvent({type:a.a.init.error,error:e}),Promise.reject(e)}return this.adsumWebMap.init().then(function(){return Promise.all([t.objectManagerProxy.init(t.adsumWebMap.objectManager),t.wayfindingManagerProxy.init(t.adsumWebMap.wayfindingManager),t.mouseManagerProxy.init(t.adsumWebMap.mouseManager),t.sceneManagerProxy.init(t.adsumWebMap.sceneManager),t.cameraManagerProxy.init(t.adsumWebMap.cameraManager)])}).then(function(e){var r=d(e,2),n=r[0],i=r[1];return t.dispatchEvent({type:a.a.init.did}),{objectManagerData:n,locationRepositoryData:i}}).catch(function(e){return t.dispatchEvent({type:a.a.init.error,error:e}),Promise.reject(e)})}},{key:"start",value:function start(){try{this.dispatchEvent({type:a.a.start.will}),this.adsumWebMap.start(),this.dispatchEvent({type:a.a.start.did})}catch(e){throw this.dispatchEvent({type:a.a.start.error,error:e}),e}}},{key:"getDeviceId",value:function getDeviceId(){return this.adsumWebMap.getDeviceId()}},{key:"setDeviceId",value:function setDeviceId(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return this.adsumWebMap.setDeviceId(e,t).then(function(){})}}]),AdsumWebMapProxy}();t.a=g},function(e,t,r){"use strict";r.d(t,"a",function(){return i});var n=function(){function defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(e,t,r){return t&&defineProperties(e.prototype,t),r&&defineProperties(e,r),e}}();var i=function(){function EventDispatcher(){!function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,EventDispatcher),this._listeners=new Map}return n(EventDispatcher,[{key:"addEventListener",value:function addEventListener(e,t){var r=this._listeners;r.has(e)||r.set(e,new Set),r.get(e).has(t)||r.get(e).add(t)}},{key:"hasEventListener",value:function hasEventListener(e,t){var r=this._listeners;return r.has(e)&&r.get(e).has(t)}},{key:"removeEventListener",value:function removeEventListener(e,t){var r=this._listeners;this.hasEventListener(e,t)&&r.get(e).delete(t)}},{key:"dispatchEvent",value:function dispatchEvent(e){var t=this,r=this._listeners;r.has(e.type)&&(e.target=this,r.get(e.type).forEach(function(r){r.call(t,e)}))}}]),EventDispatcher}()},function(e,t,r){"use strict";r.d(t,"a",function(){return a}),r.d(t,"b",function(){return s}),r.d(t,"c",function(){return c});var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},i=function(){function defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(e,t,r){return t&&defineProperties(e.prototype,t),r&&defineProperties(e,r),e}}();function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var o={ERROR:"error",WARN:"warn",INFO:"info",VERBOSE:"verbose",DEBUG:"debug",SILLY:"silly"},a=function(){function AbstractLogger(){_classCallCheck(this,AbstractLogger)}return i(AbstractLogger,[{key:"log",value:function log(e,t,r){throw new Error("This is an interface")}},{key:"error",value:function error(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this.log(o.ERROR,e,t)}},{key:"warn",value:function warn(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this.log(o.WARN,e,t)}},{key:"info",value:function info(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this.log(o.INFO,e,t)}},{key:"verbose",value:function verbose(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this.log(o.VERBOSE,e,t)}},{key:"debug",value:function debug(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this.log(o.DEBUG,e,t)}},{key:"silly",value:function silly(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this.log(o.SILLY,e,t)}}],[{key:"isValidLogger",value:function isValidLogger(e){var t={isValid:!0,reasons:[]};return"object"!=(void 0===e?"undefined":n(e))||null===e?(t.isValid=!1,t.reasons.push("Logger must be a not null object"),t):(Object.keys(o).forEach(function(r){var n=o[r];"function"!=typeof e[n]&&(t.isValid=!1,t.reasons.push("Logger must implement method "+n))}),t)}},{key:"_getLevelValue",value:function _getLevelValue(e){switch(e){case o.ERROR:return 0;case o.WARN:return 1;case o.INFO:return 2;case o.VERBOSE:return 3;case o.DEBUG:return 4;case o.SILLY:return 5;default:return 2}}}]),AbstractLogger}(),s=(function(e){function NullLogger(){return _classCallCheck(this,NullLogger),_possibleConstructorReturn(this,(NullLogger.__proto__||Object.getPrototypeOf(NullLogger)).apply(this,arguments))}_inherits(NullLogger,a),i(NullLogger,[{key:"log",value:function log(e,t){arguments.length>2&&void 0!==arguments[2]&&arguments[2]}}])}(),function(e){function ChildLogger(e,t){var r;return _classCallCheck(this,ChildLogger),(r=_possibleConstructorReturn(this,(ChildLogger.__proto__||Object.getPrototypeOf(ChildLogger)).call(this))).logger=e,r.tag=t,r}return _inherits(ChildLogger,a),i(ChildLogger,[{key:"log",value:function log(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;this.logger.log(e,"["+this.tag+"]"+t,r)}}]),ChildLogger}()),c=function(e){function ConsoleLogger(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:o.WARN,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return _classCallCheck(this,ConsoleLogger),(e=_possibleConstructorReturn(this,(ConsoleLogger.__proto__||Object.getPrototypeOf(ConsoleLogger)).call(this))).level=t,e.tag=r,e}return _inherits(ConsoleLogger,a),i(ConsoleLogger,[{key:"log",value:function log(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(!(this.constructor._getLevelValue(this.level)<this.constructor._getLevelValue(e))){var n;n=null!==this.tag?"["+e+"]["+this.tag+"]: "+t:"["+e+"]: "+t,r?console.log(n,r):console.log(n)}}}]),ConsoleLogger}()},function(e,t,r){"use strict";var n=Object.prototype.hasOwnProperty,i="~";function Events(){}function addListener(e,t,r,n,o){if("function"!=typeof r)throw new TypeError("The listener must be a function");var a=new function EE(e,t,r){this.fn=e,this.context=t,this.once=r||!1}(r,n||e,o),s=i?i+t:t;return e._events[s]?e._events[s].fn?e._events[s]=[e._events[s],a]:e._events[s].push(a):(e._events[s]=a,e._eventsCount++),e}function clearEvent(e,t){0==--e._eventsCount?e._events=new Events:delete e._events[t]}function EventEmitter(){this._events=new Events,this._eventsCount=0}Object.create&&(Events.prototype=Object.create(null),(new Events).__proto__||(i=!1)),EventEmitter.prototype.eventNames=function eventNames(){var e,t,r=[];if(0===this._eventsCount)return r;for(t in e=this._events)n.call(e,t)&&r.push(i?t.slice(1):t);return Object.getOwnPropertySymbols?r.concat(Object.getOwnPropertySymbols(e)):r},EventEmitter.prototype.listeners=function listeners(e){var t=i?i+e:e,r=this._events[t];if(!r)return[];if(r.fn)return[r.fn];for(var n=0,o=r.length,a=new Array(o);n<o;n++)a[n]=r[n].fn;return a},EventEmitter.prototype.listenerCount=function listenerCount(e){var t=i?i+e:e,r=this._events[t];return r?r.fn?1:r.length:0},EventEmitter.prototype.emit=function emit(e,t,r,n,o,a){var s=i?i+e:e;if(!this._events[s])return!1;var c,u,l=this._events[s],h=arguments.length;if(l.fn){switch(l.once&&this.removeListener(e,l.fn,void 0,!0),h){case 1:return l.fn.call(l.context),!0;case 2:return l.fn.call(l.context,t),!0;case 3:return l.fn.call(l.context,t,r),!0;case 4:return l.fn.call(l.context,t,r,n),!0;case 5:return l.fn.call(l.context,t,r,n,o),!0;case 6:return l.fn.call(l.context,t,r,n,o,a),!0}for(u=1,c=new Array(h-1);u<h;u++)c[u-1]=arguments[u];l.fn.apply(l.context,c)}else{var p,f=l.length;for(u=0;u<f;u++)switch(l[u].once&&this.removeListener(e,l[u].fn,void 0,!0),h){case 1:l[u].fn.call(l[u].context);break;case 2:l[u].fn.call(l[u].context,t);break;case 3:l[u].fn.call(l[u].context,t,r);break;case 4:l[u].fn.call(l[u].context,t,r,n);break;default:if(!c)for(p=1,c=new Array(h-1);p<h;p++)c[p-1]=arguments[p];l[u].fn.apply(l[u].context,c)}}return!0},EventEmitter.prototype.on=function on(e,t,r){return addListener(this,e,t,r,!1)},EventEmitter.prototype.once=function once(e,t,r){return addListener(this,e,t,r,!0)},EventEmitter.prototype.removeListener=function removeListener(e,t,r,n){var o=i?i+e:e;if(!this._events[o])return this;if(!t)return clearEvent(this,o),this;var a=this._events[o];if(a.fn)a.fn!==t||n&&!a.once||r&&a.context!==r||clearEvent(this,o);else{for(var s=0,c=[],u=a.length;s<u;s++)(a[s].fn!==t||n&&!a[s].once||r&&a[s].context!==r)&&c.push(a[s]);c.length?this._events[o]=1===c.length?c[0]:c:clearEvent(this,o)}return this},EventEmitter.prototype.removeAllListeners=function removeAllListeners(e){var t;return e?(t=i?i+e:e,this._events[t]&&clearEvent(this,t)):(this._events=new Events,this._eventsCount=0),this},EventEmitter.prototype.off=EventEmitter.prototype.removeListener,EventEmitter.prototype.addListener=EventEmitter.prototype.on,EventEmitter.prefixed=i,EventEmitter.EventEmitter=EventEmitter,e.exports=EventEmitter},function(e,t,r){e.exports=r(352)},function(e,t,r){"use strict";var n=r(18),i=r(135),o=r(354),a=r(97);function createInstance(e){var t=new o(e),r=i(o.prototype.request,t);return n.extend(r,o.prototype,t),n.extend(r,t),r}var s=createInstance(a);s.Axios=o,s.create=function create(e){return createInstance(n.merge(a,e))},s.Cancel=r(140),s.CancelToken=r(368),s.isCancel=r(139),s.all=function all(e){return Promise.all(e)},s.spread=r(369),e.exports=s,e.exports.default=s},function(e,t){function isBuffer(e){return!!e.constructor&&"function"==typeof e.constructor.isBuffer&&e.constructor.isBuffer(e)}
/*!
 * Determine if an object is a Buffer
 *
 * @author   Feross Aboukhadijeh <https://feross.org>
 * @license  MIT
 */
e.exports=function(e){return null!=e&&(isBuffer(e)||function isSlowBuffer(e){return"function"==typeof e.readFloatLE&&"function"==typeof e.slice&&isBuffer(e.slice(0,0))}(e)||!!e._isBuffer)}},function(e,t,r){"use strict";var n=r(97),i=r(18),o=r(363),a=r(364);function Axios(e){this.defaults=e,this.interceptors={request:new o,response:new o}}Axios.prototype.request=function request(e){"string"==typeof e&&(e=i.merge({url:arguments[0]},arguments[1])),(e=i.merge(n,{method:"get"},this.defaults,e)).method=e.method.toLowerCase();var t=[a,void 0],r=Promise.resolve(e);for(this.interceptors.request.forEach(function unshiftRequestInterceptors(e){t.unshift(e.fulfilled,e.rejected)}),this.interceptors.response.forEach(function pushResponseInterceptors(e){t.push(e.fulfilled,e.rejected)});t.length;)r=r.then(t.shift(),t.shift());return r},i.forEach(["delete","get","head","options"],function forEachMethodNoData(e){Axios.prototype[e]=function(t,r){return this.request(i.merge(r||{},{method:e,url:t}))}}),i.forEach(["post","put","patch"],function forEachMethodWithData(e){Axios.prototype[e]=function(t,r,n){return this.request(i.merge(n||{},{method:e,url:t,data:r}))}}),e.exports=Axios},function(e,t,r){"use strict";var n=r(18);e.exports=function normalizeHeaderName(e,t){n.forEach(e,function processHeader(r,n){n!==t&&n.toUpperCase()===t.toUpperCase()&&(e[t]=r,delete e[n])})}},function(e,t,r){"use strict";var n=r(138);e.exports=function settle(e,t,r){var i=r.config.validateStatus;r.status&&i&&!i(r.status)?t(n("Request failed with status code "+r.status,r.config,null,r.request,r)):e(r)}},function(e,t,r){"use strict";e.exports=function enhanceError(e,t,r,n,i){return e.config=t,r&&(e.code=r),e.request=n,e.response=i,e}},function(e,t,r){"use strict";var n=r(18);function encode(e){return encodeURIComponent(e).replace(/%40/gi,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}e.exports=function buildURL(e,t,r){if(!t)return e;var i;if(r)i=r(t);else if(n.isURLSearchParams(t))i=t.toString();else{var o=[];n.forEach(t,function serialize(e,t){null!==e&&void 0!==e&&(n.isArray(e)?t+="[]":e=[e],n.forEach(e,function parseValue(e){n.isDate(e)?e=e.toISOString():n.isObject(e)&&(e=JSON.stringify(e)),o.push(encode(t)+"="+encode(e))}))}),i=o.join("&")}return i&&(e+=(-1===e.indexOf("?")?"?":"&")+i),e}},function(e,t,r){"use strict";var n=r(18),i=["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"];e.exports=function parseHeaders(e){var t,r,o,a={};return e?(n.forEach(e.split("\n"),function parser(e){if(o=e.indexOf(":"),t=n.trim(e.substr(0,o)).toLowerCase(),r=n.trim(e.substr(o+1)),t){if(a[t]&&i.indexOf(t)>=0)return;a[t]="set-cookie"===t?(a[t]?a[t]:[]).concat([r]):a[t]?a[t]+", "+r:r}}),a):a}},function(e,t,r){"use strict";var n=r(18);e.exports=n.isStandardBrowserEnv()?function standardBrowserEnv(){var e,t=/(msie|trident)/i.test(navigator.userAgent),r=document.createElement("a");function resolveURL(e){var n=e;return t&&(r.setAttribute("href",n),n=r.href),r.setAttribute("href",n),{href:r.href,protocol:r.protocol?r.protocol.replace(/:$/,""):"",host:r.host,search:r.search?r.search.replace(/^\?/,""):"",hash:r.hash?r.hash.replace(/^#/,""):"",hostname:r.hostname,port:r.port,pathname:"/"===r.pathname.charAt(0)?r.pathname:"/"+r.pathname}}return e=resolveURL(window.location.href),function isURLSameOrigin(t){var r=n.isString(t)?resolveURL(t):t;return r.protocol===e.protocol&&r.host===e.host}}():function isURLSameOrigin(){return!0}},function(e,t,r){"use strict";var n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";function E(){this.message="String contains an invalid character"}E.prototype=new Error,E.prototype.code=5,E.prototype.name="InvalidCharacterError",e.exports=function btoa(e){for(var t,r,i=String(e),o="",a=0,s=n;i.charAt(0|a)||(s="=",a%1);o+=s.charAt(63&t>>8-a%1*8)){if((r=i.charCodeAt(a+=.75))>255)throw new E;t=t<<8|r}return o}},function(e,t,r){"use strict";var n=r(18);e.exports=n.isStandardBrowserEnv()?function standardBrowserEnv(){return{write:function write(e,t,r,i,o,a){var s=[];s.push(e+"="+encodeURIComponent(t)),n.isNumber(r)&&s.push("expires="+new Date(r).toGMTString()),n.isString(i)&&s.push("path="+i),n.isString(o)&&s.push("domain="+o),!0===a&&s.push("secure"),document.cookie=s.join("; ")},read:function read(e){var t=document.cookie.match(new RegExp("(^|;\\s*)("+e+")=([^;]*)"));return t?decodeURIComponent(t[3]):null},remove:function remove(e){this.write(e,"",Date.now()-864e5)}}}():{write:function write(){},read:function read(){return null},remove:function remove(){}}},function(e,t,r){"use strict";var n=r(18);function InterceptorManager(){this.handlers=[]}InterceptorManager.prototype.use=function use(e,t){return this.handlers.push({fulfilled:e,rejected:t}),this.handlers.length-1},InterceptorManager.prototype.eject=function eject(e){this.handlers[e]&&(this.handlers[e]=null)},InterceptorManager.prototype.forEach=function forEach(e){n.forEach(this.handlers,function forEachHandler(t){null!==t&&e(t)})},e.exports=InterceptorManager},function(e,t,r){"use strict";var n=r(18),i=r(365),o=r(139),a=r(97),s=r(366),c=r(367);function throwIfCancellationRequested(e){e.cancelToken&&e.cancelToken.throwIfRequested()}e.exports=function dispatchRequest(e){return throwIfCancellationRequested(e),e.baseURL&&!s(e.url)&&(e.url=c(e.baseURL,e.url)),e.headers=e.headers||{},e.data=i(e.data,e.headers,e.transformRequest),e.headers=n.merge(e.headers.common||{},e.headers[e.method]||{},e.headers||{}),n.forEach(["delete","get","head","post","put","patch","common"],function cleanHeaderConfig(t){delete e.headers[t]}),(e.adapter||a.adapter)(e).then(function onAdapterResolution(t){return throwIfCancellationRequested(e),t.data=i(t.data,t.headers,e.transformResponse),t},function onAdapterRejection(t){return o(t)||(throwIfCancellationRequested(e),t&&t.response&&(t.response.data=i(t.response.data,t.response.headers,e.transformResponse))),Promise.reject(t)})}},function(e,t,r){"use strict";var n=r(18);e.exports=function transformData(e,t,r){return n.forEach(r,function transform(r){e=r(e,t)}),e}},function(e,t,r){"use strict";e.exports=function isAbsoluteURL(e){return/^([a-z][a-z\d\+\-\.]*:)?\/\//i.test(e)}},function(e,t,r){"use strict";e.exports=function combineURLs(e,t){return t?e.replace(/\/+$/,"")+"/"+t.replace(/^\/+/,""):e}},function(e,t,r){"use strict";var n=r(140);function CancelToken(e){if("function"!=typeof e)throw new TypeError("executor must be a function.");var t;this.promise=new Promise(function promiseExecutor(e){t=e});var r=this;e(function cancel(e){r.reason||(r.reason=new n(e),t(r.reason))})}CancelToken.prototype.throwIfRequested=function throwIfRequested(){if(this.reason)throw this.reason},CancelToken.source=function source(){var e;return{token:new CancelToken(function executor(t){e=t}),cancel:e}},e.exports=CancelToken},function(e,t,r){"use strict";e.exports=function spread(e){return function wrap(t){return e.apply(null,t)}}},function(e,t,r){var n,i,o,a,s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};a=function(e){return function(t){var r=e,n=r.lib,i=n.WordArray,o=n.Hasher,a=r.algo,s=[];!function(){for(var e=0;e<64;e++)s[e]=4294967296*t.abs(t.sin(e+1))|0}();var c=a.MD5=o.extend({_doReset:function _doReset(){this._hash=new i.init([1732584193,4023233417,2562383102,271733878])},_doProcessBlock:function _doProcessBlock(e,t){for(var r=0;r<16;r++){var n=t+r,i=e[n];e[n]=16711935&(i<<8|i>>>24)|4278255360&(i<<24|i>>>8)}var o=this._hash.words,a=e[t+0],c=e[t+1],u=e[t+2],l=e[t+3],h=e[t+4],p=e[t+5],f=e[t+6],d=e[t+7],m=e[t+8],g=e[t+9],y=e[t+10],v=e[t+11],_=e[t+12],b=e[t+13],w=e[t+14],x=e[t+15],M=o[0],S=o[1],C=o[2],P=o[3];S=II(S=II(S=II(S=II(S=HH(S=HH(S=HH(S=HH(S=GG(S=GG(S=GG(S=GG(S=FF(S=FF(S=FF(S=FF(S,C=FF(C,P=FF(P,M=FF(M,S,C,P,a,7,s[0]),S,C,c,12,s[1]),M,S,u,17,s[2]),P,M,l,22,s[3]),C=FF(C,P=FF(P,M=FF(M,S,C,P,h,7,s[4]),S,C,p,12,s[5]),M,S,f,17,s[6]),P,M,d,22,s[7]),C=FF(C,P=FF(P,M=FF(M,S,C,P,m,7,s[8]),S,C,g,12,s[9]),M,S,y,17,s[10]),P,M,v,22,s[11]),C=FF(C,P=FF(P,M=FF(M,S,C,P,_,7,s[12]),S,C,b,12,s[13]),M,S,w,17,s[14]),P,M,x,22,s[15]),C=GG(C,P=GG(P,M=GG(M,S,C,P,c,5,s[16]),S,C,f,9,s[17]),M,S,v,14,s[18]),P,M,a,20,s[19]),C=GG(C,P=GG(P,M=GG(M,S,C,P,p,5,s[20]),S,C,y,9,s[21]),M,S,x,14,s[22]),P,M,h,20,s[23]),C=GG(C,P=GG(P,M=GG(M,S,C,P,g,5,s[24]),S,C,w,9,s[25]),M,S,l,14,s[26]),P,M,m,20,s[27]),C=GG(C,P=GG(P,M=GG(M,S,C,P,b,5,s[28]),S,C,u,9,s[29]),M,S,d,14,s[30]),P,M,_,20,s[31]),C=HH(C,P=HH(P,M=HH(M,S,C,P,p,4,s[32]),S,C,m,11,s[33]),M,S,v,16,s[34]),P,M,w,23,s[35]),C=HH(C,P=HH(P,M=HH(M,S,C,P,c,4,s[36]),S,C,h,11,s[37]),M,S,d,16,s[38]),P,M,y,23,s[39]),C=HH(C,P=HH(P,M=HH(M,S,C,P,b,4,s[40]),S,C,a,11,s[41]),M,S,l,16,s[42]),P,M,f,23,s[43]),C=HH(C,P=HH(P,M=HH(M,S,C,P,g,4,s[44]),S,C,_,11,s[45]),M,S,x,16,s[46]),P,M,u,23,s[47]),C=II(C,P=II(P,M=II(M,S,C,P,a,6,s[48]),S,C,d,10,s[49]),M,S,w,15,s[50]),P,M,p,21,s[51]),C=II(C,P=II(P,M=II(M,S,C,P,_,6,s[52]),S,C,l,10,s[53]),M,S,y,15,s[54]),P,M,c,21,s[55]),C=II(C,P=II(P,M=II(M,S,C,P,m,6,s[56]),S,C,x,10,s[57]),M,S,f,15,s[58]),P,M,b,21,s[59]),C=II(C,P=II(P,M=II(M,S,C,P,h,6,s[60]),S,C,v,10,s[61]),M,S,u,15,s[62]),P,M,g,21,s[63]),o[0]=o[0]+M|0,o[1]=o[1]+S|0,o[2]=o[2]+C|0,o[3]=o[3]+P|0},_doFinalize:function _doFinalize(){var e=this._data,r=e.words,n=8*this._nDataBytes,i=8*e.sigBytes;r[i>>>5]|=128<<24-i%32;var o=t.floor(n/4294967296),a=n;r[15+(i+64>>>9<<4)]=16711935&(o<<8|o>>>24)|4278255360&(o<<24|o>>>8),r[14+(i+64>>>9<<4)]=16711935&(a<<8|a>>>24)|4278255360&(a<<24|a>>>8),e.sigBytes=4*(r.length+1),this._process();for(var s=this._hash,c=s.words,u=0;u<4;u++){var l=c[u];c[u]=16711935&(l<<8|l>>>24)|4278255360&(l<<24|l>>>8)}return s},clone:function clone(){var clone=o.clone.call(this);return clone._hash=this._hash.clone(),clone}});function FF(e,t,r,n,i,o,a){var s=e+(t&r|~t&n)+i+a;return(s<<o|s>>>32-o)+t}function GG(e,t,r,n,i,o,a){var s=e+(t&n|r&~n)+i+a;return(s<<o|s>>>32-o)+t}function HH(e,t,r,n,i,o,a){var s=e+(t^r^n)+i+a;return(s<<o|s>>>32-o)+t}function II(e,t,r,n,i,o,a){var s=e+(r^(t|~n))+i+a;return(s<<o|s>>>32-o)+t}r.MD5=o._createHelper(c),r.HmacMD5=o._createHmacHelper(c)}(Math),e.MD5},"object"===s(t)?e.exports=t=a(r(48)):(i=[r(48)],void 0===(o="function"==typeof(n=a)?n.apply(t,i):n)||(e.exports=o))},function(e,t,r){var n,i,o,a,s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};a=function(e){return function(){if("function"==typeof ArrayBuffer){var t=e.lib.WordArray,r=t.init;(t.init=function(e){if(e instanceof ArrayBuffer&&(e=new Uint8Array(e)),(e instanceof Int8Array||"undefined"!=typeof Uint8ClampedArray&&e instanceof Uint8ClampedArray||e instanceof Int16Array||e instanceof Uint16Array||e instanceof Int32Array||e instanceof Uint32Array||e instanceof Float32Array||e instanceof Float64Array)&&(e=new Uint8Array(e.buffer,e.byteOffset,e.byteLength)),e instanceof Uint8Array){for(var t=e.byteLength,n=[],i=0;i<t;i++)n[i>>>2]|=e[i]<<24-i%4*8;r.call(this,n,t)}else r.apply(this,arguments)}).prototype=t}}(),e.lib.WordArray},"object"===s(t)?e.exports=t=a(r(48)):(i=[r(48)],void 0===(o="function"==typeof(n=a)?n.apply(t,i):n)||(e.exports=o))},function(e,t,r){var n,i,o,a,s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};a=function(e){var t,r,n,i,o,a;return r=(t=e).lib,n=r.WordArray,i=r.Hasher,o=[],a=t.algo.SHA1=i.extend({_doReset:function _doReset(){this._hash=new n.init([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function _doProcessBlock(e,t){for(var r=this._hash.words,n=r[0],i=r[1],a=r[2],s=r[3],c=r[4],u=0;u<80;u++){if(u<16)o[u]=0|e[t+u];else{var l=o[u-3]^o[u-8]^o[u-14]^o[u-16];o[u]=l<<1|l>>>31}var h=(n<<5|n>>>27)+c+o[u];h+=u<20?1518500249+(i&a|~i&s):u<40?1859775393+(i^a^s):u<60?(i&a|i&s|a&s)-1894007588:(i^a^s)-899497514,c=s,s=a,a=i<<30|i>>>2,i=n,n=h}r[0]=r[0]+n|0,r[1]=r[1]+i|0,r[2]=r[2]+a|0,r[3]=r[3]+s|0,r[4]=r[4]+c|0},_doFinalize:function _doFinalize(){var e=this._data,t=e.words,r=8*this._nDataBytes,n=8*e.sigBytes;return t[n>>>5]|=128<<24-n%32,t[14+(n+64>>>9<<4)]=Math.floor(r/4294967296),t[15+(n+64>>>9<<4)]=r,e.sigBytes=4*t.length,this._process(),this._hash},clone:function clone(){var clone=i.clone.call(this);return clone._hash=this._hash.clone(),clone}}),t.SHA1=i._createHelper(a),t.HmacSHA1=i._createHmacHelper(a),e.SHA1},"object"===s(t)?e.exports=t=a(r(48)):(i=[r(48)],void 0===(o="function"==typeof(n=a)?n.apply(t,i):n)||(e.exports=o))},function(e,t,r){"use strict";r.d(t,"Z",function(){return WebGLRenderer}),r.d(t,"k",function(){return FogExp2}),r.d(t,"O",function(){return Scene}),r.d(t,"P",function(){return SkinnedMesh}),r.d(t,"w",function(){return Mesh}),r.d(t,"q",function(){return Line}),r.d(t,"n",function(){return Group}),r.d(t,"c",function(){return CanvasTexture}),r.d(t,"T",function(){return Texture}),r.d(t,"U",function(){return TextureLoader}),r.d(t,"p",function(){return ImageLoader}),r.d(t,"s",function(){return Loader}),r.d(t,"S",function(){return SpotLight}),r.d(t,"I",function(){return PointLight}),r.d(t,"o",function(){return HemisphereLight}),r.d(t,"g",function(){return DirectionalLight}),r.d(t,"a",function(){return AmbientLight}),r.d(t,"F",function(){return PerspectiveCamera}),r.d(t,"m",function(){return Geometry}),r.d(t,"j",function(){return Face3}),r.d(t,"D",function(){return Object3D}),r.d(t,"L",function(){return Raycaster}),r.d(t,"i",function(){return EventDispatcher}),r.d(t,"u",function(){return At}),r.d(t,"R",function(){return Spherical}),r.d(t,"G",function(){return Plane}),r.d(t,"Q",function(){return Sphere}),r.d(t,"K",function(){return Ray}),r.d(t,"v",function(){return Matrix4}),r.d(t,"b",function(){return Box3}),r.d(t,"r",function(){return Line3}),r.d(t,"X",function(){return Vector4}),r.d(t,"W",function(){return Vector3}),r.d(t,"V",function(){return Vector2}),r.d(t,"J",function(){return Quaternion}),r.d(t,"f",function(){return Color}),r.d(t,"N",function(){return RingGeometry}),r.d(t,"H",function(){return PlaneGeometry}),r.d(t,"d",function(){return CircleGeometry}),r.d(t,"z",function(){return MeshPhongMaterial}),r.d(t,"y",function(){return MeshLambertMaterial}),r.d(t,"x",function(){return MeshBasicMaterial}),r.d(t,"t",function(){return d}),r.d(t,"E",function(){return b}),r.d(t,"l",function(){return w}),r.d(t,"h",function(){return M}),r.d(t,"Y",function(){return P}),r.d(t,"B",function(){return ie}),r.d(t,"M",function(){return ve}),r.d(t,"e",function(){return _e}),r.d(t,"A",function(){return be}),r.d(t,"C",function(){return MultiMaterial});var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};function EventDispatcher(){}void 0===Number.EPSILON&&(Number.EPSILON=Math.pow(2,-52)),void 0===Number.isInteger&&(Number.isInteger=function(e){return"number"==typeof e&&isFinite(e)&&Math.floor(e)===e}),void 0===Math.sign&&(Math.sign=function(e){return e<0?-1:e>0?1:+e}),"name"in Function.prototype==!1&&Object.defineProperty(Function.prototype,"name",{get:function get(){return this.toString().match(/^\s*function\s*([^\(\s]*)/)[1]}}),void 0===Object.assign&&(Object.assign=function(e){if(void 0===e||null===e)throw new TypeError("Cannot convert undefined or null to object");for(var t=Object(e),r=1;r<arguments.length;r++){var n=arguments[r];if(void 0!==n&&null!==n)for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(t[i]=n[i])}return t}),Object.assign(EventDispatcher.prototype,{addEventListener:function addEventListener(e,t){void 0===this._listeners&&(this._listeners={});var r=this._listeners;void 0===r[e]&&(r[e]=[]),-1===r[e].indexOf(t)&&r[e].push(t)},hasEventListener:function hasEventListener(e,t){if(void 0===this._listeners)return!1;var r=this._listeners;return void 0!==r[e]&&-1!==r[e].indexOf(t)},removeEventListener:function removeEventListener(e,t){if(void 0!==this._listeners){var r=this._listeners[e];if(void 0!==r){var n=r.indexOf(t);-1!==n&&r.splice(n,1)}}},dispatchEvent:function dispatchEvent(e){if(void 0!==this._listeners){var t=this._listeners[e.type];if(void 0!==t){e.target=this;for(var r=t.slice(0),n=0,i=r.length;n<i;n++)r[n].call(this,e)}}}});var i,o,a,s,c,u,l,h,p,f="91",d={LEFT:0,MIDDLE:1,RIGHT:2},m=0,g=1,y=2,_=1,b=2,w=0,x=1,M=2,S=0,C=1,P=2,E=0,T=1,O=2,A=3,L=4,k=5,R=100,I=101,N=102,F=103,j=104,B=200,V=201,D=202,U=203,G=204,z=205,H=206,W=207,q=208,X=209,Y=210,J=0,Z=1,K=2,Q=3,$=4,ee=5,te=6,re=7,ne=0,ie=1,oe=2,ae=0,se=1,ce=2,ue=3,le=4,he=301,pe=302,fe=303,de=304,me=305,ge=306,ye=307,ve=1e3,_e=1001,be=1002,we=1003,xe=1004,Me=1005,Se=1006,Ce=1007,Pe=1008,Ee=1009,Te=1010,Oe=1011,Ae=1012,Le=1013,ke=1014,Re=1015,Ie=1016,Ne=1017,Fe=1018,je=1019,Be=1020,Ve=1021,De=1022,Ue=1023,Ge=1024,ze=1025,He=1026,We=1027,qe=33776,Xe=33777,Ye=33778,Je=33779,Ze=35840,Ke=35841,Qe=35842,$e=35843,et=36196,tt=37808,rt=37809,nt=37810,it=37811,ot=37812,st=37813,ct=37814,ut=37815,lt=37816,ht=37817,pt=37818,ft=37819,dt=37820,mt=37821,gt=2201,yt=2400,vt=0,_t=1,bt=2,wt=3e3,xt=3001,Mt=3007,St=3002,Ct=3004,Pt=3005,Et=3006,Tt=3200,Ot=3201,At={DEG2RAD:Math.PI/180,RAD2DEG:180/Math.PI,generateUUID:function(){for(var e=[],t=0;t<256;t++)e[t]=(t<16?"0":"")+t.toString(16).toUpperCase();return function generateUUID(){var t=4294967295*Math.random()|0,r=4294967295*Math.random()|0,n=4294967295*Math.random()|0,i=4294967295*Math.random()|0;return e[255&t]+e[t>>8&255]+e[t>>16&255]+e[t>>24&255]+"-"+e[255&r]+e[r>>8&255]+"-"+e[r>>16&15|64]+e[r>>24&255]+"-"+e[63&n|128]+e[n>>8&255]+"-"+e[n>>16&255]+e[n>>24&255]+e[255&i]+e[i>>8&255]+e[i>>16&255]+e[i>>24&255]}}(),clamp:function clamp(e,t,r){return Math.max(t,Math.min(r,e))},euclideanModulo:function euclideanModulo(e,t){return(e%t+t)%t},mapLinear:function mapLinear(e,t,r,n,i){return n+(e-t)*(i-n)/(r-t)},lerp:function lerp(e,t,r){return(1-r)*e+r*t},smoothstep:function smoothstep(e,t,r){return e<=t?0:e>=r?1:(e=(e-t)/(r-t))*e*(3-2*e)},smootherstep:function smootherstep(e,t,r){return e<=t?0:e>=r?1:(e=(e-t)/(r-t))*e*e*(e*(6*e-15)+10)},randInt:function randInt(e,t){return e+Math.floor(Math.random()*(t-e+1))},randFloat:function randFloat(e,t){return e+Math.random()*(t-e)},randFloatSpread:function randFloatSpread(e){return e*(.5-Math.random())},degToRad:function degToRad(e){return e*At.DEG2RAD},radToDeg:function radToDeg(e){return e*At.RAD2DEG},isPowerOfTwo:function isPowerOfTwo(e){return 0==(e&e-1)&&0!==e},ceilPowerOfTwo:function ceilPowerOfTwo(e){return Math.pow(2,Math.ceil(Math.log(e)/Math.LN2))},floorPowerOfTwo:function floorPowerOfTwo(e){return Math.pow(2,Math.floor(Math.log(e)/Math.LN2))}};function Vector2(e,t){this.x=e||0,this.y=t||0}function Matrix4(){this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix4: the constructor no longer reads arguments. use .set() instead.")}function Quaternion(e,t,r,n){this._x=e||0,this._y=t||0,this._z=r||0,this._w=void 0!==n?n:1}function Vector3(e,t,r){this.x=e||0,this.y=t||0,this.z=r||0}function Matrix3(){this.elements=[1,0,0,0,1,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix3: the constructor no longer reads arguments. use .set() instead.")}Object.defineProperties(Vector2.prototype,{width:{get:function get(){return this.x},set:function set(e){this.x=e}},height:{get:function get(){return this.y},set:function set(e){this.y=e}}}),Object.assign(Vector2.prototype,{isVector2:!0,set:function set(e,t){return this.x=e,this.y=t,this},setScalar:function setScalar(e){return this.x=e,this.y=e,this},setX:function setX(e){return this.x=e,this},setY:function setY(e){return this.y=e,this},setComponent:function setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}return this},getComponent:function getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}},clone:function clone(){return new this.constructor(this.x,this.y)},copy:function copy(e){return this.x=e.x,this.y=e.y,this},add:function add(e,t){return void 0!==t?(console.warn("THREE.Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this)},addScalar:function addScalar(e){return this.x+=e,this.y+=e,this},addVectors:function addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this},addScaledVector:function addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this},sub:function sub(e,t){return void 0!==t?(console.warn("THREE.Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this)},subScalar:function subScalar(e){return this.x-=e,this.y-=e,this},subVectors:function subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this},multiply:function multiply(e){return this.x*=e.x,this.y*=e.y,this},multiplyScalar:function multiplyScalar(e){return this.x*=e,this.y*=e,this},divide:function divide(e){return this.x/=e.x,this.y/=e.y,this},divideScalar:function divideScalar(e){return this.multiplyScalar(1/e)},applyMatrix3:function applyMatrix3(e){var t=this.x,r=this.y,n=e.elements;return this.x=n[0]*t+n[3]*r+n[6],this.y=n[1]*t+n[4]*r+n[7],this},min:function min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this},max:function max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this},clamp:function clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this},clampScalar:(i=new Vector2,o=new Vector2,function clampScalar(e,t){return i.set(e,e),o.set(t,t),this.clamp(i,o)}),clampLength:function clampLength(e,t){var r=this.length();return this.divideScalar(r||1).multiplyScalar(Math.max(e,Math.min(t,r)))},floor:function floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this},ceil:function ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this},round:function round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},roundToZero:function roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this},negate:function negate(){return this.x=-this.x,this.y=-this.y,this},dot:function dot(e){return this.x*e.x+this.y*e.y},lengthSq:function lengthSq(){return this.x*this.x+this.y*this.y},length:function length(){return Math.sqrt(this.x*this.x+this.y*this.y)},manhattanLength:function manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)},normalize:function normalize(){return this.divideScalar(this.length()||1)},angle:function angle(){var angle=Math.atan2(this.y,this.x);return angle<0&&(angle+=2*Math.PI),angle},distanceTo:function distanceTo(e){return Math.sqrt(this.distanceToSquared(e))},distanceToSquared:function distanceToSquared(e){var t=this.x-e.x,r=this.y-e.y;return t*t+r*r},manhattanDistanceTo:function manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)},setLength:function setLength(e){return this.normalize().multiplyScalar(e)},lerp:function lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this},lerpVectors:function lerpVectors(e,t,r){return this.subVectors(t,e).multiplyScalar(r).add(e)},equals:function equals(e){return e.x===this.x&&e.y===this.y},fromArray:function fromArray(e,t){return void 0===t&&(t=0),this.x=e[t],this.y=e[t+1],this},toArray:function toArray(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this.x,e[t+1]=this.y,e},fromBufferAttribute:function fromBufferAttribute(e,t,r){return void 0!==r&&console.warn("THREE.Vector2: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this},rotateAround:function rotateAround(e,t){var r=Math.cos(t),n=Math.sin(t),i=this.x-e.x,o=this.y-e.y;return this.x=i*r-o*n+e.x,this.y=i*n+o*r+e.y,this}}),Object.assign(Matrix4.prototype,{isMatrix4:!0,set:function set(e,t,r,n,i,o,a,s,c,u,l,h,p,f,d,m){var g=this.elements;return g[0]=e,g[4]=t,g[8]=r,g[12]=n,g[1]=i,g[5]=o,g[9]=a,g[13]=s,g[2]=c,g[6]=u,g[10]=l,g[14]=h,g[3]=p,g[7]=f,g[11]=d,g[15]=m,this},identity:function identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this},clone:function clone(){return(new Matrix4).fromArray(this.elements)},copy:function copy(e){var t=this.elements,r=e.elements;return t[0]=r[0],t[1]=r[1],t[2]=r[2],t[3]=r[3],t[4]=r[4],t[5]=r[5],t[6]=r[6],t[7]=r[7],t[8]=r[8],t[9]=r[9],t[10]=r[10],t[11]=r[11],t[12]=r[12],t[13]=r[13],t[14]=r[14],t[15]=r[15],this},copyPosition:function copyPosition(e){var t=this.elements,r=e.elements;return t[12]=r[12],t[13]=r[13],t[14]=r[14],this},extractBasis:function extractBasis(e,t,r){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),r.setFromMatrixColumn(this,2),this},makeBasis:function makeBasis(e,t,r){return this.set(e.x,t.x,r.x,0,e.y,t.y,r.y,0,e.z,t.z,r.z,0,0,0,0,1),this},extractRotation:(h=new Vector3,function extractRotation(e){var t=this.elements,r=e.elements,n=1/h.setFromMatrixColumn(e,0).length(),i=1/h.setFromMatrixColumn(e,1).length(),o=1/h.setFromMatrixColumn(e,2).length();return t[0]=r[0]*n,t[1]=r[1]*n,t[2]=r[2]*n,t[4]=r[4]*i,t[5]=r[5]*i,t[6]=r[6]*i,t[8]=r[8]*o,t[9]=r[9]*o,t[10]=r[10]*o,this}),makeRotationFromEuler:function makeRotationFromEuler(e){e&&e.isEuler||console.error("THREE.Matrix4: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.");var t=this.elements,r=e.x,n=e.y,i=e.z,o=Math.cos(r),a=Math.sin(r),s=Math.cos(n),c=Math.sin(n),u=Math.cos(i),l=Math.sin(i);if("XYZ"===e.order){var h=o*u,p=o*l,f=a*u,d=a*l;t[0]=s*u,t[4]=-s*l,t[8]=c,t[1]=p+f*c,t[5]=h-d*c,t[9]=-a*s,t[2]=d-h*c,t[6]=f+p*c,t[10]=o*s}else if("YXZ"===e.order){var m=s*u,g=s*l,y=c*u,v=c*l;t[0]=m+v*a,t[4]=y*a-g,t[8]=o*c,t[1]=o*l,t[5]=o*u,t[9]=-a,t[2]=g*a-y,t[6]=v+m*a,t[10]=o*s}else if("ZXY"===e.order){m=s*u,g=s*l,y=c*u,v=c*l;t[0]=m-v*a,t[4]=-o*l,t[8]=y+g*a,t[1]=g+y*a,t[5]=o*u,t[9]=v-m*a,t[2]=-o*c,t[6]=a,t[10]=o*s}else if("ZYX"===e.order){h=o*u,p=o*l,f=a*u,d=a*l;t[0]=s*u,t[4]=f*c-p,t[8]=h*c+d,t[1]=s*l,t[5]=d*c+h,t[9]=p*c-f,t[2]=-c,t[6]=a*s,t[10]=o*s}else if("YZX"===e.order){var _=o*s,b=o*c,w=a*s,x=a*c;t[0]=s*u,t[4]=x-_*l,t[8]=w*l+b,t[1]=l,t[5]=o*u,t[9]=-a*u,t[2]=-c*u,t[6]=b*l+w,t[10]=_-x*l}else if("XZY"===e.order){_=o*s,b=o*c,w=a*s,x=a*c;t[0]=s*u,t[4]=-l,t[8]=c*u,t[1]=_*l+x,t[5]=o*u,t[9]=b*l-w,t[2]=w*l-b,t[6]=a*u,t[10]=x*l+_}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this},makeRotationFromQuaternion:function makeRotationFromQuaternion(e){var t=this.elements,r=e._x,n=e._y,i=e._z,o=e._w,a=r+r,s=n+n,c=i+i,u=r*a,l=r*s,h=r*c,p=n*s,f=n*c,d=i*c,m=o*a,g=o*s,y=o*c;return t[0]=1-(p+d),t[4]=l-y,t[8]=h+g,t[1]=l+y,t[5]=1-(u+d),t[9]=f-m,t[2]=h-g,t[6]=f+m,t[10]=1-(u+p),t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this},lookAt:(c=new Vector3,u=new Vector3,l=new Vector3,function lookAt(e,t,r){var n=this.elements;return l.subVectors(e,t),0===l.lengthSq()&&(l.z=1),l.normalize(),c.crossVectors(r,l),0===c.lengthSq()&&(1===Math.abs(r.z)?l.x+=1e-4:l.z+=1e-4,l.normalize(),c.crossVectors(r,l)),c.normalize(),u.crossVectors(l,c),n[0]=c.x,n[4]=u.x,n[8]=l.x,n[1]=c.y,n[5]=u.y,n[9]=l.y,n[2]=c.z,n[6]=u.z,n[10]=l.z,this}),multiply:function multiply(e,t){return void 0!==t?(console.warn("THREE.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(e,t)):this.multiplyMatrices(this,e)},premultiply:function premultiply(e){return this.multiplyMatrices(e,this)},multiplyMatrices:function multiplyMatrices(e,t){var r=e.elements,n=t.elements,i=this.elements,o=r[0],a=r[4],s=r[8],c=r[12],u=r[1],l=r[5],h=r[9],p=r[13],f=r[2],d=r[6],m=r[10],g=r[14],y=r[3],v=r[7],_=r[11],b=r[15],w=n[0],x=n[4],M=n[8],S=n[12],C=n[1],P=n[5],E=n[9],T=n[13],O=n[2],A=n[6],L=n[10],k=n[14],R=n[3],I=n[7],N=n[11],F=n[15];return i[0]=o*w+a*C+s*O+c*R,i[4]=o*x+a*P+s*A+c*I,i[8]=o*M+a*E+s*L+c*N,i[12]=o*S+a*T+s*k+c*F,i[1]=u*w+l*C+h*O+p*R,i[5]=u*x+l*P+h*A+p*I,i[9]=u*M+l*E+h*L+p*N,i[13]=u*S+l*T+h*k+p*F,i[2]=f*w+d*C+m*O+g*R,i[6]=f*x+d*P+m*A+g*I,i[10]=f*M+d*E+m*L+g*N,i[14]=f*S+d*T+m*k+g*F,i[3]=y*w+v*C+_*O+b*R,i[7]=y*x+v*P+_*A+b*I,i[11]=y*M+v*E+_*L+b*N,i[15]=y*S+v*T+_*k+b*F,this},multiplyScalar:function multiplyScalar(e){var t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this},applyToBufferAttribute:function(){var e=new Vector3;return function applyToBufferAttribute(t){for(var r=0,n=t.count;r<n;r++)e.x=t.getX(r),e.y=t.getY(r),e.z=t.getZ(r),e.applyMatrix4(this),t.setXYZ(r,e.x,e.y,e.z);return t}}(),determinant:function determinant(){var e=this.elements,t=e[0],r=e[4],n=e[8],i=e[12],o=e[1],a=e[5],s=e[9],c=e[13],u=e[2],l=e[6],h=e[10],p=e[14];return e[3]*(+i*s*l-n*c*l-i*a*h+r*c*h+n*a*p-r*s*p)+e[7]*(+t*s*p-t*c*h+i*o*h-n*o*p+n*c*u-i*s*u)+e[11]*(+t*c*l-t*a*p-i*o*l+r*o*p+i*a*u-r*c*u)+e[15]*(-n*a*u-t*s*l+t*a*h+n*o*l-r*o*h+r*s*u)},transpose:function transpose(){var e,t=this.elements;return e=t[1],t[1]=t[4],t[4]=e,e=t[2],t[2]=t[8],t[8]=e,e=t[6],t[6]=t[9],t[9]=e,e=t[3],t[3]=t[12],t[12]=e,e=t[7],t[7]=t[13],t[13]=e,e=t[11],t[11]=t[14],t[14]=e,this},setPosition:function setPosition(e){var t=this.elements;return t[12]=e.x,t[13]=e.y,t[14]=e.z,this},getInverse:function getInverse(e,t){var r=this.elements,n=e.elements,i=n[0],o=n[1],a=n[2],s=n[3],c=n[4],u=n[5],l=n[6],h=n[7],p=n[8],f=n[9],d=n[10],m=n[11],g=n[12],y=n[13],v=n[14],_=n[15],b=f*v*h-y*d*h+y*l*m-u*v*m-f*l*_+u*d*_,w=g*d*h-p*v*h-g*l*m+c*v*m+p*l*_-c*d*_,x=p*y*h-g*f*h+g*u*m-c*y*m-p*u*_+c*f*_,M=g*f*l-p*y*l-g*u*d+c*y*d+p*u*v-c*f*v,S=i*b+o*w+a*x+s*M;if(0===S){var C="THREE.Matrix4: .getInverse() can't invert matrix, determinant is 0";if(!0===t)throw new Error(C);return console.warn(C),this.identity()}var P=1/S;return r[0]=b*P,r[1]=(y*d*s-f*v*s-y*a*m+o*v*m+f*a*_-o*d*_)*P,r[2]=(u*v*s-y*l*s+y*a*h-o*v*h-u*a*_+o*l*_)*P,r[3]=(f*l*s-u*d*s-f*a*h+o*d*h+u*a*m-o*l*m)*P,r[4]=w*P,r[5]=(p*v*s-g*d*s+g*a*m-i*v*m-p*a*_+i*d*_)*P,r[6]=(g*l*s-c*v*s-g*a*h+i*v*h+c*a*_-i*l*_)*P,r[7]=(c*d*s-p*l*s+p*a*h-i*d*h-c*a*m+i*l*m)*P,r[8]=x*P,r[9]=(g*f*s-p*y*s-g*o*m+i*y*m+p*o*_-i*f*_)*P,r[10]=(c*y*s-g*u*s+g*o*h-i*y*h-c*o*_+i*u*_)*P,r[11]=(p*u*s-c*f*s-p*o*h+i*f*h+c*o*m-i*u*m)*P,r[12]=M*P,r[13]=(p*y*a-g*f*a+g*o*d-i*y*d-p*o*v+i*f*v)*P,r[14]=(g*u*a-c*y*a-g*o*l+i*y*l+c*o*v-i*u*v)*P,r[15]=(c*f*a-p*u*a+p*o*l-i*f*l-c*o*d+i*u*d)*P,this},scale:function scale(e){var t=this.elements,r=e.x,n=e.y,i=e.z;return t[0]*=r,t[4]*=n,t[8]*=i,t[1]*=r,t[5]*=n,t[9]*=i,t[2]*=r,t[6]*=n,t[10]*=i,t[3]*=r,t[7]*=n,t[11]*=i,this},getMaxScaleOnAxis:function getMaxScaleOnAxis(){var e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],r=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],n=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,r,n))},makeTranslation:function makeTranslation(e,t,r){return this.set(1,0,0,e,0,1,0,t,0,0,1,r,0,0,0,1),this},makeRotationX:function makeRotationX(e){var t=Math.cos(e),r=Math.sin(e);return this.set(1,0,0,0,0,t,-r,0,0,r,t,0,0,0,0,1),this},makeRotationY:function makeRotationY(e){var t=Math.cos(e),r=Math.sin(e);return this.set(t,0,r,0,0,1,0,0,-r,0,t,0,0,0,0,1),this},makeRotationZ:function makeRotationZ(e){var t=Math.cos(e),r=Math.sin(e);return this.set(t,-r,0,0,r,t,0,0,0,0,1,0,0,0,0,1),this},makeRotationAxis:function makeRotationAxis(e,t){var r=Math.cos(t),n=Math.sin(t),i=1-r,o=e.x,a=e.y,s=e.z,c=i*o,u=i*a;return this.set(c*o+r,c*a-n*s,c*s+n*a,0,c*a+n*s,u*a+r,u*s-n*o,0,c*s-n*a,u*s+n*o,i*s*s+r,0,0,0,0,1),this},makeScale:function makeScale(e,t,r){return this.set(e,0,0,0,0,t,0,0,0,0,r,0,0,0,0,1),this},makeShear:function makeShear(e,t,r){return this.set(1,t,r,0,e,1,r,0,e,t,1,0,0,0,0,1),this},compose:function compose(e,t,r){return this.makeRotationFromQuaternion(t),this.scale(r),this.setPosition(e),this},decompose:(a=new Vector3,s=new Matrix4,function decompose(e,t,r){var n=this.elements,i=a.set(n[0],n[1],n[2]).length(),o=a.set(n[4],n[5],n[6]).length(),c=a.set(n[8],n[9],n[10]).length();this.determinant()<0&&(i=-i),e.x=n[12],e.y=n[13],e.z=n[14],s.copy(this);var u=1/i,l=1/o,h=1/c;return s.elements[0]*=u,s.elements[1]*=u,s.elements[2]*=u,s.elements[4]*=l,s.elements[5]*=l,s.elements[6]*=l,s.elements[8]*=h,s.elements[9]*=h,s.elements[10]*=h,t.setFromRotationMatrix(s),r.x=i,r.y=o,r.z=c,this}),makePerspective:function makePerspective(e,t,r,n,i,o){void 0===o&&console.warn("THREE.Matrix4: .makePerspective() has been redefined and has a new signature. Please check the docs.");var a=this.elements,s=2*i/(t-e),c=2*i/(r-n),u=(t+e)/(t-e),l=(r+n)/(r-n),h=-(o+i)/(o-i),p=-2*o*i/(o-i);return a[0]=s,a[4]=0,a[8]=u,a[12]=0,a[1]=0,a[5]=c,a[9]=l,a[13]=0,a[2]=0,a[6]=0,a[10]=h,a[14]=p,a[3]=0,a[7]=0,a[11]=-1,a[15]=0,this},makeOrthographic:function makeOrthographic(e,t,r,n,i,o){var a=this.elements,s=1/(t-e),c=1/(r-n),u=1/(o-i),l=(t+e)*s,h=(r+n)*c,p=(o+i)*u;return a[0]=2*s,a[4]=0,a[8]=0,a[12]=-l,a[1]=0,a[5]=2*c,a[9]=0,a[13]=-h,a[2]=0,a[6]=0,a[10]=-2*u,a[14]=-p,a[3]=0,a[7]=0,a[11]=0,a[15]=1,this},equals:function equals(e){for(var t=this.elements,r=e.elements,n=0;n<16;n++)if(t[n]!==r[n])return!1;return!0},fromArray:function fromArray(e,t){void 0===t&&(t=0);for(var r=0;r<16;r++)this.elements[r]=e[r+t];return this},toArray:function toArray(e,t){void 0===e&&(e=[]),void 0===t&&(t=0);var r=this.elements;return e[t]=r[0],e[t+1]=r[1],e[t+2]=r[2],e[t+3]=r[3],e[t+4]=r[4],e[t+5]=r[5],e[t+6]=r[6],e[t+7]=r[7],e[t+8]=r[8],e[t+9]=r[9],e[t+10]=r[10],e[t+11]=r[11],e[t+12]=r[12],e[t+13]=r[13],e[t+14]=r[14],e[t+15]=r[15],e}}),Object.assign(Quaternion,{slerp:function slerp(e,t,r,n){return r.copy(e).slerp(t,n)},slerpFlat:function slerpFlat(e,t,r,n,i,o,a){var s=r[n+0],c=r[n+1],u=r[n+2],l=r[n+3],h=i[o+0],p=i[o+1],f=i[o+2],d=i[o+3];if(l!==d||s!==h||c!==p||u!==f){var m=1-a,g=s*h+c*p+u*f+l*d,y=g>=0?1:-1,v=1-g*g;if(v>Number.EPSILON){var _=Math.sqrt(v),b=Math.atan2(_,g*y);m=Math.sin(m*b)/_,a=Math.sin(a*b)/_}var w=a*y;if(s=s*m+h*w,c=c*m+p*w,u=u*m+f*w,l=l*m+d*w,m===1-a){var x=1/Math.sqrt(s*s+c*c+u*u+l*l);s*=x,c*=x,u*=x,l*=x}}e[t]=s,e[t+1]=c,e[t+2]=u,e[t+3]=l}}),Object.defineProperties(Quaternion.prototype,{x:{get:function get(){return this._x},set:function set(e){this._x=e,this.onChangeCallback()}},y:{get:function get(){return this._y},set:function set(e){this._y=e,this.onChangeCallback()}},z:{get:function get(){return this._z},set:function set(e){this._z=e,this.onChangeCallback()}},w:{get:function get(){return this._w},set:function set(e){this._w=e,this.onChangeCallback()}}}),Object.assign(Quaternion.prototype,{set:function set(e,t,r,n){return this._x=e,this._y=t,this._z=r,this._w=n,this.onChangeCallback(),this},clone:function clone(){return new this.constructor(this._x,this._y,this._z,this._w)},copy:function copy(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this.onChangeCallback(),this},setFromEuler:function setFromEuler(e,t){if(!e||!e.isEuler)throw new Error("THREE.Quaternion: .setFromEuler() now expects an Euler rotation rather than a Vector3 and order.");var r=e._x,n=e._y,i=e._z,o=e.order,a=Math.cos,s=Math.sin,c=a(r/2),u=a(n/2),l=a(i/2),h=s(r/2),p=s(n/2),f=s(i/2);return"XYZ"===o?(this._x=h*u*l+c*p*f,this._y=c*p*l-h*u*f,this._z=c*u*f+h*p*l,this._w=c*u*l-h*p*f):"YXZ"===o?(this._x=h*u*l+c*p*f,this._y=c*p*l-h*u*f,this._z=c*u*f-h*p*l,this._w=c*u*l+h*p*f):"ZXY"===o?(this._x=h*u*l-c*p*f,this._y=c*p*l+h*u*f,this._z=c*u*f+h*p*l,this._w=c*u*l-h*p*f):"ZYX"===o?(this._x=h*u*l-c*p*f,this._y=c*p*l+h*u*f,this._z=c*u*f-h*p*l,this._w=c*u*l+h*p*f):"YZX"===o?(this._x=h*u*l+c*p*f,this._y=c*p*l+h*u*f,this._z=c*u*f-h*p*l,this._w=c*u*l-h*p*f):"XZY"===o&&(this._x=h*u*l-c*p*f,this._y=c*p*l-h*u*f,this._z=c*u*f+h*p*l,this._w=c*u*l+h*p*f),!1!==t&&this.onChangeCallback(),this},setFromAxisAngle:function setFromAxisAngle(e,t){var r=t/2,n=Math.sin(r);return this._x=e.x*n,this._y=e.y*n,this._z=e.z*n,this._w=Math.cos(r),this.onChangeCallback(),this},setFromRotationMatrix:function setFromRotationMatrix(e){var t,r=e.elements,n=r[0],i=r[4],o=r[8],a=r[1],s=r[5],c=r[9],u=r[2],l=r[6],h=r[10],p=n+s+h;return p>0?(t=.5/Math.sqrt(p+1),this._w=.25/t,this._x=(l-c)*t,this._y=(o-u)*t,this._z=(a-i)*t):n>s&&n>h?(t=2*Math.sqrt(1+n-s-h),this._w=(l-c)/t,this._x=.25*t,this._y=(i+a)/t,this._z=(o+u)/t):s>h?(t=2*Math.sqrt(1+s-n-h),this._w=(o-u)/t,this._x=(i+a)/t,this._y=.25*t,this._z=(c+l)/t):(t=2*Math.sqrt(1+h-n-s),this._w=(a-i)/t,this._x=(o+u)/t,this._y=(c+l)/t,this._z=.25*t),this.onChangeCallback(),this},setFromUnitVectors:function(){var e,t=new Vector3;return function setFromUnitVectors(r,n){return void 0===t&&(t=new Vector3),(e=r.dot(n)+1)<1e-6?(e=0,Math.abs(r.x)>Math.abs(r.z)?t.set(-r.y,r.x,0):t.set(0,-r.z,r.y)):t.crossVectors(r,n),this._x=t.x,this._y=t.y,this._z=t.z,this._w=e,this.normalize()}}(),inverse:function inverse(){return this.conjugate()},conjugate:function conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this.onChangeCallback(),this},dot:function dot(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w},lengthSq:function lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w},length:function length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)},normalize:function normalize(){var e=this.length();return 0===e?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this.onChangeCallback(),this},multiply:function multiply(e,t){return void 0!==t?(console.warn("THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(e,t)):this.multiplyQuaternions(this,e)},premultiply:function premultiply(e){return this.multiplyQuaternions(e,this)},multiplyQuaternions:function multiplyQuaternions(e,t){var r=e._x,n=e._y,i=e._z,o=e._w,a=t._x,s=t._y,c=t._z,u=t._w;return this._x=r*u+o*a+n*c-i*s,this._y=n*u+o*s+i*a-r*c,this._z=i*u+o*c+r*s-n*a,this._w=o*u-r*a-n*s-i*c,this.onChangeCallback(),this},slerp:function slerp(e,t){if(0===t)return this;if(1===t)return this.copy(e);var r=this._x,n=this._y,i=this._z,o=this._w,a=o*e._w+r*e._x+n*e._y+i*e._z;if(a<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,a=-a):this.copy(e),a>=1)return this._w=o,this._x=r,this._y=n,this._z=i,this;var s=Math.sqrt(1-a*a);if(Math.abs(s)<.001)return this._w=.5*(o+this._w),this._x=.5*(r+this._x),this._y=.5*(n+this._y),this._z=.5*(i+this._z),this;var c=Math.atan2(s,a),u=Math.sin((1-t)*c)/s,l=Math.sin(t*c)/s;return this._w=o*u+this._w*l,this._x=r*u+this._x*l,this._y=n*u+this._y*l,this._z=i*u+this._z*l,this.onChangeCallback(),this},equals:function equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w},fromArray:function fromArray(e,t){return void 0===t&&(t=0),this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this.onChangeCallback(),this},toArray:function toArray(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e},onChange:function onChange(e){return this.onChangeCallback=e,this},onChangeCallback:function onChangeCallback(){}}),Object.assign(Vector3.prototype,{isVector3:!0,set:function set(e,t,r){return this.x=e,this.y=t,this.z=r,this},setScalar:function setScalar(e){return this.x=e,this.y=e,this.z=e,this},setX:function setX(e){return this.x=e,this},setY:function setY(e){return this.y=e,this},setZ:function setZ(e){return this.z=e,this},setComponent:function setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}return this},getComponent:function getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}},clone:function clone(){return new this.constructor(this.x,this.y,this.z)},copy:function copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this},add:function add(e,t){return void 0!==t?(console.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this)},addScalar:function addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this},addVectors:function addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this},addScaledVector:function addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this},sub:function sub(e,t){return void 0!==t?(console.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this)},subScalar:function subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this},subVectors:function subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this},multiply:function multiply(e,t){return void 0!==t?(console.warn("THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(e,t)):(this.x*=e.x,this.y*=e.y,this.z*=e.z,this)},multiplyScalar:function multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this},multiplyVectors:function multiplyVectors(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this},applyEuler:(p=new Quaternion,function applyEuler(e){return e&&e.isEuler||console.error("THREE.Vector3: .applyEuler() now expects an Euler rotation rather than a Vector3 and order."),this.applyQuaternion(p.setFromEuler(e))}),applyAxisAngle:function(){var e=new Quaternion;return function applyAxisAngle(t,r){return this.applyQuaternion(e.setFromAxisAngle(t,r))}}(),applyMatrix3:function applyMatrix3(e){var t=this.x,r=this.y,n=this.z,i=e.elements;return this.x=i[0]*t+i[3]*r+i[6]*n,this.y=i[1]*t+i[4]*r+i[7]*n,this.z=i[2]*t+i[5]*r+i[8]*n,this},applyMatrix4:function applyMatrix4(e){var t=this.x,r=this.y,n=this.z,i=e.elements,o=1/(i[3]*t+i[7]*r+i[11]*n+i[15]);return this.x=(i[0]*t+i[4]*r+i[8]*n+i[12])*o,this.y=(i[1]*t+i[5]*r+i[9]*n+i[13])*o,this.z=(i[2]*t+i[6]*r+i[10]*n+i[14])*o,this},applyQuaternion:function applyQuaternion(e){var t=this.x,r=this.y,n=this.z,i=e.x,o=e.y,a=e.z,s=e.w,c=s*t+o*n-a*r,u=s*r+a*t-i*n,l=s*n+i*r-o*t,h=-i*t-o*r-a*n;return this.x=c*s+h*-i+u*-a-l*-o,this.y=u*s+h*-o+l*-i-c*-a,this.z=l*s+h*-a+c*-o-u*-i,this},project:function(){var e=new Matrix4;return function project(t){return e.multiplyMatrices(t.projectionMatrix,e.getInverse(t.matrixWorld)),this.applyMatrix4(e)}}(),unproject:function(){var e=new Matrix4;return function unproject(t){return e.multiplyMatrices(t.matrixWorld,e.getInverse(t.projectionMatrix)),this.applyMatrix4(e)}}(),transformDirection:function transformDirection(e){var t=this.x,r=this.y,n=this.z,i=e.elements;return this.x=i[0]*t+i[4]*r+i[8]*n,this.y=i[1]*t+i[5]*r+i[9]*n,this.z=i[2]*t+i[6]*r+i[10]*n,this.normalize()},divide:function divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this},divideScalar:function divideScalar(e){return this.multiplyScalar(1/e)},min:function min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this},max:function max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this},clamp:function clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this},clampScalar:function(){var e=new Vector3,t=new Vector3;return function clampScalar(r,n){return e.set(r,r,r),t.set(n,n,n),this.clamp(e,t)}}(),clampLength:function clampLength(e,t){var r=this.length();return this.divideScalar(r||1).multiplyScalar(Math.max(e,Math.min(t,r)))},floor:function floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this},ceil:function ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this},round:function round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this},roundToZero:function roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this},negate:function negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this},dot:function dot(e){return this.x*e.x+this.y*e.y+this.z*e.z},lengthSq:function lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z},length:function length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},manhattanLength:function manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)},normalize:function normalize(){return this.divideScalar(this.length()||1)},setLength:function setLength(e){return this.normalize().multiplyScalar(e)},lerp:function lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this},lerpVectors:function lerpVectors(e,t,r){return this.subVectors(t,e).multiplyScalar(r).add(e)},cross:function cross(e,t){return void 0!==t?(console.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(e,t)):this.crossVectors(this,e)},crossVectors:function crossVectors(e,t){var r=e.x,n=e.y,i=e.z,o=t.x,a=t.y,s=t.z;return this.x=n*s-i*a,this.y=i*o-r*s,this.z=r*a-n*o,this},projectOnVector:function projectOnVector(e){var t=e.dot(this)/e.lengthSq();return this.copy(e).multiplyScalar(t)},projectOnPlane:function(){var e=new Vector3;return function projectOnPlane(t){return e.copy(this).projectOnVector(t),this.sub(e)}}(),reflect:function(){var e=new Vector3;return function reflect(t){return this.sub(e.copy(t).multiplyScalar(2*this.dot(t)))}}(),angleTo:function angleTo(e){var t=this.dot(e)/Math.sqrt(this.lengthSq()*e.lengthSq());return Math.acos(At.clamp(t,-1,1))},distanceTo:function distanceTo(e){return Math.sqrt(this.distanceToSquared(e))},distanceToSquared:function distanceToSquared(e){var t=this.x-e.x,r=this.y-e.y,n=this.z-e.z;return t*t+r*r+n*n},manhattanDistanceTo:function manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)},setFromSpherical:function setFromSpherical(e){var t=Math.sin(e.phi)*e.radius;return this.x=t*Math.sin(e.theta),this.y=Math.cos(e.phi)*e.radius,this.z=t*Math.cos(e.theta),this},setFromCylindrical:function setFromCylindrical(e){return this.x=e.radius*Math.sin(e.theta),this.y=e.y,this.z=e.radius*Math.cos(e.theta),this},setFromMatrixPosition:function setFromMatrixPosition(e){var t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this},setFromMatrixScale:function setFromMatrixScale(e){var t=this.setFromMatrixColumn(e,0).length(),r=this.setFromMatrixColumn(e,1).length(),n=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=r,this.z=n,this},setFromMatrixColumn:function setFromMatrixColumn(e,t){return this.fromArray(e.elements,4*t)},equals:function equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z},fromArray:function fromArray(e,t){return void 0===t&&(t=0),this.x=e[t],this.y=e[t+1],this.z=e[t+2],this},toArray:function toArray(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e},fromBufferAttribute:function fromBufferAttribute(e,t,r){return void 0!==r&&console.warn("THREE.Vector3: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}}),Object.assign(Matrix3.prototype,{isMatrix3:!0,set:function set(e,t,r,n,i,o,a,s,c){var u=this.elements;return u[0]=e,u[1]=n,u[2]=a,u[3]=t,u[4]=i,u[5]=s,u[6]=r,u[7]=o,u[8]=c,this},identity:function identity(){return this.set(1,0,0,0,1,0,0,0,1),this},clone:function clone(){return(new this.constructor).fromArray(this.elements)},copy:function copy(e){var t=this.elements,r=e.elements;return t[0]=r[0],t[1]=r[1],t[2]=r[2],t[3]=r[3],t[4]=r[4],t[5]=r[5],t[6]=r[6],t[7]=r[7],t[8]=r[8],this},setFromMatrix4:function setFromMatrix4(e){var t=e.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this},applyToBufferAttribute:function(){var e=new Vector3;return function applyToBufferAttribute(t){for(var r=0,n=t.count;r<n;r++)e.x=t.getX(r),e.y=t.getY(r),e.z=t.getZ(r),e.applyMatrix3(this),t.setXYZ(r,e.x,e.y,e.z);return t}}(),multiply:function multiply(e){return this.multiplyMatrices(this,e)},premultiply:function premultiply(e){return this.multiplyMatrices(e,this)},multiplyMatrices:function multiplyMatrices(e,t){var r=e.elements,n=t.elements,i=this.elements,o=r[0],a=r[3],s=r[6],c=r[1],u=r[4],l=r[7],h=r[2],p=r[5],f=r[8],d=n[0],m=n[3],g=n[6],y=n[1],v=n[4],_=n[7],b=n[2],w=n[5],x=n[8];return i[0]=o*d+a*y+s*b,i[3]=o*m+a*v+s*w,i[6]=o*g+a*_+s*x,i[1]=c*d+u*y+l*b,i[4]=c*m+u*v+l*w,i[7]=c*g+u*_+l*x,i[2]=h*d+p*y+f*b,i[5]=h*m+p*v+f*w,i[8]=h*g+p*_+f*x,this},multiplyScalar:function multiplyScalar(e){var t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this},determinant:function determinant(){var e=this.elements,t=e[0],r=e[1],n=e[2],i=e[3],o=e[4],a=e[5],s=e[6],c=e[7],u=e[8];return t*o*u-t*a*c-r*i*u+r*a*s+n*i*c-n*o*s},getInverse:function getInverse(e,t){e&&e.isMatrix4&&console.error("THREE.Matrix3: .getInverse() no longer takes a Matrix4 argument.");var r=e.elements,n=this.elements,i=r[0],o=r[1],a=r[2],s=r[3],c=r[4],u=r[5],l=r[6],h=r[7],p=r[8],f=p*c-u*h,d=u*l-p*s,m=h*s-c*l,g=i*f+o*d+a*m;if(0===g){var y="THREE.Matrix3: .getInverse() can't invert matrix, determinant is 0";if(!0===t)throw new Error(y);return console.warn(y),this.identity()}var v=1/g;return n[0]=f*v,n[1]=(a*h-p*o)*v,n[2]=(u*o-a*c)*v,n[3]=d*v,n[4]=(p*i-a*l)*v,n[5]=(a*s-u*i)*v,n[6]=m*v,n[7]=(o*l-h*i)*v,n[8]=(c*i-o*s)*v,this},transpose:function transpose(){var e,t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this},getNormalMatrix:function getNormalMatrix(e){return this.setFromMatrix4(e).getInverse(this).transpose()},transposeIntoArray:function transposeIntoArray(e){var t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this},setUvTransform:function setUvTransform(e,t,r,n,i,o,a){var s=Math.cos(i),c=Math.sin(i);this.set(r*s,r*c,-r*(s*o+c*a)+o+e,-n*c,n*s,-n*(-c*o+s*a)+a+t,0,0,1)},scale:function scale(e,t){var r=this.elements;return r[0]*=e,r[3]*=e,r[6]*=e,r[1]*=t,r[4]*=t,r[7]*=t,this},rotate:function rotate(e){var t=Math.cos(e),r=Math.sin(e),n=this.elements,i=n[0],o=n[3],a=n[6],s=n[1],c=n[4],u=n[7];return n[0]=t*i+r*s,n[3]=t*o+r*c,n[6]=t*a+r*u,n[1]=-r*i+t*s,n[4]=-r*o+t*c,n[7]=-r*a+t*u,this},translate:function translate(e,t){var r=this.elements;return r[0]+=e*r[2],r[3]+=e*r[5],r[6]+=e*r[8],r[1]+=t*r[2],r[4]+=t*r[5],r[7]+=t*r[8],this},equals:function equals(e){for(var t=this.elements,r=e.elements,n=0;n<9;n++)if(t[n]!==r[n])return!1;return!0},fromArray:function fromArray(e,t){void 0===t&&(t=0);for(var r=0;r<9;r++)this.elements[r]=e[r+t];return this},toArray:function toArray(e,t){void 0===e&&(e=[]),void 0===t&&(t=0);var r=this.elements;return e[t]=r[0],e[t+1]=r[1],e[t+2]=r[2],e[t+3]=r[3],e[t+4]=r[4],e[t+5]=r[5],e[t+6]=r[6],e[t+7]=r[7],e[t+8]=r[8],e}});var Lt,kt,Rt,It,Nt,Ft,jt=0;function Texture(e,t,r,n,i,o,a,s,c,u){Object.defineProperty(this,"id",{value:jt++}),this.uuid=At.generateUUID(),this.name="",this.image=void 0!==e?e:Texture.DEFAULT_IMAGE,this.mipmaps=[],this.mapping=void 0!==t?t:Texture.DEFAULT_MAPPING,this.wrapS=void 0!==r?r:_e,this.wrapT=void 0!==n?n:_e,this.magFilter=void 0!==i?i:Se,this.minFilter=void 0!==o?o:Pe,this.anisotropy=void 0!==c?c:1,this.format=void 0!==a?a:Ue,this.type=void 0!==s?s:Ee,this.offset=new Vector2(0,0),this.repeat=new Vector2(1,1),this.center=new Vector2(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new Matrix3,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.encoding=void 0!==u?u:wt,this.version=0,this.onUpdate=null}function Vector4(e,t,r,n){this.x=e||0,this.y=t||0,this.z=r||0,this.w=void 0!==n?n:1}function WebGLRenderTarget(e,t,r){this.width=e,this.height=t,this.scissor=new Vector4(0,0,e,t),this.scissorTest=!1,this.viewport=new Vector4(0,0,e,t),void 0===(r=r||{}).minFilter&&(r.minFilter=Se),this.texture=new Texture(void 0,void 0,r.wrapS,r.wrapT,r.magFilter,r.minFilter,r.format,r.type,r.anisotropy,r.encoding),this.depthBuffer=void 0===r.depthBuffer||r.depthBuffer,this.stencilBuffer=void 0===r.stencilBuffer||r.stencilBuffer,this.depthTexture=void 0!==r.depthTexture?r.depthTexture:null}function WebGLRenderTargetCube(e,t,r){WebGLRenderTarget.call(this,e,t,r),this.activeCubeFace=0,this.activeMipMapLevel=0}function DataTexture(e,t,r,n,i,o,a,s,c,u,l,h){Texture.call(this,null,o,a,s,c,u,n,i,l,h),this.image={data:e,width:t,height:r},this.magFilter=void 0!==c?c:we,this.minFilter=void 0!==u?u:we,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}function Box3(e,t){this.min=void 0!==e?e:new Vector3(1/0,1/0,1/0),this.max=void 0!==t?t:new Vector3(-1/0,-1/0,-1/0)}function Sphere(e,t){this.center=void 0!==e?e:new Vector3,this.radius=void 0!==t?t:0}function Plane(e,t){this.normal=void 0!==e?e:new Vector3(1,0,0),this.constant=void 0!==t?t:0}function Frustum(e,t,r,n,i,o){this.planes=[void 0!==e?e:new Plane,void 0!==t?t:new Plane,void 0!==r?r:new Plane,void 0!==n?n:new Plane,void 0!==i?i:new Plane,void 0!==o?o:new Plane]}Texture.DEFAULT_IMAGE=void 0,Texture.DEFAULT_MAPPING=300,Texture.prototype=Object.assign(Object.create(EventDispatcher.prototype),{constructor:Texture,isTexture:!0,clone:function clone(){return(new this.constructor).copy(this)},copy:function copy(e){return this.name=e.name,this.image=e.image,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.encoding=e.encoding,this},toJSON:function toJSON(e){var t=void 0===e||"string"==typeof e;if(!t&&void 0!==e.textures[this.uuid])return e.textures[this.uuid];var r={metadata:{version:4.5,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY};if(void 0!==this.image){var n=this.image;void 0===n.uuid&&(n.uuid=At.generateUUID()),t||void 0!==e.images[n.uuid]||(e.images[n.uuid]={uuid:n.uuid,url:function getDataURL(e){var t;if(e instanceof HTMLCanvasElement)t=e;else{(t=document.createElementNS("http://www.w3.org/1999/xhtml","canvas")).width=e.width,t.height=e.height;var r=t.getContext("2d");e instanceof ImageData?r.putImageData(e,0,0):r.drawImage(e,0,0,e.width,e.height)}return t.width>2048||t.height>2048?t.toDataURL("image/jpeg",.6):t.toDataURL("image/png")}(n)}),r.image=n.uuid}return t||(e.textures[this.uuid]=r),r},dispose:function dispose(){this.dispatchEvent({type:"dispose"})},transformUv:function transformUv(e){if(300===this.mapping){if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case ve:e.x=e.x-Math.floor(e.x);break;case _e:e.x=e.x<0?0:1;break;case be:1===Math.abs(Math.floor(e.x)%2)?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x)}if(e.y<0||e.y>1)switch(this.wrapT){case ve:e.y=e.y-Math.floor(e.y);break;case _e:e.y=e.y<0?0:1;break;case be:1===Math.abs(Math.floor(e.y)%2)?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y)}this.flipY&&(e.y=1-e.y)}}}),Object.defineProperty(Texture.prototype,"needsUpdate",{set:function set(e){!0===e&&this.version++}}),Object.assign(Vector4.prototype,{isVector4:!0,set:function set(e,t,r,n){return this.x=e,this.y=t,this.z=r,this.w=n,this},setScalar:function setScalar(e){return this.x=e,this.y=e,this.z=e,this.w=e,this},setX:function setX(e){return this.x=e,this},setY:function setY(e){return this.y=e,this},setZ:function setZ(e){return this.z=e,this},setW:function setW(e){return this.w=e,this},setComponent:function setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e)}return this},getComponent:function getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}},clone:function clone(){return new this.constructor(this.x,this.y,this.z,this.w)},copy:function copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=void 0!==e.w?e.w:1,this},add:function add(e,t){return void 0!==t?(console.warn("THREE.Vector4: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this)},addScalar:function addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this},addVectors:function addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this},addScaledVector:function addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this},sub:function sub(e,t){return void 0!==t?(console.warn("THREE.Vector4: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this)},subScalar:function subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this},subVectors:function subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this},multiplyScalar:function multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this},applyMatrix4:function applyMatrix4(e){var t=this.x,r=this.y,n=this.z,i=this.w,o=e.elements;return this.x=o[0]*t+o[4]*r+o[8]*n+o[12]*i,this.y=o[1]*t+o[5]*r+o[9]*n+o[13]*i,this.z=o[2]*t+o[6]*r+o[10]*n+o[14]*i,this.w=o[3]*t+o[7]*r+o[11]*n+o[15]*i,this},divideScalar:function divideScalar(e){return this.multiplyScalar(1/e)},setAxisAngleFromQuaternion:function setAxisAngleFromQuaternion(e){this.w=2*Math.acos(e.w);var t=Math.sqrt(1-e.w*e.w);return t<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this},setAxisAngleFromRotationMatrix:function setAxisAngleFromRotationMatrix(e){var t,r,n,i,o=e.elements,a=o[0],s=o[4],c=o[8],u=o[1],l=o[5],h=o[9],p=o[2],f=o[6],d=o[10];if(Math.abs(s-u)<.01&&Math.abs(c-p)<.01&&Math.abs(h-f)<.01){if(Math.abs(s+u)<.1&&Math.abs(c+p)<.1&&Math.abs(h+f)<.1&&Math.abs(a+l+d-3)<.1)return this.set(1,0,0,0),this;t=Math.PI;var m=(a+1)/2,g=(l+1)/2,y=(d+1)/2,v=(s+u)/4,_=(c+p)/4,b=(h+f)/4;return m>g&&m>y?m<.01?(r=0,n=.707106781,i=.707106781):(n=v/(r=Math.sqrt(m)),i=_/r):g>y?g<.01?(r=.707106781,n=0,i=.707106781):(r=v/(n=Math.sqrt(g)),i=b/n):y<.01?(r=.707106781,n=.707106781,i=0):(r=_/(i=Math.sqrt(y)),n=b/i),this.set(r,n,i,t),this}var w=Math.sqrt((f-h)*(f-h)+(c-p)*(c-p)+(u-s)*(u-s));return Math.abs(w)<.001&&(w=1),this.x=(f-h)/w,this.y=(c-p)/w,this.z=(u-s)/w,this.w=Math.acos((a+l+d-1)/2),this},min:function min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this},max:function max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this},clamp:function clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this.w=Math.max(e.w,Math.min(t.w,this.w)),this},clampScalar:function(){var e,t;return function clampScalar(r,n){return void 0===e&&(e=new Vector4,t=new Vector4),e.set(r,r,r,r),t.set(n,n,n,n),this.clamp(e,t)}}(),clampLength:function clampLength(e,t){var r=this.length();return this.divideScalar(r||1).multiplyScalar(Math.max(e,Math.min(t,r)))},floor:function floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this},ceil:function ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this},round:function round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this},roundToZero:function roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this},negate:function negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this},dot:function dot(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w},lengthSq:function lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},length:function length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},manhattanLength:function manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)},normalize:function normalize(){return this.divideScalar(this.length()||1)},setLength:function setLength(e){return this.normalize().multiplyScalar(e)},lerp:function lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this},lerpVectors:function lerpVectors(e,t,r){return this.subVectors(t,e).multiplyScalar(r).add(e)},equals:function equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w},fromArray:function fromArray(e,t){return void 0===t&&(t=0),this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this},toArray:function toArray(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e},fromBufferAttribute:function fromBufferAttribute(e,t,r){return void 0!==r&&console.warn("THREE.Vector4: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this.w=e.getW(t),this}}),WebGLRenderTarget.prototype=Object.assign(Object.create(EventDispatcher.prototype),{constructor:WebGLRenderTarget,isWebGLRenderTarget:!0,setSize:function setSize(e,t){this.width===e&&this.height===t||(this.width=e,this.height=t,this.dispose()),this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t)},clone:function clone(){return(new this.constructor).copy(this)},copy:function copy(e){return this.width=e.width,this.height=e.height,this.viewport.copy(e.viewport),this.texture=e.texture.clone(),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,this.depthTexture=e.depthTexture,this},dispose:function dispose(){this.dispatchEvent({type:"dispose"})}}),WebGLRenderTargetCube.prototype=Object.create(WebGLRenderTarget.prototype),WebGLRenderTargetCube.prototype.constructor=WebGLRenderTargetCube,WebGLRenderTargetCube.prototype.isWebGLRenderTargetCube=!0,DataTexture.prototype=Object.create(Texture.prototype),DataTexture.prototype.constructor=DataTexture,DataTexture.prototype.isDataTexture=!0,Object.assign(Box3.prototype,{isBox3:!0,set:function set(e,t){return this.min.copy(e),this.max.copy(t),this},setFromArray:function setFromArray(e){for(var t=1/0,r=1/0,n=1/0,i=-1/0,o=-1/0,a=-1/0,s=0,c=e.length;s<c;s+=3){var u=e[s],l=e[s+1],h=e[s+2];u<t&&(t=u),l<r&&(r=l),h<n&&(n=h),u>i&&(i=u),l>o&&(o=l),h>a&&(a=h)}return this.min.set(t,r,n),this.max.set(i,o,a),this},setFromBufferAttribute:function setFromBufferAttribute(e){for(var t=1/0,r=1/0,n=1/0,i=-1/0,o=-1/0,a=-1/0,s=0,c=e.count;s<c;s++){var u=e.getX(s),l=e.getY(s),h=e.getZ(s);u<t&&(t=u),l<r&&(r=l),h<n&&(n=h),u>i&&(i=u),l>o&&(o=l),h>a&&(a=h)}return this.min.set(t,r,n),this.max.set(i,o,a),this},setFromPoints:function setFromPoints(e){this.makeEmpty();for(var t=0,r=e.length;t<r;t++)this.expandByPoint(e[t]);return this},setFromCenterAndSize:function(){var e=new Vector3;return function setFromCenterAndSize(t,r){var n=e.copy(r).multiplyScalar(.5);return this.min.copy(t).sub(n),this.max.copy(t).add(n),this}}(),setFromObject:function setFromObject(e){return this.makeEmpty(),this.expandByObject(e)},clone:function clone(){return(new this.constructor).copy(this)},copy:function copy(e){return this.min.copy(e.min),this.max.copy(e.max),this},makeEmpty:function makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this},isEmpty:function isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z},getCenter:function getCenter(e){return void 0===e&&(console.warn("THREE.Box3: .getCenter() target is now required"),e=new Vector3),this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)},getSize:function getSize(e){return void 0===e&&(console.warn("THREE.Box3: .getSize() target is now required"),e=new Vector3),this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)},expandByPoint:function expandByPoint(e){return this.min.min(e),this.max.max(e),this},expandByVector:function expandByVector(e){return this.min.sub(e),this.max.add(e),this},expandByScalar:function expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this},expandByObject:function(){var e,t,r,n=new Vector3;function traverse(i){var o=i.geometry;if(void 0!==o)if(o.isGeometry){var a=o.vertices;for(t=0,r=a.length;t<r;t++)n.copy(a[t]),n.applyMatrix4(i.matrixWorld),e.expandByPoint(n)}else if(o.isBufferGeometry){var s=o.attributes.position;if(void 0!==s)for(t=0,r=s.count;t<r;t++)n.fromBufferAttribute(s,t).applyMatrix4(i.matrixWorld),e.expandByPoint(n)}}return function expandByObject(t){return e=this,t.updateMatrixWorld(!0),t.traverse(traverse),this}}(),containsPoint:function containsPoint(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y||e.z<this.min.z||e.z>this.max.z)},containsBox:function containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z},getParameter:function getParameter(e,t){return void 0===t&&(console.warn("THREE.Box3: .getParameter() target is now required"),t=new Vector3),t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))},intersectsBox:function intersectsBox(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y||e.max.z<this.min.z||e.min.z>this.max.z)},intersectsSphere:(kt=new Vector3,function intersectsSphere(e){return this.clampPoint(e.center,kt),kt.distanceToSquared(e.center)<=e.radius*e.radius}),intersectsPlane:function intersectsPlane(e){var t,r;return e.normal.x>0?(t=e.normal.x*this.min.x,r=e.normal.x*this.max.x):(t=e.normal.x*this.max.x,r=e.normal.x*this.min.x),e.normal.y>0?(t+=e.normal.y*this.min.y,r+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,r+=e.normal.y*this.min.y),e.normal.z>0?(t+=e.normal.z*this.min.z,r+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,r+=e.normal.z*this.min.z),t<=e.constant&&r>=e.constant},intersectsTriangle:function(){var e=new Vector3,t=new Vector3,r=new Vector3,n=new Vector3,i=new Vector3,o=new Vector3,a=new Vector3,s=new Vector3,c=new Vector3,u=new Vector3;function satForAxes(n){var i,o;for(i=0,o=n.length-3;i<=o;i+=3){a.fromArray(n,i);var s=c.x*Math.abs(a.x)+c.y*Math.abs(a.y)+c.z*Math.abs(a.z),u=e.dot(a),l=t.dot(a),h=r.dot(a);if(Math.max(-Math.max(u,l,h),Math.min(u,l,h))>s)return!1}return!0}return function intersectsTriangle(a){if(this.isEmpty())return!1;this.getCenter(s),c.subVectors(this.max,s),e.subVectors(a.a,s),t.subVectors(a.b,s),r.subVectors(a.c,s),n.subVectors(t,e),i.subVectors(r,t),o.subVectors(e,r);var l=[0,-n.z,n.y,0,-i.z,i.y,0,-o.z,o.y,n.z,0,-n.x,i.z,0,-i.x,o.z,0,-o.x,-n.y,n.x,0,-i.y,i.x,0,-o.y,o.x,0];return!!satForAxes(l)&&(!!satForAxes(l=[1,0,0,0,1,0,0,0,1])&&(u.crossVectors(n,i),satForAxes(l=[u.x,u.y,u.z])))}}(),clampPoint:function clampPoint(e,t){return void 0===t&&(console.warn("THREE.Box3: .clampPoint() target is now required"),t=new Vector3),t.copy(e).clamp(this.min,this.max)},distanceToPoint:function(){var e=new Vector3;return function distanceToPoint(t){return e.copy(t).clamp(this.min,this.max).sub(t).length()}}(),getBoundingSphere:function(){var e=new Vector3;return function getBoundingSphere(t){return void 0===t&&(console.warn("THREE.Box3: .getBoundingSphere() target is now required"),t=new Sphere),this.getCenter(t.center),t.radius=.5*this.getSize(e).length(),t}}(),intersect:function intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this},union:function union(e){return this.min.min(e.min),this.max.max(e.max),this},applyMatrix4:(Lt=[new Vector3,new Vector3,new Vector3,new Vector3,new Vector3,new Vector3,new Vector3,new Vector3],function applyMatrix4(e){return this.isEmpty()?this:(Lt[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),Lt[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),Lt[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),Lt[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),Lt[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),Lt[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),Lt[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),Lt[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(Lt),this)}),translate:function translate(e){return this.min.add(e),this.max.add(e),this},equals:function equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}),Object.assign(Sphere.prototype,{set:function set(e,t){return this.center.copy(e),this.radius=t,this},setFromPoints:(Rt=new Box3,function setFromPoints(e,t){var r=this.center;void 0!==t?r.copy(t):Rt.setFromPoints(e).getCenter(r);for(var n=0,i=0,o=e.length;i<o;i++)n=Math.max(n,r.distanceToSquared(e[i]));return this.radius=Math.sqrt(n),this}),clone:function clone(){return(new this.constructor).copy(this)},copy:function copy(e){return this.center.copy(e.center),this.radius=e.radius,this},empty:function empty(){return this.radius<=0},containsPoint:function containsPoint(e){return e.distanceToSquared(this.center)<=this.radius*this.radius},distanceToPoint:function distanceToPoint(e){return e.distanceTo(this.center)-this.radius},intersectsSphere:function intersectsSphere(e){var t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t},intersectsBox:function intersectsBox(e){return e.intersectsSphere(this)},intersectsPlane:function intersectsPlane(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius},clampPoint:function clampPoint(e,t){var r=this.center.distanceToSquared(e);return void 0===t&&(console.warn("THREE.Sphere: .clampPoint() target is now required"),t=new Vector3),t.copy(e),r>this.radius*this.radius&&(t.sub(this.center).normalize(),t.multiplyScalar(this.radius).add(this.center)),t},getBoundingBox:function getBoundingBox(e){return void 0===e&&(console.warn("THREE.Sphere: .getBoundingBox() target is now required"),e=new Box3),e.set(this.center,this.center),e.expandByScalar(this.radius),e},applyMatrix4:function applyMatrix4(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this},translate:function translate(e){return this.center.add(e),this},equals:function equals(e){return e.center.equals(this.center)&&e.radius===this.radius}}),Object.assign(Plane.prototype,{set:function set(e,t){return this.normal.copy(e),this.constant=t,this},setComponents:function setComponents(e,t,r,n){return this.normal.set(e,t,r),this.constant=n,this},setFromNormalAndCoplanarPoint:function setFromNormalAndCoplanarPoint(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this},setFromCoplanarPoints:function(){var e=new Vector3,t=new Vector3;return function setFromCoplanarPoints(r,n,i){var o=e.subVectors(i,n).cross(t.subVectors(r,n)).normalize();return this.setFromNormalAndCoplanarPoint(o,r),this}}(),clone:function clone(){return(new this.constructor).copy(this)},copy:function copy(e){return this.normal.copy(e.normal),this.constant=e.constant,this},normalize:function normalize(){var e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this},negate:function negate(){return this.constant*=-1,this.normal.negate(),this},distanceToPoint:function distanceToPoint(e){return this.normal.dot(e)+this.constant},distanceToSphere:function distanceToSphere(e){return this.distanceToPoint(e.center)-e.radius},projectPoint:function projectPoint(e,t){return void 0===t&&(console.warn("THREE.Plane: .projectPoint() target is now required"),t=new Vector3),t.copy(this.normal).multiplyScalar(-this.distanceToPoint(e)).add(e)},intersectLine:function(){var e=new Vector3;return function intersectLine(t,r){void 0===r&&(console.warn("THREE.Plane: .intersectLine() target is now required"),r=new Vector3);var n=t.delta(e),i=this.normal.dot(n);if(0===i)return 0===this.distanceToPoint(t.start)?r.copy(t.start):void 0;var o=-(t.start.dot(this.normal)+this.constant)/i;return o<0||o>1?void 0:r.copy(n).multiplyScalar(o).add(t.start)}}(),intersectsLine:function intersectsLine(e){var t=this.distanceToPoint(e.start),r=this.distanceToPoint(e.end);return t<0&&r>0||r<0&&t>0},intersectsBox:function intersectsBox(e){return e.intersectsPlane(this)},intersectsSphere:function intersectsSphere(e){return e.intersectsPlane(this)},coplanarPoint:function coplanarPoint(e){return void 0===e&&(console.warn("THREE.Plane: .coplanarPoint() target is now required"),e=new Vector3),e.copy(this.normal).multiplyScalar(-this.constant)},applyMatrix4:function(){var e=new Vector3,t=new Matrix3;return function applyMatrix4(r,n){var i=n||t.getNormalMatrix(r),o=this.coplanarPoint(e).applyMatrix4(r),a=this.normal.applyMatrix3(i).normalize();return this.constant=-o.dot(a),this}}(),translate:function translate(e){return this.constant-=e.dot(this.normal),this},equals:function equals(e){return e.normal.equals(this.normal)&&e.constant===this.constant}}),Object.assign(Frustum.prototype,{set:function set(e,t,r,n,i,o){var a=this.planes;return a[0].copy(e),a[1].copy(t),a[2].copy(r),a[3].copy(n),a[4].copy(i),a[5].copy(o),this},clone:function clone(){return(new this.constructor).copy(this)},copy:function copy(e){for(var t=this.planes,r=0;r<6;r++)t[r].copy(e.planes[r]);return this},setFromMatrix:function setFromMatrix(e){var t=this.planes,r=e.elements,n=r[0],i=r[1],o=r[2],a=r[3],s=r[4],c=r[5],u=r[6],l=r[7],h=r[8],p=r[9],f=r[10],d=r[11],m=r[12],g=r[13],y=r[14],v=r[15];return t[0].setComponents(a-n,l-s,d-h,v-m).normalize(),t[1].setComponents(a+n,l+s,d+h,v+m).normalize(),t[2].setComponents(a+i,l+c,d+p,v+g).normalize(),t[3].setComponents(a-i,l-c,d-p,v-g).normalize(),t[4].setComponents(a-o,l-u,d-f,v-y).normalize(),t[5].setComponents(a+o,l+u,d+f,v+y).normalize(),this},intersectsObject:(Ft=new Sphere,function intersectsObject(e){var t=e.geometry;return null===t.boundingSphere&&t.computeBoundingSphere(),Ft.copy(t.boundingSphere).applyMatrix4(e.matrixWorld),this.intersectsSphere(Ft)}),intersectsSprite:function(){var e=new Sphere;return function intersectsSprite(t){return e.center.set(0,0,0),e.radius=.7071067811865476,e.applyMatrix4(t.matrixWorld),this.intersectsSphere(e)}}(),intersectsSphere:function intersectsSphere(e){for(var t=this.planes,r=e.center,n=-e.radius,i=0;i<6;i++){if(t[i].distanceToPoint(r)<n)return!1}return!0},intersectsBox:(It=new Vector3,Nt=new Vector3,function intersectsBox(e){for(var t=this.planes,r=0;r<6;r++){var n=t[r];It.x=n.normal.x>0?e.min.x:e.max.x,Nt.x=n.normal.x>0?e.max.x:e.min.x,It.y=n.normal.y>0?e.min.y:e.max.y,Nt.y=n.normal.y>0?e.max.y:e.min.y,It.z=n.normal.z>0?e.min.z:e.max.z,Nt.z=n.normal.z>0?e.max.z:e.min.z;var i=n.distanceToPoint(It),o=n.distanceToPoint(Nt);if(i<0&&o<0)return!1}return!0}),containsPoint:function containsPoint(e){for(var t=this.planes,r=0;r<6;r++)if(t[r].distanceToPoint(e)<0)return!1;return!0}});var Bt,Vt={alphamap_fragment:"#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, vUv ).g;\n#endif\n",alphamap_pars_fragment:"#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif\n",alphatest_fragment:"#ifdef ALPHATEST\n\tif ( diffuseColor.a < ALPHATEST ) discard;\n#endif\n",aomap_fragment:"#ifdef USE_AOMAP\n\tfloat ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;\n\treflectedLight.indirectDiffuse *= ambientOcclusion;\n\t#if defined( USE_ENVMAP ) && defined( PHYSICAL )\n\t\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\t\treflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.specularRoughness );\n\t#endif\n#endif\n",aomap_pars_fragment:"#ifdef USE_AOMAP\n\tuniform sampler2D aoMap;\n\tuniform float aoMapIntensity;\n#endif",begin_vertex:"\nvec3 transformed = vec3( position );\n",beginnormal_vertex:"\nvec3 objectNormal = vec3( normal );\n",bsdfs:"float punctualLightIntensityToIrradianceFactor( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {\n\tif( decayExponent > 0.0 ) {\n#if defined ( PHYSICALLY_CORRECT_LIGHTS )\n\t\tfloat distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );\n\t\tfloat maxDistanceCutoffFactor = pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );\n\t\treturn distanceFalloff * maxDistanceCutoffFactor;\n#else\n\t\treturn pow( saturate( -lightDistance / cutoffDistance + 1.0 ), decayExponent );\n#endif\n\t}\n\treturn 1.0;\n}\nvec3 BRDF_Diffuse_Lambert( const in vec3 diffuseColor ) {\n\treturn RECIPROCAL_PI * diffuseColor;\n}\nvec3 F_Schlick( const in vec3 specularColor, const in float dotLH ) {\n\tfloat fresnel = exp2( ( -5.55473 * dotLH - 6.98316 ) * dotLH );\n\treturn ( 1.0 - specularColor ) * fresnel + specularColor;\n}\nfloat G_GGX_Smith( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gl = dotNL + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\tfloat gv = dotNV + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\treturn 1.0 / ( gl * gv );\n}\nfloat G_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\tfloat gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\treturn 0.5 / max( gv + gl, EPSILON );\n}\nfloat D_GGX( const in float alpha, const in float dotNH ) {\n\tfloat a2 = pow2( alpha );\n\tfloat denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;\n\treturn RECIPROCAL_PI * a2 / pow2( denom );\n}\nvec3 BRDF_Specular_GGX( const in IncidentLight incidentLight, const in GeometricContext geometry, const in vec3 specularColor, const in float roughness ) {\n\tfloat alpha = pow2( roughness );\n\tvec3 halfDir = normalize( incidentLight.direction + geometry.viewDir );\n\tfloat dotNL = saturate( dot( geometry.normal, incidentLight.direction ) );\n\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\tfloat dotNH = saturate( dot( geometry.normal, halfDir ) );\n\tfloat dotLH = saturate( dot( incidentLight.direction, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, dotLH );\n\tfloat G = G_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\tfloat D = D_GGX( alpha, dotNH );\n\treturn F * ( G * D );\n}\nvec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {\n\tconst float LUT_SIZE  = 64.0;\n\tconst float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;\n\tconst float LUT_BIAS  = 0.5 / LUT_SIZE;\n\tfloat dotNV = saturate( dot( N, V ) );\n\tvec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );\n\tuv = uv * LUT_SCALE + LUT_BIAS;\n\treturn uv;\n}\nfloat LTC_ClippedSphereFormFactor( const in vec3 f ) {\n\tfloat l = length( f );\n\treturn max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );\n}\nvec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {\n\tfloat x = dot( v1, v2 );\n\tfloat y = abs( x );\n\tfloat a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;\n\tfloat b = 3.4175940 + ( 4.1616724 + y ) * y;\n\tfloat v = a / b;\n\tfloat theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;\n\treturn cross( v1, v2 ) * theta_sintheta;\n}\nvec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {\n\tvec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];\n\tvec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];\n\tvec3 lightNormal = cross( v1, v2 );\n\tif( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );\n\tvec3 T1, T2;\n\tT1 = normalize( V - N * dot( V, N ) );\n\tT2 = - cross( N, T1 );\n\tmat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );\n\tvec3 coords[ 4 ];\n\tcoords[ 0 ] = mat * ( rectCoords[ 0 ] - P );\n\tcoords[ 1 ] = mat * ( rectCoords[ 1 ] - P );\n\tcoords[ 2 ] = mat * ( rectCoords[ 2 ] - P );\n\tcoords[ 3 ] = mat * ( rectCoords[ 3 ] - P );\n\tcoords[ 0 ] = normalize( coords[ 0 ] );\n\tcoords[ 1 ] = normalize( coords[ 1 ] );\n\tcoords[ 2 ] = normalize( coords[ 2 ] );\n\tcoords[ 3 ] = normalize( coords[ 3 ] );\n\tvec3 vectorFormFactor = vec3( 0.0 );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );\n\tfloat result = LTC_ClippedSphereFormFactor( vectorFormFactor );\n\treturn vec3( result );\n}\nvec3 BRDF_Specular_GGX_Environment( const in GeometricContext geometry, const in vec3 specularColor, const in float roughness ) {\n\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\tconst vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );\n\tconst vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );\n\tvec4 r = roughness * c0 + c1;\n\tfloat a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;\n\tvec2 AB = vec2( -1.04, 1.04 ) * a004 + r.zw;\n\treturn specularColor * AB.x + AB.y;\n}\nfloat G_BlinnPhong_Implicit( ) {\n\treturn 0.25;\n}\nfloat D_BlinnPhong( const in float shininess, const in float dotNH ) {\n\treturn RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\n}\nvec3 BRDF_Specular_BlinnPhong( const in IncidentLight incidentLight, const in GeometricContext geometry, const in vec3 specularColor, const in float shininess ) {\n\tvec3 halfDir = normalize( incidentLight.direction + geometry.viewDir );\n\tfloat dotNH = saturate( dot( geometry.normal, halfDir ) );\n\tfloat dotLH = saturate( dot( incidentLight.direction, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, dotLH );\n\tfloat G = G_BlinnPhong_Implicit( );\n\tfloat D = D_BlinnPhong( shininess, dotNH );\n\treturn F * ( G * D );\n}\nfloat GGXRoughnessToBlinnExponent( const in float ggxRoughness ) {\n\treturn ( 2.0 / pow2( ggxRoughness + 0.0001 ) - 2.0 );\n}\nfloat BlinnExponentToGGXRoughness( const in float blinnExponent ) {\n\treturn sqrt( 2.0 / ( blinnExponent + 2.0 ) );\n}\n",bumpmap_pars_fragment:"#ifdef USE_BUMPMAP\n\tuniform sampler2D bumpMap;\n\tuniform float bumpScale;\n\tvec2 dHdxy_fwd() {\n\t\tvec2 dSTdx = dFdx( vUv );\n\t\tvec2 dSTdy = dFdy( vUv );\n\t\tfloat Hll = bumpScale * texture2D( bumpMap, vUv ).x;\n\t\tfloat dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;\n\t\tfloat dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;\n\t\treturn vec2( dBx, dBy );\n\t}\n\tvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy ) {\n\t\tvec3 vSigmaX = vec3( dFdx( surf_pos.x ), dFdx( surf_pos.y ), dFdx( surf_pos.z ) );\n\t\tvec3 vSigmaY = vec3( dFdy( surf_pos.x ), dFdy( surf_pos.y ), dFdy( surf_pos.z ) );\n\t\tvec3 vN = surf_norm;\n\t\tvec3 R1 = cross( vSigmaY, vN );\n\t\tvec3 R2 = cross( vN, vSigmaX );\n\t\tfloat fDet = dot( vSigmaX, R1 );\n\t\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n\t\treturn normalize( abs( fDet ) * surf_norm - vGrad );\n\t}\n#endif\n",clipping_planes_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvec4 plane;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {\n\t\tplane = clippingPlanes[ i ];\n\t\tif ( dot( vViewPosition, plane.xyz ) > plane.w ) discard;\n\t}\n\t#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\n\t\tbool clipped = true;\n\t\t#pragma unroll_loop\n\t\tfor ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {\n\t\t\tplane = clippingPlanes[ i ];\n\t\t\tclipped = ( dot( vViewPosition, plane.xyz ) > plane.w ) && clipped;\n\t\t}\n\t\tif ( clipped ) discard;\n\t#endif\n#endif\n",clipping_planes_pars_fragment:"#if NUM_CLIPPING_PLANES > 0\n\t#if ! defined( PHYSICAL ) && ! defined( PHONG )\n\t\tvarying vec3 vViewPosition;\n\t#endif\n\tuniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];\n#endif\n",clipping_planes_pars_vertex:"#if NUM_CLIPPING_PLANES > 0 && ! defined( PHYSICAL ) && ! defined( PHONG )\n\tvarying vec3 vViewPosition;\n#endif\n",clipping_planes_vertex:"#if NUM_CLIPPING_PLANES > 0 && ! defined( PHYSICAL ) && ! defined( PHONG )\n\tvViewPosition = - mvPosition.xyz;\n#endif\n",color_fragment:"#ifdef USE_COLOR\n\tdiffuseColor.rgb *= vColor;\n#endif",color_pars_fragment:"#ifdef USE_COLOR\n\tvarying vec3 vColor;\n#endif\n",color_pars_vertex:"#ifdef USE_COLOR\n\tvarying vec3 vColor;\n#endif",color_vertex:"#ifdef USE_COLOR\n\tvColor.xyz = color.xyz;\n#endif",common:"#define PI 3.14159265359\n#define PI2 6.28318530718\n#define PI_HALF 1.5707963267949\n#define RECIPROCAL_PI 0.31830988618\n#define RECIPROCAL_PI2 0.15915494\n#define LOG2 1.442695\n#define EPSILON 1e-6\n#define saturate(a) clamp( a, 0.0, 1.0 )\n#define whiteCompliment(a) ( 1.0 - saturate( a ) )\nfloat pow2( const in float x ) { return x*x; }\nfloat pow3( const in float x ) { return x*x*x; }\nfloat pow4( const in float x ) { float x2 = x*x; return x2*x2; }\nfloat average( const in vec3 color ) { return dot( color, vec3( 0.3333 ) ); }\nhighp float rand( const in vec2 uv ) {\n\tconst highp float a = 12.9898, b = 78.233, c = 43758.5453;\n\thighp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );\n\treturn fract(sin(sn) * c);\n}\nstruct IncidentLight {\n\tvec3 color;\n\tvec3 direction;\n\tbool visible;\n};\nstruct ReflectedLight {\n\tvec3 directDiffuse;\n\tvec3 directSpecular;\n\tvec3 indirectDiffuse;\n\tvec3 indirectSpecular;\n};\nstruct GeometricContext {\n\tvec3 position;\n\tvec3 normal;\n\tvec3 viewDir;\n};\nvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n}\nvec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );\n}\nvec3 projectOnPlane(in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\tfloat distance = dot( planeNormal, point - pointOnPlane );\n\treturn - distance * planeNormal + point;\n}\nfloat sideOfPlane( in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\treturn sign( dot( point - pointOnPlane, planeNormal ) );\n}\nvec3 linePlaneIntersect( in vec3 pointOnLine, in vec3 lineDirection, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\treturn lineDirection * ( dot( planeNormal, pointOnPlane - pointOnLine ) / dot( planeNormal, lineDirection ) ) + pointOnLine;\n}\nmat3 transposeMat3( const in mat3 m ) {\n\tmat3 tmp;\n\ttmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );\n\ttmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );\n\ttmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );\n\treturn tmp;\n}\nfloat linearToRelativeLuminance( const in vec3 color ) {\n\tvec3 weights = vec3( 0.2126, 0.7152, 0.0722 );\n\treturn dot( weights, color.rgb );\n}\n",cube_uv_reflection_fragment:"#ifdef ENVMAP_TYPE_CUBE_UV\n#define cubeUV_textureSize (1024.0)\nint getFaceFromDirection(vec3 direction) {\n\tvec3 absDirection = abs(direction);\n\tint face = -1;\n\tif( absDirection.x > absDirection.z ) {\n\t\tif(absDirection.x > absDirection.y )\n\t\t\tface = direction.x > 0.0 ? 0 : 3;\n\t\telse\n\t\t\tface = direction.y > 0.0 ? 1 : 4;\n\t}\n\telse {\n\t\tif(absDirection.z > absDirection.y )\n\t\t\tface = direction.z > 0.0 ? 2 : 5;\n\t\telse\n\t\t\tface = direction.y > 0.0 ? 1 : 4;\n\t}\n\treturn face;\n}\n#define cubeUV_maxLods1  (log2(cubeUV_textureSize*0.25) - 1.0)\n#define cubeUV_rangeClamp (exp2((6.0 - 1.0) * 2.0))\nvec2 MipLevelInfo( vec3 vec, float roughnessLevel, float roughness ) {\n\tfloat scale = exp2(cubeUV_maxLods1 - roughnessLevel);\n\tfloat dxRoughness = dFdx(roughness);\n\tfloat dyRoughness = dFdy(roughness);\n\tvec3 dx = dFdx( vec * scale * dxRoughness );\n\tvec3 dy = dFdy( vec * scale * dyRoughness );\n\tfloat d = max( dot( dx, dx ), dot( dy, dy ) );\n\td = clamp(d, 1.0, cubeUV_rangeClamp);\n\tfloat mipLevel = 0.5 * log2(d);\n\treturn vec2(floor(mipLevel), fract(mipLevel));\n}\n#define cubeUV_maxLods2 (log2(cubeUV_textureSize*0.25) - 2.0)\n#define cubeUV_rcpTextureSize (1.0 / cubeUV_textureSize)\nvec2 getCubeUV(vec3 direction, float roughnessLevel, float mipLevel) {\n\tmipLevel = roughnessLevel > cubeUV_maxLods2 - 3.0 ? 0.0 : mipLevel;\n\tfloat a = 16.0 * cubeUV_rcpTextureSize;\n\tvec2 exp2_packed = exp2( vec2( roughnessLevel, mipLevel ) );\n\tvec2 rcp_exp2_packed = vec2( 1.0 ) / exp2_packed;\n\tfloat powScale = exp2_packed.x * exp2_packed.y;\n\tfloat scale = rcp_exp2_packed.x * rcp_exp2_packed.y * 0.25;\n\tfloat mipOffset = 0.75*(1.0 - rcp_exp2_packed.y) * rcp_exp2_packed.x;\n\tbool bRes = mipLevel == 0.0;\n\tscale =  bRes && (scale < a) ? a : scale;\n\tvec3 r;\n\tvec2 offset;\n\tint face = getFaceFromDirection(direction);\n\tfloat rcpPowScale = 1.0 / powScale;\n\tif( face == 0) {\n\t\tr = vec3(direction.x, -direction.z, direction.y);\n\t\toffset = vec2(0.0+mipOffset,0.75 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? a : offset.y;\n\t}\n\telse if( face == 1) {\n\t\tr = vec3(direction.y, direction.x, direction.z);\n\t\toffset = vec2(scale+mipOffset, 0.75 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? a : offset.y;\n\t}\n\telse if( face == 2) {\n\t\tr = vec3(direction.z, direction.x, direction.y);\n\t\toffset = vec2(2.0*scale+mipOffset, 0.75 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? a : offset.y;\n\t}\n\telse if( face == 3) {\n\t\tr = vec3(direction.x, direction.z, direction.y);\n\t\toffset = vec2(0.0+mipOffset,0.5 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? 0.0 : offset.y;\n\t}\n\telse if( face == 4) {\n\t\tr = vec3(direction.y, direction.x, -direction.z);\n\t\toffset = vec2(scale+mipOffset, 0.5 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? 0.0 : offset.y;\n\t}\n\telse {\n\t\tr = vec3(direction.z, -direction.x, direction.y);\n\t\toffset = vec2(2.0*scale+mipOffset, 0.5 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? 0.0 : offset.y;\n\t}\n\tr = normalize(r);\n\tfloat texelOffset = 0.5 * cubeUV_rcpTextureSize;\n\tvec2 s = ( r.yz / abs( r.x ) + vec2( 1.0 ) ) * 0.5;\n\tvec2 base = offset + vec2( texelOffset );\n\treturn base + s * ( scale - 2.0 * texelOffset );\n}\n#define cubeUV_maxLods3 (log2(cubeUV_textureSize*0.25) - 3.0)\nvec4 textureCubeUV(vec3 reflectedDirection, float roughness ) {\n\tfloat roughnessVal = roughness* cubeUV_maxLods3;\n\tfloat r1 = floor(roughnessVal);\n\tfloat r2 = r1 + 1.0;\n\tfloat t = fract(roughnessVal);\n\tvec2 mipInfo = MipLevelInfo(reflectedDirection, r1, roughness);\n\tfloat s = mipInfo.y;\n\tfloat level0 = mipInfo.x;\n\tfloat level1 = level0 + 1.0;\n\tlevel1 = level1 > 5.0 ? 5.0 : level1;\n\tlevel0 += min( floor( s + 0.5 ), 5.0 );\n\tvec2 uv_10 = getCubeUV(reflectedDirection, r1, level0);\n\tvec4 color10 = envMapTexelToLinear(texture2D(envMap, uv_10));\n\tvec2 uv_20 = getCubeUV(reflectedDirection, r2, level0);\n\tvec4 color20 = envMapTexelToLinear(texture2D(envMap, uv_20));\n\tvec4 result = mix(color10, color20, t);\n\treturn vec4(result.rgb, 1.0);\n}\n#endif\n",defaultnormal_vertex:"vec3 transformedNormal = normalMatrix * objectNormal;\n#ifdef FLIP_SIDED\n\ttransformedNormal = - transformedNormal;\n#endif\n",displacementmap_pars_vertex:"#ifdef USE_DISPLACEMENTMAP\n\tuniform sampler2D displacementMap;\n\tuniform float displacementScale;\n\tuniform float displacementBias;\n#endif\n",displacementmap_vertex:"#ifdef USE_DISPLACEMENTMAP\n\ttransformed += normalize( objectNormal ) * ( texture2D( displacementMap, uv ).x * displacementScale + displacementBias );\n#endif\n",emissivemap_fragment:"#ifdef USE_EMISSIVEMAP\n\tvec4 emissiveColor = texture2D( emissiveMap, vUv );\n\temissiveColor.rgb = emissiveMapTexelToLinear( emissiveColor ).rgb;\n\ttotalEmissiveRadiance *= emissiveColor.rgb;\n#endif\n",emissivemap_pars_fragment:"#ifdef USE_EMISSIVEMAP\n\tuniform sampler2D emissiveMap;\n#endif\n",encodings_fragment:"  gl_FragColor = linearToOutputTexel( gl_FragColor );\n",encodings_pars_fragment:"\nvec4 LinearToLinear( in vec4 value ) {\n\treturn value;\n}\nvec4 GammaToLinear( in vec4 value, in float gammaFactor ) {\n\treturn vec4( pow( value.xyz, vec3( gammaFactor ) ), value.w );\n}\nvec4 LinearToGamma( in vec4 value, in float gammaFactor ) {\n\treturn vec4( pow( value.xyz, vec3( 1.0 / gammaFactor ) ), value.w );\n}\nvec4 sRGBToLinear( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.w );\n}\nvec4 LinearTosRGB( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.w );\n}\nvec4 RGBEToLinear( in vec4 value ) {\n\treturn vec4( value.rgb * exp2( value.a * 255.0 - 128.0 ), 1.0 );\n}\nvec4 LinearToRGBE( in vec4 value ) {\n\tfloat maxComponent = max( max( value.r, value.g ), value.b );\n\tfloat fExp = clamp( ceil( log2( maxComponent ) ), -128.0, 127.0 );\n\treturn vec4( value.rgb / exp2( fExp ), ( fExp + 128.0 ) / 255.0 );\n}\nvec4 RGBMToLinear( in vec4 value, in float maxRange ) {\n\treturn vec4( value.xyz * value.w * maxRange, 1.0 );\n}\nvec4 LinearToRGBM( in vec4 value, in float maxRange ) {\n\tfloat maxRGB = max( value.x, max( value.g, value.b ) );\n\tfloat M      = clamp( maxRGB / maxRange, 0.0, 1.0 );\n\tM            = ceil( M * 255.0 ) / 255.0;\n\treturn vec4( value.rgb / ( M * maxRange ), M );\n}\nvec4 RGBDToLinear( in vec4 value, in float maxRange ) {\n\treturn vec4( value.rgb * ( ( maxRange / 255.0 ) / value.a ), 1.0 );\n}\nvec4 LinearToRGBD( in vec4 value, in float maxRange ) {\n\tfloat maxRGB = max( value.x, max( value.g, value.b ) );\n\tfloat D      = max( maxRange / maxRGB, 1.0 );\n\tD            = min( floor( D ) / 255.0, 1.0 );\n\treturn vec4( value.rgb * ( D * ( 255.0 / maxRange ) ), D );\n}\nconst mat3 cLogLuvM = mat3( 0.2209, 0.3390, 0.4184, 0.1138, 0.6780, 0.7319, 0.0102, 0.1130, 0.2969 );\nvec4 LinearToLogLuv( in vec4 value )  {\n\tvec3 Xp_Y_XYZp = value.rgb * cLogLuvM;\n\tXp_Y_XYZp = max(Xp_Y_XYZp, vec3(1e-6, 1e-6, 1e-6));\n\tvec4 vResult;\n\tvResult.xy = Xp_Y_XYZp.xy / Xp_Y_XYZp.z;\n\tfloat Le = 2.0 * log2(Xp_Y_XYZp.y) + 127.0;\n\tvResult.w = fract(Le);\n\tvResult.z = (Le - (floor(vResult.w*255.0))/255.0)/255.0;\n\treturn vResult;\n}\nconst mat3 cLogLuvInverseM = mat3( 6.0014, -2.7008, -1.7996, -1.3320, 3.1029, -5.7721, 0.3008, -1.0882, 5.6268 );\nvec4 LogLuvToLinear( in vec4 value ) {\n\tfloat Le = value.z * 255.0 + value.w;\n\tvec3 Xp_Y_XYZp;\n\tXp_Y_XYZp.y = exp2((Le - 127.0) / 2.0);\n\tXp_Y_XYZp.z = Xp_Y_XYZp.y / value.y;\n\tXp_Y_XYZp.x = value.x * Xp_Y_XYZp.z;\n\tvec3 vRGB = Xp_Y_XYZp.rgb * cLogLuvInverseM;\n\treturn vec4( max(vRGB, 0.0), 1.0 );\n}\n",envmap_fragment:"#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\t\tvec3 cameraToVertex = normalize( vWorldPosition - cameraPosition );\n\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#else\n\t\tvec3 reflectVec = vReflect;\n\t#endif\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\t#elif defined( ENVMAP_TYPE_EQUIREC )\n\t\tvec2 sampleUV;\n\t\treflectVec = normalize( reflectVec );\n\t\tsampleUV.y = asin( clamp( reflectVec.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\t\tsampleUV.x = atan( reflectVec.z, reflectVec.x ) * RECIPROCAL_PI2 + 0.5;\n\t\tvec4 envColor = texture2D( envMap, sampleUV );\n\t#elif defined( ENVMAP_TYPE_SPHERE )\n\t\treflectVec = normalize( reflectVec );\n\t\tvec3 reflectView = normalize( ( viewMatrix * vec4( reflectVec, 0.0 ) ).xyz + vec3( 0.0, 0.0, 1.0 ) );\n\t\tvec4 envColor = texture2D( envMap, reflectView.xy * 0.5 + 0.5 );\n\t#else\n\t\tvec4 envColor = vec4( 0.0 );\n\t#endif\n\tenvColor = envMapTexelToLinear( envColor );\n\t#ifdef ENVMAP_BLENDING_MULTIPLY\n\t\toutgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_MIX )\n\t\toutgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_ADD )\n\t\toutgoingLight += envColor.xyz * specularStrength * reflectivity;\n\t#endif\n#endif\n",envmap_pars_fragment:"#if defined( USE_ENVMAP ) || defined( PHYSICAL )\n\tuniform float reflectivity;\n\tuniform float envMapIntensity;\n#endif\n#ifdef USE_ENVMAP\n\t#if ! defined( PHYSICAL ) && ( defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) )\n\t\tvarying vec3 vWorldPosition;\n\t#endif\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tuniform samplerCube envMap;\n\t#else\n\t\tuniform sampler2D envMap;\n\t#endif\n\tuniform float flipEnvMap;\n\tuniform int maxMipLevel;\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( PHYSICAL )\n\t\tuniform float refractionRatio;\n\t#else\n\t\tvarying vec3 vReflect;\n\t#endif\n#endif\n",envmap_pars_vertex:"#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\t\tvarying vec3 vWorldPosition;\n\t#else\n\t\tvarying vec3 vReflect;\n\t\tuniform float refractionRatio;\n\t#endif\n#endif\n",envmap_vertex:"#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\t\tvWorldPosition = worldPosition.xyz;\n\t#else\n\t\tvec3 cameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n\t\tvec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvReflect = reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#endif\n#endif\n",fog_vertex:"\n#ifdef USE_FOG\nfogDepth = -mvPosition.z;\n#endif",fog_pars_vertex:"#ifdef USE_FOG\n  varying float fogDepth;\n#endif\n",fog_fragment:"#ifdef USE_FOG\n\t#ifdef FOG_EXP2\n\t\tfloat fogFactor = whiteCompliment( exp2( - fogDensity * fogDensity * fogDepth * fogDepth * LOG2 ) );\n\t#else\n\t\tfloat fogFactor = smoothstep( fogNear, fogFar, fogDepth );\n\t#endif\n\tgl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );\n#endif\n",fog_pars_fragment:"#ifdef USE_FOG\n\tuniform vec3 fogColor;\n\tvarying float fogDepth;\n\t#ifdef FOG_EXP2\n\t\tuniform float fogDensity;\n\t#else\n\t\tuniform float fogNear;\n\t\tuniform float fogFar;\n\t#endif\n#endif\n",gradientmap_pars_fragment:"#ifdef TOON\n\tuniform sampler2D gradientMap;\n\tvec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {\n\t\tfloat dotNL = dot( normal, lightDirection );\n\t\tvec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );\n\t\t#ifdef USE_GRADIENTMAP\n\t\t\treturn texture2D( gradientMap, coord ).rgb;\n\t\t#else\n\t\t\treturn ( coord.x < 0.7 ) ? vec3( 0.7 ) : vec3( 1.0 );\n\t\t#endif\n\t}\n#endif\n",lightmap_fragment:"#ifdef USE_LIGHTMAP\n\treflectedLight.indirectDiffuse += PI * texture2D( lightMap, vUv2 ).xyz * lightMapIntensity;\n#endif\n",lightmap_pars_fragment:"#ifdef USE_LIGHTMAP\n\tuniform sampler2D lightMap;\n\tuniform float lightMapIntensity;\n#endif",lights_lambert_vertex:"vec3 diffuse = vec3( 1.0 );\nGeometricContext geometry;\ngeometry.position = mvPosition.xyz;\ngeometry.normal = normalize( transformedNormal );\ngeometry.viewDir = normalize( -mvPosition.xyz );\nGeometricContext backGeometry;\nbackGeometry.position = geometry.position;\nbackGeometry.normal = -geometry.normal;\nbackGeometry.viewDir = geometry.viewDir;\nvLightFront = vec3( 0.0 );\n#ifdef DOUBLE_SIDED\n\tvLightBack = vec3( 0.0 );\n#endif\nIncidentLight directLight;\nfloat dotNL;\nvec3 directLightColor_Diffuse;\n#if NUM_POINT_LIGHTS > 0\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tgetPointDirectLightIrradiance( pointLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tgetSpotDirectLightIrradiance( spotLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n#endif\n#if NUM_DIR_LIGHTS > 0\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tgetDirectionalDirectLightIrradiance( directionalLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\tvLightFront += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += getHemisphereLightIrradiance( hemisphereLights[ i ], backGeometry );\n\t\t#endif\n\t}\n#endif\n",lights_pars_begin:"uniform vec3 ambientLightColor;\nvec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {\n\tvec3 irradiance = ambientLightColor;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\treturn irradiance;\n}\n#if NUM_DIR_LIGHTS > 0\n\tstruct DirectionalLight {\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tint shadow;\n\t\tfloat shadowBias;\n\t\tfloat shadowRadius;\n\t\tvec2 shadowMapSize;\n\t};\n\tuniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];\n\tvoid getDirectionalDirectLightIrradiance( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight directLight ) {\n\t\tdirectLight.color = directionalLight.color;\n\t\tdirectLight.direction = directionalLight.direction;\n\t\tdirectLight.visible = true;\n\t}\n#endif\n#if NUM_POINT_LIGHTS > 0\n\tstruct PointLight {\n\t\tvec3 position;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tint shadow;\n\t\tfloat shadowBias;\n\t\tfloat shadowRadius;\n\t\tvec2 shadowMapSize;\n\t\tfloat shadowCameraNear;\n\t\tfloat shadowCameraFar;\n\t};\n\tuniform PointLight pointLights[ NUM_POINT_LIGHTS ];\n\tvoid getPointDirectLightIrradiance( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight directLight ) {\n\t\tvec3 lVector = pointLight.position - geometry.position;\n\t\tdirectLight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tdirectLight.color = pointLight.color;\n\t\tdirectLight.color *= punctualLightIntensityToIrradianceFactor( lightDistance, pointLight.distance, pointLight.decay );\n\t\tdirectLight.visible = ( directLight.color != vec3( 0.0 ) );\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\tstruct SpotLight {\n\t\tvec3 position;\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tfloat coneCos;\n\t\tfloat penumbraCos;\n\t\tint shadow;\n\t\tfloat shadowBias;\n\t\tfloat shadowRadius;\n\t\tvec2 shadowMapSize;\n\t};\n\tuniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];\n\tvoid getSpotDirectLightIrradiance( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight directLight  ) {\n\t\tvec3 lVector = spotLight.position - geometry.position;\n\t\tdirectLight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tfloat angleCos = dot( directLight.direction, spotLight.direction );\n\t\tif ( angleCos > spotLight.coneCos ) {\n\t\t\tfloat spotEffect = smoothstep( spotLight.coneCos, spotLight.penumbraCos, angleCos );\n\t\t\tdirectLight.color = spotLight.color;\n\t\t\tdirectLight.color *= spotEffect * punctualLightIntensityToIrradianceFactor( lightDistance, spotLight.distance, spotLight.decay );\n\t\t\tdirectLight.visible = true;\n\t\t} else {\n\t\t\tdirectLight.color = vec3( 0.0 );\n\t\t\tdirectLight.visible = false;\n\t\t}\n\t}\n#endif\n#if NUM_RECT_AREA_LIGHTS > 0\n\tstruct RectAreaLight {\n\t\tvec3 color;\n\t\tvec3 position;\n\t\tvec3 halfWidth;\n\t\tvec3 halfHeight;\n\t};\n\tuniform sampler2D ltc_1;\tuniform sampler2D ltc_2;\n\tuniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\tstruct HemisphereLight {\n\t\tvec3 direction;\n\t\tvec3 skyColor;\n\t\tvec3 groundColor;\n\t};\n\tuniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];\n\tvec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in GeometricContext geometry ) {\n\t\tfloat dotNL = dot( geometry.normal, hemiLight.direction );\n\t\tfloat hemiDiffuseWeight = 0.5 * dotNL + 0.5;\n\t\tvec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tirradiance *= PI;\n\t\t#endif\n\t\treturn irradiance;\n\t}\n#endif\n",lights_pars_maps:"#if defined( USE_ENVMAP ) && defined( PHYSICAL )\n\tvec3 getLightProbeIndirectIrradiance( const in GeometricContext geometry, const in int maxMIPLevel ) {\n\t\tvec3 worldNormal = inverseTransformDirection( geometry.normal, viewMatrix );\n\t\t#ifdef ENVMAP_TYPE_CUBE\n\t\t\tvec3 queryVec = vec3( flipEnvMap * worldNormal.x, worldNormal.yz );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = textureCubeLodEXT( envMap, queryVec, float( maxMIPLevel ) );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = textureCube( envMap, queryVec, float( maxMIPLevel ) );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec3 queryVec = vec3( flipEnvMap * worldNormal.x, worldNormal.yz );\n\t\t\tvec4 envMapColor = textureCubeUV( queryVec, 1.0 );\n\t\t#else\n\t\t\tvec4 envMapColor = vec4( 0.0 );\n\t\t#endif\n\t\treturn PI * envMapColor.rgb * envMapIntensity;\n\t}\n\tfloat getSpecularMIPLevel( const in float blinnShininessExponent, const in int maxMIPLevel ) {\n\t\tfloat maxMIPLevelScalar = float( maxMIPLevel );\n\t\tfloat desiredMIPLevel = maxMIPLevelScalar + 0.79248 - 0.5 * log2( pow2( blinnShininessExponent ) + 1.0 );\n\t\treturn clamp( desiredMIPLevel, 0.0, maxMIPLevelScalar );\n\t}\n\tvec3 getLightProbeIndirectRadiance( const in GeometricContext geometry, const in float blinnShininessExponent, const in int maxMIPLevel ) {\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( -geometry.viewDir, geometry.normal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( -geometry.viewDir, geometry.normal, refractionRatio );\n\t\t#endif\n\t\treflectVec = inverseTransformDirection( reflectVec, viewMatrix );\n\t\tfloat specularMIPLevel = getSpecularMIPLevel( blinnShininessExponent, maxMIPLevel );\n\t\t#ifdef ENVMAP_TYPE_CUBE\n\t\t\tvec3 queryReflectVec = vec3( flipEnvMap * reflectVec.x, reflectVec.yz );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = textureCubeLodEXT( envMap, queryReflectVec, specularMIPLevel );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = textureCube( envMap, queryReflectVec, specularMIPLevel );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec3 queryReflectVec = vec3( flipEnvMap * reflectVec.x, reflectVec.yz );\n\t\t\tvec4 envMapColor = textureCubeUV(queryReflectVec, BlinnExponentToGGXRoughness(blinnShininessExponent));\n\t\t#elif defined( ENVMAP_TYPE_EQUIREC )\n\t\t\tvec2 sampleUV;\n\t\t\tsampleUV.y = asin( clamp( reflectVec.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\t\t\tsampleUV.x = atan( reflectVec.z, reflectVec.x ) * RECIPROCAL_PI2 + 0.5;\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = texture2DLodEXT( envMap, sampleUV, specularMIPLevel );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = texture2D( envMap, sampleUV, specularMIPLevel );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#elif defined( ENVMAP_TYPE_SPHERE )\n\t\t\tvec3 reflectView = normalize( ( viewMatrix * vec4( reflectVec, 0.0 ) ).xyz + vec3( 0.0,0.0,1.0 ) );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = texture2DLodEXT( envMap, reflectView.xy * 0.5 + 0.5, specularMIPLevel );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = texture2D( envMap, reflectView.xy * 0.5 + 0.5, specularMIPLevel );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#endif\n\t\treturn envMapColor.rgb * envMapIntensity;\n\t}\n#endif\n",lights_phong_fragment:"BlinnPhongMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularColor = specular;\nmaterial.specularShininess = shininess;\nmaterial.specularStrength = specularStrength;\n",lights_phong_pars_fragment:"varying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\nstruct BlinnPhongMaterial {\n\tvec3\tdiffuseColor;\n\tvec3\tspecularColor;\n\tfloat\tspecularShininess;\n\tfloat\tspecularStrength;\n};\nvoid RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\t#ifdef TOON\n\t\tvec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;\n\t#else\n\t\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\t\tvec3 irradiance = dotNL * directLight.color;\n\t#endif\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\treflectedLight.directDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n\treflectedLight.directSpecular += irradiance * BRDF_Specular_BlinnPhong( directLight, geometry, material.specularColor, material.specularShininess ) * material.specularStrength;\n}\nvoid RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_BlinnPhong\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_BlinnPhong\n#define Material_LightProbeLOD( material )\t(0)\n",lights_physical_fragment:"PhysicalMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );\nmaterial.specularRoughness = clamp( roughnessFactor, 0.04, 1.0 );\n#ifdef STANDARD\n\tmaterial.specularColor = mix( vec3( DEFAULT_SPECULAR_COEFFICIENT ), diffuseColor.rgb, metalnessFactor );\n#else\n\tmaterial.specularColor = mix( vec3( MAXIMUM_SPECULAR_COEFFICIENT * pow2( reflectivity ) ), diffuseColor.rgb, metalnessFactor );\n\tmaterial.clearCoat = saturate( clearCoat );\tmaterial.clearCoatRoughness = clamp( clearCoatRoughness, 0.04, 1.0 );\n#endif\n",lights_physical_pars_fragment:"struct PhysicalMaterial {\n\tvec3\tdiffuseColor;\n\tfloat\tspecularRoughness;\n\tvec3\tspecularColor;\n\t#ifndef STANDARD\n\t\tfloat clearCoat;\n\t\tfloat clearCoatRoughness;\n\t#endif\n};\n#define MAXIMUM_SPECULAR_COEFFICIENT 0.16\n#define DEFAULT_SPECULAR_COEFFICIENT 0.04\nfloat clearCoatDHRApprox( const in float roughness, const in float dotNL ) {\n\treturn DEFAULT_SPECULAR_COEFFICIENT + ( 1.0 - DEFAULT_SPECULAR_COEFFICIENT ) * ( pow( 1.0 - dotNL, 5.0 ) * pow( 1.0 - roughness, 2.0 ) );\n}\n#if NUM_RECT_AREA_LIGHTS > 0\n\tvoid RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\t\tvec3 normal = geometry.normal;\n\t\tvec3 viewDir = geometry.viewDir;\n\t\tvec3 position = geometry.position;\n\t\tvec3 lightPos = rectAreaLight.position;\n\t\tvec3 halfWidth = rectAreaLight.halfWidth;\n\t\tvec3 halfHeight = rectAreaLight.halfHeight;\n\t\tvec3 lightColor = rectAreaLight.color;\n\t\tfloat roughness = material.specularRoughness;\n\t\tvec3 rectCoords[ 4 ];\n\t\trectCoords[ 0 ] = lightPos - halfWidth - halfHeight;\t\trectCoords[ 1 ] = lightPos + halfWidth - halfHeight;\n\t\trectCoords[ 2 ] = lightPos + halfWidth + halfHeight;\n\t\trectCoords[ 3 ] = lightPos - halfWidth + halfHeight;\n\t\tvec2 uv = LTC_Uv( normal, viewDir, roughness );\n\t\tvec4 t1 = texture2D( ltc_1, uv );\n\t\tvec4 t2 = texture2D( ltc_2, uv );\n\t\tmat3 mInv = mat3(\n\t\t\tvec3( t1.x, 0, t1.y ),\n\t\t\tvec3(    0, 1,    0 ),\n\t\t\tvec3( t1.z, 0, t1.w )\n\t\t);\n\t\tvec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );\n\t\treflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );\n\t\treflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );\n\t}\n#endif\nvoid RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\t#ifndef STANDARD\n\t\tfloat clearCoatDHR = material.clearCoat * clearCoatDHRApprox( material.clearCoatRoughness, dotNL );\n\t#else\n\t\tfloat clearCoatDHR = 0.0;\n\t#endif\n\treflectedLight.directSpecular += ( 1.0 - clearCoatDHR ) * irradiance * BRDF_Specular_GGX( directLight, geometry, material.specularColor, material.specularRoughness );\n\treflectedLight.directDiffuse += ( 1.0 - clearCoatDHR ) * irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n\t#ifndef STANDARD\n\t\treflectedLight.directSpecular += irradiance * material.clearCoat * BRDF_Specular_GGX( directLight, geometry, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearCoatRoughness );\n\t#endif\n}\nvoid RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 clearCoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\t#ifndef STANDARD\n\t\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\t\tfloat dotNL = dotNV;\n\t\tfloat clearCoatDHR = material.clearCoat * clearCoatDHRApprox( material.clearCoatRoughness, dotNL );\n\t#else\n\t\tfloat clearCoatDHR = 0.0;\n\t#endif\n\treflectedLight.indirectSpecular += ( 1.0 - clearCoatDHR ) * radiance * BRDF_Specular_GGX_Environment( geometry, material.specularColor, material.specularRoughness );\n\t#ifndef STANDARD\n\t\treflectedLight.indirectSpecular += clearCoatRadiance * material.clearCoat * BRDF_Specular_GGX_Environment( geometry, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearCoatRoughness );\n\t#endif\n}\n#define RE_Direct\t\t\t\tRE_Direct_Physical\n#define RE_Direct_RectArea\t\tRE_Direct_RectArea_Physical\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Physical\n#define RE_IndirectSpecular\t\tRE_IndirectSpecular_Physical\n#define Material_BlinnShininessExponent( material )   GGXRoughnessToBlinnExponent( material.specularRoughness )\n#define Material_ClearCoat_BlinnShininessExponent( material )   GGXRoughnessToBlinnExponent( material.clearCoatRoughness )\nfloat computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {\n\treturn saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );\n}\n",lights_fragment_begin:"\nGeometricContext geometry;\ngeometry.position = - vViewPosition;\ngeometry.normal = normal;\ngeometry.viewDir = normalize( vViewPosition );\nIncidentLight directLight;\n#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )\n\tPointLight pointLight;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tgetPointDirectLightIrradiance( pointLight, geometry, directLight );\n\t\t#ifdef USE_SHADOWMAP\n\t\tdirectLight.color *= all( bvec2( pointLight.shadow, directLight.visible ) ) ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n#endif\n#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )\n\tSpotLight spotLight;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tgetSpotDirectLightIrradiance( spotLight, geometry, directLight );\n\t\t#ifdef USE_SHADOWMAP\n\t\tdirectLight.color *= all( bvec2( spotLight.shadow, directLight.visible ) ) ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n#endif\n#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )\n\tDirectionalLight directionalLight;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tgetDirectionalDirectLightIrradiance( directionalLight, geometry, directLight );\n\t\t#ifdef USE_SHADOWMAP\n\t\tdirectLight.color *= all( bvec2( directionalLight.shadow, directLight.visible ) ) ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n#endif\n#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )\n\tRectAreaLight rectAreaLight;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {\n\t\trectAreaLight = rectAreaLights[ i ];\n\t\tRE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );\n\t}\n#endif\n#if defined( RE_IndirectDiffuse )\n\tvec3 irradiance = getAmbientLightIrradiance( ambientLightColor );\n\t#if ( NUM_HEMI_LIGHTS > 0 )\n\t\t#pragma unroll_loop\n\t\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\t\tirradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );\n\t\t}\n\t#endif\n#endif\n#if defined( RE_IndirectSpecular )\n\tvec3 radiance = vec3( 0.0 );\n\tvec3 clearCoatRadiance = vec3( 0.0 );\n#endif\n",lights_fragment_maps:"#if defined( RE_IndirectDiffuse )\n\t#ifdef USE_LIGHTMAP\n\t\tvec3 lightMapIrradiance = texture2D( lightMap, vUv2 ).xyz * lightMapIntensity;\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tlightMapIrradiance *= PI;\n\t\t#endif\n\t\tirradiance += lightMapIrradiance;\n\t#endif\n\t#if defined( USE_ENVMAP ) && defined( PHYSICAL ) && defined( ENVMAP_TYPE_CUBE_UV )\n\t\tirradiance += getLightProbeIndirectIrradiance( geometry, maxMipLevel );\n\t#endif\n#endif\n#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )\n\tradiance += getLightProbeIndirectRadiance( geometry, Material_BlinnShininessExponent( material ), maxMipLevel );\n\t#ifndef STANDARD\n\t\tclearCoatRadiance += getLightProbeIndirectRadiance( geometry, Material_ClearCoat_BlinnShininessExponent( material ), maxMipLevel );\n\t#endif\n#endif\n",lights_fragment_end:"#if defined( RE_IndirectDiffuse )\n\tRE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );\n#endif\n#if defined( RE_IndirectSpecular )\n\tRE_IndirectSpecular( radiance, clearCoatRadiance, geometry, material, reflectedLight );\n#endif\n",logdepthbuf_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tgl_FragDepthEXT = log2( vFragDepth ) * logDepthBufFC * 0.5;\n#endif",logdepthbuf_pars_fragment:"#ifdef USE_LOGDEPTHBUF\n\tuniform float logDepthBufFC;\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvarying float vFragDepth;\n\t#endif\n#endif\n",logdepthbuf_pars_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvarying float vFragDepth;\n\t#endif\n\tuniform float logDepthBufFC;\n#endif",logdepthbuf_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvFragDepth = 1.0 + gl_Position.w;\n\t#else\n\t\tgl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;\n\t\tgl_Position.z *= gl_Position.w;\n\t#endif\n#endif\n",map_fragment:"#ifdef USE_MAP\n\tvec4 texelColor = texture2D( map, vUv );\n\ttexelColor = mapTexelToLinear( texelColor );\n\tdiffuseColor *= texelColor;\n#endif\n",map_pars_fragment:"#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif\n",map_particle_fragment:"#ifdef USE_MAP\n\tvec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;\n\tvec4 mapTexel = texture2D( map, uv );\n\tdiffuseColor *= mapTexelToLinear( mapTexel );\n#endif\n",map_particle_pars_fragment:"#ifdef USE_MAP\n\tuniform mat3 uvTransform;\n\tuniform sampler2D map;\n#endif\n",metalnessmap_fragment:"float metalnessFactor = metalness;\n#ifdef USE_METALNESSMAP\n\tvec4 texelMetalness = texture2D( metalnessMap, vUv );\n\tmetalnessFactor *= texelMetalness.b;\n#endif\n",metalnessmap_pars_fragment:"#ifdef USE_METALNESSMAP\n\tuniform sampler2D metalnessMap;\n#endif",morphnormal_vertex:"#ifdef USE_MORPHNORMALS\n\tobjectNormal += ( morphNormal0 - normal ) * morphTargetInfluences[ 0 ];\n\tobjectNormal += ( morphNormal1 - normal ) * morphTargetInfluences[ 1 ];\n\tobjectNormal += ( morphNormal2 - normal ) * morphTargetInfluences[ 2 ];\n\tobjectNormal += ( morphNormal3 - normal ) * morphTargetInfluences[ 3 ];\n#endif\n",morphtarget_pars_vertex:"#ifdef USE_MORPHTARGETS\n\t#ifndef USE_MORPHNORMALS\n\tuniform float morphTargetInfluences[ 8 ];\n\t#else\n\tuniform float morphTargetInfluences[ 4 ];\n\t#endif\n#endif",morphtarget_vertex:"#ifdef USE_MORPHTARGETS\n\ttransformed += ( morphTarget0 - position ) * morphTargetInfluences[ 0 ];\n\ttransformed += ( morphTarget1 - position ) * morphTargetInfluences[ 1 ];\n\ttransformed += ( morphTarget2 - position ) * morphTargetInfluences[ 2 ];\n\ttransformed += ( morphTarget3 - position ) * morphTargetInfluences[ 3 ];\n\t#ifndef USE_MORPHNORMALS\n\ttransformed += ( morphTarget4 - position ) * morphTargetInfluences[ 4 ];\n\ttransformed += ( morphTarget5 - position ) * morphTargetInfluences[ 5 ];\n\ttransformed += ( morphTarget6 - position ) * morphTargetInfluences[ 6 ];\n\ttransformed += ( morphTarget7 - position ) * morphTargetInfluences[ 7 ];\n\t#endif\n#endif\n",normal_fragment_begin:"#ifdef FLAT_SHADED\n\tvec3 fdx = vec3( dFdx( vViewPosition.x ), dFdx( vViewPosition.y ), dFdx( vViewPosition.z ) );\n\tvec3 fdy = vec3( dFdy( vViewPosition.x ), dFdy( vViewPosition.y ), dFdy( vViewPosition.z ) );\n\tvec3 normal = normalize( cross( fdx, fdy ) );\n#else\n\tvec3 normal = normalize( vNormal );\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t#endif\n#endif\n",normal_fragment_maps:"#ifdef USE_NORMALMAP\n\tnormal = perturbNormal2Arb( -vViewPosition, normal );\n#elif defined( USE_BUMPMAP )\n\tnormal = perturbNormalArb( -vViewPosition, normal, dHdxy_fwd() );\n#endif\n",normalmap_pars_fragment:"#ifdef USE_NORMALMAP\n\tuniform sampler2D normalMap;\n\tuniform vec2 normalScale;\n\tvec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm ) {\n\t\tvec3 q0 = vec3( dFdx( eye_pos.x ), dFdx( eye_pos.y ), dFdx( eye_pos.z ) );\n\t\tvec3 q1 = vec3( dFdy( eye_pos.x ), dFdy( eye_pos.y ), dFdy( eye_pos.z ) );\n\t\tvec2 st0 = dFdx( vUv.st );\n\t\tvec2 st1 = dFdy( vUv.st );\n\t\tvec3 S = normalize( q0 * st1.t - q1 * st0.t );\n\t\tvec3 T = normalize( -q0 * st1.s + q1 * st0.s );\n\t\tvec3 N = normalize( surf_norm );\n\t\tvec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\t\tmapN.xy = normalScale * mapN.xy;\n\t\tmat3 tsn = mat3( S, T, N );\n\t\treturn normalize( tsn * mapN );\n\t}\n#endif\n",packing:"vec3 packNormalToRGB( const in vec3 normal ) {\n\treturn normalize( normal ) * 0.5 + 0.5;\n}\nvec3 unpackRGBToNormal( const in vec3 rgb ) {\n\treturn 2.0 * rgb.xyz - 1.0;\n}\nconst float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;\nconst vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256.,  256. );\nconst vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );\nconst float ShiftRight8 = 1. / 256.;\nvec4 packDepthToRGBA( const in float v ) {\n\tvec4 r = vec4( fract( v * PackFactors ), v );\n\tr.yzw -= r.xyz * ShiftRight8;\treturn r * PackUpscale;\n}\nfloat unpackRGBAToDepth( const in vec4 v ) {\n\treturn dot( v, UnpackFactors );\n}\nfloat viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( viewZ + near ) / ( near - far );\n}\nfloat orthographicDepthToViewZ( const in float linearClipZ, const in float near, const in float far ) {\n\treturn linearClipZ * ( near - far ) - near;\n}\nfloat viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn (( near + viewZ ) * far ) / (( far - near ) * viewZ );\n}\nfloat perspectiveDepthToViewZ( const in float invClipZ, const in float near, const in float far ) {\n\treturn ( near * far ) / ( ( far - near ) * invClipZ - far );\n}\n",premultiplied_alpha_fragment:"#ifdef PREMULTIPLIED_ALPHA\n\tgl_FragColor.rgb *= gl_FragColor.a;\n#endif\n",project_vertex:"vec4 mvPosition = modelViewMatrix * vec4( transformed, 1.0 );\ngl_Position = projectionMatrix * mvPosition;\n",dithering_fragment:"#if defined( DITHERING )\n  gl_FragColor.rgb = dithering( gl_FragColor.rgb );\n#endif\n",dithering_pars_fragment:"#if defined( DITHERING )\n\tvec3 dithering( vec3 color ) {\n\t\tfloat grid_position = rand( gl_FragCoord.xy );\n\t\tvec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );\n\t\tdither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );\n\t\treturn color + dither_shift_RGB;\n\t}\n#endif\n",roughnessmap_fragment:"float roughnessFactor = roughness;\n#ifdef USE_ROUGHNESSMAP\n\tvec4 texelRoughness = texture2D( roughnessMap, vUv );\n\troughnessFactor *= texelRoughness.g;\n#endif\n",roughnessmap_pars_fragment:"#ifdef USE_ROUGHNESSMAP\n\tuniform sampler2D roughnessMap;\n#endif",shadowmap_pars_fragment:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHTS > 0\n\t\tuniform sampler2D directionalShadowMap[ NUM_DIR_LIGHTS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHTS ];\n\t#endif\n\t#if NUM_SPOT_LIGHTS > 0\n\t\tuniform sampler2D spotShadowMap[ NUM_SPOT_LIGHTS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHTS ];\n\t#endif\n\t#if NUM_POINT_LIGHTS > 0\n\t\tuniform sampler2D pointShadowMap[ NUM_POINT_LIGHTS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHTS ];\n\t#endif\n\tfloat texture2DCompare( sampler2D depths, vec2 uv, float compare ) {\n\t\treturn step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );\n\t}\n\tfloat texture2DShadowLerp( sampler2D depths, vec2 size, vec2 uv, float compare ) {\n\t\tconst vec2 offset = vec2( 0.0, 1.0 );\n\t\tvec2 texelSize = vec2( 1.0 ) / size;\n\t\tvec2 centroidUV = floor( uv * size + 0.5 ) / size;\n\t\tfloat lb = texture2DCompare( depths, centroidUV + texelSize * offset.xx, compare );\n\t\tfloat lt = texture2DCompare( depths, centroidUV + texelSize * offset.xy, compare );\n\t\tfloat rb = texture2DCompare( depths, centroidUV + texelSize * offset.yx, compare );\n\t\tfloat rt = texture2DCompare( depths, centroidUV + texelSize * offset.yy, compare );\n\t\tvec2 f = fract( uv * size + 0.5 );\n\t\tfloat a = mix( lb, lt, f.y );\n\t\tfloat b = mix( rb, rt, f.y );\n\t\tfloat c = mix( a, b, f.x );\n\t\treturn c;\n\t}\n\tfloat getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n\t\tfloat shadow = 1.0;\n\t\tshadowCoord.xyz /= shadowCoord.w;\n\t\tshadowCoord.z += shadowBias;\n\t\tbvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );\n\t\tbool inFrustum = all( inFrustumVec );\n\t\tbvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );\n\t\tbool frustumTest = all( frustumTestVec );\n\t\tif ( frustumTest ) {\n\t\t#if defined( SHADOWMAP_TYPE_PCF )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\tshadow = (\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#else\n\t\t\tshadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#endif\n\t\t}\n\t\treturn shadow;\n\t}\n\tvec2 cubeToUV( vec3 v, float texelSizeY ) {\n\t\tvec3 absV = abs( v );\n\t\tfloat scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );\n\t\tabsV *= scaleToCube;\n\t\tv *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );\n\t\tvec2 planar = v.xy;\n\t\tfloat almostATexel = 1.5 * texelSizeY;\n\t\tfloat almostOne = 1.0 - almostATexel;\n\t\tif ( absV.z >= almostOne ) {\n\t\t\tif ( v.z > 0.0 )\n\t\t\t\tplanar.x = 4.0 - v.x;\n\t\t} else if ( absV.x >= almostOne ) {\n\t\t\tfloat signX = sign( v.x );\n\t\t\tplanar.x = v.z * signX + 2.0 * signX;\n\t\t} else if ( absV.y >= almostOne ) {\n\t\t\tfloat signY = sign( v.y );\n\t\t\tplanar.x = v.x + 2.0 * signY + 2.0;\n\t\t\tplanar.y = v.z * signY - 2.0;\n\t\t}\n\t\treturn vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );\n\t}\n\tfloat getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {\n\t\tvec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );\n\t\tvec3 lightToPosition = shadowCoord.xyz;\n\t\tfloat dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );\t\tdp += shadowBias;\n\t\tvec3 bd3D = normalize( lightToPosition );\n\t\t#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\tvec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;\n\t\t\treturn (\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#else\n\t\t\treturn texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );\n\t\t#endif\n\t}\n#endif\n",shadowmap_pars_vertex:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHTS > 0\n\t\tuniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHTS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHTS ];\n\t#endif\n\t#if NUM_SPOT_LIGHTS > 0\n\t\tuniform mat4 spotShadowMatrix[ NUM_SPOT_LIGHTS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHTS ];\n\t#endif\n\t#if NUM_POINT_LIGHTS > 0\n\t\tuniform mat4 pointShadowMatrix[ NUM_POINT_LIGHTS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHTS ];\n\t#endif\n#endif\n",shadowmap_vertex:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHTS > 0\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tvDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * worldPosition;\n\t}\n\t#endif\n\t#if NUM_SPOT_LIGHTS > 0\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tvSpotShadowCoord[ i ] = spotShadowMatrix[ i ] * worldPosition;\n\t}\n\t#endif\n\t#if NUM_POINT_LIGHTS > 0\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tvPointShadowCoord[ i ] = pointShadowMatrix[ i ] * worldPosition;\n\t}\n\t#endif\n#endif\n",shadowmask_pars_fragment:"float getShadowMask() {\n\tfloat shadow = 1.0;\n\t#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHTS > 0\n\tDirectionalLight directionalLight;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tshadow *= bool( directionalLight.shadow ) ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t}\n\t#endif\n\t#if NUM_SPOT_LIGHTS > 0\n\tSpotLight spotLight;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tshadow *= bool( spotLight.shadow ) ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t}\n\t#endif\n\t#if NUM_POINT_LIGHTS > 0\n\tPointLight pointLight;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tshadow *= bool( pointLight.shadow ) ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n\t}\n\t#endif\n\t#endif\n\treturn shadow;\n}\n",skinbase_vertex:"#ifdef USE_SKINNING\n\tmat4 boneMatX = getBoneMatrix( skinIndex.x );\n\tmat4 boneMatY = getBoneMatrix( skinIndex.y );\n\tmat4 boneMatZ = getBoneMatrix( skinIndex.z );\n\tmat4 boneMatW = getBoneMatrix( skinIndex.w );\n#endif",skinning_pars_vertex:"#ifdef USE_SKINNING\n\tuniform mat4 bindMatrix;\n\tuniform mat4 bindMatrixInverse;\n\t#ifdef BONE_TEXTURE\n\t\tuniform sampler2D boneTexture;\n\t\tuniform int boneTextureSize;\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tfloat j = i * 4.0;\n\t\t\tfloat x = mod( j, float( boneTextureSize ) );\n\t\t\tfloat y = floor( j / float( boneTextureSize ) );\n\t\t\tfloat dx = 1.0 / float( boneTextureSize );\n\t\t\tfloat dy = 1.0 / float( boneTextureSize );\n\t\t\ty = dy * ( y + 0.5 );\n\t\t\tvec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );\n\t\t\tvec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );\n\t\t\tvec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );\n\t\t\tvec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );\n\t\t\tmat4 bone = mat4( v1, v2, v3, v4 );\n\t\t\treturn bone;\n\t\t}\n\t#else\n\t\tuniform mat4 boneMatrices[ MAX_BONES ];\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tmat4 bone = boneMatrices[ int(i) ];\n\t\t\treturn bone;\n\t\t}\n\t#endif\n#endif\n",skinning_vertex:"#ifdef USE_SKINNING\n\tvec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );\n\tvec4 skinned = vec4( 0.0 );\n\tskinned += boneMatX * skinVertex * skinWeight.x;\n\tskinned += boneMatY * skinVertex * skinWeight.y;\n\tskinned += boneMatZ * skinVertex * skinWeight.z;\n\tskinned += boneMatW * skinVertex * skinWeight.w;\n\ttransformed = ( bindMatrixInverse * skinned ).xyz;\n#endif\n",skinnormal_vertex:"#ifdef USE_SKINNING\n\tmat4 skinMatrix = mat4( 0.0 );\n\tskinMatrix += skinWeight.x * boneMatX;\n\tskinMatrix += skinWeight.y * boneMatY;\n\tskinMatrix += skinWeight.z * boneMatZ;\n\tskinMatrix += skinWeight.w * boneMatW;\n\tskinMatrix  = bindMatrixInverse * skinMatrix * bindMatrix;\n\tobjectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;\n#endif\n",specularmap_fragment:"float specularStrength;\n#ifdef USE_SPECULARMAP\n\tvec4 texelSpecular = texture2D( specularMap, vUv );\n\tspecularStrength = texelSpecular.r;\n#else\n\tspecularStrength = 1.0;\n#endif",specularmap_pars_fragment:"#ifdef USE_SPECULARMAP\n\tuniform sampler2D specularMap;\n#endif",tonemapping_fragment:"#if defined( TONE_MAPPING )\n  gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );\n#endif\n",tonemapping_pars_fragment:"#ifndef saturate\n\t#define saturate(a) clamp( a, 0.0, 1.0 )\n#endif\nuniform float toneMappingExposure;\nuniform float toneMappingWhitePoint;\nvec3 LinearToneMapping( vec3 color ) {\n\treturn toneMappingExposure * color;\n}\nvec3 ReinhardToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( color / ( vec3( 1.0 ) + color ) );\n}\n#define Uncharted2Helper( x ) max( ( ( x * ( 0.15 * x + 0.10 * 0.50 ) + 0.20 * 0.02 ) / ( x * ( 0.15 * x + 0.50 ) + 0.20 * 0.30 ) ) - 0.02 / 0.30, vec3( 0.0 ) )\nvec3 Uncharted2ToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( Uncharted2Helper( color ) / Uncharted2Helper( vec3( toneMappingWhitePoint ) ) );\n}\nvec3 OptimizedCineonToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\tcolor = max( vec3( 0.0 ), color - 0.004 );\n\treturn pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );\n}\n",uv_pars_fragment:"#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP ) || defined( USE_EMISSIVEMAP ) || defined( USE_ROUGHNESSMAP ) || defined( USE_METALNESSMAP )\n\tvarying vec2 vUv;\n#endif",uv_pars_vertex:"#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP ) || defined( USE_EMISSIVEMAP ) || defined( USE_ROUGHNESSMAP ) || defined( USE_METALNESSMAP )\n\tvarying vec2 vUv;\n\tuniform mat3 uvTransform;\n#endif\n",uv_vertex:"#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP ) || defined( USE_EMISSIVEMAP ) || defined( USE_ROUGHNESSMAP ) || defined( USE_METALNESSMAP )\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n#endif",uv2_pars_fragment:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvarying vec2 vUv2;\n#endif",uv2_pars_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tattribute vec2 uv2;\n\tvarying vec2 vUv2;\n#endif",uv2_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvUv2 = uv2;\n#endif",worldpos_vertex:"#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP )\n\tvec4 worldPosition = modelMatrix * vec4( transformed, 1.0 );\n#endif\n",cube_frag:"uniform samplerCube tCube;\nuniform float tFlip;\nuniform float opacity;\nvarying vec3 vWorldPosition;\nvoid main() {\n\tgl_FragColor = textureCube( tCube, vec3( tFlip * vWorldPosition.x, vWorldPosition.yz ) );\n\tgl_FragColor.a *= opacity;\n}\n",cube_vert:"varying vec3 vWorldPosition;\n#include <common>\nvoid main() {\n\tvWorldPosition = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}\n",depth_frag:"#if DEPTH_PACKING == 3200\n\tuniform float opacity;\n#endif\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#if DEPTH_PACKING == 3200\n\t\tdiffuseColor.a = opacity;\n\t#endif\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <logdepthbuf_fragment>\n\t#if DEPTH_PACKING == 3200\n\t\tgl_FragColor = vec4( vec3( 1.0 - gl_FragCoord.z ), opacity );\n\t#elif DEPTH_PACKING == 3201\n\t\tgl_FragColor = packDepthToRGBA( gl_FragCoord.z );\n\t#endif\n}\n",depth_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n}\n",distanceRGBA_frag:"#define DISTANCE\nuniform vec3 referencePosition;\nuniform float nearDistance;\nuniform float farDistance;\nvarying vec3 vWorldPosition;\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main () {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\tfloat dist = length( vWorldPosition - referencePosition );\n\tdist = ( dist - nearDistance ) / ( farDistance - nearDistance );\n\tdist = saturate( dist );\n\tgl_FragColor = packDepthToRGBA( dist );\n}\n",distanceRGBA_vert:"#define DISTANCE\nvarying vec3 vWorldPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\tvWorldPosition = worldPosition.xyz;\n}\n",equirect_frag:"uniform sampler2D tEquirect;\nvarying vec3 vWorldPosition;\n#include <common>\nvoid main() {\n\tvec3 direction = normalize( vWorldPosition );\n\tvec2 sampleUV;\n\tsampleUV.y = asin( clamp( direction.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\tsampleUV.x = atan( direction.z, direction.x ) * RECIPROCAL_PI2 + 0.5;\n\tgl_FragColor = texture2D( tEquirect, sampleUV );\n}\n",equirect_vert:"varying vec3 vWorldPosition;\n#include <common>\nvoid main() {\n\tvWorldPosition = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n}\n",linedashed_frag:"uniform vec3 diffuse;\nuniform float opacity;\nuniform float dashSize;\nuniform float totalSize;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tif ( mod( vLineDistance, totalSize ) > dashSize ) {\n\t\tdiscard;\n\t}\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <color_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <premultiplied_alpha_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}\n",linedashed_vert:"uniform float scale;\nattribute float lineDistance;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <color_vertex>\n\tvLineDistance = scale * lineDistance;\n\tvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\n\tgl_Position = projectionMatrix * mvPosition;\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}\n",meshbasic_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\t#ifdef USE_LIGHTMAP\n\t\treflectedLight.indirectDiffuse += texture2D( lightMap, vUv2 ).xyz * lightMapIntensity;\n\t#else\n\t\treflectedLight.indirectDiffuse += vec3( 1.0 );\n\t#endif\n\t#include <aomap_fragment>\n\treflectedLight.indirectDiffuse *= diffuseColor.rgb;\n\tvec3 outgoingLight = reflectedLight.indirectDiffuse;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <premultiplied_alpha_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}\n",meshbasic_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_ENVMAP\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <envmap_vertex>\n\t#include <fog_vertex>\n}\n",meshlambert_frag:"uniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\nvarying vec3 vLightFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n#endif\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <lights_pars_maps>\n#include <fog_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <emissivemap_fragment>\n\treflectedLight.indirectDiffuse = getAmbientLightIrradiance( ambientLightColor );\n\t#include <lightmap_fragment>\n\treflectedLight.indirectDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb );\n\t#ifdef DOUBLE_SIDED\n\t\treflectedLight.directDiffuse = ( gl_FrontFacing ) ? vLightFront : vLightBack;\n\t#else\n\t\treflectedLight.directDiffuse = vLightFront;\n\t#endif\n\treflectedLight.directDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb ) * getShadowMask();\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}\n",meshlambert_vert:"#define LAMBERT\nvarying vec3 vLightFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <lights_pars_maps>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <lights_lambert_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}\n",meshphong_frag:"#define PHONG\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_pars_fragment>\n#include <gradientmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <lights_pars_maps>\n#include <lights_phong_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_phong_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}\n",meshphong_vert:"#define PHONG\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}\n",meshphysical_frag:"#define PHYSICAL\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\n#ifndef STANDARD\n\tuniform float clearCoat;\n\tuniform float clearCoatRoughness;\n#endif\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <cube_uv_reflection_fragment>\n#include <lights_pars_begin>\n#include <lights_pars_maps>\n#include <lights_physical_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <roughnessmap_fragment>\n\t#include <metalnessmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_physical_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}\n",meshphysical_vert:"#define PHYSICAL\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}\n",normal_frag:"#define NORMAL\nuniform float opacity;\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <packing>\n#include <uv_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\nvoid main() {\n\t#include <logdepthbuf_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tgl_FragColor = vec4( packNormalToRGB( normal ), opacity );\n}\n",normal_vert:"#define NORMAL\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP )\n\tvViewPosition = - mvPosition.xyz;\n#endif\n}\n",points_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <color_pars_fragment>\n#include <map_particle_pars_fragment>\n#include <fog_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_particle_fragment>\n\t#include <color_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <premultiplied_alpha_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}\n",points_vert:"uniform float size;\nuniform float scale;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <color_vertex>\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\t#ifdef USE_SIZEATTENUATION\n\t\tgl_PointSize = size * ( scale / - mvPosition.z );\n\t#else\n\t\tgl_PointSize = size;\n\t#endif\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}\n",shadow_frag:"uniform vec3 color;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\nvoid main() {\n\tgl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );\n\t#include <fog_fragment>\n}\n",shadow_vert:"#include <fog_pars_vertex>\n#include <shadowmap_pars_vertex>\nvoid main() {\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}\n"},Dt={merge:function merge(e){for(var t={},r=0;r<e.length;r++){var n=this.clone(e[r]);for(var i in n)t[i]=n[i]}return t},clone:function clone(e){var t={};for(var r in e)for(var n in t[r]={},e[r]){var i=e[r][n];i&&(i.isColor||i.isMatrix3||i.isMatrix4||i.isVector2||i.isVector3||i.isVector4||i.isTexture)?t[r][n]=i.clone():Array.isArray(i)?t[r][n]=i.slice():t[r][n]=i}return t}},Ut={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};function Color(e,t,r){return void 0===t&&void 0===r?this.set(e):this.setRGB(e,t,r)}Object.assign(Color.prototype,{isColor:!0,r:1,g:1,b:1,set:function set(e){return e&&e.isColor?this.copy(e):"number"==typeof e?this.setHex(e):"string"==typeof e&&this.setStyle(e),this},setScalar:function setScalar(e){return this.r=e,this.g=e,this.b=e,this},setHex:function setHex(e){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(255&e)/255,this},setRGB:function setRGB(e,t,r){return this.r=e,this.g=t,this.b=r,this},setHSL:function(){function hue2rgb(e,t,r){return r<0&&(r+=1),r>1&&(r-=1),r<1/6?e+6*(t-e)*r:r<.5?t:r<2/3?e+6*(t-e)*(2/3-r):e}return function setHSL(e,t,r){if(e=At.euclideanModulo(e,1),t=At.clamp(t,0,1),r=At.clamp(r,0,1),0===t)this.r=this.g=this.b=r;else{var n=r<=.5?r*(1+t):r+t-r*t,i=2*r-n;this.r=hue2rgb(i,n,e+1/3),this.g=hue2rgb(i,n,e),this.b=hue2rgb(i,n,e-1/3)}return this}}(),setStyle:function setStyle(e){function handleAlpha(t){void 0!==t&&parseFloat(t)<1&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}var t;if(t=/^((?:rgb|hsl)a?)\(\s*([^\)]*)\)/.exec(e)){var r,n=t[1],i=t[2];switch(n){case"rgb":case"rgba":if(r=/^(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(i))return this.r=Math.min(255,parseInt(r[1],10))/255,this.g=Math.min(255,parseInt(r[2],10))/255,this.b=Math.min(255,parseInt(r[3],10))/255,handleAlpha(r[5]),this;if(r=/^(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(i))return this.r=Math.min(100,parseInt(r[1],10))/100,this.g=Math.min(100,parseInt(r[2],10))/100,this.b=Math.min(100,parseInt(r[3],10))/100,handleAlpha(r[5]),this;break;case"hsl":case"hsla":if(r=/^([0-9]*\.?[0-9]+)\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(i)){var o=parseFloat(r[1])/360,a=parseInt(r[2],10)/100,s=parseInt(r[3],10)/100;return handleAlpha(r[5]),this.setHSL(o,a,s)}}}else if(t=/^\#([A-Fa-f0-9]+)$/.exec(e)){var c,u=(c=t[1]).length;if(3===u)return this.r=parseInt(c.charAt(0)+c.charAt(0),16)/255,this.g=parseInt(c.charAt(1)+c.charAt(1),16)/255,this.b=parseInt(c.charAt(2)+c.charAt(2),16)/255,this;if(6===u)return this.r=parseInt(c.charAt(0)+c.charAt(1),16)/255,this.g=parseInt(c.charAt(2)+c.charAt(3),16)/255,this.b=parseInt(c.charAt(4)+c.charAt(5),16)/255,this}e&&e.length>0&&(void 0!==(c=Ut[e])?this.setHex(c):console.warn("THREE.Color: Unknown color "+e));return this},clone:function clone(){return new this.constructor(this.r,this.g,this.b)},copy:function copy(e){return this.r=e.r,this.g=e.g,this.b=e.b,this},copyGammaToLinear:function copyGammaToLinear(e,t){return void 0===t&&(t=2),this.r=Math.pow(e.r,t),this.g=Math.pow(e.g,t),this.b=Math.pow(e.b,t),this},copyLinearToGamma:function copyLinearToGamma(e,t){void 0===t&&(t=2);var r=t>0?1/t:1;return this.r=Math.pow(e.r,r),this.g=Math.pow(e.g,r),this.b=Math.pow(e.b,r),this},convertGammaToLinear:function convertGammaToLinear(){var e=this.r,t=this.g,r=this.b;return this.r=e*e,this.g=t*t,this.b=r*r,this},convertLinearToGamma:function convertLinearToGamma(){return this.r=Math.sqrt(this.r),this.g=Math.sqrt(this.g),this.b=Math.sqrt(this.b),this},getHex:function getHex(){return 255*this.r<<16^255*this.g<<8^255*this.b<<0},getHexString:function getHexString(){return("000000"+this.getHex().toString(16)).slice(-6)},getHSL:function getHSL(e){void 0===e&&(console.warn("THREE.Color: .getHSL() target is now required"),e={h:0,s:0,l:0});var t,r,n=this.r,i=this.g,o=this.b,a=Math.max(n,i,o),s=Math.min(n,i,o),c=(s+a)/2;if(s===a)t=0,r=0;else{var u=a-s;switch(r=c<=.5?u/(a+s):u/(2-a-s),a){case n:t=(i-o)/u+(i<o?6:0);break;case i:t=(o-n)/u+2;break;case o:t=(n-i)/u+4}t/=6}return e.h=t,e.s=r,e.l=c,e},getStyle:function getStyle(){return"rgb("+(255*this.r|0)+","+(255*this.g|0)+","+(255*this.b|0)+")"},offsetHSL:(Bt={},function(e,t,r){return this.getHSL(Bt),Bt.h+=e,Bt.s+=t,Bt.l+=r,this.setHSL(Bt.h,Bt.s,Bt.l),this}),add:function add(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this},addColors:function addColors(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this},addScalar:function addScalar(e){return this.r+=e,this.g+=e,this.b+=e,this},sub:function sub(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this},multiply:function multiply(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this},multiplyScalar:function multiplyScalar(e){return this.r*=e,this.g*=e,this.b*=e,this},lerp:function lerp(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this},equals:function equals(e){return e.r===this.r&&e.g===this.g&&e.b===this.b},fromArray:function fromArray(e,t){return void 0===t&&(t=0),this.r=e[t],this.g=e[t+1],this.b=e[t+2],this},toArray:function toArray(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e},toJSON:function toJSON(){return this.getHex()}});var Gt,zt={common:{diffuse:{value:new Color(15658734)},opacity:{value:1},map:{value:null},uvTransform:{value:new Matrix3},alphaMap:{value:null}},specularmap:{specularMap:{value:null}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},refractionRatio:{value:.98},maxMipLevel:{value:0}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1}},emissivemap:{emissiveMap:{value:null}},bumpmap:{bumpMap:{value:null},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalScale:{value:new Vector2(1,1)}},displacementmap:{displacementMap:{value:null},displacementScale:{value:1},displacementBias:{value:0}},roughnessmap:{roughnessMap:{value:null}},metalnessmap:{metalnessMap:{value:null}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new Color(16777215)}},lights:{ambientLightColor:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{},shadow:{},shadowBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{},shadow:{},shadowBias:{},shadowRadius:{},shadowMapSize:{}}},spotShadowMap:{value:[]},spotShadowMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{},shadow:{},shadowBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}}},points:{diffuse:{value:new Color(15658734)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},uvTransform:{value:new Matrix3}}},Ht={basic:{uniforms:Dt.merge([zt.common,zt.specularmap,zt.envmap,zt.aomap,zt.lightmap,zt.fog]),vertexShader:Vt.meshbasic_vert,fragmentShader:Vt.meshbasic_frag},lambert:{uniforms:Dt.merge([zt.common,zt.specularmap,zt.envmap,zt.aomap,zt.lightmap,zt.emissivemap,zt.fog,zt.lights,{emissive:{value:new Color(0)}}]),vertexShader:Vt.meshlambert_vert,fragmentShader:Vt.meshlambert_frag},phong:{uniforms:Dt.merge([zt.common,zt.specularmap,zt.envmap,zt.aomap,zt.lightmap,zt.emissivemap,zt.bumpmap,zt.normalmap,zt.displacementmap,zt.gradientmap,zt.fog,zt.lights,{emissive:{value:new Color(0)},specular:{value:new Color(1118481)},shininess:{value:30}}]),vertexShader:Vt.meshphong_vert,fragmentShader:Vt.meshphong_frag},standard:{uniforms:Dt.merge([zt.common,zt.envmap,zt.aomap,zt.lightmap,zt.emissivemap,zt.bumpmap,zt.normalmap,zt.displacementmap,zt.roughnessmap,zt.metalnessmap,zt.fog,zt.lights,{emissive:{value:new Color(0)},roughness:{value:.5},metalness:{value:.5},envMapIntensity:{value:1}}]),vertexShader:Vt.meshphysical_vert,fragmentShader:Vt.meshphysical_frag},points:{uniforms:Dt.merge([zt.points,zt.fog]),vertexShader:Vt.points_vert,fragmentShader:Vt.points_frag},dashed:{uniforms:Dt.merge([zt.common,zt.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:Vt.linedashed_vert,fragmentShader:Vt.linedashed_frag},depth:{uniforms:Dt.merge([zt.common,zt.displacementmap]),vertexShader:Vt.depth_vert,fragmentShader:Vt.depth_frag},normal:{uniforms:Dt.merge([zt.common,zt.bumpmap,zt.normalmap,zt.displacementmap,{opacity:{value:1}}]),vertexShader:Vt.normal_vert,fragmentShader:Vt.normal_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:Vt.cube_vert,fragmentShader:Vt.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:Vt.equirect_vert,fragmentShader:Vt.equirect_frag},distanceRGBA:{uniforms:Dt.merge([zt.common,zt.displacementmap,{referencePosition:{value:new Vector3},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:Vt.distanceRGBA_vert,fragmentShader:Vt.distanceRGBA_frag},shadow:{uniforms:Dt.merge([zt.lights,zt.fog,{color:{value:new Color(0)},opacity:{value:1}}]),vertexShader:Vt.shadow_vert,fragmentShader:Vt.shadow_frag}};function WebGLAttributes(e){var t=new WeakMap;return{get:function get(e){return e.isInterleavedBufferAttribute&&(e=e.data),t.get(e)},remove:function remove(r){r.isInterleavedBufferAttribute&&(r=r.data);var n=t.get(r);n&&(e.deleteBuffer(n.buffer),t.delete(r))},update:function update(r,n){r.isInterleavedBufferAttribute&&(r=r.data);var i=t.get(r);void 0===i?t.set(r,function createBuffer(t,r){var n=t.array,i=t.dynamic?e.DYNAMIC_DRAW:e.STATIC_DRAW,o=e.createBuffer();e.bindBuffer(r,o),e.bufferData(r,n,i),t.onUploadCallback();var a=e.FLOAT;return n instanceof Float32Array?a=e.FLOAT:n instanceof Float64Array?console.warn("THREE.WebGLAttributes: Unsupported data buffer format: Float64Array."):n instanceof Uint16Array?a=e.UNSIGNED_SHORT:n instanceof Int16Array?a=e.SHORT:n instanceof Uint32Array?a=e.UNSIGNED_INT:n instanceof Int32Array?a=e.INT:n instanceof Int8Array?a=e.BYTE:n instanceof Uint8Array&&(a=e.UNSIGNED_BYTE),{buffer:o,type:a,bytesPerElement:n.BYTES_PER_ELEMENT,version:t.version}}(r,n)):i.version<r.version&&(function updateBuffer(t,r,n){var i=r.array,o=r.updateRange;e.bindBuffer(n,t),!1===r.dynamic?e.bufferData(n,i,e.STATIC_DRAW):-1===o.count?e.bufferSubData(n,0,i):0===o.count?console.error("THREE.WebGLObjects.updateBuffer: dynamic THREE.BufferAttribute marked as needsUpdate but updateRange.count is 0, ensure you are using set methods or updating manually."):(e.bufferSubData(n,o.offset*i.BYTES_PER_ELEMENT,i.subarray(o.offset,o.offset+o.count)),o.count=-1)}(i.buffer,r,n),i.version=r.version)}}}function Euler(e,t,r,n){this._x=e||0,this._y=t||0,this._z=r||0,this._order=n||Euler.DefaultOrder}function Layers(){this.mask=1}Ht.physical={uniforms:Dt.merge([Ht.standard.uniforms,{clearCoat:{value:0},clearCoatRoughness:{value:0}}]),vertexShader:Vt.meshphysical_vert,fragmentShader:Vt.meshphysical_frag},Euler.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"],Euler.DefaultOrder="XYZ",Object.defineProperties(Euler.prototype,{x:{get:function get(){return this._x},set:function set(e){this._x=e,this.onChangeCallback()}},y:{get:function get(){return this._y},set:function set(e){this._y=e,this.onChangeCallback()}},z:{get:function get(){return this._z},set:function set(e){this._z=e,this.onChangeCallback()}},order:{get:function get(){return this._order},set:function set(e){this._order=e,this.onChangeCallback()}}}),Object.assign(Euler.prototype,{isEuler:!0,set:function set(e,t,r,n){return this._x=e,this._y=t,this._z=r,this._order=n||this._order,this.onChangeCallback(),this},clone:function clone(){return new this.constructor(this._x,this._y,this._z,this._order)},copy:function copy(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this.onChangeCallback(),this},setFromRotationMatrix:function setFromRotationMatrix(e,t,r){var n=At.clamp,i=e.elements,o=i[0],a=i[4],s=i[8],c=i[1],u=i[5],l=i[9],h=i[2],p=i[6],f=i[10];return"XYZ"===(t=t||this._order)?(this._y=Math.asin(n(s,-1,1)),Math.abs(s)<.99999?(this._x=Math.atan2(-l,f),this._z=Math.atan2(-a,o)):(this._x=Math.atan2(p,u),this._z=0)):"YXZ"===t?(this._x=Math.asin(-n(l,-1,1)),Math.abs(l)<.99999?(this._y=Math.atan2(s,f),this._z=Math.atan2(c,u)):(this._y=Math.atan2(-h,o),this._z=0)):"ZXY"===t?(this._x=Math.asin(n(p,-1,1)),Math.abs(p)<.99999?(this._y=Math.atan2(-h,f),this._z=Math.atan2(-a,u)):(this._y=0,this._z=Math.atan2(c,o))):"ZYX"===t?(this._y=Math.asin(-n(h,-1,1)),Math.abs(h)<.99999?(this._x=Math.atan2(p,f),this._z=Math.atan2(c,o)):(this._x=0,this._z=Math.atan2(-a,u))):"YZX"===t?(this._z=Math.asin(n(c,-1,1)),Math.abs(c)<.99999?(this._x=Math.atan2(-l,u),this._y=Math.atan2(-h,o)):(this._x=0,this._y=Math.atan2(s,f))):"XZY"===t?(this._z=Math.asin(-n(a,-1,1)),Math.abs(a)<.99999?(this._x=Math.atan2(p,u),this._y=Math.atan2(s,o)):(this._x=Math.atan2(-l,f),this._y=0)):console.warn("THREE.Euler: .setFromRotationMatrix() given unsupported order: "+t),this._order=t,!1!==r&&this.onChangeCallback(),this},setFromQuaternion:function(){var e=new Matrix4;return function setFromQuaternion(t,r,n){return e.makeRotationFromQuaternion(t),this.setFromRotationMatrix(e,r,n)}}(),setFromVector3:function setFromVector3(e,t){return this.set(e.x,e.y,e.z,t||this._order)},reorder:(Gt=new Quaternion,function reorder(e){return Gt.setFromEuler(this),this.setFromQuaternion(Gt,e)}),equals:function equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order},fromArray:function fromArray(e){return this._x=e[0],this._y=e[1],this._z=e[2],void 0!==e[3]&&(this._order=e[3]),this.onChangeCallback(),this},toArray:function toArray(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._order,e},toVector3:function toVector3(e){return e?e.set(this._x,this._y,this._z):new Vector3(this._x,this._y,this._z)},onChange:function onChange(e){return this.onChangeCallback=e,this},onChangeCallback:function onChangeCallback(){}}),Object.assign(Layers.prototype,{set:function set(e){this.mask=1<<e|0},enable:function enable(e){this.mask|=1<<e|0},toggle:function toggle(e){this.mask^=1<<e|0},disable:function disable(e){this.mask&=~(1<<e|0)},test:function test(e){return 0!=(this.mask&e.mask)}});var Wt,qt,Xt,Yt,Jt=0;function Object3D(){Object.defineProperty(this,"id",{value:Jt++}),this.uuid=At.generateUUID(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=Object3D.DefaultUp.clone();var e=new Vector3,t=new Euler,r=new Quaternion,n=new Vector3(1,1,1);t.onChange(function onRotationChange(){r.setFromEuler(t,!1)}),r.onChange(function onQuaternionChange(){t.setFromQuaternion(r,void 0,!1)}),Object.defineProperties(this,{position:{enumerable:!0,value:e},rotation:{enumerable:!0,value:t},quaternion:{enumerable:!0,value:r},scale:{enumerable:!0,value:n},modelViewMatrix:{value:new Matrix4},normalMatrix:{value:new Matrix3}}),this.matrix=new Matrix4,this.matrixWorld=new Matrix4,this.matrixAutoUpdate=Object3D.DefaultMatrixAutoUpdate,this.matrixWorldNeedsUpdate=!1,this.layers=new Layers,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.userData={}}function Camera(){Object3D.call(this),this.type="Camera",this.matrixWorldInverse=new Matrix4,this.projectionMatrix=new Matrix4}function OrthographicCamera(e,t,r,n,i,o){Camera.call(this),this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=e,this.right=t,this.top=r,this.bottom=n,this.near=void 0!==i?i:.1,this.far=void 0!==o?o:2e3,this.updateProjectionMatrix()}function Face3(e,t,r,n,i,o){this.a=e,this.b=t,this.c=r,this.normal=n&&n.isVector3?n:new Vector3,this.vertexNormals=Array.isArray(n)?n:[],this.color=i&&i.isColor?i:new Color,this.vertexColors=Array.isArray(i)?i:[],this.materialIndex=void 0!==o?o:0}Object3D.DefaultUp=new Vector3(0,1,0),Object3D.DefaultMatrixAutoUpdate=!0,Object3D.prototype=Object.assign(Object.create(EventDispatcher.prototype),{constructor:Object3D,isObject3D:!0,onBeforeRender:function onBeforeRender(){},onAfterRender:function onAfterRender(){},applyMatrix:function applyMatrix(e){this.matrix.multiplyMatrices(e,this.matrix),this.matrix.decompose(this.position,this.quaternion,this.scale)},applyQuaternion:function applyQuaternion(e){return this.quaternion.premultiply(e),this},setRotationFromAxisAngle:function setRotationFromAxisAngle(e,t){this.quaternion.setFromAxisAngle(e,t)},setRotationFromEuler:function setRotationFromEuler(e){this.quaternion.setFromEuler(e,!0)},setRotationFromMatrix:function setRotationFromMatrix(e){this.quaternion.setFromRotationMatrix(e)},setRotationFromQuaternion:function setRotationFromQuaternion(e){this.quaternion.copy(e)},rotateOnAxis:(Yt=new Quaternion,function rotateOnAxis(e,t){return Yt.setFromAxisAngle(e,t),this.quaternion.multiply(Yt),this}),rotateOnWorldAxis:function(){var e=new Quaternion;return function rotateOnWorldAxis(t,r){return e.setFromAxisAngle(t,r),this.quaternion.premultiply(e),this}}(),rotateX:function(){var e=new Vector3(1,0,0);return function rotateX(t){return this.rotateOnAxis(e,t)}}(),rotateY:function(){var e=new Vector3(0,1,0);return function rotateY(t){return this.rotateOnAxis(e,t)}}(),rotateZ:function(){var e=new Vector3(0,0,1);return function rotateZ(t){return this.rotateOnAxis(e,t)}}(),translateOnAxis:function(){var e=new Vector3;return function translateOnAxis(t,r){return e.copy(t).applyQuaternion(this.quaternion),this.position.add(e.multiplyScalar(r)),this}}(),translateX:function(){var e=new Vector3(1,0,0);return function translateX(t){return this.translateOnAxis(e,t)}}(),translateY:function(){var e=new Vector3(0,1,0);return function translateY(t){return this.translateOnAxis(e,t)}}(),translateZ:function(){var e=new Vector3(0,0,1);return function translateZ(t){return this.translateOnAxis(e,t)}}(),localToWorld:function localToWorld(e){return e.applyMatrix4(this.matrixWorld)},worldToLocal:(Xt=new Matrix4,function worldToLocal(e){return e.applyMatrix4(Xt.getInverse(this.matrixWorld))}),lookAt:function(){var e=new Matrix4,t=new Vector3;return function lookAt(r,n,i){r.isVector3?t.copy(r):t.set(r,n,i),this.isCamera?e.lookAt(this.position,t,this.up):e.lookAt(t,this.position,this.up),this.quaternion.setFromRotationMatrix(e)}}(),add:function add(e){if(arguments.length>1){for(var t=0;t<arguments.length;t++)this.add(arguments[t]);return this}return e===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",e),this):(e&&e.isObject3D?(null!==e.parent&&e.parent.remove(e),e.parent=this,e.dispatchEvent({type:"added"}),this.children.push(e)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e),this)},remove:function remove(e){if(arguments.length>1){for(var t=0;t<arguments.length;t++)this.remove(arguments[t]);return this}var r=this.children.indexOf(e);return-1!==r&&(e.parent=null,e.dispatchEvent({type:"removed"}),this.children.splice(r,1)),this},getObjectById:function getObjectById(e){return this.getObjectByProperty("id",e)},getObjectByName:function getObjectByName(e){return this.getObjectByProperty("name",e)},getObjectByProperty:function getObjectByProperty(e,t){if(this[e]===t)return this;for(var r=0,n=this.children.length;r<n;r++){var i=this.children[r].getObjectByProperty(e,t);if(void 0!==i)return i}},getWorldPosition:function getWorldPosition(e){return void 0===e&&(console.warn("THREE.Object3D: .getWorldPosition() target is now required"),e=new Vector3),this.updateMatrixWorld(!0),e.setFromMatrixPosition(this.matrixWorld)},getWorldQuaternion:(Wt=new Vector3,qt=new Vector3,function getWorldQuaternion(e){return void 0===e&&(console.warn("THREE.Object3D: .getWorldQuaternion() target is now required"),e=new Quaternion),this.updateMatrixWorld(!0),this.matrixWorld.decompose(Wt,e,qt),e}),getWorldScale:function(){var e=new Vector3,t=new Quaternion;return function getWorldScale(r){return void 0===r&&(console.warn("THREE.Object3D: .getWorldScale() target is now required"),r=new Vector3),this.updateMatrixWorld(!0),this.matrixWorld.decompose(e,t,r),r}}(),getWorldDirection:function(){var e=new Quaternion;return function getWorldDirection(t){return void 0===t&&(console.warn("THREE.Object3D: .getWorldDirection() target is now required"),t=new Vector3),this.getWorldQuaternion(e),t.set(0,0,1).applyQuaternion(e)}}(),raycast:function raycast(){},traverse:function traverse(e){e(this);for(var t=this.children,r=0,n=t.length;r<n;r++)t[r].traverse(e)},traverseVisible:function traverseVisible(e){if(!1!==this.visible){e(this);for(var t=this.children,r=0,n=t.length;r<n;r++)t[r].traverseVisible(e)}},traverseAncestors:function traverseAncestors(e){var t=this.parent;null!==t&&(e(t),t.traverseAncestors(e))},updateMatrix:function updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0},updateMatrixWorld:function updateMatrixWorld(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0);for(var t=this.children,r=0,n=t.length;r<n;r++)t[r].updateMatrixWorld(e)},toJSON:function toJSON(e){var t=void 0===e||"string"==typeof e,r={};t&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{}},r.metadata={version:4.5,type:"Object",generator:"Object3D.toJSON"});var n={};function serialize(t,r){return void 0===t[r.uuid]&&(t[r.uuid]=r.toJSON(e)),r.uuid}if(n.uuid=this.uuid,n.type=this.type,""!==this.name&&(n.name=this.name),!0===this.castShadow&&(n.castShadow=!0),!0===this.receiveShadow&&(n.receiveShadow=!0),!1===this.visible&&(n.visible=!1),!1===this.frustumCulled&&(n.frustumCulled=!1),0!==this.renderOrder&&(n.renderOrder=this.renderOrder),"{}"!==JSON.stringify(this.userData)&&(n.userData=this.userData),n.matrix=this.matrix.toArray(),void 0!==this.geometry){n.geometry=serialize(e.geometries,this.geometry);var i=this.geometry.parameters;if(void 0!==i&&void 0!==i.shapes){var o=i.shapes;if(Array.isArray(o))for(var a=0,s=o.length;a<s;a++){var c=o[a];serialize(e.shapes,c)}else serialize(e.shapes,o)}}if(void 0!==this.material)if(Array.isArray(this.material)){var u=[];for(a=0,s=this.material.length;a<s;a++)u.push(serialize(e.materials,this.material[a]));n.material=u}else n.material=serialize(e.materials,this.material);if(this.children.length>0){n.children=[];for(a=0;a<this.children.length;a++)n.children.push(this.children[a].toJSON(e).object)}if(t){var l=extractFromCache(e.geometries),h=extractFromCache(e.materials),p=extractFromCache(e.textures),f=extractFromCache(e.images);o=extractFromCache(e.shapes);l.length>0&&(r.geometries=l),h.length>0&&(r.materials=h),p.length>0&&(r.textures=p),f.length>0&&(r.images=f),o.length>0&&(r.shapes=o)}return r.object=n,r;function extractFromCache(e){var t=[];for(var r in e){var n=e[r];delete n.metadata,t.push(n)}return t}},clone:function clone(e){return(new this.constructor).copy(this,e)},copy:function copy(e,t){if(void 0===t&&(t=!0),this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.userData=JSON.parse(JSON.stringify(e.userData)),!0===t)for(var r=0;r<e.children.length;r++){var n=e.children[r];this.add(n.clone())}return this}}),Camera.prototype=Object.assign(Object.create(Object3D.prototype),{constructor:Camera,isCamera:!0,copy:function copy(e,t){return Object3D.prototype.copy.call(this,e,t),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this},getWorldDirection:function(){var e=new Quaternion;return function getWorldDirection(t){return void 0===t&&(console.warn("THREE.Camera: .getWorldDirection() target is now required"),t=new Vector3),this.getWorldQuaternion(e),t.set(0,0,-1).applyQuaternion(e)}}(),updateMatrixWorld:function updateMatrixWorld(e){Object3D.prototype.updateMatrixWorld.call(this,e),this.matrixWorldInverse.getInverse(this.matrixWorld)},clone:function clone(){return(new this.constructor).copy(this)}}),OrthographicCamera.prototype=Object.assign(Object.create(Camera.prototype),{constructor:OrthographicCamera,isOrthographicCamera:!0,copy:function copy(e,t){return Camera.prototype.copy.call(this,e,t),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=null===e.view?null:Object.assign({},e.view),this},setViewOffset:function setViewOffset(e,t,r,n,i,o){null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=r,this.view.offsetY=n,this.view.width=i,this.view.height=o,this.updateProjectionMatrix()},clearViewOffset:function clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()},updateProjectionMatrix:function updateProjectionMatrix(){var e=(this.right-this.left)/(2*this.zoom),t=(this.top-this.bottom)/(2*this.zoom),r=(this.right+this.left)/2,n=(this.top+this.bottom)/2,i=r-e,o=r+e,a=n+t,s=n-t;if(null!==this.view&&this.view.enabled){var c=this.zoom/(this.view.width/this.view.fullWidth),u=this.zoom/(this.view.height/this.view.fullHeight),l=(this.right-this.left)/this.view.width,h=(this.top-this.bottom)/this.view.height;o=(i+=l*(this.view.offsetX/c))+l*(this.view.width/c),s=(a-=h*(this.view.offsetY/u))-h*(this.view.height/u)}this.projectionMatrix.makeOrthographic(i,o,a,s,this.near,this.far)},toJSON:function toJSON(e){var t=Object3D.prototype.toJSON.call(this,e);return t.object.zoom=this.zoom,t.object.left=this.left,t.object.right=this.right,t.object.top=this.top,t.object.bottom=this.bottom,t.object.near=this.near,t.object.far=this.far,null!==this.view&&(t.object.view=Object.assign({},this.view)),t}}),Object.assign(Face3.prototype,{clone:function clone(){return(new this.constructor).copy(this)},copy:function copy(e){this.a=e.a,this.b=e.b,this.c=e.c,this.normal.copy(e.normal),this.color.copy(e.color),this.materialIndex=e.materialIndex;for(var t=0,r=e.vertexNormals.length;t<r;t++)this.vertexNormals[t]=e.vertexNormals[t].clone();for(t=0,r=e.vertexColors.length;t<r;t++)this.vertexColors[t]=e.vertexColors[t].clone();return this}});var Zt,Kt,Qt=0;function Geometry(){Object.defineProperty(this,"id",{value:Qt+=2}),this.uuid=At.generateUUID(),this.name="",this.type="Geometry",this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingBox=null,this.boundingSphere=null,this.elementsNeedUpdate=!1,this.verticesNeedUpdate=!1,this.uvsNeedUpdate=!1,this.normalsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.lineDistancesNeedUpdate=!1,this.groupsNeedUpdate=!1}function BufferAttribute(e,t,r){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.name="",this.array=e,this.itemSize=t,this.count=void 0!==e?e.length/t:0,this.normalized=!0===r,this.dynamic=!1,this.updateRange={offset:0,count:-1},this.version=0}function Int8BufferAttribute(e,t,r){BufferAttribute.call(this,new Int8Array(e),t,r)}function Uint8BufferAttribute(e,t,r){BufferAttribute.call(this,new Uint8Array(e),t,r)}function Uint8ClampedBufferAttribute(e,t,r){BufferAttribute.call(this,new Uint8ClampedArray(e),t,r)}function Int16BufferAttribute(e,t,r){BufferAttribute.call(this,new Int16Array(e),t,r)}function Uint16BufferAttribute(e,t,r){BufferAttribute.call(this,new Uint16Array(e),t,r)}function Int32BufferAttribute(e,t,r){BufferAttribute.call(this,new Int32Array(e),t,r)}function Uint32BufferAttribute(e,t,r){BufferAttribute.call(this,new Uint32Array(e),t,r)}function Float32BufferAttribute(e,t,r){BufferAttribute.call(this,new Float32Array(e),t,r)}function Float64BufferAttribute(e,t,r){BufferAttribute.call(this,new Float64Array(e),t,r)}function DirectGeometry(){this.vertices=[],this.normals=[],this.colors=[],this.uvs=[],this.uvs2=[],this.groups=[],this.morphTargets={},this.skinWeights=[],this.skinIndices=[],this.boundingBox=null,this.boundingSphere=null,this.verticesNeedUpdate=!1,this.normalsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.uvsNeedUpdate=!1,this.groupsNeedUpdate=!1}function arrayMax(e){if(0===e.length)return-1/0;for(var t=e[0],r=1,n=e.length;r<n;++r)e[r]>t&&(t=e[r]);return t}Geometry.prototype=Object.assign(Object.create(EventDispatcher.prototype),{constructor:Geometry,isGeometry:!0,applyMatrix:function applyMatrix(e){for(var t=(new Matrix3).getNormalMatrix(e),r=0,n=this.vertices.length;r<n;r++){this.vertices[r].applyMatrix4(e)}for(r=0,n=this.faces.length;r<n;r++){var i=this.faces[r];i.normal.applyMatrix3(t).normalize();for(var o=0,a=i.vertexNormals.length;o<a;o++)i.vertexNormals[o].applyMatrix3(t).normalize()}return null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this.verticesNeedUpdate=!0,this.normalsNeedUpdate=!0,this},rotateX:function(){var e=new Matrix4;return function rotateX(t){return e.makeRotationX(t),this.applyMatrix(e),this}}(),rotateY:function(){var e=new Matrix4;return function rotateY(t){return e.makeRotationY(t),this.applyMatrix(e),this}}(),rotateZ:function(){var e=new Matrix4;return function rotateZ(t){return e.makeRotationZ(t),this.applyMatrix(e),this}}(),translate:function(){var e=new Matrix4;return function translate(t,r,n){return e.makeTranslation(t,r,n),this.applyMatrix(e),this}}(),scale:function(){var e=new Matrix4;return function scale(t,r,n){return e.makeScale(t,r,n),this.applyMatrix(e),this}}(),lookAt:(Kt=new Object3D,function lookAt(e){Kt.lookAt(e),Kt.updateMatrix(),this.applyMatrix(Kt.matrix)}),fromBufferGeometry:function fromBufferGeometry(e){var t=this,r=null!==e.index?e.index.array:void 0,n=e.attributes,i=n.position.array,o=void 0!==n.normal?n.normal.array:void 0,a=void 0!==n.color?n.color.array:void 0,s=void 0!==n.uv?n.uv.array:void 0,c=void 0!==n.uv2?n.uv2.array:void 0;void 0!==c&&(this.faceVertexUvs[1]=[]);for(var u=[],l=[],h=[],p=0,f=0;p<i.length;p+=3,f+=2)t.vertices.push(new Vector3(i[p],i[p+1],i[p+2])),void 0!==o&&u.push(new Vector3(o[p],o[p+1],o[p+2])),void 0!==a&&t.colors.push(new Color(a[p],a[p+1],a[p+2])),void 0!==s&&l.push(new Vector2(s[f],s[f+1])),void 0!==c&&h.push(new Vector2(c[f],c[f+1]));function addFace(e,r,n,i){var p=new Face3(e,r,n,void 0!==o?[u[e].clone(),u[r].clone(),u[n].clone()]:[],void 0!==a?[t.colors[e].clone(),t.colors[r].clone(),t.colors[n].clone()]:[],i);t.faces.push(p),void 0!==s&&t.faceVertexUvs[0].push([l[e].clone(),l[r].clone(),l[n].clone()]),void 0!==c&&t.faceVertexUvs[1].push([h[e].clone(),h[r].clone(),h[n].clone()])}var d=e.groups;if(d.length>0)for(p=0;p<d.length;p++)for(var m=d[p],g=m.start,y=(f=g,g+m.count);f<y;f+=3)void 0!==r?addFace(r[f],r[f+1],r[f+2],m.materialIndex):addFace(f,f+1,f+2,m.materialIndex);else if(void 0!==r)for(p=0;p<r.length;p+=3)addFace(r[p],r[p+1],r[p+2]);else for(p=0;p<i.length/3;p+=3)addFace(p,p+1,p+2);return this.computeFaceNormals(),null!==e.boundingBox&&(this.boundingBox=e.boundingBox.clone()),null!==e.boundingSphere&&(this.boundingSphere=e.boundingSphere.clone()),this},center:(Zt=new Vector3,function center(){return this.computeBoundingBox(),this.boundingBox.getCenter(Zt).negate(),this.translate(Zt.x,Zt.y,Zt.z),this}),normalize:function normalize(){this.computeBoundingSphere();var e=this.boundingSphere.center,t=this.boundingSphere.radius,r=0===t?1:1/t,n=new Matrix4;return n.set(r,0,0,-r*e.x,0,r,0,-r*e.y,0,0,r,-r*e.z,0,0,0,1),this.applyMatrix(n),this},computeFaceNormals:function computeFaceNormals(){for(var e=new Vector3,t=new Vector3,r=0,n=this.faces.length;r<n;r++){var i=this.faces[r],o=this.vertices[i.a],a=this.vertices[i.b],s=this.vertices[i.c];e.subVectors(s,a),t.subVectors(o,a),e.cross(t),e.normalize(),i.normal.copy(e)}},computeVertexNormals:function computeVertexNormals(e){var t,r,n,i,o,a;for(void 0===e&&(e=!0),a=new Array(this.vertices.length),t=0,r=this.vertices.length;t<r;t++)a[t]=new Vector3;if(e){var s,c,u,l=new Vector3,h=new Vector3;for(n=0,i=this.faces.length;n<i;n++)o=this.faces[n],s=this.vertices[o.a],c=this.vertices[o.b],u=this.vertices[o.c],l.subVectors(u,c),h.subVectors(s,c),l.cross(h),a[o.a].add(l),a[o.b].add(l),a[o.c].add(l)}else for(this.computeFaceNormals(),n=0,i=this.faces.length;n<i;n++)a[(o=this.faces[n]).a].add(o.normal),a[o.b].add(o.normal),a[o.c].add(o.normal);for(t=0,r=this.vertices.length;t<r;t++)a[t].normalize();for(n=0,i=this.faces.length;n<i;n++){var p=(o=this.faces[n]).vertexNormals;3===p.length?(p[0].copy(a[o.a]),p[1].copy(a[o.b]),p[2].copy(a[o.c])):(p[0]=a[o.a].clone(),p[1]=a[o.b].clone(),p[2]=a[o.c].clone())}this.faces.length>0&&(this.normalsNeedUpdate=!0)},computeFlatVertexNormals:function computeFlatVertexNormals(){var e,t,r;for(this.computeFaceNormals(),e=0,t=this.faces.length;e<t;e++){var n=(r=this.faces[e]).vertexNormals;3===n.length?(n[0].copy(r.normal),n[1].copy(r.normal),n[2].copy(r.normal)):(n[0]=r.normal.clone(),n[1]=r.normal.clone(),n[2]=r.normal.clone())}this.faces.length>0&&(this.normalsNeedUpdate=!0)},computeMorphNormals:function computeMorphNormals(){var e,t,r,n,i;for(r=0,n=this.faces.length;r<n;r++)for((i=this.faces[r]).__originalFaceNormal?i.__originalFaceNormal.copy(i.normal):i.__originalFaceNormal=i.normal.clone(),i.__originalVertexNormals||(i.__originalVertexNormals=[]),e=0,t=i.vertexNormals.length;e<t;e++)i.__originalVertexNormals[e]?i.__originalVertexNormals[e].copy(i.vertexNormals[e]):i.__originalVertexNormals[e]=i.vertexNormals[e].clone();var o=new Geometry;for(o.faces=this.faces,e=0,t=this.morphTargets.length;e<t;e++){if(!this.morphNormals[e]){this.morphNormals[e]={},this.morphNormals[e].faceNormals=[],this.morphNormals[e].vertexNormals=[];var a=this.morphNormals[e].faceNormals,s=this.morphNormals[e].vertexNormals;for(r=0,n=this.faces.length;r<n;r++)c=new Vector3,u={a:new Vector3,b:new Vector3,c:new Vector3},a.push(c),s.push(u)}var c,u,l=this.morphNormals[e];for(o.vertices=this.morphTargets[e].vertices,o.computeFaceNormals(),o.computeVertexNormals(),r=0,n=this.faces.length;r<n;r++)i=this.faces[r],c=l.faceNormals[r],u=l.vertexNormals[r],c.copy(i.normal),u.a.copy(i.vertexNormals[0]),u.b.copy(i.vertexNormals[1]),u.c.copy(i.vertexNormals[2])}for(r=0,n=this.faces.length;r<n;r++)(i=this.faces[r]).normal=i.__originalFaceNormal,i.vertexNormals=i.__originalVertexNormals},computeBoundingBox:function computeBoundingBox(){null===this.boundingBox&&(this.boundingBox=new Box3),this.boundingBox.setFromPoints(this.vertices)},computeBoundingSphere:function computeBoundingSphere(){null===this.boundingSphere&&(this.boundingSphere=new Sphere),this.boundingSphere.setFromPoints(this.vertices)},merge:function merge(e,t,r){if(e&&e.isGeometry){var n,i=this.vertices.length,o=this.vertices,a=e.vertices,s=this.faces,c=e.faces,u=this.faceVertexUvs[0],l=e.faceVertexUvs[0],h=this.colors,p=e.colors;void 0===r&&(r=0),void 0!==t&&(n=(new Matrix3).getNormalMatrix(t));for(var f=0,d=a.length;f<d;f++){var m=a[f].clone();void 0!==t&&m.applyMatrix4(t),o.push(m)}for(f=0,d=p.length;f<d;f++)h.push(p[f].clone());for(f=0,d=c.length;f<d;f++){var g,y,v,_=c[f],b=_.vertexNormals,w=_.vertexColors;(g=new Face3(_.a+i,_.b+i,_.c+i)).normal.copy(_.normal),void 0!==n&&g.normal.applyMatrix3(n).normalize();for(var x=0,M=b.length;x<M;x++)y=b[x].clone(),void 0!==n&&y.applyMatrix3(n).normalize(),g.vertexNormals.push(y);g.color.copy(_.color);for(x=0,M=w.length;x<M;x++)v=w[x],g.vertexColors.push(v.clone());g.materialIndex=_.materialIndex+r,s.push(g)}for(f=0,d=l.length;f<d;f++){var S=l[f],C=[];if(void 0!==S){for(x=0,M=S.length;x<M;x++)C.push(S[x].clone());u.push(C)}}}else console.error("THREE.Geometry.merge(): geometry not an instance of THREE.Geometry.",e)},mergeMesh:function mergeMesh(e){e&&e.isMesh?(e.matrixAutoUpdate&&e.updateMatrix(),this.merge(e.geometry,e.matrix)):console.error("THREE.Geometry.mergeMesh(): mesh not an instance of THREE.Mesh.",e)},mergeVertices:function mergeVertices(){var e,t,r,n,i,o,a,s,c={},u=[],l=[],h=Math.pow(10,4);for(r=0,n=this.vertices.length;r<n;r++)e=this.vertices[r],void 0===c[t=Math.round(e.x*h)+"_"+Math.round(e.y*h)+"_"+Math.round(e.z*h)]?(c[t]=r,u.push(this.vertices[r]),l[r]=u.length-1):l[r]=l[c[t]];var p=[];for(r=0,n=this.faces.length;r<n;r++){(i=this.faces[r]).a=l[i.a],i.b=l[i.b],i.c=l[i.c],o=[i.a,i.b,i.c];for(var f=0;f<3;f++)if(o[f]===o[(f+1)%3]){p.push(r);break}}for(r=p.length-1;r>=0;r--){var d=p[r];for(this.faces.splice(d,1),a=0,s=this.faceVertexUvs.length;a<s;a++)this.faceVertexUvs[a].splice(d,1)}var m=this.vertices.length-u.length;return this.vertices=u,m},setFromPoints:function setFromPoints(e){this.vertices=[];for(var t=0,r=e.length;t<r;t++){var n=e[t];this.vertices.push(new Vector3(n.x,n.y,n.z||0))}return this},sortFacesByMaterialIndex:function sortFacesByMaterialIndex(){for(var e=this.faces,t=e.length,r=0;r<t;r++)e[r]._id=r;e.sort(function materialIndexSort(e,t){return e.materialIndex-t.materialIndex});var n,i,o=this.faceVertexUvs[0],a=this.faceVertexUvs[1];o&&o.length===t&&(n=[]),a&&a.length===t&&(i=[]);for(r=0;r<t;r++){var s=e[r]._id;n&&n.push(o[s]),i&&i.push(a[s])}n&&(this.faceVertexUvs[0]=n),i&&(this.faceVertexUvs[1]=i)},toJSON:function toJSON(){var e={metadata:{version:4.5,type:"Geometry",generator:"Geometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,""!==this.name&&(e.name=this.name),void 0!==this.parameters){var t=this.parameters;for(var r in t)void 0!==t[r]&&(e[r]=t[r]);return e}for(var n=[],i=0;i<this.vertices.length;i++){var o=this.vertices[i];n.push(o.x,o.y,o.z)}var a=[],s=[],c={},u=[],l={},h=[],p={};for(i=0;i<this.faces.length;i++){var f=this.faces[i],d=void 0!==this.faceVertexUvs[0][i],m=f.normal.length()>0,g=f.vertexNormals.length>0,y=1!==f.color.r||1!==f.color.g||1!==f.color.b,v=f.vertexColors.length>0,_=0;if(_=setBit(_=setBit(_=setBit(_=setBit(_=setBit(_=setBit(_=setBit(_=setBit(_,0,0),1,!0),2,!1),3,d),4,m),5,g),6,y),7,v),a.push(_),a.push(f.a,f.b,f.c),a.push(f.materialIndex),d){var b=this.faceVertexUvs[0][i];a.push(getUvIndex(b[0]),getUvIndex(b[1]),getUvIndex(b[2]))}if(m&&a.push(getNormalIndex(f.normal)),g){var w=f.vertexNormals;a.push(getNormalIndex(w[0]),getNormalIndex(w[1]),getNormalIndex(w[2]))}if(y&&a.push(getColorIndex(f.color)),v){var x=f.vertexColors;a.push(getColorIndex(x[0]),getColorIndex(x[1]),getColorIndex(x[2]))}}function setBit(e,t,r){return r?e|1<<t:e&~(1<<t)}function getNormalIndex(e){var t=e.x.toString()+e.y.toString()+e.z.toString();return void 0!==c[t]?c[t]:(c[t]=s.length/3,s.push(e.x,e.y,e.z),c[t])}function getColorIndex(e){var t=e.r.toString()+e.g.toString()+e.b.toString();return void 0!==l[t]?l[t]:(l[t]=u.length,u.push(e.getHex()),l[t])}function getUvIndex(e){var t=e.x.toString()+e.y.toString();return void 0!==p[t]?p[t]:(p[t]=h.length/2,h.push(e.x,e.y),p[t])}return e.data={},e.data.vertices=n,e.data.normals=s,u.length>0&&(e.data.colors=u),h.length>0&&(e.data.uvs=[h]),e.data.faces=a,e},clone:function clone(){return(new Geometry).copy(this)},copy:function copy(e){var t,r,n,i,o,a;this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingBox=null,this.boundingSphere=null,this.name=e.name;var s=e.vertices;for(t=0,r=s.length;t<r;t++)this.vertices.push(s[t].clone());var c=e.colors;for(t=0,r=c.length;t<r;t++)this.colors.push(c[t].clone());var u=e.faces;for(t=0,r=u.length;t<r;t++)this.faces.push(u[t].clone());for(t=0,r=e.faceVertexUvs.length;t<r;t++){var l=e.faceVertexUvs[t];for(void 0===this.faceVertexUvs[t]&&(this.faceVertexUvs[t]=[]),n=0,i=l.length;n<i;n++){var h=l[n],p=[];for(o=0,a=h.length;o<a;o++){var f=h[o];p.push(f.clone())}this.faceVertexUvs[t].push(p)}}var d=e.morphTargets;for(t=0,r=d.length;t<r;t++){var m={};if(m.name=d[t].name,void 0!==d[t].vertices)for(m.vertices=[],n=0,i=d[t].vertices.length;n<i;n++)m.vertices.push(d[t].vertices[n].clone());if(void 0!==d[t].normals)for(m.normals=[],n=0,i=d[t].normals.length;n<i;n++)m.normals.push(d[t].normals[n].clone());this.morphTargets.push(m)}var g=e.morphNormals;for(t=0,r=g.length;t<r;t++){var y={};if(void 0!==g[t].vertexNormals)for(y.vertexNormals=[],n=0,i=g[t].vertexNormals.length;n<i;n++){var v=g[t].vertexNormals[n],_={};_.a=v.a.clone(),_.b=v.b.clone(),_.c=v.c.clone(),y.vertexNormals.push(_)}if(void 0!==g[t].faceNormals)for(y.faceNormals=[],n=0,i=g[t].faceNormals.length;n<i;n++)y.faceNormals.push(g[t].faceNormals[n].clone());this.morphNormals.push(y)}var b=e.skinWeights;for(t=0,r=b.length;t<r;t++)this.skinWeights.push(b[t].clone());var w=e.skinIndices;for(t=0,r=w.length;t<r;t++)this.skinIndices.push(w[t].clone());var x=e.lineDistances;for(t=0,r=x.length;t<r;t++)this.lineDistances.push(x[t]);var M=e.boundingBox;null!==M&&(this.boundingBox=M.clone());var S=e.boundingSphere;return null!==S&&(this.boundingSphere=S.clone()),this.elementsNeedUpdate=e.elementsNeedUpdate,this.verticesNeedUpdate=e.verticesNeedUpdate,this.uvsNeedUpdate=e.uvsNeedUpdate,this.normalsNeedUpdate=e.normalsNeedUpdate,this.colorsNeedUpdate=e.colorsNeedUpdate,this.lineDistancesNeedUpdate=e.lineDistancesNeedUpdate,this.groupsNeedUpdate=e.groupsNeedUpdate,this},dispose:function dispose(){this.dispatchEvent({type:"dispose"})}}),Object.defineProperty(BufferAttribute.prototype,"needsUpdate",{set:function set(e){!0===e&&this.version++}}),Object.assign(BufferAttribute.prototype,{isBufferAttribute:!0,onUploadCallback:function onUploadCallback(){},setArray:function setArray(e){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.count=void 0!==e?e.length/this.itemSize:0,this.array=e},setDynamic:function setDynamic(e){return this.dynamic=e,this},copy:function copy(e){return this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.dynamic=e.dynamic,this},copyAt:function copyAt(e,t,r){e*=this.itemSize,r*=t.itemSize;for(var n=0,i=this.itemSize;n<i;n++)this.array[e+n]=t.array[r+n];return this},copyArray:function copyArray(e){return this.array.set(e),this},copyColorsArray:function copyColorsArray(e){for(var t=this.array,r=0,n=0,i=e.length;n<i;n++){var o=e[n];void 0===o&&(console.warn("THREE.BufferAttribute.copyColorsArray(): color is undefined",n),o=new Color),t[r++]=o.r,t[r++]=o.g,t[r++]=o.b}return this},copyVector2sArray:function copyVector2sArray(e){for(var t=this.array,r=0,n=0,i=e.length;n<i;n++){var o=e[n];void 0===o&&(console.warn("THREE.BufferAttribute.copyVector2sArray(): vector is undefined",n),o=new Vector2),t[r++]=o.x,t[r++]=o.y}return this},copyVector3sArray:function copyVector3sArray(e){for(var t=this.array,r=0,n=0,i=e.length;n<i;n++){var o=e[n];void 0===o&&(console.warn("THREE.BufferAttribute.copyVector3sArray(): vector is undefined",n),o=new Vector3),t[r++]=o.x,t[r++]=o.y,t[r++]=o.z}return this},copyVector4sArray:function copyVector4sArray(e){for(var t=this.array,r=0,n=0,i=e.length;n<i;n++){var o=e[n];void 0===o&&(console.warn("THREE.BufferAttribute.copyVector4sArray(): vector is undefined",n),o=new Vector4),t[r++]=o.x,t[r++]=o.y,t[r++]=o.z,t[r++]=o.w}return this},set:function set(e,t){return void 0===t&&(t=0),this.array.set(e,t),this},getX:function getX(e){return this.array[e*this.itemSize]},setX:function setX(e,t){return this.array[e*this.itemSize]=t,this},getY:function getY(e){return this.array[e*this.itemSize+1]},setY:function setY(e,t){return this.array[e*this.itemSize+1]=t,this},getZ:function getZ(e){return this.array[e*this.itemSize+2]},setZ:function setZ(e,t){return this.array[e*this.itemSize+2]=t,this},getW:function getW(e){return this.array[e*this.itemSize+3]},setW:function setW(e,t){return this.array[e*this.itemSize+3]=t,this},setXY:function setXY(e,t,r){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=r,this},setXYZ:function setXYZ(e,t,r,n){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=r,this.array[e+2]=n,this},setXYZW:function setXYZW(e,t,r,n,i){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=r,this.array[e+2]=n,this.array[e+3]=i,this},onUpload:function onUpload(e){return this.onUploadCallback=e,this},clone:function clone(){return new this.constructor(this.array,this.itemSize).copy(this)}}),Int8BufferAttribute.prototype=Object.create(BufferAttribute.prototype),Int8BufferAttribute.prototype.constructor=Int8BufferAttribute,Uint8BufferAttribute.prototype=Object.create(BufferAttribute.prototype),Uint8BufferAttribute.prototype.constructor=Uint8BufferAttribute,Uint8ClampedBufferAttribute.prototype=Object.create(BufferAttribute.prototype),Uint8ClampedBufferAttribute.prototype.constructor=Uint8ClampedBufferAttribute,Int16BufferAttribute.prototype=Object.create(BufferAttribute.prototype),Int16BufferAttribute.prototype.constructor=Int16BufferAttribute,Uint16BufferAttribute.prototype=Object.create(BufferAttribute.prototype),Uint16BufferAttribute.prototype.constructor=Uint16BufferAttribute,Int32BufferAttribute.prototype=Object.create(BufferAttribute.prototype),Int32BufferAttribute.prototype.constructor=Int32BufferAttribute,Uint32BufferAttribute.prototype=Object.create(BufferAttribute.prototype),Uint32BufferAttribute.prototype.constructor=Uint32BufferAttribute,Float32BufferAttribute.prototype=Object.create(BufferAttribute.prototype),Float32BufferAttribute.prototype.constructor=Float32BufferAttribute,Float64BufferAttribute.prototype=Object.create(BufferAttribute.prototype),Float64BufferAttribute.prototype.constructor=Float64BufferAttribute,Object.assign(DirectGeometry.prototype,{computeGroups:function computeGroups(e){for(var t,r=[],n=void 0,i=e.faces,o=0;o<i.length;o++){var a=i[o];a.materialIndex!==n&&(n=a.materialIndex,void 0!==t&&(t.count=3*o-t.start,r.push(t)),t={start:3*o,materialIndex:n})}void 0!==t&&(t.count=3*o-t.start,r.push(t)),this.groups=r},fromGeometry:function fromGeometry(e){var t,r=e.faces,n=e.vertices,i=e.faceVertexUvs,o=i[0]&&i[0].length>0,a=i[1]&&i[1].length>0,s=e.morphTargets,c=s.length;if(c>0){t=[];for(var u=0;u<c;u++)t[u]=[];this.morphTargets.position=t}var l,h=e.morphNormals,p=h.length;if(p>0){l=[];for(u=0;u<p;u++)l[u]=[];this.morphTargets.normal=l}var f=e.skinIndices,d=e.skinWeights,m=f.length===n.length,g=d.length===n.length;for(u=0;u<r.length;u++){var y=r[u];this.vertices.push(n[y.a],n[y.b],n[y.c]);var v=y.vertexNormals;if(3===v.length)this.normals.push(v[0],v[1],v[2]);else{var _=y.normal;this.normals.push(_,_,_)}var b,w=y.vertexColors;if(3===w.length)this.colors.push(w[0],w[1],w[2]);else{var x=y.color;this.colors.push(x,x,x)}if(!0===o)void 0!==(b=i[0][u])?this.uvs.push(b[0],b[1],b[2]):(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv ",u),this.uvs.push(new Vector2,new Vector2,new Vector2));if(!0===a)void 0!==(b=i[1][u])?this.uvs2.push(b[0],b[1],b[2]):(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv2 ",u),this.uvs2.push(new Vector2,new Vector2,new Vector2));for(var M=0;M<c;M++){var S=s[M].vertices;t[M].push(S[y.a],S[y.b],S[y.c])}for(M=0;M<p;M++){var C=h[M].vertexNormals[u];l[M].push(C.a,C.b,C.c)}m&&this.skinIndices.push(f[y.a],f[y.b],f[y.c]),g&&this.skinWeights.push(d[y.a],d[y.b],d[y.c])}return this.computeGroups(e),this.verticesNeedUpdate=e.verticesNeedUpdate,this.normalsNeedUpdate=e.normalsNeedUpdate,this.colorsNeedUpdate=e.colorsNeedUpdate,this.uvsNeedUpdate=e.uvsNeedUpdate,this.groupsNeedUpdate=e.groupsNeedUpdate,this}});var $t=1;function BufferGeometry(){Object.defineProperty(this,"id",{value:$t+=2}),this.uuid=At.generateUUID(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0}}function BoxGeometry(e,t,r,n,i,o){Geometry.call(this),this.type="BoxGeometry",this.parameters={width:e,height:t,depth:r,widthSegments:n,heightSegments:i,depthSegments:o},this.fromBufferGeometry(new BoxBufferGeometry(e,t,r,n,i,o)),this.mergeVertices()}function BoxBufferGeometry(e,t,r,n,i,o){BufferGeometry.call(this),this.type="BoxBufferGeometry",this.parameters={width:e,height:t,depth:r,widthSegments:n,heightSegments:i,depthSegments:o};var a=this;e=e||1,t=t||1,r=r||1,n=Math.floor(n)||1,i=Math.floor(i)||1;var s=[],c=[],u=[],l=[],h=0,p=0;function buildPlane(e,t,r,n,i,o,f,d,m,g,y){var v,_,b=o/m,w=f/g,x=o/2,M=f/2,S=d/2,C=m+1,P=g+1,E=0,T=0,O=new Vector3;for(_=0;_<P;_++){var A=_*w-M;for(v=0;v<C;v++){var L=v*b-x;O[e]=L*n,O[t]=A*i,O[r]=S,c.push(O.x,O.y,O.z),O[e]=0,O[t]=0,O[r]=d>0?1:-1,u.push(O.x,O.y,O.z),l.push(v/m),l.push(1-_/g),E+=1}}for(_=0;_<g;_++)for(v=0;v<m;v++){var k=h+v+C*_,R=h+v+C*(_+1),I=h+(v+1)+C*(_+1),N=h+(v+1)+C*_;s.push(k,R,N),s.push(R,I,N),T+=6}a.addGroup(p,T,y),p+=T,h+=E}buildPlane("z","y","x",-1,-1,r,t,e,o=Math.floor(o)||1,i,0),buildPlane("z","y","x",1,-1,r,t,-e,o,i,1),buildPlane("x","z","y",1,1,e,r,t,n,o,2),buildPlane("x","z","y",1,-1,e,r,-t,n,o,3),buildPlane("x","y","z",1,-1,e,t,r,n,i,4),buildPlane("x","y","z",-1,-1,e,t,-r,n,i,5),this.setIndex(s),this.addAttribute("position",new Float32BufferAttribute(c,3)),this.addAttribute("normal",new Float32BufferAttribute(u,3)),this.addAttribute("uv",new Float32BufferAttribute(l,2))}function PlaneGeometry(e,t,r,n){Geometry.call(this),this.type="PlaneGeometry",this.parameters={width:e,height:t,widthSegments:r,heightSegments:n},this.fromBufferGeometry(new PlaneBufferGeometry(e,t,r,n)),this.mergeVertices()}function PlaneBufferGeometry(e,t,r,n){BufferGeometry.call(this),this.type="PlaneBufferGeometry",this.parameters={width:e,height:t,widthSegments:r,heightSegments:n};var i,o,a=(e=e||1)/2,s=(t=t||1)/2,c=Math.floor(r)||1,u=Math.floor(n)||1,l=c+1,h=u+1,p=e/c,f=t/u,d=[],m=[],g=[],y=[];for(o=0;o<h;o++){var v=o*f-s;for(i=0;i<l;i++){var _=i*p-a;m.push(_,-v,0),g.push(0,0,1),y.push(i/c),y.push(1-o/u)}}for(o=0;o<u;o++)for(i=0;i<c;i++){var b=i+l*o,w=i+l*(o+1),x=i+1+l*(o+1),M=i+1+l*o;d.push(b,w,M),d.push(w,x,M)}this.setIndex(d),this.addAttribute("position",new Float32BufferAttribute(m,3)),this.addAttribute("normal",new Float32BufferAttribute(g,3)),this.addAttribute("uv",new Float32BufferAttribute(y,2))}BufferGeometry.prototype=Object.assign(Object.create(EventDispatcher.prototype),{constructor:BufferGeometry,isBufferGeometry:!0,getIndex:function getIndex(){return this.index},setIndex:function setIndex(e){Array.isArray(e)?this.index=new(arrayMax(e)>65535?Uint32BufferAttribute:Uint16BufferAttribute)(e,1):this.index=e},addAttribute:function addAttribute(e,t){return t&&t.isBufferAttribute||t&&t.isInterleavedBufferAttribute?"index"===e?(console.warn("THREE.BufferGeometry.addAttribute: Use .setIndex() for index attribute."),void this.setIndex(t)):(this.attributes[e]=t,this):(console.warn("THREE.BufferGeometry: .addAttribute() now expects ( name, attribute )."),void this.addAttribute(e,new BufferAttribute(arguments[1],arguments[2])))},getAttribute:function getAttribute(e){return this.attributes[e]},removeAttribute:function removeAttribute(e){return delete this.attributes[e],this},addGroup:function addGroup(e,t,r){this.groups.push({start:e,count:t,materialIndex:void 0!==r?r:0})},clearGroups:function clearGroups(){this.groups=[]},setDrawRange:function setDrawRange(e,t){this.drawRange.start=e,this.drawRange.count=t},applyMatrix:function applyMatrix(e){var t=this.attributes.position;void 0!==t&&(e.applyToBufferAttribute(t),t.needsUpdate=!0);var r=this.attributes.normal;void 0!==r&&((new Matrix3).getNormalMatrix(e).applyToBufferAttribute(r),r.needsUpdate=!0);return null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this},rotateX:function(){var e=new Matrix4;return function rotateX(t){return e.makeRotationX(t),this.applyMatrix(e),this}}(),rotateY:function(){var e=new Matrix4;return function rotateY(t){return e.makeRotationY(t),this.applyMatrix(e),this}}(),rotateZ:function(){var e=new Matrix4;return function rotateZ(t){return e.makeRotationZ(t),this.applyMatrix(e),this}}(),translate:function(){var e=new Matrix4;return function translate(t,r,n){return e.makeTranslation(t,r,n),this.applyMatrix(e),this}}(),scale:function(){var e=new Matrix4;return function scale(t,r,n){return e.makeScale(t,r,n),this.applyMatrix(e),this}}(),lookAt:function(){var e=new Object3D;return function lookAt(t){e.lookAt(t),e.updateMatrix(),this.applyMatrix(e.matrix)}}(),center:function(){var e=new Vector3;return function center(){return this.computeBoundingBox(),this.boundingBox.getCenter(e).negate(),this.translate(e.x,e.y,e.z),this}}(),setFromObject:function setFromObject(e){var t=e.geometry;if(e.isPoints||e.isLine){var r=new Float32BufferAttribute(3*t.vertices.length,3),n=new Float32BufferAttribute(3*t.colors.length,3);if(this.addAttribute("position",r.copyVector3sArray(t.vertices)),this.addAttribute("color",n.copyColorsArray(t.colors)),t.lineDistances&&t.lineDistances.length===t.vertices.length){var i=new Float32BufferAttribute(t.lineDistances.length,1);this.addAttribute("lineDistance",i.copyArray(t.lineDistances))}null!==t.boundingSphere&&(this.boundingSphere=t.boundingSphere.clone()),null!==t.boundingBox&&(this.boundingBox=t.boundingBox.clone())}else e.isMesh&&t&&t.isGeometry&&this.fromGeometry(t);return this},setFromPoints:function setFromPoints(e){for(var t=[],r=0,n=e.length;r<n;r++){var i=e[r];t.push(i.x,i.y,i.z||0)}return this.addAttribute("position",new Float32BufferAttribute(t,3)),this},updateFromObject:function updateFromObject(e){var t,r=e.geometry;if(e.isMesh){var n=r.__directGeometry;if(!0===r.elementsNeedUpdate&&(n=void 0,r.elementsNeedUpdate=!1),void 0===n)return this.fromGeometry(r);n.verticesNeedUpdate=r.verticesNeedUpdate,n.normalsNeedUpdate=r.normalsNeedUpdate,n.colorsNeedUpdate=r.colorsNeedUpdate,n.uvsNeedUpdate=r.uvsNeedUpdate,n.groupsNeedUpdate=r.groupsNeedUpdate,r.verticesNeedUpdate=!1,r.normalsNeedUpdate=!1,r.colorsNeedUpdate=!1,r.uvsNeedUpdate=!1,r.groupsNeedUpdate=!1,r=n}return!0===r.verticesNeedUpdate&&(void 0!==(t=this.attributes.position)&&(t.copyVector3sArray(r.vertices),t.needsUpdate=!0),r.verticesNeedUpdate=!1),!0===r.normalsNeedUpdate&&(void 0!==(t=this.attributes.normal)&&(t.copyVector3sArray(r.normals),t.needsUpdate=!0),r.normalsNeedUpdate=!1),!0===r.colorsNeedUpdate&&(void 0!==(t=this.attributes.color)&&(t.copyColorsArray(r.colors),t.needsUpdate=!0),r.colorsNeedUpdate=!1),r.uvsNeedUpdate&&(void 0!==(t=this.attributes.uv)&&(t.copyVector2sArray(r.uvs),t.needsUpdate=!0),r.uvsNeedUpdate=!1),r.lineDistancesNeedUpdate&&(void 0!==(t=this.attributes.lineDistance)&&(t.copyArray(r.lineDistances),t.needsUpdate=!0),r.lineDistancesNeedUpdate=!1),r.groupsNeedUpdate&&(r.computeGroups(e.geometry),this.groups=r.groups,r.groupsNeedUpdate=!1),this},fromGeometry:function fromGeometry(e){return e.__directGeometry=(new DirectGeometry).fromGeometry(e),this.fromDirectGeometry(e.__directGeometry)},fromDirectGeometry:function fromDirectGeometry(e){var t=new Float32Array(3*e.vertices.length);if(this.addAttribute("position",new BufferAttribute(t,3).copyVector3sArray(e.vertices)),e.normals.length>0){var r=new Float32Array(3*e.normals.length);this.addAttribute("normal",new BufferAttribute(r,3).copyVector3sArray(e.normals))}if(e.colors.length>0){var n=new Float32Array(3*e.colors.length);this.addAttribute("color",new BufferAttribute(n,3).copyColorsArray(e.colors))}if(e.uvs.length>0){var i=new Float32Array(2*e.uvs.length);this.addAttribute("uv",new BufferAttribute(i,2).copyVector2sArray(e.uvs))}if(e.uvs2.length>0){var o=new Float32Array(2*e.uvs2.length);this.addAttribute("uv2",new BufferAttribute(o,2).copyVector2sArray(e.uvs2))}for(var a in this.groups=e.groups,e.morphTargets){for(var s=[],c=e.morphTargets[a],u=0,l=c.length;u<l;u++){var h=c[u],p=new Float32BufferAttribute(3*h.length,3);s.push(p.copyVector3sArray(h))}this.morphAttributes[a]=s}if(e.skinIndices.length>0){var f=new Float32BufferAttribute(4*e.skinIndices.length,4);this.addAttribute("skinIndex",f.copyVector4sArray(e.skinIndices))}if(e.skinWeights.length>0){var d=new Float32BufferAttribute(4*e.skinWeights.length,4);this.addAttribute("skinWeight",d.copyVector4sArray(e.skinWeights))}return null!==e.boundingSphere&&(this.boundingSphere=e.boundingSphere.clone()),null!==e.boundingBox&&(this.boundingBox=e.boundingBox.clone()),this},computeBoundingBox:function computeBoundingBox(){null===this.boundingBox&&(this.boundingBox=new Box3);var e=this.attributes.position;void 0!==e?this.boundingBox.setFromBufferAttribute(e):this.boundingBox.makeEmpty(),(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox: Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)},computeBoundingSphere:function(){var e=new Box3,t=new Vector3;return function computeBoundingSphere(){null===this.boundingSphere&&(this.boundingSphere=new Sphere);var r=this.attributes.position;if(r){var n=this.boundingSphere.center;e.setFromBufferAttribute(r),e.getCenter(n);for(var i=0,o=0,a=r.count;o<a;o++)t.x=r.getX(o),t.y=r.getY(o),t.z=r.getZ(o),i=Math.max(i,n.distanceToSquared(t));this.boundingSphere.radius=Math.sqrt(i),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}}(),computeFaceNormals:function computeFaceNormals(){},computeVertexNormals:function computeVertexNormals(){var e=this.index,t=this.attributes,r=this.groups;if(t.position){var n=t.position.array;if(void 0===t.normal)this.addAttribute("normal",new BufferAttribute(new Float32Array(n.length),3));else for(var i=t.normal.array,o=0,a=i.length;o<a;o++)i[o]=0;var s,c,u,l=t.normal.array,h=new Vector3,p=new Vector3,f=new Vector3,d=new Vector3,m=new Vector3;if(e){var g=e.array;0===r.length&&this.addGroup(0,g.length);for(var y=0,v=r.length;y<v;++y){var _=r[y],b=_.start;for(o=b,a=b+_.count;o<a;o+=3)s=3*g[o+0],c=3*g[o+1],u=3*g[o+2],h.fromArray(n,s),p.fromArray(n,c),f.fromArray(n,u),d.subVectors(f,p),m.subVectors(h,p),d.cross(m),l[s]+=d.x,l[s+1]+=d.y,l[s+2]+=d.z,l[c]+=d.x,l[c+1]+=d.y,l[c+2]+=d.z,l[u]+=d.x,l[u+1]+=d.y,l[u+2]+=d.z}}else for(o=0,a=n.length;o<a;o+=9)h.fromArray(n,o),p.fromArray(n,o+3),f.fromArray(n,o+6),d.subVectors(f,p),m.subVectors(h,p),d.cross(m),l[o]=d.x,l[o+1]=d.y,l[o+2]=d.z,l[o+3]=d.x,l[o+4]=d.y,l[o+5]=d.z,l[o+6]=d.x,l[o+7]=d.y,l[o+8]=d.z;this.normalizeNormals(),t.normal.needsUpdate=!0}},merge:function merge(e,t){if(e&&e.isBufferGeometry){void 0===t&&(t=0,console.warn("THREE.BufferGeometry.merge(): Overwriting original geometry, starting at offset=0. Use BufferGeometryUtils.mergeBufferGeometries() for lossless merge."));var r=this.attributes;for(var n in r)if(void 0!==e.attributes[n])for(var i=r[n].array,o=e.attributes[n],a=o.array,s=0,c=o.itemSize*t;s<a.length;s++,c++)i[c]=a[s];return this}console.error("THREE.BufferGeometry.merge(): geometry not an instance of THREE.BufferGeometry.",e)},normalizeNormals:function(){var e=new Vector3;return function normalizeNormals(){for(var t=this.attributes.normal,r=0,n=t.count;r<n;r++)e.x=t.getX(r),e.y=t.getY(r),e.z=t.getZ(r),e.normalize(),t.setXYZ(r,e.x,e.y,e.z)}}(),toNonIndexed:function toNonIndexed(){if(null===this.index)return console.warn("THREE.BufferGeometry.toNonIndexed(): Geometry is already non-indexed."),this;var e=new BufferGeometry,t=this.index.array,r=this.attributes;for(var n in r){for(var i=r[n],o=i.array,a=i.itemSize,s=new o.constructor(t.length*a),c=0,u=0,l=0,h=t.length;l<h;l++){c=t[l]*a;for(var p=0;p<a;p++)s[u++]=o[c++]}e.addAttribute(n,new BufferAttribute(s,a))}var f=this.groups;for(l=0,h=f.length;l<h;l++){var d=f[l];e.addGroup(d.start,d.count,d.materialIndex)}return e},toJSON:function toJSON(){var e={metadata:{version:4.5,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,""!==this.name&&(e.name=this.name),void 0!==this.parameters){var t=this.parameters;for(var r in t)void 0!==t[r]&&(e[r]=t[r]);return e}e.data={attributes:{}};var n=this.index;if(null!==n){var i=Array.prototype.slice.call(n.array);e.data.index={type:n.array.constructor.name,array:i}}var o=this.attributes;for(var r in o){var a=o[r];i=Array.prototype.slice.call(a.array);e.data.attributes[r]={itemSize:a.itemSize,type:a.array.constructor.name,array:i,normalized:a.normalized}}var s=this.groups;s.length>0&&(e.data.groups=JSON.parse(JSON.stringify(s)));var c=this.boundingSphere;return null!==c&&(e.data.boundingSphere={center:c.center.toArray(),radius:c.radius}),e},clone:function clone(){return(new BufferGeometry).copy(this)},copy:function copy(e){var t,r,n;this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.name=e.name;var i=e.index;null!==i&&this.setIndex(i.clone());var o=e.attributes;for(t in o){var a=o[t];this.addAttribute(t,a.clone())}var s=e.morphAttributes;for(t in s){var c=[],u=s[t];for(r=0,n=u.length;r<n;r++)c.push(u[r].clone());this.morphAttributes[t]=c}var l=e.groups;for(r=0,n=l.length;r<n;r++){var h=l[r];this.addGroup(h.start,h.count,h.materialIndex)}var p=e.boundingBox;null!==p&&(this.boundingBox=p.clone());var f=e.boundingSphere;return null!==f&&(this.boundingSphere=f.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this},dispose:function dispose(){this.dispatchEvent({type:"dispose"})}}),BoxGeometry.prototype=Object.create(Geometry.prototype),BoxGeometry.prototype.constructor=BoxGeometry,BoxBufferGeometry.prototype=Object.create(BufferGeometry.prototype),BoxBufferGeometry.prototype.constructor=BoxBufferGeometry,PlaneGeometry.prototype=Object.create(Geometry.prototype),PlaneGeometry.prototype.constructor=PlaneGeometry,PlaneBufferGeometry.prototype=Object.create(BufferGeometry.prototype),PlaneBufferGeometry.prototype.constructor=PlaneBufferGeometry;var er,tr,rr,nr,ir,or,ar,sr=0;function Material(){Object.defineProperty(this,"id",{value:sr++}),this.uuid=At.generateUUID(),this.name="",this.type="Material",this.fog=!0,this.lights=!0,this.blending=T,this.side=w,this.flatShading=!1,this.vertexColors=S,this.opacity=1,this.transparent=!1,this.blendSrc=G,this.blendDst=z,this.blendEquation=R,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=Q,this.depthTest=!0,this.depthWrite=!0,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaTest=0,this.premultipliedAlpha=!1,this.overdraw=0,this.visible=!0,this.userData={},this.needsUpdate=!0}function MeshBasicMaterial(e){Material.call(this),this.type="MeshBasicMaterial",this.color=new Color(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=ne,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.lights=!1,this.setValues(e)}function ShaderMaterial(e){Material.call(this),this.type="ShaderMaterial",this.defines={},this.uniforms={},this.vertexShader="void main() {\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",this.fragmentShader="void main() {\n\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}",this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,void 0!==e&&(void 0!==e.attributes&&console.error("THREE.ShaderMaterial: attributes should now be defined in THREE.BufferGeometry instead."),this.setValues(e))}function Ray(e,t){this.origin=void 0!==e?e:new Vector3,this.direction=void 0!==t?t:new Vector3}function Line3(e,t){this.start=void 0!==e?e:new Vector3,this.end=void 0!==t?t:new Vector3}function Triangle(e,t,r){this.a=void 0!==e?e:new Vector3,this.b=void 0!==t?t:new Vector3,this.c=void 0!==r?r:new Vector3}function Mesh(e,t){Object3D.call(this),this.type="Mesh",this.geometry=void 0!==e?e:new BufferGeometry,this.material=void 0!==t?t:new MeshBasicMaterial({color:16777215*Math.random()}),this.drawMode=vt,this.updateMorphTargets()}function absNumericalSort(e,t){return Math.abs(t[1])-Math.abs(e[1])}function CubeTexture(e,t,r,n,i,o,a,s,c,u){e=void 0!==e?e:[],t=void 0!==t?t:he,Texture.call(this,e,t,r,n,i,o,a,s,c,u),this.flipY=!1}Material.prototype=Object.assign(Object.create(EventDispatcher.prototype),{constructor:Material,isMaterial:!0,onBeforeCompile:function onBeforeCompile(){},setValues:function setValues(e){if(void 0!==e)for(var t in e){var r=e[t];if(void 0!==r)if("shading"!==t){var n=this[t];void 0!==n?n&&n.isColor?n.set(r):n&&n.isVector3&&r&&r.isVector3?n.copy(r):this[t]="overdraw"===t?Number(r):r:console.warn("THREE."+this.type+": '"+t+"' is not a property of this material.")}else console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=1===r;else console.warn("THREE.Material: '"+t+"' parameter is undefined.")}},toJSON:function toJSON(e){var t=void 0===e||"string"==typeof e;t&&(e={textures:{},images:{}});var r={metadata:{version:4.5,type:"Material",generator:"Material.toJSON"}};function extractFromCache(e){var t=[];for(var r in e){var n=e[r];delete n.metadata,t.push(n)}return t}if(r.uuid=this.uuid,r.type=this.type,""!==this.name&&(r.name=this.name),this.color&&this.color.isColor&&(r.color=this.color.getHex()),void 0!==this.roughness&&(r.roughness=this.roughness),void 0!==this.metalness&&(r.metalness=this.metalness),this.emissive&&this.emissive.isColor&&(r.emissive=this.emissive.getHex()),1!==this.emissiveIntensity&&(r.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(r.specular=this.specular.getHex()),void 0!==this.shininess&&(r.shininess=this.shininess),void 0!==this.clearCoat&&(r.clearCoat=this.clearCoat),void 0!==this.clearCoatRoughness&&(r.clearCoatRoughness=this.clearCoatRoughness),this.map&&this.map.isTexture&&(r.map=this.map.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(r.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(r.lightMap=this.lightMap.toJSON(e).uuid),this.bumpMap&&this.bumpMap.isTexture&&(r.bumpMap=this.bumpMap.toJSON(e).uuid,r.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(r.normalMap=this.normalMap.toJSON(e).uuid,r.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(r.displacementMap=this.displacementMap.toJSON(e).uuid,r.displacementScale=this.displacementScale,r.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(r.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(r.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(r.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(r.specularMap=this.specularMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(r.envMap=this.envMap.toJSON(e).uuid,r.reflectivity=this.reflectivity),this.gradientMap&&this.gradientMap.isTexture&&(r.gradientMap=this.gradientMap.toJSON(e).uuid),void 0!==this.size&&(r.size=this.size),void 0!==this.sizeAttenuation&&(r.sizeAttenuation=this.sizeAttenuation),this.blending!==T&&(r.blending=this.blending),!0===this.flatShading&&(r.flatShading=this.flatShading),this.side!==w&&(r.side=this.side),this.vertexColors!==S&&(r.vertexColors=this.vertexColors),this.opacity<1&&(r.opacity=this.opacity),!0===this.transparent&&(r.transparent=this.transparent),r.depthFunc=this.depthFunc,r.depthTest=this.depthTest,r.depthWrite=this.depthWrite,0!==this.rotation&&(r.rotation=this.rotation),1!==this.linewidth&&(r.linewidth=this.linewidth),void 0!==this.dashSize&&(r.dashSize=this.dashSize),void 0!==this.gapSize&&(r.gapSize=this.gapSize),void 0!==this.scale&&(r.scale=this.scale),!0===this.dithering&&(r.dithering=!0),this.alphaTest>0&&(r.alphaTest=this.alphaTest),!0===this.premultipliedAlpha&&(r.premultipliedAlpha=this.premultipliedAlpha),!0===this.wireframe&&(r.wireframe=this.wireframe),this.wireframeLinewidth>1&&(r.wireframeLinewidth=this.wireframeLinewidth),"round"!==this.wireframeLinecap&&(r.wireframeLinecap=this.wireframeLinecap),"round"!==this.wireframeLinejoin&&(r.wireframeLinejoin=this.wireframeLinejoin),!0===this.morphTargets&&(r.morphTargets=!0),!0===this.skinning&&(r.skinning=!0),!1===this.visible&&(r.visible=!1),"{}"!==JSON.stringify(this.userData)&&(r.userData=this.userData),t){var n=extractFromCache(e.textures),i=extractFromCache(e.images);n.length>0&&(r.textures=n),i.length>0&&(r.images=i)}return r},clone:function clone(){return(new this.constructor).copy(this)},copy:function copy(e){this.name=e.name,this.fog=e.fog,this.lights=e.lights,this.blending=e.blending,this.side=e.side,this.flatShading=e.flatShading,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.premultipliedAlpha=e.premultipliedAlpha,this.overdraw=e.overdraw,this.visible=e.visible,this.userData=JSON.parse(JSON.stringify(e.userData)),this.clipShadows=e.clipShadows,this.clipIntersection=e.clipIntersection;var t=e.clippingPlanes,r=null;if(null!==t){var n=t.length;r=new Array(n);for(var i=0;i!==n;++i)r[i]=t[i].clone()}return this.clippingPlanes=r,this.shadowSide=e.shadowSide,this},dispose:function dispose(){this.dispatchEvent({type:"dispose"})}}),MeshBasicMaterial.prototype=Object.create(Material.prototype),MeshBasicMaterial.prototype.constructor=MeshBasicMaterial,MeshBasicMaterial.prototype.isMeshBasicMaterial=!0,MeshBasicMaterial.prototype.copy=function(e){return Material.prototype.copy.call(this,e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this},ShaderMaterial.prototype=Object.create(Material.prototype),ShaderMaterial.prototype.constructor=ShaderMaterial,ShaderMaterial.prototype.isShaderMaterial=!0,ShaderMaterial.prototype.copy=function(e){return Material.prototype.copy.call(this,e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=Dt.clone(e.uniforms),this.defines=e.defines,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.lights=e.lights,this.clipping=e.clipping,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this.extensions=e.extensions,this},ShaderMaterial.prototype.toJSON=function(e){var t=Material.prototype.toJSON.call(this,e);return t.uniforms=this.uniforms,t.vertexShader=this.vertexShader,t.fragmentShader=this.fragmentShader,t},Object.assign(Ray.prototype,{set:function set(e,t){return this.origin.copy(e),this.direction.copy(t),this},clone:function clone(){return(new this.constructor).copy(this)},copy:function copy(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this},at:function at(e,t){return void 0===t&&(console.warn("THREE.Ray: .at() target is now required"),t=new Vector3),t.copy(this.direction).multiplyScalar(e).add(this.origin)},lookAt:function lookAt(e){return this.direction.copy(e).sub(this.origin).normalize(),this},recast:function(){var e=new Vector3;return function recast(t){return this.origin.copy(this.at(t,e)),this}}(),closestPointToPoint:function closestPointToPoint(e,t){void 0===t&&(console.warn("THREE.Ray: .closestPointToPoint() target is now required"),t=new Vector3),t.subVectors(e,this.origin);var r=t.dot(this.direction);return r<0?t.copy(this.origin):t.copy(this.direction).multiplyScalar(r).add(this.origin)},distanceToPoint:function distanceToPoint(e){return Math.sqrt(this.distanceSqToPoint(e))},distanceSqToPoint:function(){var e=new Vector3;return function distanceSqToPoint(t){var r=e.subVectors(t,this.origin).dot(this.direction);return r<0?this.origin.distanceToSquared(t):(e.copy(this.direction).multiplyScalar(r).add(this.origin),e.distanceToSquared(t))}}(),distanceSqToSegment:(tr=new Vector3,rr=new Vector3,nr=new Vector3,function distanceSqToSegment(e,t,r,n){tr.copy(e).add(t).multiplyScalar(.5),rr.copy(t).sub(e).normalize(),nr.copy(this.origin).sub(tr);var i,o,a,s,c=.5*e.distanceTo(t),u=-this.direction.dot(rr),l=nr.dot(this.direction),h=-nr.dot(rr),p=nr.lengthSq(),f=Math.abs(1-u*u);if(f>0)if(o=u*l-h,s=c*f,(i=u*h-l)>=0)if(o>=-s)if(o<=s){var d=1/f;a=(i*=d)*(i+u*(o*=d)+2*l)+o*(u*i+o+2*h)+p}else o=c,a=-(i=Math.max(0,-(u*o+l)))*i+o*(o+2*h)+p;else o=-c,a=-(i=Math.max(0,-(u*o+l)))*i+o*(o+2*h)+p;else o<=-s?a=-(i=Math.max(0,-(-u*c+l)))*i+(o=i>0?-c:Math.min(Math.max(-c,-h),c))*(o+2*h)+p:o<=s?(i=0,a=(o=Math.min(Math.max(-c,-h),c))*(o+2*h)+p):a=-(i=Math.max(0,-(u*c+l)))*i+(o=i>0?c:Math.min(Math.max(-c,-h),c))*(o+2*h)+p;else o=u>0?-c:c,a=-(i=Math.max(0,-(u*o+l)))*i+o*(o+2*h)+p;return r&&r.copy(this.direction).multiplyScalar(i).add(this.origin),n&&n.copy(rr).multiplyScalar(o).add(tr),a}),intersectSphere:function(){var e=new Vector3;return function intersectSphere(t,r){e.subVectors(t.center,this.origin);var n=e.dot(this.direction),i=e.dot(e)-n*n,o=t.radius*t.radius;if(i>o)return null;var a=Math.sqrt(o-i),s=n-a,c=n+a;return s<0&&c<0?null:s<0?this.at(c,r):this.at(s,r)}}(),intersectsSphere:function intersectsSphere(e){return this.distanceToPoint(e.center)<=e.radius},distanceToPlane:function distanceToPlane(e){var t=e.normal.dot(this.direction);if(0===t)return 0===e.distanceToPoint(this.origin)?0:null;var r=-(this.origin.dot(e.normal)+e.constant)/t;return r>=0?r:null},intersectPlane:function intersectPlane(e,t){var r=this.distanceToPlane(e);return null===r?null:this.at(r,t)},intersectsPlane:function intersectsPlane(e){var t=e.distanceToPoint(this.origin);return 0===t||e.normal.dot(this.direction)*t<0},intersectBox:function intersectBox(e,t){var r,n,i,o,a,s,c=1/this.direction.x,u=1/this.direction.y,l=1/this.direction.z,h=this.origin;return c>=0?(r=(e.min.x-h.x)*c,n=(e.max.x-h.x)*c):(r=(e.max.x-h.x)*c,n=(e.min.x-h.x)*c),u>=0?(i=(e.min.y-h.y)*u,o=(e.max.y-h.y)*u):(i=(e.max.y-h.y)*u,o=(e.min.y-h.y)*u),r>o||i>n?null:((i>r||r!=r)&&(r=i),(o<n||n!=n)&&(n=o),l>=0?(a=(e.min.z-h.z)*l,s=(e.max.z-h.z)*l):(a=(e.max.z-h.z)*l,s=(e.min.z-h.z)*l),r>s||a>n?null:((a>r||r!=r)&&(r=a),(s<n||n!=n)&&(n=s),n<0?null:this.at(r>=0?r:n,t)))},intersectsBox:(er=new Vector3,function intersectsBox(e){return null!==this.intersectBox(e,er)}),intersectTriangle:function(){var e=new Vector3,t=new Vector3,r=new Vector3,n=new Vector3;return function intersectTriangle(i,o,a,s,c){t.subVectors(o,i),r.subVectors(a,i),n.crossVectors(t,r);var u,l=this.direction.dot(n);if(l>0){if(s)return null;u=1}else{if(!(l<0))return null;u=-1,l=-l}e.subVectors(this.origin,i);var h=u*this.direction.dot(r.crossVectors(e,r));if(h<0)return null;var p=u*this.direction.dot(t.cross(e));if(p<0)return null;if(h+p>l)return null;var f=-u*e.dot(n);return f<0?null:this.at(f/l,c)}}(),applyMatrix4:function applyMatrix4(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this},equals:function equals(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}}),Object.assign(Line3.prototype,{set:function set(e,t){return this.start.copy(e),this.end.copy(t),this},clone:function clone(){return(new this.constructor).copy(this)},copy:function copy(e){return this.start.copy(e.start),this.end.copy(e.end),this},getCenter:function getCenter(e){return void 0===e&&(console.warn("THREE.Line3: .getCenter() target is now required"),e=new Vector3),e.addVectors(this.start,this.end).multiplyScalar(.5)},delta:function delta(e){return void 0===e&&(console.warn("THREE.Line3: .delta() target is now required"),e=new Vector3),e.subVectors(this.end,this.start)},distanceSq:function distanceSq(){return this.start.distanceToSquared(this.end)},distance:function distance(){return this.start.distanceTo(this.end)},at:function at(e,t){return void 0===t&&(console.warn("THREE.Line3: .at() target is now required"),t=new Vector3),this.delta(t).multiplyScalar(e).add(this.start)},closestPointToPointParameter:(ir=new Vector3,or=new Vector3,function closestPointToPointParameter(e,t){ir.subVectors(e,this.start),or.subVectors(this.end,this.start);var r=or.dot(or),n=or.dot(ir)/r;return t&&(n=At.clamp(n,0,1)),n}),closestPointToPoint:function closestPointToPoint(e,t,r){var n=this.closestPointToPointParameter(e,t);return void 0===r&&(console.warn("THREE.Line3: .closestPointToPoint() target is now required"),r=new Vector3),this.delta(r).multiplyScalar(n).add(this.start)},applyMatrix4:function applyMatrix4(e){return this.start.applyMatrix4(e),this.end.applyMatrix4(e),this},equals:function equals(e){return e.start.equals(this.start)&&e.end.equals(this.end)}}),Object.assign(Triangle,{getNormal:(ar=new Vector3,function getNormal(e,t,r,n){void 0===n&&(console.warn("THREE.Triangle: .getNormal() target is now required"),n=new Vector3),n.subVectors(r,t),ar.subVectors(e,t),n.cross(ar);var i=n.lengthSq();return i>0?n.multiplyScalar(1/Math.sqrt(i)):n.set(0,0,0)}),getBarycoord:function(){var e=new Vector3,t=new Vector3,r=new Vector3;return function getBarycoord(n,i,o,a,s){e.subVectors(a,i),t.subVectors(o,i),r.subVectors(n,i);var c=e.dot(e),u=e.dot(t),l=e.dot(r),h=t.dot(t),p=t.dot(r),f=c*h-u*u;if(void 0===s&&(console.warn("THREE.Triangle: .getBarycoord() target is now required"),s=new Vector3),0===f)return s.set(-2,-1,-1);var d=1/f,m=(h*l-u*p)*d,g=(c*p-u*l)*d;return s.set(1-m-g,g,m)}}(),containsPoint:function(){var e=new Vector3;return function containsPoint(t,r,n,i){return Triangle.getBarycoord(t,r,n,i,e),e.x>=0&&e.y>=0&&e.x+e.y<=1}}()}),Object.assign(Triangle.prototype,{set:function set(e,t,r){return this.a.copy(e),this.b.copy(t),this.c.copy(r),this},setFromPointsAndIndices:function setFromPointsAndIndices(e,t,r,n){return this.a.copy(e[t]),this.b.copy(e[r]),this.c.copy(e[n]),this},clone:function clone(){return(new this.constructor).copy(this)},copy:function copy(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this},getArea:function(){var e=new Vector3,t=new Vector3;return function getArea(){return e.subVectors(this.c,this.b),t.subVectors(this.a,this.b),.5*e.cross(t).length()}}(),getMidpoint:function getMidpoint(e){return void 0===e&&(console.warn("THREE.Triangle: .getMidpoint() target is now required"),e=new Vector3),e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)},getNormal:function getNormal(e){return Triangle.getNormal(this.a,this.b,this.c,e)},getPlane:function getPlane(e){return void 0===e&&(console.warn("THREE.Triangle: .getPlane() target is now required"),e=new Vector3),e.setFromCoplanarPoints(this.a,this.b,this.c)},getBarycoord:function getBarycoord(e,t){return Triangle.getBarycoord(e,this.a,this.b,this.c,t)},containsPoint:function containsPoint(e){return Triangle.containsPoint(e,this.a,this.b,this.c)},intersectsBox:function intersectsBox(e){return e.intersectsTriangle(this)},closestPointToPoint:function(){var e=new Plane,t=[new Line3,new Line3,new Line3],r=new Vector3,n=new Vector3;return function closestPointToPoint(i,o){void 0===o&&(console.warn("THREE.Triangle: .closestPointToPoint() target is now required"),o=new Vector3);var a=1/0;if(e.setFromCoplanarPoints(this.a,this.b,this.c),e.projectPoint(i,r),!0===this.containsPoint(r))o.copy(r);else{t[0].set(this.a,this.b),t[1].set(this.b,this.c),t[2].set(this.c,this.a);for(var s=0;s<t.length;s++){t[s].closestPointToPoint(r,!0,n);var c=r.distanceToSquared(n);c<a&&(a=c,o.copy(n))}}return o}}(),equals:function equals(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}}),Mesh.prototype=Object.assign(Object.create(Object3D.prototype),{constructor:Mesh,isMesh:!0,setDrawMode:function setDrawMode(e){this.drawMode=e},copy:function copy(e){return Object3D.prototype.copy.call(this,e),this.drawMode=e.drawMode,void 0!==e.morphTargetInfluences&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),void 0!==e.morphTargetDictionary&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this},updateMorphTargets:function updateMorphTargets(){var e,t,r,n=this.geometry;if(n.isBufferGeometry){var i=n.morphAttributes,o=Object.keys(i);if(o.length>0){var a=i[o[0]];if(void 0!==a)for(this.morphTargetInfluences=[],this.morphTargetDictionary={},e=0,t=a.length;e<t;e++)r=a[e].name||String(e),this.morphTargetInfluences.push(0),this.morphTargetDictionary[r]=e}}else{var s=n.morphTargets;if(void 0!==s&&s.length>0)for(this.morphTargetInfluences=[],this.morphTargetDictionary={},e=0,t=s.length;e<t;e++)r=s[e].name||String(e),this.morphTargetInfluences.push(0),this.morphTargetDictionary[r]=e}},raycast:function(){var e=new Matrix4,t=new Ray,r=new Sphere,n=new Vector3,i=new Vector3,o=new Vector3,a=new Vector3,s=new Vector3,c=new Vector3,u=new Vector2,l=new Vector2,h=new Vector2,p=new Vector3,f=new Vector3,d=new Vector3;function uvIntersection(e,t,r,n,i,o,a){return Triangle.getBarycoord(e,t,r,n,p),i.multiplyScalar(p.x),o.multiplyScalar(p.y),a.multiplyScalar(p.z),i.add(o).add(a),i.clone()}function checkIntersection(e,t,r,n,i,o,a,s){if(null===(t.side===x?n.intersectTriangle(a,o,i,!0,s):n.intersectTriangle(i,o,a,t.side!==M,s)))return null;d.copy(s),d.applyMatrix4(e.matrixWorld);var c=r.ray.origin.distanceTo(d);return c<r.near||c>r.far?null:{distance:c,point:d.clone(),object:e}}function checkBufferGeometryIntersection(e,t,r,a,s,c,p,d){n.fromBufferAttribute(a,c),i.fromBufferAttribute(a,p),o.fromBufferAttribute(a,d);var m=checkIntersection(e,e.material,t,r,n,i,o,f);if(m){s&&(u.fromBufferAttribute(s,c),l.fromBufferAttribute(s,p),h.fromBufferAttribute(s,d),m.uv=uvIntersection(f,n,i,o,u,l,h));var g=new Face3(c,p,d);Triangle.getNormal(n,i,o,g.normal),m.face=g,m.faceIndex=c}return m}return function raycast(p,d){var m,g=this.geometry,y=this.material,v=this.matrixWorld;if(void 0!==y&&(null===g.boundingSphere&&g.computeBoundingSphere(),r.copy(g.boundingSphere),r.applyMatrix4(v),!1!==p.ray.intersectsSphere(r)&&(e.getInverse(v),t.copy(p.ray).applyMatrix4(e),null===g.boundingBox||!1!==t.intersectsBox(g.boundingBox))))if(g.isBufferGeometry){var _,b,w,x,M,S=g.index,C=g.attributes.position,P=g.attributes.uv;if(null!==S)for(x=0,M=S.count;x<M;x+=3)_=S.getX(x),b=S.getX(x+1),w=S.getX(x+2),(m=checkBufferGeometryIntersection(this,p,t,C,P,_,b,w))&&(m.faceIndex=Math.floor(x/3),d.push(m));else if(void 0!==C)for(x=0,M=C.count;x<M;x+=3)(m=checkBufferGeometryIntersection(this,p,t,C,P,_=x,b=x+1,w=x+2))&&(m.index=_,d.push(m))}else if(g.isGeometry){var E,T,O,A,L=Array.isArray(y),k=g.vertices,R=g.faces,I=g.faceVertexUvs[0];I.length>0&&(A=I);for(var N=0,F=R.length;N<F;N++){var j=R[N],B=L?y[j.materialIndex]:y;if(void 0!==B){if(E=k[j.a],T=k[j.b],O=k[j.c],!0===B.morphTargets){var V=g.morphTargets,D=this.morphTargetInfluences;n.set(0,0,0),i.set(0,0,0),o.set(0,0,0);for(var U=0,G=V.length;U<G;U++){var z=D[U];if(0!==z){var H=V[U].vertices;n.addScaledVector(a.subVectors(H[j.a],E),z),i.addScaledVector(s.subVectors(H[j.b],T),z),o.addScaledVector(c.subVectors(H[j.c],O),z)}}n.add(E),i.add(T),o.add(O),E=n,T=i,O=o}if(m=checkIntersection(this,B,p,t,E,T,O,f)){if(A&&A[N]){var W=A[N];u.copy(W[0]),l.copy(W[1]),h.copy(W[2]),m.uv=uvIntersection(f,E,T,O,u,l,h)}m.face=j,m.faceIndex=N,d.push(m)}}}}}}(),clone:function clone(){return new this.constructor(this.geometry,this.material).copy(this)}}),CubeTexture.prototype=Object.create(Texture.prototype),CubeTexture.prototype.constructor=CubeTexture,CubeTexture.prototype.isCubeTexture=!0,Object.defineProperty(CubeTexture.prototype,"images",{get:function get(){return this.image},set:function set(e){this.image=e}});var cr=new Texture,ur=new CubeTexture;function UniformContainer(){this.seq=[],this.map={}}var lr=[],hr=[],pr=new Float32Array(16),fr=new Float32Array(9);function flatten(e,t,r){var n=e[0];if(n<=0||n>0)return e;var i=t*r,o=lr[i];if(void 0===o&&(o=new Float32Array(i),lr[i]=o),0!==t){n.toArray(o,0);for(var a=1,s=0;a!==t;++a)s+=r,e[a].toArray(o,s)}return o}function allocTexUnits(e,t){var r=hr[t];void 0===r&&(r=new Int32Array(t),hr[t]=r);for(var n=0;n!==t;++n)r[n]=e.allocTextureUnit();return r}function setValue1f(e,t){e.uniform1f(this.addr,t)}function setValue1i(e,t){e.uniform1i(this.addr,t)}function setValue2fv(e,t){void 0===t.x?e.uniform2fv(this.addr,t):e.uniform2f(this.addr,t.x,t.y)}function setValue3fv(e,t){void 0!==t.x?e.uniform3f(this.addr,t.x,t.y,t.z):void 0!==t.r?e.uniform3f(this.addr,t.r,t.g,t.b):e.uniform3fv(this.addr,t)}function setValue4fv(e,t){void 0===t.x?e.uniform4fv(this.addr,t):e.uniform4f(this.addr,t.x,t.y,t.z,t.w)}function setValue2fm(e,t){e.uniformMatrix2fv(this.addr,!1,t.elements||t)}function setValue3fm(e,t){void 0===t.elements?e.uniformMatrix3fv(this.addr,!1,t):(fr.set(t.elements),e.uniformMatrix3fv(this.addr,!1,fr))}function setValue4fm(e,t){void 0===t.elements?e.uniformMatrix4fv(this.addr,!1,t):(pr.set(t.elements),e.uniformMatrix4fv(this.addr,!1,pr))}function setValueT1(e,t,r){var n=r.allocTextureUnit();e.uniform1i(this.addr,n),r.setTexture2D(t||cr,n)}function setValueT6(e,t,r){var n=r.allocTextureUnit();e.uniform1i(this.addr,n),r.setTextureCube(t||ur,n)}function setValue2iv(e,t){e.uniform2iv(this.addr,t)}function setValue3iv(e,t){e.uniform3iv(this.addr,t)}function setValue4iv(e,t){e.uniform4iv(this.addr,t)}function setValue1fv(e,t){e.uniform1fv(this.addr,t)}function setValue1iv(e,t){e.uniform1iv(this.addr,t)}function setValueV2a(e,t){e.uniform2fv(this.addr,flatten(t,this.size,2))}function setValueV3a(e,t){e.uniform3fv(this.addr,flatten(t,this.size,3))}function setValueV4a(e,t){e.uniform4fv(this.addr,flatten(t,this.size,4))}function setValueM2a(e,t){e.uniformMatrix2fv(this.addr,!1,flatten(t,this.size,4))}function setValueM3a(e,t){e.uniformMatrix3fv(this.addr,!1,flatten(t,this.size,9))}function setValueM4a(e,t){e.uniformMatrix4fv(this.addr,!1,flatten(t,this.size,16))}function setValueT1a(e,t,r){var n=t.length,i=allocTexUnits(r,n);e.uniform1iv(this.addr,i);for(var o=0;o!==n;++o)r.setTexture2D(t[o]||cr,i[o])}function setValueT6a(e,t,r){var n=t.length,i=allocTexUnits(r,n);e.uniform1iv(this.addr,i);for(var o=0;o!==n;++o)r.setTextureCube(t[o]||ur,i[o])}function SingleUniform(e,t,r){this.id=e,this.addr=r,this.setValue=function getSingularSetter(e){switch(e){case 5126:return setValue1f;case 35664:return setValue2fv;case 35665:return setValue3fv;case 35666:return setValue4fv;case 35674:return setValue2fm;case 35675:return setValue3fm;case 35676:return setValue4fm;case 35678:case 36198:return setValueT1;case 35680:return setValueT6;case 5124:case 35670:return setValue1i;case 35667:case 35671:return setValue2iv;case 35668:case 35672:return setValue3iv;case 35669:case 35673:return setValue4iv}}(t.type)}function PureArrayUniform(e,t,r){this.id=e,this.addr=r,this.size=t.size,this.setValue=function getPureArraySetter(e){switch(e){case 5126:return setValue1fv;case 35664:return setValueV2a;case 35665:return setValueV3a;case 35666:return setValueV4a;case 35674:return setValueM2a;case 35675:return setValueM3a;case 35676:return setValueM4a;case 35678:return setValueT1a;case 35680:return setValueT6a;case 5124:case 35670:return setValue1iv;case 35667:case 35671:return setValue2iv;case 35668:case 35672:return setValue3iv;case 35669:case 35673:return setValue4iv}}(t.type)}function StructuredUniform(e){this.id=e,UniformContainer.call(this)}StructuredUniform.prototype.setValue=function(e,t){for(var r=this.seq,n=0,i=r.length;n!==i;++n){var o=r[n];o.setValue(e,t[o.id])}};var dr=/([\w\d_]+)(\])?(\[|\.)?/g;function addUniform(e,t){e.seq.push(t),e.map[t.id]=t}function parseUniform(e,t,r){var n=e.name,i=n.length;for(dr.lastIndex=0;;){var o=dr.exec(n),a=dr.lastIndex,s=o[1],c="]"===o[2],u=o[3];if(c&&(s|=0),void 0===u||"["===u&&a+2===i){addUniform(r,void 0===u?new SingleUniform(s,e,t):new PureArrayUniform(s,e,t));break}var l=r.map[s];void 0===l&&addUniform(r,l=new StructuredUniform(s)),r=l}}function WebGLUniforms(e,t,r){UniformContainer.call(this),this.renderer=r;for(var n=e.getProgramParameter(t,e.ACTIVE_UNIFORMS),i=0;i<n;++i){var o=e.getActiveUniform(t,i),a=o.name;parseUniform(o,e.getUniformLocation(t,a),this)}}function WebGLShader(e,t,r){var n=e.createShader(t);return e.shaderSource(n,r),e.compileShader(n),!1===e.getShaderParameter(n,e.COMPILE_STATUS)&&console.error("THREE.WebGLShader: Shader couldn't compile."),""!==e.getShaderInfoLog(n)&&console.warn("THREE.WebGLShader: gl.getShaderInfoLog()",t===e.VERTEX_SHADER?"vertex":"fragment",e.getShaderInfoLog(n),function addLineNumbers(e){for(var t=e.split("\n"),r=0;r<t.length;r++)t[r]=r+1+": "+t[r];return t.join("\n")}(r)),n}WebGLUniforms.prototype.setValue=function(e,t,r){var n=this.map[t];void 0!==n&&n.setValue(e,r,this.renderer)},WebGLUniforms.prototype.setOptional=function(e,t,r){var n=t[r];void 0!==n&&this.setValue(e,r,n)},WebGLUniforms.upload=function(e,t,r,n){for(var i=0,o=t.length;i!==o;++i){var a=t[i],s=r[a.id];!1!==s.needsUpdate&&a.setValue(e,s.value,n)}},WebGLUniforms.seqWithValue=function(e,t){for(var r=[],n=0,i=e.length;n!==i;++n){var o=e[n];o.id in t&&r.push(o)}return r};var mr=0;function getEncodingComponents(e){switch(e){case wt:return["Linear","( value )"];case xt:return["sRGB","( value )"];case St:return["RGBE","( value )"];case Ct:return["RGBM","( value, 7.0 )"];case Pt:return["RGBM","( value, 16.0 )"];case Et:return["RGBD","( value, 256.0 )"];case Mt:return["Gamma","( value, float( GAMMA_FACTOR ) )"];default:throw new Error("unsupported encoding: "+e)}}function getTexelDecodingFunction(e,t){var r=getEncodingComponents(t);return"vec4 "+e+"( vec4 value ) { return "+r[0]+"ToLinear"+r[1]+"; }"}function filterEmptyLine(e){return""!==e}function replaceLightNums(e,t){return e.replace(/NUM_DIR_LIGHTS/g,t.numDirLights).replace(/NUM_SPOT_LIGHTS/g,t.numSpotLights).replace(/NUM_RECT_AREA_LIGHTS/g,t.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,t.numPointLights).replace(/NUM_HEMI_LIGHTS/g,t.numHemiLights)}function replaceClippingPlaneNums(e,t){return e.replace(/NUM_CLIPPING_PLANES/g,t.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,t.numClippingPlanes-t.numClipIntersection)}function parseIncludes(e){return e.replace(/^[ \t]*#include +<([\w\d.]+)>/gm,function replace(e,t){var r=Vt[t];if(void 0===r)throw new Error("Can not resolve #include <"+t+">");return parseIncludes(r)})}function unrollLoops(e){return e.replace(/#pragma unroll_loop[\s]+?for \( int i \= (\d+)\; i < (\d+)\; i \+\+ \) \{([\s\S]+?)(?=\})\}/g,function replace(e,t,r,n){for(var i="",o=parseInt(t);o<parseInt(r);o++)i+=n.replace(/\[ i \]/g,"[ "+o+" ]");return i})}function WebGLProgram(e,t,r,n,i,o){var a=e.context,s=n.defines,c=i.vertexShader,u=i.fragmentShader,l="SHADOWMAP_TYPE_BASIC";o.shadowMapType===_?l="SHADOWMAP_TYPE_PCF":o.shadowMapType===b&&(l="SHADOWMAP_TYPE_PCF_SOFT");var h="ENVMAP_TYPE_CUBE",p="ENVMAP_MODE_REFLECTION",f="ENVMAP_BLENDING_MULTIPLY";if(o.envMap){switch(n.envMap.mapping){case he:case pe:h="ENVMAP_TYPE_CUBE";break;case ge:case ye:h="ENVMAP_TYPE_CUBE_UV";break;case fe:case de:h="ENVMAP_TYPE_EQUIREC";break;case me:h="ENVMAP_TYPE_SPHERE"}switch(n.envMap.mapping){case pe:case de:p="ENVMAP_MODE_REFRACTION"}switch(n.combine){case ne:f="ENVMAP_BLENDING_MULTIPLY";break;case ie:f="ENVMAP_BLENDING_MIX";break;case oe:f="ENVMAP_BLENDING_ADD"}}var d,m,g=e.gammaFactor>0?e.gammaFactor:1,y=function generateExtensions(e,t,r){return[(e=e||{}).derivatives||t.envMapCubeUV||t.bumpMap||t.normalMap||t.flatShading?"#extension GL_OES_standard_derivatives : enable":"",(e.fragDepth||t.logarithmicDepthBuffer)&&r.get("EXT_frag_depth")?"#extension GL_EXT_frag_depth : enable":"",e.drawBuffers&&r.get("WEBGL_draw_buffers")?"#extension GL_EXT_draw_buffers : require":"",(e.shaderTextureLOD||t.envMap)&&r.get("EXT_shader_texture_lod")?"#extension GL_EXT_shader_texture_lod : enable":""].filter(filterEmptyLine).join("\n")}(n.extensions,o,t),v=function generateDefines(e){var t=[];for(var r in e){var n=e[r];!1!==n&&t.push("#define "+r+" "+n)}return t.join("\n")}(s),w=a.createProgram();n.isRawShaderMaterial?((d=[v].filter(filterEmptyLine).join("\n")).length>0&&(d+="\n"),(m=[y,v].filter(filterEmptyLine).join("\n")).length>0&&(m+="\n")):(d=["precision "+o.precision+" float;","precision "+o.precision+" int;","#define SHADER_NAME "+i.name,v,o.supportsVertexTextures?"#define VERTEX_TEXTURES":"","#define GAMMA_FACTOR "+g,"#define MAX_BONES "+o.maxBones,o.useFog&&o.fog?"#define USE_FOG":"",o.useFog&&o.fogExp?"#define FOG_EXP2":"",o.map?"#define USE_MAP":"",o.envMap?"#define USE_ENVMAP":"",o.envMap?"#define "+p:"",o.lightMap?"#define USE_LIGHTMAP":"",o.aoMap?"#define USE_AOMAP":"",o.emissiveMap?"#define USE_EMISSIVEMAP":"",o.bumpMap?"#define USE_BUMPMAP":"",o.normalMap?"#define USE_NORMALMAP":"",o.displacementMap&&o.supportsVertexTextures?"#define USE_DISPLACEMENTMAP":"",o.specularMap?"#define USE_SPECULARMAP":"",o.roughnessMap?"#define USE_ROUGHNESSMAP":"",o.metalnessMap?"#define USE_METALNESSMAP":"",o.alphaMap?"#define USE_ALPHAMAP":"",o.vertexColors?"#define USE_COLOR":"",o.flatShading?"#define FLAT_SHADED":"",o.skinning?"#define USE_SKINNING":"",o.useVertexTexture?"#define BONE_TEXTURE":"",o.morphTargets?"#define USE_MORPHTARGETS":"",o.morphNormals&&!1===o.flatShading?"#define USE_MORPHNORMALS":"",o.doubleSided?"#define DOUBLE_SIDED":"",o.flipSided?"#define FLIP_SIDED":"",o.shadowMapEnabled?"#define USE_SHADOWMAP":"",o.shadowMapEnabled?"#define "+l:"",o.sizeAttenuation?"#define USE_SIZEATTENUATION":"",o.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",o.logarithmicDepthBuffer&&t.get("EXT_frag_depth")?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_COLOR","\tattribute vec3 color;","#endif","#ifdef USE_MORPHTARGETS","\tattribute vec3 morphTarget0;","\tattribute vec3 morphTarget1;","\tattribute vec3 morphTarget2;","\tattribute vec3 morphTarget3;","\t#ifdef USE_MORPHNORMALS","\t\tattribute vec3 morphNormal0;","\t\tattribute vec3 morphNormal1;","\t\tattribute vec3 morphNormal2;","\t\tattribute vec3 morphNormal3;","\t#else","\t\tattribute vec3 morphTarget4;","\t\tattribute vec3 morphTarget5;","\t\tattribute vec3 morphTarget6;","\t\tattribute vec3 morphTarget7;","\t#endif","#endif","#ifdef USE_SKINNING","\tattribute vec4 skinIndex;","\tattribute vec4 skinWeight;","#endif","\n"].filter(filterEmptyLine).join("\n"),m=[y,"precision "+o.precision+" float;","precision "+o.precision+" int;","#define SHADER_NAME "+i.name,v,o.alphaTest?"#define ALPHATEST "+o.alphaTest:"","#define GAMMA_FACTOR "+g,o.useFog&&o.fog?"#define USE_FOG":"",o.useFog&&o.fogExp?"#define FOG_EXP2":"",o.map?"#define USE_MAP":"",o.envMap?"#define USE_ENVMAP":"",o.envMap?"#define "+h:"",o.envMap?"#define "+p:"",o.envMap?"#define "+f:"",o.lightMap?"#define USE_LIGHTMAP":"",o.aoMap?"#define USE_AOMAP":"",o.emissiveMap?"#define USE_EMISSIVEMAP":"",o.bumpMap?"#define USE_BUMPMAP":"",o.normalMap?"#define USE_NORMALMAP":"",o.specularMap?"#define USE_SPECULARMAP":"",o.roughnessMap?"#define USE_ROUGHNESSMAP":"",o.metalnessMap?"#define USE_METALNESSMAP":"",o.alphaMap?"#define USE_ALPHAMAP":"",o.vertexColors?"#define USE_COLOR":"",o.gradientMap?"#define USE_GRADIENTMAP":"",o.flatShading?"#define FLAT_SHADED":"",o.doubleSided?"#define DOUBLE_SIDED":"",o.flipSided?"#define FLIP_SIDED":"",o.shadowMapEnabled?"#define USE_SHADOWMAP":"",o.shadowMapEnabled?"#define "+l:"",o.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",o.physicallyCorrectLights?"#define PHYSICALLY_CORRECT_LIGHTS":"",o.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",o.logarithmicDepthBuffer&&t.get("EXT_frag_depth")?"#define USE_LOGDEPTHBUF_EXT":"",o.envMap&&t.get("EXT_shader_texture_lod")?"#define TEXTURE_LOD_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;",o.toneMapping!==ae?"#define TONE_MAPPING":"",o.toneMapping!==ae?Vt.tonemapping_pars_fragment:"",o.toneMapping!==ae?function getToneMappingFunction(e,t){var r;switch(t){case se:r="Linear";break;case ce:r="Reinhard";break;case ue:r="Uncharted2";break;case le:r="OptimizedCineon";break;default:throw new Error("unsupported toneMapping: "+t)}return"vec3 "+e+"( vec3 color ) { return "+r+"ToneMapping( color ); }"}("toneMapping",o.toneMapping):"",o.dithering?"#define DITHERING":"",o.outputEncoding||o.mapEncoding||o.envMapEncoding||o.emissiveMapEncoding?Vt.encodings_pars_fragment:"",o.mapEncoding?getTexelDecodingFunction("mapTexelToLinear",o.mapEncoding):"",o.envMapEncoding?getTexelDecodingFunction("envMapTexelToLinear",o.envMapEncoding):"",o.emissiveMapEncoding?getTexelDecodingFunction("emissiveMapTexelToLinear",o.emissiveMapEncoding):"",o.outputEncoding?function getTexelEncodingFunction(e,t){var r=getEncodingComponents(t);return"vec4 "+e+"( vec4 value ) { return LinearTo"+r[0]+r[1]+"; }"}("linearToOutputTexel",o.outputEncoding):"",o.depthPacking?"#define DEPTH_PACKING "+n.depthPacking:"","\n"].filter(filterEmptyLine).join("\n")),c=replaceClippingPlaneNums(c=replaceLightNums(c=parseIncludes(c),o),o),u=replaceClippingPlaneNums(u=replaceLightNums(u=parseIncludes(u),o),o);var x=d+(c=unrollLoops(c)),M=m+(u=unrollLoops(u)),S=WebGLShader(a,a.VERTEX_SHADER,x),C=WebGLShader(a,a.FRAGMENT_SHADER,M);a.attachShader(w,S),a.attachShader(w,C),void 0!==n.index0AttributeName?a.bindAttribLocation(w,0,n.index0AttributeName):!0===o.morphTargets&&a.bindAttribLocation(w,0,"position"),a.linkProgram(w);var P,E,T=a.getProgramInfoLog(w).trim(),O=a.getShaderInfoLog(S).trim(),A=a.getShaderInfoLog(C).trim(),L=!0,k=!0;return!1===a.getProgramParameter(w,a.LINK_STATUS)?(L=!1,console.error("THREE.WebGLProgram: shader error: ",a.getError(),"gl.VALIDATE_STATUS",a.getProgramParameter(w,a.VALIDATE_STATUS),"gl.getProgramInfoLog",T,O,A)):""!==T?console.warn("THREE.WebGLProgram: gl.getProgramInfoLog()",T):""!==O&&""!==A||(k=!1),k&&(this.diagnostics={runnable:L,material:n,programLog:T,vertexShader:{log:O,prefix:d},fragmentShader:{log:A,prefix:m}}),a.deleteShader(S),a.deleteShader(C),this.getUniforms=function(){return void 0===P&&(P=new WebGLUniforms(a,w,e)),P},this.getAttributes=function(){return void 0===E&&(E=function fetchAttributeLocations(e,t){for(var r={},n=e.getProgramParameter(t,e.ACTIVE_ATTRIBUTES),i=0;i<n;i++){var o=e.getActiveAttrib(t,i).name;r[o]=e.getAttribLocation(t,o)}return r}(a,w)),E},this.destroy=function(){a.deleteProgram(w),this.program=void 0},Object.defineProperties(this,{uniforms:{get:function get(){return console.warn("THREE.WebGLProgram: .uniforms is now .getUniforms()."),this.getUniforms()}},attributes:{get:function get(){return console.warn("THREE.WebGLProgram: .attributes is now .getAttributes()."),this.getAttributes()}}}),this.id=mr++,this.code=r,this.usedTimes=1,this.program=w,this.vertexShader=S,this.fragmentShader=C,this}function WebGLPrograms(e,t,r){var n=[],i={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"phong",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow"},o=["precision","supportsVertexTextures","map","mapEncoding","envMap","envMapMode","envMapEncoding","lightMap","aoMap","emissiveMap","emissiveMapEncoding","bumpMap","normalMap","displacementMap","specularMap","roughnessMap","metalnessMap","gradientMap","alphaMap","combine","vertexColors","fog","useFog","fogExp","flatShading","sizeAttenuation","logarithmicDepthBuffer","skinning","maxBones","useVertexTexture","morphTargets","morphNormals","maxMorphTargets","maxMorphNormals","premultipliedAlpha","numDirLights","numPointLights","numSpotLights","numHemiLights","numRectAreaLights","shadowMapEnabled","shadowMapType","toneMapping","physicallyCorrectLights","alphaTest","doubleSided","flipSided","numClippingPlanes","numClipIntersection","depthPacking","dithering"];function getTextureEncodingFromMap(e,t){var r;return e?e.isTexture?r=e.encoding:e.isWebGLRenderTarget&&(console.warn("THREE.WebGLPrograms.getTextureEncodingFromMap: don't use render targets as textures. Use their .texture property instead."),r=e.texture.encoding):r=wt,r===wt&&t&&(r=Mt),r}this.getParameters=function(t,n,o,a,s,c,u){var l=i[t.type],h=u.isSkinnedMesh?function allocateBones(e){var t=e.skeleton.bones;if(r.floatVertexTextures)return 1024;var n=r.maxVertexUniforms,i=Math.floor((n-20)/4),o=Math.min(i,t.length);return o<t.length?(console.warn("THREE.WebGLRenderer: Skeleton has "+t.length+" bones. This GPU supports "+o+"."),0):o}(u):0,p=r.precision;null!==t.precision&&(p=r.getMaxPrecision(t.precision))!==t.precision&&console.warn("THREE.WebGLProgram.getParameters:",t.precision,"not supported, using",p,"instead.");var f=e.getRenderTarget();return{shaderID:l,precision:p,supportsVertexTextures:r.vertexTextures,outputEncoding:getTextureEncodingFromMap(f?f.texture:null,e.gammaOutput),map:!!t.map,mapEncoding:getTextureEncodingFromMap(t.map,e.gammaInput),envMap:!!t.envMap,envMapMode:t.envMap&&t.envMap.mapping,envMapEncoding:getTextureEncodingFromMap(t.envMap,e.gammaInput),envMapCubeUV:!!t.envMap&&(t.envMap.mapping===ge||t.envMap.mapping===ye),lightMap:!!t.lightMap,aoMap:!!t.aoMap,emissiveMap:!!t.emissiveMap,emissiveMapEncoding:getTextureEncodingFromMap(t.emissiveMap,e.gammaInput),bumpMap:!!t.bumpMap,normalMap:!!t.normalMap,displacementMap:!!t.displacementMap,roughnessMap:!!t.roughnessMap,metalnessMap:!!t.metalnessMap,specularMap:!!t.specularMap,alphaMap:!!t.alphaMap,gradientMap:!!t.gradientMap,combine:t.combine,vertexColors:t.vertexColors,fog:!!a,useFog:t.fog,fogExp:a&&a.isFogExp2,flatShading:t.flatShading,sizeAttenuation:t.sizeAttenuation,logarithmicDepthBuffer:r.logarithmicDepthBuffer,skinning:t.skinning&&h>0,maxBones:h,useVertexTexture:r.floatVertexTextures,morphTargets:t.morphTargets,morphNormals:t.morphNormals,maxMorphTargets:e.maxMorphTargets,maxMorphNormals:e.maxMorphNormals,numDirLights:n.directional.length,numPointLights:n.point.length,numSpotLights:n.spot.length,numRectAreaLights:n.rectArea.length,numHemiLights:n.hemi.length,numClippingPlanes:s,numClipIntersection:c,dithering:t.dithering,shadowMapEnabled:e.shadowMap.enabled&&u.receiveShadow&&o.length>0,shadowMapType:e.shadowMap.type,toneMapping:e.toneMapping,physicallyCorrectLights:e.physicallyCorrectLights,premultipliedAlpha:t.premultipliedAlpha,alphaTest:t.alphaTest,doubleSided:t.side===M,flipSided:t.side===x,depthPacking:void 0!==t.depthPacking&&t.depthPacking}},this.getProgramCode=function(t,r){var n=[];if(r.shaderID?n.push(r.shaderID):(n.push(t.fragmentShader),n.push(t.vertexShader)),void 0!==t.defines)for(var i in t.defines)n.push(i),n.push(t.defines[i]);for(var a=0;a<o.length;a++)n.push(r[o[a]]);return n.push(t.onBeforeCompile.toString()),n.push(e.gammaOutput),n.join()},this.acquireProgram=function(r,i,o,a){for(var s,c=0,u=n.length;c<u;c++){var l=n[c];if(l.code===a){++(s=l).usedTimes;break}}return void 0===s&&(s=new WebGLProgram(e,t,a,r,i,o),n.push(s)),s},this.releaseProgram=function(e){if(0==--e.usedTimes){var t=n.indexOf(e);n[t]=n[n.length-1],n.pop(),e.destroy()}},this.programs=n}function painterSortStable(e,t){return e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.program&&t.program&&e.program!==t.program?e.program.id-t.program.id:e.material.id!==t.material.id?e.material.id-t.material.id:e.z!==t.z?e.z-t.z:e.id-t.id}function reversePainterSortStable(e,t){return e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.z!==t.z?t.z-e.z:e.id-t.id}function WebGLRenderLists(){var e={};return{get:function get(t,r){var n=t.id+","+r.id,i=e[n];return void 0===i&&(i=new function WebGLRenderList(){var e=[],t=0,r=[],n=[];return{opaque:r,transparent:n,init:function init(){t=0,r.length=0,n.length=0},push:function push(i,o,a,s,c){var u=e[t];void 0===u?(u={id:i.id,object:i,geometry:o,material:a,program:a.program,renderOrder:i.renderOrder,z:s,group:c},e[t]=u):(u.id=i.id,u.object=i,u.geometry=o,u.material=a,u.program=a.program,u.renderOrder=i.renderOrder,u.z=s,u.group=c),(!0===a.transparent?n:r).push(u),t++},sort:function sort(){r.length>1&&r.sort(painterSortStable),n.length>1&&n.sort(reversePainterSortStable)}}},e[n]=i),i},dispose:function dispose(){e={}}}}var gr,yr,vr,_r,br,wr,xr,Mr,Sr=0;function WebGLLights(){var e=new function UniformsCache(){var e={};return{get:function get(t){if(void 0!==e[t.id])return e[t.id];var r;switch(t.type){case"DirectionalLight":r={direction:new Vector3,color:new Color,shadow:!1,shadowBias:0,shadowRadius:1,shadowMapSize:new Vector2};break;case"SpotLight":r={position:new Vector3,direction:new Vector3,color:new Color,distance:0,coneCos:0,penumbraCos:0,decay:0,shadow:!1,shadowBias:0,shadowRadius:1,shadowMapSize:new Vector2};break;case"PointLight":r={position:new Vector3,color:new Color,distance:0,decay:0,shadow:!1,shadowBias:0,shadowRadius:1,shadowMapSize:new Vector2,shadowCameraNear:1,shadowCameraFar:1e3};break;case"HemisphereLight":r={direction:new Vector3,skyColor:new Color,groundColor:new Color};break;case"RectAreaLight":r={color:new Color,position:new Vector3,halfWidth:new Vector3,halfHeight:new Vector3}}return e[t.id]=r,r}}},t={id:Sr++,hash:"",ambient:[0,0,0],directional:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotShadowMap:[],spotShadowMatrix:[],rectArea:[],point:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[]},r=new Vector3,n=new Matrix4,i=new Matrix4;return{setup:function setup(o,a,s){for(var c=0,u=0,l=0,h=0,p=0,f=0,d=0,m=0,g=s.matrixWorldInverse,y=0,v=o.length;y<v;y++){var _=o[y],b=_.color,w=_.intensity,x=_.distance,M=_.shadow&&_.shadow.map?_.shadow.map.texture:null;if(_.isAmbientLight)c+=b.r*w,u+=b.g*w,l+=b.b*w;else if(_.isDirectionalLight){if((C=e.get(_)).color.copy(_.color).multiplyScalar(_.intensity),C.direction.setFromMatrixPosition(_.matrixWorld),r.setFromMatrixPosition(_.target.matrixWorld),C.direction.sub(r),C.direction.transformDirection(g),C.shadow=_.castShadow,_.castShadow){var S=_.shadow;C.shadowBias=S.bias,C.shadowRadius=S.radius,C.shadowMapSize=S.mapSize}t.directionalShadowMap[h]=M,t.directionalShadowMatrix[h]=_.shadow.matrix,t.directional[h]=C,h++}else if(_.isSpotLight)(C=e.get(_)).position.setFromMatrixPosition(_.matrixWorld),C.position.applyMatrix4(g),C.color.copy(b).multiplyScalar(w),C.distance=x,C.direction.setFromMatrixPosition(_.matrixWorld),r.setFromMatrixPosition(_.target.matrixWorld),C.direction.sub(r),C.direction.transformDirection(g),C.coneCos=Math.cos(_.angle),C.penumbraCos=Math.cos(_.angle*(1-_.penumbra)),C.decay=0===_.distance?0:_.decay,C.shadow=_.castShadow,_.castShadow&&(S=_.shadow,C.shadowBias=S.bias,C.shadowRadius=S.radius,C.shadowMapSize=S.mapSize),t.spotShadowMap[f]=M,t.spotShadowMatrix[f]=_.shadow.matrix,t.spot[f]=C,f++;else if(_.isRectAreaLight)(C=e.get(_)).color.copy(b).multiplyScalar(w),C.position.setFromMatrixPosition(_.matrixWorld),C.position.applyMatrix4(g),i.identity(),n.copy(_.matrixWorld),n.premultiply(g),i.extractRotation(n),C.halfWidth.set(.5*_.width,0,0),C.halfHeight.set(0,.5*_.height,0),C.halfWidth.applyMatrix4(i),C.halfHeight.applyMatrix4(i),t.rectArea[d]=C,d++;else if(_.isPointLight)(C=e.get(_)).position.setFromMatrixPosition(_.matrixWorld),C.position.applyMatrix4(g),C.color.copy(_.color).multiplyScalar(_.intensity),C.distance=_.distance,C.decay=0===_.distance?0:_.decay,C.shadow=_.castShadow,_.castShadow&&(S=_.shadow,C.shadowBias=S.bias,C.shadowRadius=S.radius,C.shadowMapSize=S.mapSize,C.shadowCameraNear=S.camera.near,C.shadowCameraFar=S.camera.far),t.pointShadowMap[p]=M,t.pointShadowMatrix[p]=_.shadow.matrix,t.point[p]=C,p++;else if(_.isHemisphereLight){var C;(C=e.get(_)).direction.setFromMatrixPosition(_.matrixWorld),C.direction.transformDirection(g),C.direction.normalize(),C.skyColor.copy(_.color).multiplyScalar(w),C.groundColor.copy(_.groundColor).multiplyScalar(w),t.hemi[m]=C,m++}}t.ambient[0]=c,t.ambient[1]=u,t.ambient[2]=l,t.directional.length=h,t.spot.length=f,t.rectArea.length=d,t.point.length=p,t.hemi.length=m,t.hash=t.id+","+h+","+p+","+f+","+d+","+m+","+a.length},state:t}}function WebGLRenderStates(){var e={};return{get:function get(t,r){var n=t.id+","+r.id,i=e[n];return void 0===i&&(i=new function WebGLRenderState(){var e=new WebGLLights,t=[],r=[],n=[];return{init:function init(){t.length=0,r.length=0,n.length=0},state:{lightsArray:t,shadowsArray:r,spritesArray:n,lights:e},setupLights:function setupLights(n){e.setup(t,r,n)},pushLight:function pushLight(e){t.push(e)},pushShadow:function pushShadow(e){r.push(e)},pushSprite:function pushSprite(e){n.push(e)}}},e[n]=i),i},dispose:function dispose(){e={}}}}function MeshDepthMaterial(e){Material.call(this),this.type="MeshDepthMaterial",this.depthPacking=Tt,this.skinning=!1,this.morphTargets=!1,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.setValues(e)}function MeshDistanceMaterial(e){Material.call(this),this.type="MeshDistanceMaterial",this.referencePosition=new Vector3,this.nearDistance=1,this.farDistance=1e3,this.skinning=!1,this.morphTargets=!1,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.fog=!1,this.lights=!1,this.setValues(e)}function WebGLShadowMap(e,t,r){for(var n=new Frustum,i=new Matrix4,o=new Vector2,a=new Vector2(r,r),s=new Vector3,c=new Vector3,u=1,l=2,h=1+(u|l),p=new Array(h),f=new Array(h),d={},m={0:x,1:w,2:M},g=[new Vector3(1,0,0),new Vector3(-1,0,0),new Vector3(0,0,1),new Vector3(0,0,-1),new Vector3(0,1,0),new Vector3(0,-1,0)],y=[new Vector3(0,1,0),new Vector3(0,1,0),new Vector3(0,1,0),new Vector3(0,1,0),new Vector3(0,0,1),new Vector3(0,0,-1)],v=[new Vector4,new Vector4,new Vector4,new Vector4,new Vector4,new Vector4],b=0;b!==h;++b){var S=0!=(b&u),C=0!=(b&l),P=new MeshDepthMaterial({depthPacking:Ot,morphTargets:S,skinning:C});p[b]=P;var E=new MeshDistanceMaterial({morphTargets:S,skinning:C});f[b]=E}var T=this;function getDepthMaterial(t,r,n,i,o,a){var s=t.geometry,c=null,h=p,g=t.customDepthMaterial;if(n&&(h=f,g=t.customDistanceMaterial),g)c=g;else{var y=!1;r.morphTargets&&(s&&s.isBufferGeometry?y=s.morphAttributes&&s.morphAttributes.position&&s.morphAttributes.position.length>0:s&&s.isGeometry&&(y=s.morphTargets&&s.morphTargets.length>0)),t.isSkinnedMesh&&!1===r.skinning&&console.warn("THREE.WebGLShadowMap: THREE.SkinnedMesh with material.skinning set to false:",t);var v=t.isSkinnedMesh&&r.skinning,_=0;y&&(_|=u),v&&(_|=l),c=h[_]}if(e.localClippingEnabled&&!0===r.clipShadows&&0!==r.clippingPlanes.length){var b=c.uuid,w=r.uuid,x=d[b];void 0===x&&(x={},d[b]=x);var M=x[w];void 0===M&&(M=c.clone(),x[w]=M),c=M}return c.visible=r.visible,c.wireframe=r.wireframe,c.side=null!=r.shadowSide?r.shadowSide:m[r.side],c.clipShadows=r.clipShadows,c.clippingPlanes=r.clippingPlanes,c.clipIntersection=r.clipIntersection,c.wireframeLinewidth=r.wireframeLinewidth,c.linewidth=r.linewidth,n&&c.isMeshDistanceMaterial&&(c.referencePosition.copy(i),c.nearDistance=o,c.farDistance=a),c}function renderObject(r,i,o,a){if(!1!==r.visible){if(r.layers.test(i.layers)&&(r.isMesh||r.isLine||r.isPoints)&&r.castShadow&&(!r.frustumCulled||n.intersectsObject(r))){r.modelViewMatrix.multiplyMatrices(o.matrixWorldInverse,r.matrixWorld);var s=t.update(r),u=r.material;if(Array.isArray(u))for(var l=s.groups,h=0,p=l.length;h<p;h++){var f=l[h],d=u[f.materialIndex];if(d&&d.visible){var m=getDepthMaterial(r,d,a,c,o.near,o.far);e.renderBufferDirect(o,null,s,m,r,f)}}else if(u.visible){m=getDepthMaterial(r,u,a,c,o.near,o.far);e.renderBufferDirect(o,null,s,m,r,null)}}for(var g=r.children,y=0,v=g.length;y<v;y++)renderObject(g[y],i,o,a)}}this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=_,this.render=function(t,r,u){if(!1!==T.enabled&&(!1!==T.autoUpdate||!1!==T.needsUpdate)&&0!==t.length){var l,h=e.context,p=e.state;p.disable(h.BLEND),p.buffers.color.setClear(1,1,1,1),p.buffers.depth.setTest(!0),p.setScissorTest(!1);for(var f=0,d=t.length;f<d;f++){var m=t[f],_=m.shadow,b=m&&m.isPointLight;if(void 0!==_){var w=_.camera;if(o.copy(_.mapSize),o.min(a),b){var x=o.x,M=o.y;v[0].set(2*x,M,x,M),v[1].set(0,M,x,M),v[2].set(3*x,M,x,M),v[3].set(x,M,x,M),v[4].set(3*x,0,x,M),v[5].set(x,0,x,M),o.x*=4,o.y*=2}if(null===_.map){var S={minFilter:we,magFilter:we,format:Ue};_.map=new WebGLRenderTarget(o.x,o.y,S),_.map.texture.name=m.name+".shadowMap",w.updateProjectionMatrix()}_.isSpotLightShadow&&_.update(m);var C=_.map,P=_.matrix;c.setFromMatrixPosition(m.matrixWorld),w.position.copy(c),b?(l=6,P.makeTranslation(-c.x,-c.y,-c.z)):(l=1,s.setFromMatrixPosition(m.target.matrixWorld),w.lookAt(s),w.updateMatrixWorld(),P.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),P.multiply(w.projectionMatrix),P.multiply(w.matrixWorldInverse)),e.setRenderTarget(C),e.clear();for(var E=0;E<l;E++){if(b){s.copy(w.position),s.add(g[E]),w.up.copy(y[E]),w.lookAt(s),w.updateMatrixWorld();var O=v[E];p.viewport(O)}i.multiplyMatrices(w.projectionMatrix,w.matrixWorldInverse),n.setFromMatrix(i),renderObject(r,u,w,b)}}else console.warn("THREE.WebGLShadowMap:",m,"has no shadow.")}T.needsUpdate=!1}}}function CanvasTexture(e,t,r,n,i,o,a,s,c){Texture.call(this,e,t,r,n,i,o,a,s,c),this.needsUpdate=!0}function WebGLSpriteRenderer(e,t,r,n,i){var o,a,s,c,u,l,h=new Vector3,p=new Quaternion,f=new Vector3;function init(){var e=new Float32Array([-.5,-.5,0,0,.5,-.5,1,0,.5,.5,1,1,-.5,.5,0,1]),r=new Uint16Array([0,1,2,0,2,3]);o=t.createBuffer(),a=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,o),t.bufferData(t.ARRAY_BUFFER,e,t.STATIC_DRAW),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,a),t.bufferData(t.ELEMENT_ARRAY_BUFFER,r,t.STATIC_DRAW),s=function createProgram(){var e=t.createProgram(),r=t.createShader(t.VERTEX_SHADER),n=t.createShader(t.FRAGMENT_SHADER);return t.shaderSource(r,["precision "+i.precision+" float;","#define SHADER_NAME SpriteMaterial","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform float rotation;","uniform vec2 center;","uniform vec2 scale;","uniform vec2 uvOffset;","uniform vec2 uvScale;","attribute vec2 position;","attribute vec2 uv;","varying vec2 vUV;","varying float fogDepth;","void main() {","\tvUV = uvOffset + uv * uvScale;","\tvec2 alignedPosition = ( position - center ) * scale;","\tvec2 rotatedPosition;","\trotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;","\trotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;","\tvec4 mvPosition;","\tmvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );","\tmvPosition.xy += rotatedPosition;","\tgl_Position = projectionMatrix * mvPosition;","\tfogDepth = - mvPosition.z;","}"].join("\n")),t.shaderSource(n,["precision "+i.precision+" float;","#define SHADER_NAME SpriteMaterial","uniform vec3 color;","uniform sampler2D map;","uniform float opacity;","uniform int fogType;","uniform vec3 fogColor;","uniform float fogDensity;","uniform float fogNear;","uniform float fogFar;","uniform float alphaTest;","varying vec2 vUV;","varying float fogDepth;","void main() {","\tvec4 texture = texture2D( map, vUV );","\tgl_FragColor = vec4( color * texture.xyz, texture.a * opacity );","\tif ( gl_FragColor.a < alphaTest ) discard;","\tif ( fogType > 0 ) {","\t\tfloat fogFactor = 0.0;","\t\tif ( fogType == 1 ) {","\t\t\tfogFactor = smoothstep( fogNear, fogFar, fogDepth );","\t\t} else {","\t\t\tconst float LOG2 = 1.442695;","\t\t\tfogFactor = exp2( - fogDensity * fogDensity * fogDepth * fogDepth * LOG2 );","\t\t\tfogFactor = 1.0 - clamp( fogFactor, 0.0, 1.0 );","\t\t}","\t\tgl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );","\t}","}"].join("\n")),t.compileShader(r),t.compileShader(n),t.attachShader(e,r),t.attachShader(e,n),t.linkProgram(e),e}(),c={position:t.getAttribLocation(s,"position"),uv:t.getAttribLocation(s,"uv")},u={uvOffset:t.getUniformLocation(s,"uvOffset"),uvScale:t.getUniformLocation(s,"uvScale"),rotation:t.getUniformLocation(s,"rotation"),center:t.getUniformLocation(s,"center"),scale:t.getUniformLocation(s,"scale"),color:t.getUniformLocation(s,"color"),map:t.getUniformLocation(s,"map"),opacity:t.getUniformLocation(s,"opacity"),modelViewMatrix:t.getUniformLocation(s,"modelViewMatrix"),projectionMatrix:t.getUniformLocation(s,"projectionMatrix"),fogType:t.getUniformLocation(s,"fogType"),fogDensity:t.getUniformLocation(s,"fogDensity"),fogNear:t.getUniformLocation(s,"fogNear"),fogFar:t.getUniformLocation(s,"fogFar"),fogColor:t.getUniformLocation(s,"fogColor"),fogDepth:t.getUniformLocation(s,"fogDepth"),alphaTest:t.getUniformLocation(s,"alphaTest")};var n=document.createElementNS("http://www.w3.org/1999/xhtml","canvas");n.width=8,n.height=8;var h=n.getContext("2d");h.fillStyle="white",h.fillRect(0,0,8,8),l=new CanvasTexture(n)}function painterSortStable(e,t){return e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.z!==t.z?t.z-e.z:t.id-e.id}this.render=function(i,d,m){if(0!==i.length){void 0===s&&init(),r.useProgram(s),r.initAttributes(),r.enableAttribute(c.position),r.enableAttribute(c.uv),r.disableUnusedAttributes(),r.disable(t.CULL_FACE),r.enable(t.BLEND),t.bindBuffer(t.ARRAY_BUFFER,o),t.vertexAttribPointer(c.position,2,t.FLOAT,!1,16,0),t.vertexAttribPointer(c.uv,2,t.FLOAT,!1,16,8),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,a),t.uniformMatrix4fv(u.projectionMatrix,!1,m.projectionMatrix.elements),r.activeTexture(t.TEXTURE0),t.uniform1i(u.map,0);var g=0,y=0,v=d.fog;v?(t.uniform3f(u.fogColor,v.color.r,v.color.g,v.color.b),v.isFog?(t.uniform1f(u.fogNear,v.near),t.uniform1f(u.fogFar,v.far),t.uniform1i(u.fogType,1),g=1,y=1):v.isFogExp2&&(t.uniform1f(u.fogDensity,v.density),t.uniform1i(u.fogType,2),g=2,y=2)):(t.uniform1i(u.fogType,0),g=0,y=0);for(var _=0,b=i.length;_<b;_++){(M=i[_]).modelViewMatrix.multiplyMatrices(m.matrixWorldInverse,M.matrixWorld),M.z=-M.modelViewMatrix.elements[14]}i.sort(painterSortStable);var w=[],x=[];for(_=0,b=i.length;_<b;_++){var M,S=(M=i[_]).material;if(!1!==S.visible){M.onBeforeRender(e,d,m,void 0,S,void 0),t.uniform1f(u.alphaTest,S.alphaTest),t.uniformMatrix4fv(u.modelViewMatrix,!1,M.modelViewMatrix.elements),M.matrixWorld.decompose(h,p,f),w[0]=f.x,w[1]=f.y,x[0]=M.center.x-.5,x[1]=M.center.y-.5;var C=0;d.fog&&S.fog&&(C=y),g!==C&&(t.uniform1i(u.fogType,C),g=C),null!==S.map?(t.uniform2f(u.uvOffset,S.map.offset.x,S.map.offset.y),t.uniform2f(u.uvScale,S.map.repeat.x,S.map.repeat.y)):(t.uniform2f(u.uvOffset,0,0),t.uniform2f(u.uvScale,1,1)),t.uniform1f(u.opacity,S.opacity),t.uniform3f(u.color,S.color.r,S.color.g,S.color.b),t.uniform1f(u.rotation,S.rotation),t.uniform2fv(u.center,x),t.uniform2fv(u.scale,w),r.setBlending(S.blending,S.blendEquation,S.blendSrc,S.blendDst,S.blendEquationAlpha,S.blendSrcAlpha,S.blendDstAlpha,S.premultipliedAlpha),r.buffers.depth.setTest(S.depthTest),r.buffers.depth.setMask(S.depthWrite),r.buffers.color.setMask(S.colorWrite),n.setTexture2D(S.map||l,0),t.drawElements(t.TRIANGLES,6,t.UNSIGNED_SHORT,0),M.onAfterRender(e,d,m,void 0,S,void 0)}}r.enable(t.CULL_FACE),r.reset()}}}function WebGLTextures(e,t,r,n,i,o,a){var s,c="undefined"!=typeof WebGL2RenderingContext&&e instanceof WebGL2RenderingContext,u={};function clampToMaxSize(e,t){if(e.width>t||e.height>t){if("data"in e)return void console.warn("THREE.WebGLRenderer: image in DataTexture is too big ("+e.width+"x"+e.height+").");var r=t/Math.max(e.width,e.height),n=document.createElementNS("http://www.w3.org/1999/xhtml","canvas");return n.width=Math.floor(e.width*r),n.height=Math.floor(e.height*r),n.getContext("2d").drawImage(e,0,0,e.width,e.height,0,0,n.width,n.height),console.warn("THREE.WebGLRenderer: image is too big ("+e.width+"x"+e.height+"). Resized to "+n.width+"x"+n.height,e),n}return e}function isPowerOfTwo(e){return At.isPowerOfTwo(e.width)&&At.isPowerOfTwo(e.height)}function textureNeedsGenerateMipmaps(e,t){return e.generateMipmaps&&t&&e.minFilter!==we&&e.minFilter!==Se}function generateMipmap(t,r,i,o){e.generateMipmap(t),n.get(r).__maxMipLevel=Math.log2(Math.max(i,o))}function filterFallback(t){return t===we||t===xe||t===Me?e.NEAREST:e.LINEAR}function onTextureDispose(t){var r=t.target;r.removeEventListener("dispose",onTextureDispose),function deallocateTexture(t){var r=n.get(t);if(t.image&&r.__image__webglTextureCube)e.deleteTexture(r.__image__webglTextureCube);else{if(void 0===r.__webglInit)return;e.deleteTexture(r.__webglTexture)}n.remove(t)}(r),r.isVideoTexture&&delete u[r.id],a.memory.textures--}function onRenderTargetDispose(t){var r=t.target;r.removeEventListener("dispose",onRenderTargetDispose),function deallocateRenderTarget(t){var r=n.get(t),i=n.get(t.texture);if(!t)return;void 0!==i.__webglTexture&&e.deleteTexture(i.__webglTexture);t.depthTexture&&t.depthTexture.dispose();if(t.isWebGLRenderTargetCube)for(var o=0;o<6;o++)e.deleteFramebuffer(r.__webglFramebuffer[o]),r.__webglDepthbuffer&&e.deleteRenderbuffer(r.__webglDepthbuffer[o]);else e.deleteFramebuffer(r.__webglFramebuffer),r.__webglDepthbuffer&&e.deleteRenderbuffer(r.__webglDepthbuffer);n.remove(t.texture),n.remove(t)}(r),a.memory.textures--}function setTexture2D(t,l){var h=n.get(t);if(t.isVideoTexture&&function updateVideoTexture(e){var t=e.id,r=a.render.frame;u[t]!==r&&(u[t]=r,e.update())}(t),t.version>0&&h.__version!==t.version){var p=t.image;if(void 0===p)console.warn("THREE.WebGLRenderer: Texture marked for update but image is undefined",t);else{if(!1!==p.complete)return void function uploadTexture(t,n,u){void 0===t.__webglInit&&(t.__webglInit=!0,n.addEventListener("dispose",onTextureDispose),t.__webglTexture=e.createTexture(),a.memory.textures++);r.activeTexture(e.TEXTURE0+u),r.bindTexture(e.TEXTURE_2D,t.__webglTexture),e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,n.flipY),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,n.premultiplyAlpha),e.pixelStorei(e.UNPACK_ALIGNMENT,n.unpackAlignment);var l=clampToMaxSize(n.image,i.maxTextureSize);(function textureNeedsPowerOfTwo(e){return e.wrapS!==_e||e.wrapT!==_e||e.minFilter!==we&&e.minFilter!==Se})(n)&&!1===isPowerOfTwo(l)&&(l=function makePowerOfTwo(e){return e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof ImageBitmap?(void 0===s&&(s=document.createElementNS("http://www.w3.org/1999/xhtml","canvas")),s.width=At.floorPowerOfTwo(e.width),s.height=At.floorPowerOfTwo(e.height),s.getContext("2d").drawImage(e,0,0,s.width,s.height),console.warn("THREE.WebGLRenderer: image is not power of two ("+e.width+"x"+e.height+"). Resized to "+s.width+"x"+s.height,e),s):e}(l));var h=isPowerOfTwo(l),p=o.convert(n.format),f=o.convert(n.type);setTextureParameters(e.TEXTURE_2D,n,h);var d,m=n.mipmaps;if(n.isDepthTexture){var g=e.DEPTH_COMPONENT;if(n.type===Re){if(!c)throw new Error("Float Depth Texture only supported in WebGL2.0");g=e.DEPTH_COMPONENT32F}else c&&(g=e.DEPTH_COMPONENT16);n.format===He&&g===e.DEPTH_COMPONENT&&n.type!==Ae&&n.type!==ke&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),n.type=Ae,f=o.convert(n.type)),n.format===We&&(g=e.DEPTH_STENCIL,n.type!==Be&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),n.type=Be,f=o.convert(n.type))),r.texImage2D(e.TEXTURE_2D,0,g,l.width,l.height,0,p,f,null)}else if(n.isDataTexture)if(m.length>0&&h){for(var y=0,v=m.length;y<v;y++)d=m[y],r.texImage2D(e.TEXTURE_2D,y,p,d.width,d.height,0,p,f,d.data);n.generateMipmaps=!1,t.__maxMipLevel=m.length-1}else r.texImage2D(e.TEXTURE_2D,0,p,l.width,l.height,0,p,f,l.data),t.__maxMipLevel=0;else if(n.isCompressedTexture){for(var y=0,v=m.length;y<v;y++)d=m[y],n.format!==Ue&&n.format!==De?r.getCompressedTextureFormats().indexOf(p)>-1?r.compressedTexImage2D(e.TEXTURE_2D,y,p,d.width,d.height,0,d.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):r.texImage2D(e.TEXTURE_2D,y,p,d.width,d.height,0,p,f,d.data);t.__maxMipLevel=m.length-1}else if(m.length>0&&h){for(var y=0,v=m.length;y<v;y++)d=m[y],r.texImage2D(e.TEXTURE_2D,y,p,p,f,d);n.generateMipmaps=!1,t.__maxMipLevel=m.length-1}else r.texImage2D(e.TEXTURE_2D,0,p,p,f,l),t.__maxMipLevel=0;textureNeedsGenerateMipmaps(n,h)&&generateMipmap(e.TEXTURE_2D,n,l.width,l.height);t.__version=n.version,n.onUpdate&&n.onUpdate(n)}(h,t,l);console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete",t)}}r.activeTexture(e.TEXTURE0+l),r.bindTexture(e.TEXTURE_2D,h.__webglTexture)}function setTextureParameters(r,a,s){var c;if(s?(e.texParameteri(r,e.TEXTURE_WRAP_S,o.convert(a.wrapS)),e.texParameteri(r,e.TEXTURE_WRAP_T,o.convert(a.wrapT)),e.texParameteri(r,e.TEXTURE_MAG_FILTER,o.convert(a.magFilter)),e.texParameteri(r,e.TEXTURE_MIN_FILTER,o.convert(a.minFilter))):(e.texParameteri(r,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(r,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),a.wrapS===_e&&a.wrapT===_e||console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping.",a),e.texParameteri(r,e.TEXTURE_MAG_FILTER,filterFallback(a.magFilter)),e.texParameteri(r,e.TEXTURE_MIN_FILTER,filterFallback(a.minFilter)),a.minFilter!==we&&a.minFilter!==Se&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.",a)),c=t.get("EXT_texture_filter_anisotropic")){if(a.type===Re&&null===t.get("OES_texture_float_linear"))return;if(a.type===Ie&&null===t.get("OES_texture_half_float_linear"))return;(a.anisotropy>1||n.get(a).__currentAnisotropy)&&(e.texParameterf(r,c.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(a.anisotropy,i.getMaxAnisotropy())),n.get(a).__currentAnisotropy=a.anisotropy)}}function setupFrameBufferTexture(t,i,a,s){var c=o.convert(i.texture.format),u=o.convert(i.texture.type);r.texImage2D(s,0,c,i.width,i.height,0,c,u,null),e.bindFramebuffer(e.FRAMEBUFFER,t),e.framebufferTexture2D(e.FRAMEBUFFER,a,s,n.get(i.texture).__webglTexture,0),e.bindFramebuffer(e.FRAMEBUFFER,null)}function setupRenderBufferStorage(t,r){e.bindRenderbuffer(e.RENDERBUFFER,t),r.depthBuffer&&!r.stencilBuffer?(e.renderbufferStorage(e.RENDERBUFFER,e.DEPTH_COMPONENT16,r.width,r.height),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.RENDERBUFFER,t)):r.depthBuffer&&r.stencilBuffer?(e.renderbufferStorage(e.RENDERBUFFER,e.DEPTH_STENCIL,r.width,r.height),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_STENCIL_ATTACHMENT,e.RENDERBUFFER,t)):e.renderbufferStorage(e.RENDERBUFFER,e.RGBA4,r.width,r.height),e.bindRenderbuffer(e.RENDERBUFFER,null)}function setupDepthRenderbuffer(t){var r=n.get(t),i=!0===t.isWebGLRenderTargetCube;if(t.depthTexture){if(i)throw new Error("target.depthTexture not supported in Cube render targets");!function setupDepthTexture(t,r){if(r&&r.isWebGLRenderTargetCube)throw new Error("Depth Texture with cube render targets is not supported");if(e.bindFramebuffer(e.FRAMEBUFFER,t),!r.depthTexture||!r.depthTexture.isDepthTexture)throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");n.get(r.depthTexture).__webglTexture&&r.depthTexture.image.width===r.width&&r.depthTexture.image.height===r.height||(r.depthTexture.image.width=r.width,r.depthTexture.image.height=r.height,r.depthTexture.needsUpdate=!0),setTexture2D(r.depthTexture,0);var i=n.get(r.depthTexture).__webglTexture;if(r.depthTexture.format===He)e.framebufferTexture2D(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.TEXTURE_2D,i,0);else{if(r.depthTexture.format!==We)throw new Error("Unknown depthTexture format");e.framebufferTexture2D(e.FRAMEBUFFER,e.DEPTH_STENCIL_ATTACHMENT,e.TEXTURE_2D,i,0)}}(r.__webglFramebuffer,t)}else if(i){r.__webglDepthbuffer=[];for(var o=0;o<6;o++)e.bindFramebuffer(e.FRAMEBUFFER,r.__webglFramebuffer[o]),r.__webglDepthbuffer[o]=e.createRenderbuffer(),setupRenderBufferStorage(r.__webglDepthbuffer[o],t)}else e.bindFramebuffer(e.FRAMEBUFFER,r.__webglFramebuffer),r.__webglDepthbuffer=e.createRenderbuffer(),setupRenderBufferStorage(r.__webglDepthbuffer,t);e.bindFramebuffer(e.FRAMEBUFFER,null)}this.setTexture2D=setTexture2D,this.setTextureCube=function setTextureCube(t,s){var c=n.get(t);if(6===t.image.length)if(t.version>0&&c.__version!==t.version){c.__image__webglTextureCube||(t.addEventListener("dispose",onTextureDispose),c.__image__webglTextureCube=e.createTexture(),a.memory.textures++),r.activeTexture(e.TEXTURE0+s),r.bindTexture(e.TEXTURE_CUBE_MAP,c.__image__webglTextureCube),e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,t.flipY);for(var u=t&&t.isCompressedTexture,l=t.image[0]&&t.image[0].isDataTexture,h=[],p=0;p<6;p++)h[p]=u||l?l?t.image[p].image:t.image[p]:clampToMaxSize(t.image[p],i.maxCubemapSize);var f=h[0],d=isPowerOfTwo(f),m=o.convert(t.format),g=o.convert(t.type);for(setTextureParameters(e.TEXTURE_CUBE_MAP,t,d),p=0;p<6;p++)if(u)for(var y,v=h[p].mipmaps,_=0,b=v.length;_<b;_++)y=v[_],t.format!==Ue&&t.format!==De?r.getCompressedTextureFormats().indexOf(m)>-1?r.compressedTexImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+p,_,m,y.width,y.height,0,y.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):r.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+p,_,m,y.width,y.height,0,m,g,y.data);else l?r.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+p,0,m,h[p].width,h[p].height,0,m,g,h[p].data):r.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+p,0,m,m,g,h[p]);c.__maxMipLevel=u?v.length-1:0,textureNeedsGenerateMipmaps(t,d)&&generateMipmap(e.TEXTURE_CUBE_MAP,t,f.width,f.height),c.__version=t.version,t.onUpdate&&t.onUpdate(t)}else r.activeTexture(e.TEXTURE0+s),r.bindTexture(e.TEXTURE_CUBE_MAP,c.__image__webglTextureCube)},this.setTextureCubeDynamic=function setTextureCubeDynamic(t,i){r.activeTexture(e.TEXTURE0+i),r.bindTexture(e.TEXTURE_CUBE_MAP,n.get(t).__webglTexture)},this.setupRenderTarget=function setupRenderTarget(t){var i=n.get(t),o=n.get(t.texture);t.addEventListener("dispose",onRenderTargetDispose),o.__webglTexture=e.createTexture(),a.memory.textures++;var s=!0===t.isWebGLRenderTargetCube,c=isPowerOfTwo(t);if(s){i.__webglFramebuffer=[];for(var u=0;u<6;u++)i.__webglFramebuffer[u]=e.createFramebuffer()}else i.__webglFramebuffer=e.createFramebuffer();if(s){for(r.bindTexture(e.TEXTURE_CUBE_MAP,o.__webglTexture),setTextureParameters(e.TEXTURE_CUBE_MAP,t.texture,c),u=0;u<6;u++)setupFrameBufferTexture(i.__webglFramebuffer[u],t,e.COLOR_ATTACHMENT0,e.TEXTURE_CUBE_MAP_POSITIVE_X+u);textureNeedsGenerateMipmaps(t.texture,c)&&generateMipmap(e.TEXTURE_CUBE_MAP,t.texture,t.width,t.height),r.bindTexture(e.TEXTURE_CUBE_MAP,null)}else r.bindTexture(e.TEXTURE_2D,o.__webglTexture),setTextureParameters(e.TEXTURE_2D,t.texture,c),setupFrameBufferTexture(i.__webglFramebuffer,t,e.COLOR_ATTACHMENT0,e.TEXTURE_2D),textureNeedsGenerateMipmaps(t.texture,c)&&generateMipmap(e.TEXTURE_2D,t.texture,t.width,t.height),r.bindTexture(e.TEXTURE_2D,null);t.depthBuffer&&setupDepthRenderbuffer(t)},this.updateRenderTargetMipmap=function updateRenderTargetMipmap(t){var i=t.texture;if(textureNeedsGenerateMipmaps(i,isPowerOfTwo(t))){var o=t.isWebGLRenderTargetCube?e.TEXTURE_CUBE_MAP:e.TEXTURE_2D,a=n.get(i).__webglTexture;r.bindTexture(o,a),generateMipmap(o,i,t.width,t.height),r.bindTexture(o,null)}}}function PerspectiveCamera(e,t,r,n){Camera.call(this),this.type="PerspectiveCamera",this.fov=void 0!==e?e:50,this.zoom=1,this.near=void 0!==r?r:.1,this.far=void 0!==n?n:2e3,this.focus=10,this.aspect=void 0!==t?t:1,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}function ArrayCamera(e){PerspectiveCamera.call(this),this.cameras=e||[]}function WebVRManager(e){var t=this,r=null,n=null,i=null,o=new Matrix4,a=new Matrix4;"undefined"!=typeof window&&"VRFrameData"in window&&(n=new window.VRFrameData);var s=new Matrix4,c=new Quaternion,u=new Vector3,l=new PerspectiveCamera;l.bounds=new Vector4(0,0,.5,1),l.layers.enable(1);var h=new PerspectiveCamera;h.bounds=new Vector4(.5,0,.5,1),h.layers.enable(2);var p,f,d=new ArrayCamera([l,h]);function onVRDisplayPresentChange(){if(null!==r&&r.isPresenting){var n=r.getEyeParameters("left"),i=n.renderWidth,o=n.renderHeight;f=e.getPixelRatio(),p=e.getSize(),e.setDrawingBufferSize(2*i,o,1)}else t.enabled&&e.setDrawingBufferSize(p.width,p.height,f)}d.layers.enable(1),d.layers.enable(2),"undefined"!=typeof window&&window.addEventListener("vrdisplaypresentchange",onVRDisplayPresentChange,!1),this.enabled=!1,this.userHeight=1.6,this.getDevice=function(){return r},this.setDevice=function(e){void 0!==e&&(r=e)},this.setPoseTarget=function(e){void 0!==e&&(i=e)},this.getCamera=function(e){if(null===r)return e;r.depthNear=e.near,r.depthFar=e.far,r.getFrameData(n);var p=r.stageParameters;p?o.fromArray(p.sittingToStandingTransform):o.makeTranslation(0,t.userHeight,0);var f=n.pose,m=null!==i?i:e;if(m.matrix.copy(o),m.matrix.decompose(m.position,m.quaternion,m.scale),null!==f.orientation&&(c.fromArray(f.orientation),m.quaternion.multiply(c)),null!==f.position&&(c.setFromRotationMatrix(o),u.fromArray(f.position),u.applyQuaternion(c),m.position.add(u)),m.updateMatrixWorld(),!1===r.isPresenting)return e;l.near=e.near,h.near=e.near,l.far=e.far,h.far=e.far,d.matrixWorld.copy(e.matrixWorld),d.matrixWorldInverse.copy(e.matrixWorldInverse),l.matrixWorldInverse.fromArray(n.leftViewMatrix),h.matrixWorldInverse.fromArray(n.rightViewMatrix),a.getInverse(o),l.matrixWorldInverse.multiply(a),h.matrixWorldInverse.multiply(a);var g=m.parent;null!==g&&(s.getInverse(g.matrixWorld),l.matrixWorldInverse.multiply(s),h.matrixWorldInverse.multiply(s)),l.matrixWorld.getInverse(l.matrixWorldInverse),h.matrixWorld.getInverse(h.matrixWorldInverse),l.projectionMatrix.fromArray(n.leftProjectionMatrix),h.projectionMatrix.fromArray(n.rightProjectionMatrix),d.projectionMatrix.copy(l.projectionMatrix);var y=r.getLayers();if(y.length){var v=y[0];null!==v.leftBounds&&4===v.leftBounds.length&&l.bounds.fromArray(v.leftBounds),null!==v.rightBounds&&4===v.rightBounds.length&&h.bounds.fromArray(v.rightBounds)}return d},this.getStandingMatrix=function(){return o},this.submitFrame=function(){r&&r.isPresenting&&r.submitFrame()},this.dispose=function(){"undefined"!=typeof window&&window.removeEventListener("vrdisplaypresentchange",onVRDisplayPresentChange)}}function WebGLRenderer(e){console.log("THREE.WebGLRenderer",f);var t=void 0!==(e=e||{}).canvas?e.canvas:document.createElementNS("http://www.w3.org/1999/xhtml","canvas"),r=void 0!==e.context?e.context:null,n=void 0!==e.alpha&&e.alpha,i=void 0===e.depth||e.depth,o=void 0===e.stencil||e.stencil,a=void 0!==e.antialias&&e.antialias,s=void 0===e.premultipliedAlpha||e.premultipliedAlpha,c=void 0!==e.preserveDrawingBuffer&&e.preserveDrawingBuffer,u=void 0!==e.powerPreference?e.powerPreference:"default",l=null,h=null;this.domElement=t,this.context=null,this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.gammaFactor=2,this.gammaInput=!1,this.gammaOutput=!1,this.physicallyCorrectLights=!1,this.toneMapping=se,this.toneMappingExposure=1,this.toneMappingWhitePoint=1,this.maxMorphTargets=8,this.maxMorphNormals=4;var p,d,v,_,b,w,C,P,ne,ie,oe,ae,ce,ue,le,he,pe,fe,de,me=this,ge=!1,ye=null,at=null,gt=-1,yt="",wt=null,xt=null,Mt=new Vector4,St=new Vector4,Ct=null,Pt=0,Et=t.width,Tt=t.height,Ot=1,Lt=new Vector4(0,0,Et,Tt),kt=new Vector4(0,0,Et,Tt),Rt=!1,It=new Frustum,Nt=new function WebGLClipping(){var e=this,t=null,r=0,n=!1,i=!1,o=new Plane,a=new Matrix3,s={value:null,needsUpdate:!1};function resetGlobalState(){s.value!==t&&(s.value=t,s.needsUpdate=r>0),e.numPlanes=r,e.numIntersection=0}function projectPlanes(t,r,n,i){var c=null!==t?t.length:0,u=null;if(0!==c){if(u=s.value,!0!==i||null===u){var l=n+4*c,h=r.matrixWorldInverse;a.getNormalMatrix(h),(null===u||u.length<l)&&(u=new Float32Array(l));for(var p=0,f=n;p!==c;++p,f+=4)o.copy(t[p]).applyMatrix4(h,a),o.normal.toArray(u,f),u[f+3]=o.constant}s.value=u,s.needsUpdate=!0}return e.numPlanes=c,u}this.uniform=s,this.numPlanes=0,this.numIntersection=0,this.init=function(e,i,o){var a=0!==e.length||i||0!==r||n;return n=i,t=projectPlanes(e,o,0),r=e.length,a},this.beginShadows=function(){i=!0,projectPlanes(null)},this.endShadows=function(){i=!1,resetGlobalState()},this.setState=function(e,o,a,c,u,l){if(!n||null===e||0===e.length||i&&!a)i?projectPlanes(null):resetGlobalState();else{var h=i?0:r,p=4*h,f=u.clippingState||null;s.value=f,f=projectPlanes(e,c,p,l);for(var d=0;d!==p;++d)f[d]=t[d];u.clippingState=f,this.numIntersection=o?this.numPlanes:0,this.numPlanes+=h}}},Ft=!1,jt=!1,Bt=new Matrix4,Vt=new Vector3;function getTargetPixelRatio(){return null===ye?Ot:1}try{var Ut={alpha:n,depth:i,stencil:o,antialias:a,premultipliedAlpha:s,preserveDrawingBuffer:c,powerPreference:u};if(t.addEventListener("webglcontextlost",onContextLost,!1),t.addEventListener("webglcontextrestored",onContextRestore,!1),null===(p=r||t.getContext("webgl",Ut)||t.getContext("experimental-webgl",Ut)))throw null!==t.getContext("webgl")?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.");void 0===p.getShaderPrecisionFormat&&(p.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(e){console.error("THREE.WebGLRenderer: "+e.message)}function initGLContext(){(d=new function WebGLExtensions(e){var t={};return{get:function get(r){if(void 0!==t[r])return t[r];var n;switch(r){case"WEBGL_depth_texture":n=e.getExtension("WEBGL_depth_texture")||e.getExtension("MOZ_WEBGL_depth_texture")||e.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":n=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":n=e.getExtension("WEBGL_compressed_texture_s3tc")||e.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":n=e.getExtension("WEBGL_compressed_texture_pvrtc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;case"WEBGL_compressed_texture_etc1":n=e.getExtension("WEBGL_compressed_texture_etc1");break;default:n=e.getExtension(r)}return null===n&&console.warn("THREE.WebGLRenderer: "+r+" extension not supported."),t[r]=n,n}}}(p)).get("WEBGL_depth_texture"),d.get("OES_texture_float"),d.get("OES_texture_float_linear"),d.get("OES_texture_half_float"),d.get("OES_texture_half_float_linear"),d.get("OES_standard_derivatives"),d.get("OES_element_index_uint"),d.get("ANGLE_instanced_arrays"),de=new function WebGLUtils(e,t){return{convert:function convert(r){var n;if(r===ve)return e.REPEAT;if(r===_e)return e.CLAMP_TO_EDGE;if(r===be)return e.MIRRORED_REPEAT;if(r===we)return e.NEAREST;if(r===xe)return e.NEAREST_MIPMAP_NEAREST;if(r===Me)return e.NEAREST_MIPMAP_LINEAR;if(r===Se)return e.LINEAR;if(r===Ce)return e.LINEAR_MIPMAP_NEAREST;if(r===Pe)return e.LINEAR_MIPMAP_LINEAR;if(r===Ee)return e.UNSIGNED_BYTE;if(r===Ne)return e.UNSIGNED_SHORT_4_4_4_4;if(r===Fe)return e.UNSIGNED_SHORT_5_5_5_1;if(r===je)return e.UNSIGNED_SHORT_5_6_5;if(r===Te)return e.BYTE;if(r===Oe)return e.SHORT;if(r===Ae)return e.UNSIGNED_SHORT;if(r===Le)return e.INT;if(r===ke)return e.UNSIGNED_INT;if(r===Re)return e.FLOAT;if(r===Ie&&null!==(n=t.get("OES_texture_half_float")))return n.HALF_FLOAT_OES;if(r===Ve)return e.ALPHA;if(r===De)return e.RGB;if(r===Ue)return e.RGBA;if(r===Ge)return e.LUMINANCE;if(r===ze)return e.LUMINANCE_ALPHA;if(r===He)return e.DEPTH_COMPONENT;if(r===We)return e.DEPTH_STENCIL;if(r===R)return e.FUNC_ADD;if(r===I)return e.FUNC_SUBTRACT;if(r===N)return e.FUNC_REVERSE_SUBTRACT;if(r===B)return e.ZERO;if(r===V)return e.ONE;if(r===D)return e.SRC_COLOR;if(r===U)return e.ONE_MINUS_SRC_COLOR;if(r===G)return e.SRC_ALPHA;if(r===z)return e.ONE_MINUS_SRC_ALPHA;if(r===H)return e.DST_ALPHA;if(r===W)return e.ONE_MINUS_DST_ALPHA;if(r===q)return e.DST_COLOR;if(r===X)return e.ONE_MINUS_DST_COLOR;if(r===Y)return e.SRC_ALPHA_SATURATE;if((r===qe||r===Xe||r===Ye||r===Je)&&null!==(n=t.get("WEBGL_compressed_texture_s3tc"))){if(r===qe)return n.COMPRESSED_RGB_S3TC_DXT1_EXT;if(r===Xe)return n.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(r===Ye)return n.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(r===Je)return n.COMPRESSED_RGBA_S3TC_DXT5_EXT}if((r===Ze||r===Ke||r===Qe||r===$e)&&null!==(n=t.get("WEBGL_compressed_texture_pvrtc"))){if(r===Ze)return n.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(r===Ke)return n.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(r===Qe)return n.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(r===$e)return n.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(r===et&&null!==(n=t.get("WEBGL_compressed_texture_etc1")))return n.COMPRESSED_RGB_ETC1_WEBGL;if((r===tt||r===rt||r===nt||r===it||r===ot||r===st||r===ct||r===ut||r===lt||r===ht||r===pt||r===ft||r===dt||r===mt)&&null!==(n=t.get("WEBGL_compressed_texture_astc")))return r;if((r===F||r===j)&&null!==(n=t.get("EXT_blend_minmax"))){if(r===F)return n.MIN_EXT;if(r===j)return n.MAX_EXT}return r===Be&&null!==(n=t.get("WEBGL_depth_texture"))?n.UNSIGNED_INT_24_8_WEBGL:0}}}(p,d),v=new function WebGLCapabilities(e,t,r){var n;function getMaxPrecision(t){if("highp"===t){if(e.getShaderPrecisionFormat(e.VERTEX_SHADER,e.HIGH_FLOAT).precision>0&&e.getShaderPrecisionFormat(e.FRAGMENT_SHADER,e.HIGH_FLOAT).precision>0)return"highp";t="mediump"}return"mediump"===t&&e.getShaderPrecisionFormat(e.VERTEX_SHADER,e.MEDIUM_FLOAT).precision>0&&e.getShaderPrecisionFormat(e.FRAGMENT_SHADER,e.MEDIUM_FLOAT).precision>0?"mediump":"lowp"}var i=void 0!==r.precision?r.precision:"highp",o=getMaxPrecision(i);o!==i&&(console.warn("THREE.WebGLRenderer:",i,"not supported, using",o,"instead."),i=o);var a=!0===r.logarithmicDepthBuffer,s=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS),c=e.getParameter(e.MAX_VERTEX_TEXTURE_IMAGE_UNITS),u=e.getParameter(e.MAX_TEXTURE_SIZE),l=e.getParameter(e.MAX_CUBE_MAP_TEXTURE_SIZE),h=e.getParameter(e.MAX_VERTEX_ATTRIBS),p=e.getParameter(e.MAX_VERTEX_UNIFORM_VECTORS),f=e.getParameter(e.MAX_VARYING_VECTORS),d=e.getParameter(e.MAX_FRAGMENT_UNIFORM_VECTORS),m=c>0,g=!!t.get("OES_texture_float");return{getMaxAnisotropy:function getMaxAnisotropy(){if(void 0!==n)return n;var r=t.get("EXT_texture_filter_anisotropic");return n=null!==r?e.getParameter(r.MAX_TEXTURE_MAX_ANISOTROPY_EXT):0},getMaxPrecision:getMaxPrecision,precision:i,logarithmicDepthBuffer:a,maxTextures:s,maxVertexTextures:c,maxTextureSize:u,maxCubemapSize:l,maxAttributes:h,maxVertexUniforms:p,maxVaryings:f,maxFragmentUniforms:d,vertexTextures:m,floatFragmentTextures:g,floatVertexTextures:m&&g}}(p,d,e),(_=new function WebGLState(e,t,r){var n=new function ColorBuffer(){var t=!1,r=new Vector4,n=null,i=new Vector4(0,0,0,0);return{setMask:function setMask(r){n===r||t||(e.colorMask(r,r,r,r),n=r)},setLocked:function setLocked(e){t=e},setClear:function setClear(t,n,o,a,s){!0===s&&(t*=a,n*=a,o*=a),r.set(t,n,o,a),!1===i.equals(r)&&(e.clearColor(t,n,o,a),i.copy(r))},reset:function reset(){t=!1,n=null,i.set(-1,0,0,0)}}},i=new function DepthBuffer(){var t=!1,r=null,n=null,i=null;return{setTest:function setTest(t){t?enable(e.DEPTH_TEST):disable(e.DEPTH_TEST)},setMask:function setMask(n){r===n||t||(e.depthMask(n),r=n)},setFunc:function setFunc(t){if(n!==t){if(t)switch(t){case J:e.depthFunc(e.NEVER);break;case Z:e.depthFunc(e.ALWAYS);break;case K:e.depthFunc(e.LESS);break;case Q:e.depthFunc(e.LEQUAL);break;case $:e.depthFunc(e.EQUAL);break;case ee:e.depthFunc(e.GEQUAL);break;case te:e.depthFunc(e.GREATER);break;case re:e.depthFunc(e.NOTEQUAL);break;default:e.depthFunc(e.LEQUAL)}else e.depthFunc(e.LEQUAL);n=t}},setLocked:function setLocked(e){t=e},setClear:function setClear(t){i!==t&&(e.clearDepth(t),i=t)},reset:function reset(){t=!1,r=null,n=null,i=null}}},o=new function StencilBuffer(){var t=!1,r=null,n=null,i=null,o=null,a=null,s=null,c=null,u=null;return{setTest:function setTest(t){t?enable(e.STENCIL_TEST):disable(e.STENCIL_TEST)},setMask:function setMask(n){r===n||t||(e.stencilMask(n),r=n)},setFunc:function setFunc(t,r,a){n===t&&i===r&&o===a||(e.stencilFunc(t,r,a),n=t,i=r,o=a)},setOp:function setOp(t,r,n){a===t&&s===r&&c===n||(e.stencilOp(t,r,n),a=t,s=r,c=n)},setLocked:function setLocked(e){t=e},setClear:function setClear(t){u!==t&&(e.clearStencil(t),u=t)},reset:function reset(){t=!1,r=null,n=null,i=null,o=null,a=null,s=null,c=null,u=null}}},a=e.getParameter(e.MAX_VERTEX_ATTRIBS),s=new Uint8Array(a),c=new Uint8Array(a),u=new Uint8Array(a),l={},h=null,p=null,f=null,d=null,v=null,_=null,b=null,w=null,S=null,C=!1,P=null,R=null,I=null,N=null,F=null,j=e.getParameter(e.MAX_COMBINED_TEXTURE_IMAGE_UNITS),B=!1,V=0,D=e.getParameter(e.VERSION);-1!==D.indexOf("WebGL")?(V=parseFloat(/^WebGL\ ([0-9])/.exec(D)[1]),B=V>=1):-1!==D.indexOf("OpenGL ES")&&(V=parseFloat(/^OpenGL\ ES\ ([0-9])/.exec(D)[1]),B=V>=2);var U=null,G={},z=new Vector4,H=new Vector4;function createTexture(t,r,n){var i=new Uint8Array(4),o=e.createTexture();e.bindTexture(t,o),e.texParameteri(t,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(t,e.TEXTURE_MAG_FILTER,e.NEAREST);for(var a=0;a<n;a++)e.texImage2D(r+a,0,e.RGBA,1,1,0,e.RGBA,e.UNSIGNED_BYTE,i);return o}var W={};function enable(t){!0!==l[t]&&(e.enable(t),l[t]=!0)}function disable(t){!1!==l[t]&&(e.disable(t),l[t]=!1)}function setBlending(t,n,i,o,a,s,c,u){if(t!==E?enable(e.BLEND):disable(e.BLEND),t!==k){if(t!==f||u!==C)switch(t){case O:u?(e.blendEquationSeparate(e.FUNC_ADD,e.FUNC_ADD),e.blendFuncSeparate(e.ONE,e.ONE,e.ONE,e.ONE)):(e.blendEquation(e.FUNC_ADD),e.blendFunc(e.SRC_ALPHA,e.ONE));break;case A:u?(e.blendEquationSeparate(e.FUNC_ADD,e.FUNC_ADD),e.blendFuncSeparate(e.ZERO,e.ZERO,e.ONE_MINUS_SRC_COLOR,e.ONE_MINUS_SRC_ALPHA)):(e.blendEquation(e.FUNC_ADD),e.blendFunc(e.ZERO,e.ONE_MINUS_SRC_COLOR));break;case L:u?(e.blendEquationSeparate(e.FUNC_ADD,e.FUNC_ADD),e.blendFuncSeparate(e.ZERO,e.SRC_COLOR,e.ZERO,e.SRC_ALPHA)):(e.blendEquation(e.FUNC_ADD),e.blendFunc(e.ZERO,e.SRC_COLOR));break;default:u?(e.blendEquationSeparate(e.FUNC_ADD,e.FUNC_ADD),e.blendFuncSeparate(e.ONE,e.ONE_MINUS_SRC_ALPHA,e.ONE,e.ONE_MINUS_SRC_ALPHA)):(e.blendEquationSeparate(e.FUNC_ADD,e.FUNC_ADD),e.blendFuncSeparate(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA,e.ONE,e.ONE_MINUS_SRC_ALPHA))}d=null,v=null,_=null,b=null,w=null,S=null}else a=a||n,s=s||i,c=c||o,n===d&&a===b||(e.blendEquationSeparate(r.convert(n),r.convert(a)),d=n,b=a),i===v&&o===_&&s===w&&c===S||(e.blendFuncSeparate(r.convert(i),r.convert(o),r.convert(s),r.convert(c)),v=i,_=o,w=s,S=c);f=t,C=u}function setFlipSided(t){P!==t&&(t?e.frontFace(e.CW):e.frontFace(e.CCW),P=t)}function setCullFace(t){t!==m?(enable(e.CULL_FACE),t!==R&&(t===g?e.cullFace(e.BACK):t===y?e.cullFace(e.FRONT):e.cullFace(e.FRONT_AND_BACK))):disable(e.CULL_FACE),R=t}function setPolygonOffset(t,r,n){t?(enable(e.POLYGON_OFFSET_FILL),N===r&&F===n||(e.polygonOffset(r,n),N=r,F=n)):disable(e.POLYGON_OFFSET_FILL)}function activeTexture(t){void 0===t&&(t=e.TEXTURE0+j-1),U!==t&&(e.activeTexture(t),U=t)}return W[e.TEXTURE_2D]=createTexture(e.TEXTURE_2D,e.TEXTURE_2D,1),W[e.TEXTURE_CUBE_MAP]=createTexture(e.TEXTURE_CUBE_MAP,e.TEXTURE_CUBE_MAP_POSITIVE_X,6),n.setClear(0,0,0,1),i.setClear(1),o.setClear(0),enable(e.DEPTH_TEST),i.setFunc(Q),setFlipSided(!1),setCullFace(g),enable(e.CULL_FACE),enable(e.BLEND),setBlending(T),{buffers:{color:n,depth:i,stencil:o},initAttributes:function initAttributes(){for(var e=0,t=s.length;e<t;e++)s[e]=0},enableAttribute:function enableAttribute(r){s[r]=1,0===c[r]&&(e.enableVertexAttribArray(r),c[r]=1),0!==u[r]&&(t.get("ANGLE_instanced_arrays").vertexAttribDivisorANGLE(r,0),u[r]=0)},enableAttributeAndDivisor:function enableAttributeAndDivisor(r,n){s[r]=1,0===c[r]&&(e.enableVertexAttribArray(r),c[r]=1),u[r]!==n&&(t.get("ANGLE_instanced_arrays").vertexAttribDivisorANGLE(r,n),u[r]=n)},disableUnusedAttributes:function disableUnusedAttributes(){for(var t=0,r=c.length;t!==r;++t)c[t]!==s[t]&&(e.disableVertexAttribArray(t),c[t]=0)},enable:enable,disable:disable,getCompressedTextureFormats:function getCompressedTextureFormats(){if(null===h&&(h=[],t.get("WEBGL_compressed_texture_pvrtc")||t.get("WEBGL_compressed_texture_s3tc")||t.get("WEBGL_compressed_texture_etc1")||t.get("WEBGL_compressed_texture_astc")))for(var r=e.getParameter(e.COMPRESSED_TEXTURE_FORMATS),n=0;n<r.length;n++)h.push(r[n]);return h},useProgram:function useProgram(t){return p!==t&&(e.useProgram(t),p=t,!0)},setBlending:setBlending,setMaterial:function setMaterial(t,r){t.side===M?disable(e.CULL_FACE):enable(e.CULL_FACE);var o=t.side===x;r&&(o=!o),setFlipSided(o),!0===t.transparent?setBlending(t.blending,t.blendEquation,t.blendSrc,t.blendDst,t.blendEquationAlpha,t.blendSrcAlpha,t.blendDstAlpha,t.premultipliedAlpha):setBlending(E),i.setFunc(t.depthFunc),i.setTest(t.depthTest),i.setMask(t.depthWrite),n.setMask(t.colorWrite),setPolygonOffset(t.polygonOffset,t.polygonOffsetFactor,t.polygonOffsetUnits)},setFlipSided:setFlipSided,setCullFace:setCullFace,setLineWidth:function setLineWidth(t){t!==I&&(B&&e.lineWidth(t),I=t)},setPolygonOffset:setPolygonOffset,setScissorTest:function setScissorTest(t){t?enable(e.SCISSOR_TEST):disable(e.SCISSOR_TEST)},activeTexture:activeTexture,bindTexture:function bindTexture(t,r){null===U&&activeTexture();var n=G[U];void 0===n&&(n={type:void 0,texture:void 0},G[U]=n),n.type===t&&n.texture===r||(e.bindTexture(t,r||W[t]),n.type=t,n.texture=r)},compressedTexImage2D:function compressedTexImage2D(){try{e.compressedTexImage2D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},texImage2D:function texImage2D(){try{e.texImage2D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},scissor:function scissor(t){!1===z.equals(t)&&(e.scissor(t.x,t.y,t.z,t.w),z.copy(t))},viewport:function viewport(t){!1===H.equals(t)&&(e.viewport(t.x,t.y,t.z,t.w),H.copy(t))},reset:function reset(){for(var t=0;t<c.length;t++)1===c[t]&&(e.disableVertexAttribArray(t),c[t]=0);l={},h=null,U=null,G={},p=null,f=null,P=null,R=null,n.reset(),i.reset(),o.reset()}}}(p,d,de)).scissor(St.copy(kt).multiplyScalar(Ot)),_.viewport(Mt.copy(Lt).multiplyScalar(Ot)),b=new function WebGLInfo(e){var t={frame:0,calls:0,triangles:0,points:0,lines:0};return{memory:{geometries:0,textures:0},render:t,programs:null,autoReset:!0,reset:function reset(){t.frame++,t.calls=0,t.triangles=0,t.points=0,t.lines=0},update:function update(r,n,i){switch(i=i||1,t.calls++,n){case e.TRIANGLES:t.triangles+=i*(r/3);break;case e.TRIANGLE_STRIP:case e.TRIANGLE_FAN:t.triangles+=i*(r-2);break;case e.LINES:t.lines+=i*(r/2);break;case e.LINE_STRIP:t.lines+=i*(r-1);break;case e.LINE_LOOP:t.lines+=i*r;break;case e.POINTS:t.points+=i*r;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",n)}}}}(p),w=new function WebGLProperties(){var e=new WeakMap;return{get:function get(t){var r=e.get(t);return void 0===r&&(r={},e.set(t,r)),r},remove:function remove(t){e.delete(t)},update:function update(t,r,n){e.get(t)[r]=n},dispose:function dispose(){e=new WeakMap}}},C=new WebGLTextures(p,d,_,w,v,de,b),P=new WebGLAttributes(p),ne=new function WebGLGeometries(e,t,r){var n={},i={};function onGeometryDispose(e){var o=e.target,a=n[o.id];for(var s in null!==a.index&&t.remove(a.index),a.attributes)t.remove(a.attributes[s]);o.removeEventListener("dispose",onGeometryDispose),delete n[o.id];var c=i[o.id];c&&(t.remove(c),delete i[o.id]),(c=i[a.id])&&(t.remove(c),delete i[a.id]),r.memory.geometries--}return{get:function get(e,t){var i=n[t.id];return i||(t.addEventListener("dispose",onGeometryDispose),t.isBufferGeometry?i=t:t.isGeometry&&(void 0===t._bufferGeometry&&(t._bufferGeometry=(new BufferGeometry).setFromObject(e)),i=t._bufferGeometry),n[t.id]=i,r.memory.geometries++,i)},update:function update(r){var n=r.index,i=r.attributes;for(var o in null!==n&&t.update(n,e.ELEMENT_ARRAY_BUFFER),i)t.update(i[o],e.ARRAY_BUFFER);var a=r.morphAttributes;for(var o in a)for(var s=a[o],c=0,u=s.length;c<u;c++)t.update(s[c],e.ARRAY_BUFFER)},getWireframeAttribute:function getWireframeAttribute(r){var n=i[r.id];if(n)return n;var o,a=[],s=r.index,c=r.attributes;if(null!==s)for(var u=0,l=(o=s.array).length;u<l;u+=3){var h=o[u+0],p=o[u+1],f=o[u+2];a.push(h,p,p,f,f,h)}else for(u=0,l=(o=c.position.array).length/3-1;u<l;u+=3)h=u+0,p=u+1,f=u+2,a.push(h,p,p,f,f,h);return n=new(arrayMax(a)>65535?Uint32BufferAttribute:Uint16BufferAttribute)(a,1),t.update(n,e.ELEMENT_ARRAY_BUFFER),i[r.id]=n,n}}}(p,P,b),ie=new function WebGLObjects(e,t){var r={};return{update:function update(n){var i=t.render.frame,o=n.geometry,a=e.get(n,o);return r[a.id]!==i&&(o.isGeometry&&a.updateFromObject(n),e.update(a),r[a.id]=i),a},dispose:function dispose(){r={}}}}(ne,b),le=new function WebGLMorphtargets(e){var t={},r=new Float32Array(8);return{update:function update(n,i,o,a){var s=n.morphTargetInfluences,c=s.length,u=t[i.id];if(void 0===u){u=[];for(var l=0;l<c;l++)u[l]=[l,0];t[i.id]=u}var h=o.morphTargets&&i.morphAttributes.position,p=o.morphNormals&&i.morphAttributes.normal;for(l=0;l<c;l++)0!==(f=u[l])[1]&&(h&&i.removeAttribute("morphTarget"+l),p&&i.removeAttribute("morphNormal"+l));for(l=0;l<c;l++)(f=u[l])[0]=l,f[1]=s[l];for(u.sort(absNumericalSort),l=0;l<8;l++){var f;if(f=u[l]){var d=f[0],m=f[1];if(m){h&&i.addAttribute("morphTarget"+l,h[d]),p&&i.addAttribute("morphNormal"+l,p[d]),r[l]=m;continue}}r[l]=0}a.getUniforms().setValue(e,"morphTargetInfluences",r)}}}(p),oe=new WebGLPrograms(me,d,v),ae=new WebGLRenderLists,ce=new WebGLRenderStates,ue=new function WebGLBackground(e,t,r,n){var i,o,a,s=new Color(0),c=0;function setClear(e,r){t.buffers.color.setClear(e.r,e.g,e.b,r,n)}return{getClearColor:function getClearColor(){return s},setClearColor:function setClearColor(e,t){s.set(e),setClear(s,c=void 0!==t?t:1)},getClearAlpha:function getClearAlpha(){return c},setClearAlpha:function setClearAlpha(e){setClear(s,c=e)},render:function render(t,n,u,l){var h=n.background;null===h?setClear(s,c):h&&h.isColor&&(setClear(h,1),l=!0),(e.autoClear||l)&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),h&&h.isCubeTexture?(void 0===a&&((a=new Mesh(new BoxBufferGeometry(1,1,1),new ShaderMaterial({uniforms:Ht.cube.uniforms,vertexShader:Ht.cube.vertexShader,fragmentShader:Ht.cube.fragmentShader,side:x,depthTest:!0,depthWrite:!1,fog:!1}))).geometry.removeAttribute("normal"),a.geometry.removeAttribute("uv"),a.onBeforeRender=function(e,t,r){this.matrixWorld.copyPosition(r.matrixWorld)},r.update(a.geometry)),a.material.uniforms.tCube.value=h,t.push(a,a.geometry,a.material,0,null)):h&&h.isTexture&&(void 0===i&&(i=new OrthographicCamera(-1,1,1,-1,0,1),o=new Mesh(new PlaneBufferGeometry(2,2),new MeshBasicMaterial({depthTest:!1,depthWrite:!1,fog:!1})),r.update(o.geometry)),o.material.map=h,e.renderBufferDirect(i,null,o.geometry,o.material,o,null))}}}(me,_,ne,s),he=new function WebGLBufferRenderer(e,t,r){var n;this.setMode=function setMode(e){n=e},this.render=function render(t,i){e.drawArrays(n,t,i),r.update(i,n)},this.renderInstances=function renderInstances(e,i,o){var a=t.get("ANGLE_instanced_arrays");if(null!==a){var s=e.attributes.position;s.isInterleavedBufferAttribute?(o=s.data.count,a.drawArraysInstancedANGLE(n,0,o,e.maxInstancedCount)):a.drawArraysInstancedANGLE(n,i,o,e.maxInstancedCount),r.update(o,n,e.maxInstancedCount)}else console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.")}}(p,d,b),pe=new function WebGLIndexedBufferRenderer(e,t,r){var n,i,o;this.setMode=function setMode(e){n=e},this.setIndex=function setIndex(e){i=e.type,o=e.bytesPerElement},this.render=function render(t,a){e.drawElements(n,a,i,t*o),r.update(a,n)},this.renderInstances=function renderInstances(e,a,s){var c=t.get("ANGLE_instanced_arrays");null!==c?(c.drawElementsInstancedANGLE(n,s,i,a*o,e.maxInstancedCount),r.update(s,n,e.maxInstancedCount)):console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.")}}(p,d,b),fe=new WebGLSpriteRenderer(me,p,_,C,v),b.programs=oe.programs,me.context=p,me.capabilities=v,me.extensions=d,me.properties=w,me.renderLists=ae,me.state=_,me.info=b}initGLContext();var Gt=new WebVRManager(me);this.vr=Gt;var Wt=new WebGLShadowMap(me,ie,v.maxTextureSize);function onContextLost(e){e.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),ge=!0}function onContextRestore(){console.log("THREE.WebGLRenderer: Context Restored."),ge=!1,initGLContext()}function onMaterialDispose(e){var t=e.target;t.removeEventListener("dispose",onMaterialDispose),function deallocateMaterial(e){releaseMaterialProgramReference(e),w.remove(e)}(t)}function releaseMaterialProgramReference(e){var t=w.get(e).program;e.program=void 0,void 0!==t&&oe.releaseProgram(t)}this.shadowMap=Wt,this.getContext=function(){return p},this.getContextAttributes=function(){return p.getContextAttributes()},this.forceContextLoss=function(){var e=d.get("WEBGL_lose_context");e&&e.loseContext()},this.forceContextRestore=function(){var e=d.get("WEBGL_lose_context");e&&e.restoreContext()},this.getPixelRatio=function(){return Ot},this.setPixelRatio=function(e){void 0!==e&&(Ot=e,this.setSize(Et,Tt,!1))},this.getSize=function(){return{width:Et,height:Tt}},this.setSize=function(e,r,n){var i=Gt.getDevice();i&&i.isPresenting?console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting."):(Et=e,Tt=r,t.width=e*Ot,t.height=r*Ot,!1!==n&&(t.style.width=e+"px",t.style.height=r+"px"),this.setViewport(0,0,e,r))},this.getDrawingBufferSize=function(){return{width:Et*Ot,height:Tt*Ot}},this.setDrawingBufferSize=function(e,r,n){Et=e,Tt=r,Ot=n,t.width=e*n,t.height=r*n,this.setViewport(0,0,e,r)},this.getCurrentViewport=function(){return Mt},this.setViewport=function(e,t,r,n){Lt.set(e,Tt-t-n,r,n),_.viewport(Mt.copy(Lt).multiplyScalar(Ot))},this.setScissor=function(e,t,r,n){kt.set(e,Tt-t-n,r,n),_.scissor(St.copy(kt).multiplyScalar(Ot))},this.setScissorTest=function(e){_.setScissorTest(Rt=e)},this.getClearColor=function(){return ue.getClearColor()},this.setClearColor=function(){ue.setClearColor.apply(ue,arguments)},this.getClearAlpha=function(){return ue.getClearAlpha()},this.setClearAlpha=function(){ue.setClearAlpha.apply(ue,arguments)},this.clear=function(e,t,r){var n=0;(void 0===e||e)&&(n|=p.COLOR_BUFFER_BIT),(void 0===t||t)&&(n|=p.DEPTH_BUFFER_BIT),(void 0===r||r)&&(n|=p.STENCIL_BUFFER_BIT),p.clear(n)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.clearTarget=function(e,t,r,n){this.setRenderTarget(e),this.clear(t,r,n)},this.dispose=function(){t.removeEventListener("webglcontextlost",onContextLost,!1),t.removeEventListener("webglcontextrestored",onContextRestore,!1),ae.dispose(),ce.dispose(),w.dispose(),ie.dispose(),Gt.dispose(),stopAnimation()},this.renderBufferImmediate=function(e,t,r){_.initAttributes();var n=w.get(e);e.hasPositions&&!n.position&&(n.position=p.createBuffer()),e.hasNormals&&!n.normal&&(n.normal=p.createBuffer()),e.hasUvs&&!n.uv&&(n.uv=p.createBuffer()),e.hasColors&&!n.color&&(n.color=p.createBuffer());var i=t.getAttributes();if(e.hasPositions&&(p.bindBuffer(p.ARRAY_BUFFER,n.position),p.bufferData(p.ARRAY_BUFFER,e.positionArray,p.DYNAMIC_DRAW),_.enableAttribute(i.position),p.vertexAttribPointer(i.position,3,p.FLOAT,!1,0,0)),e.hasNormals){if(p.bindBuffer(p.ARRAY_BUFFER,n.normal),!r.isMeshPhongMaterial&&!r.isMeshStandardMaterial&&!r.isMeshNormalMaterial&&!0===r.flatShading)for(var o=0,a=3*e.count;o<a;o+=9){var s=e.normalArray,c=(s[o+0]+s[o+3]+s[o+6])/3,u=(s[o+1]+s[o+4]+s[o+7])/3,l=(s[o+2]+s[o+5]+s[o+8])/3;s[o+0]=c,s[o+1]=u,s[o+2]=l,s[o+3]=c,s[o+4]=u,s[o+5]=l,s[o+6]=c,s[o+7]=u,s[o+8]=l}p.bufferData(p.ARRAY_BUFFER,e.normalArray,p.DYNAMIC_DRAW),_.enableAttribute(i.normal),p.vertexAttribPointer(i.normal,3,p.FLOAT,!1,0,0)}e.hasUvs&&r.map&&(p.bindBuffer(p.ARRAY_BUFFER,n.uv),p.bufferData(p.ARRAY_BUFFER,e.uvArray,p.DYNAMIC_DRAW),_.enableAttribute(i.uv),p.vertexAttribPointer(i.uv,2,p.FLOAT,!1,0,0)),e.hasColors&&r.vertexColors!==S&&(p.bindBuffer(p.ARRAY_BUFFER,n.color),p.bufferData(p.ARRAY_BUFFER,e.colorArray,p.DYNAMIC_DRAW),_.enableAttribute(i.color),p.vertexAttribPointer(i.color,3,p.FLOAT,!1,0,0)),_.disableUnusedAttributes(),p.drawArrays(p.TRIANGLES,0,e.count),e.count=0},this.renderBufferDirect=function(e,t,r,n,i,o){var a=i.isMesh&&i.matrixWorld.determinant()<0;_.setMaterial(n,a);var s=setProgram(e,t,n,i),c=r.id+"_"+s.id+"_"+(!0===n.wireframe),u=!1;c!==yt&&(yt=c,u=!0),i.morphTargetInfluences&&(le.update(i,r,n,s),u=!0);var l,h=r.index,f=r.attributes.position,m=1;!0===n.wireframe&&(h=ne.getWireframeAttribute(r),m=2);var g=he;null!==h&&(l=P.get(h),(g=pe).setIndex(l)),u&&(!function setupVertexAttributes(e,t,r,n){if(r&&r.isInstancedBufferGeometry&&null===d.get("ANGLE_instanced_arrays"))return void console.error("THREE.WebGLRenderer.setupVertexAttributes: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");void 0===n&&(n=0);_.initAttributes();var i=r.attributes,o=t.getAttributes(),a=e.defaultAttributeValues;for(var s in o){var c=o[s];if(c>=0){var u=i[s];if(void 0!==u){var l=u.normalized,h=u.itemSize,f=P.get(u);if(void 0===f)continue;var m=f.buffer,g=f.type,y=f.bytesPerElement;if(u.isInterleavedBufferAttribute){var v=u.data,b=v.stride,w=u.offset;v&&v.isInstancedInterleavedBuffer?(_.enableAttributeAndDivisor(c,v.meshPerAttribute),void 0===r.maxInstancedCount&&(r.maxInstancedCount=v.meshPerAttribute*v.count)):_.enableAttribute(c),p.bindBuffer(p.ARRAY_BUFFER,m),p.vertexAttribPointer(c,h,g,l,b*y,(n*b+w)*y)}else u.isInstancedBufferAttribute?(_.enableAttributeAndDivisor(c,u.meshPerAttribute),void 0===r.maxInstancedCount&&(r.maxInstancedCount=u.meshPerAttribute*u.count)):_.enableAttribute(c),p.bindBuffer(p.ARRAY_BUFFER,m),p.vertexAttribPointer(c,h,g,l,0,n*h*y)}else if(void 0!==a){var x=a[s];if(void 0!==x)switch(x.length){case 2:p.vertexAttrib2fv(c,x);break;case 3:p.vertexAttrib3fv(c,x);break;case 4:p.vertexAttrib4fv(c,x);break;default:p.vertexAttrib1fv(c,x)}}}}_.disableUnusedAttributes()}(n,s,r),null!==h&&p.bindBuffer(p.ELEMENT_ARRAY_BUFFER,l.buffer));var y=1/0;null!==h?y=h.count:void 0!==f&&(y=f.count);var v=r.drawRange.start*m,b=r.drawRange.count*m,w=null!==o?o.start*m:0,x=null!==o?o.count*m:1/0,M=Math.max(v,w),S=Math.min(y,v+b,w+x)-1,C=Math.max(0,S-M+1);if(0!==C){if(i.isMesh)if(!0===n.wireframe)_.setLineWidth(n.wireframeLinewidth*getTargetPixelRatio()),g.setMode(p.LINES);else switch(i.drawMode){case vt:g.setMode(p.TRIANGLES);break;case _t:g.setMode(p.TRIANGLE_STRIP);break;case bt:g.setMode(p.TRIANGLE_FAN)}else if(i.isLine){var E=n.linewidth;void 0===E&&(E=1),_.setLineWidth(E*getTargetPixelRatio()),i.isLineSegments?g.setMode(p.LINES):i.isLineLoop?g.setMode(p.LINE_LOOP):g.setMode(p.LINE_STRIP)}else i.isPoints&&g.setMode(p.POINTS);r&&r.isInstancedBufferGeometry?r.maxInstancedCount>0&&g.renderInstances(r,M,C):g.render(M,C)}},this.compile=function(e,t){(h=ce.get(e,t)).init(),e.traverse(function(e){e.isLight&&(h.pushLight(e),e.castShadow&&h.pushShadow(e))}),h.setupLights(t),e.traverse(function(t){if(t.material)if(Array.isArray(t.material))for(var r=0;r<t.material.length;r++)initMaterial(t.material[r],e.fog,t);else initMaterial(t.material,e.fog,t)})};var qt,Xt=!1,Yt=null;function stopAnimation(){Xt=!1}function requestAnimationLoopFrame(){var e=Gt.getDevice();e&&e.isPresenting?e.requestAnimationFrame(animationLoop):window.requestAnimationFrame(animationLoop)}function animationLoop(e){!1!==Xt&&(Yt(e),requestAnimationLoopFrame())}function renderObjects(e,t,r,n){for(var i=0,o=e.length;i<o;i++){var a=e[i],s=a.object,c=a.geometry,u=void 0===n?a.material:n,l=a.group;if(r.isArrayCamera){xt=r;for(var h=r.cameras,p=0,f=h.length;p<f;p++){var d=h[p];if(s.layers.test(d.layers)){var m=d.bounds,g=m.x*Et,y=m.y*Tt,v=m.z*Et,b=m.w*Tt;_.viewport(Mt.set(g,y,v,b).multiplyScalar(Ot)),renderObject(s,t,d,c,u,l)}}}else xt=null,renderObject(s,t,r,c,u,l)}}function renderObject(e,t,r,n,i,o){if(e.onBeforeRender(me,t,r,n,i,o),h=ce.get(t,xt||r),e.modelViewMatrix.multiplyMatrices(r.matrixWorldInverse,e.matrixWorld),e.normalMatrix.getNormalMatrix(e.modelViewMatrix),e.isImmediateRenderObject){var a=e.isMesh&&e.matrixWorld.determinant()<0;_.setMaterial(i,a);var s=setProgram(r,t.fog,i,e);yt="",function renderObjectImmediate(e,t,r){e.render(function(e){me.renderBufferImmediate(e,t,r)})}(e,s,i)}else me.renderBufferDirect(r,t.fog,n,i,e,o);e.onAfterRender(me,t,r,n,i,o),h=ce.get(t,xt||r)}function initMaterial(e,t,r){var n=w.get(e),i=h.state.lights,o=h.state.shadowsArray,a=oe.getParameters(e,i.state,o,t,Nt.numPlanes,Nt.numIntersection,r),s=oe.getProgramCode(e,a),c=n.program,u=!0;if(void 0===c)e.addEventListener("dispose",onMaterialDispose);else if(c.code!==s)releaseMaterialProgramReference(e);else if(n.lightsHash!==i.state.hash)w.update(e,"lightsHash",i.state.hash),u=!1;else{if(void 0!==a.shaderID)return;u=!1}if(u){if(a.shaderID){var l=Ht[a.shaderID];n.shader={name:e.type,uniforms:Dt.clone(l.uniforms),vertexShader:l.vertexShader,fragmentShader:l.fragmentShader}}else n.shader={name:e.type,uniforms:e.uniforms,vertexShader:e.vertexShader,fragmentShader:e.fragmentShader};e.onBeforeCompile(n.shader,me),c=oe.acquireProgram(e,n.shader,a,s),n.program=c,e.program=c}var p=c.getAttributes();if(e.morphTargets){e.numSupportedMorphTargets=0;for(var f=0;f<me.maxMorphTargets;f++)p["morphTarget"+f]>=0&&e.numSupportedMorphTargets++}if(e.morphNormals){e.numSupportedMorphNormals=0;for(f=0;f<me.maxMorphNormals;f++)p["morphNormal"+f]>=0&&e.numSupportedMorphNormals++}var d=n.shader.uniforms;(e.isShaderMaterial||e.isRawShaderMaterial)&&!0!==e.clipping||(n.numClippingPlanes=Nt.numPlanes,n.numIntersection=Nt.numIntersection,d.clippingPlanes=Nt.uniform),n.fog=t,n.lightsHash=i.state.hash,e.lights&&(d.ambientLightColor.value=i.state.ambient,d.directionalLights.value=i.state.directional,d.spotLights.value=i.state.spot,d.rectAreaLights.value=i.state.rectArea,d.pointLights.value=i.state.point,d.hemisphereLights.value=i.state.hemi,d.directionalShadowMap.value=i.state.directionalShadowMap,d.directionalShadowMatrix.value=i.state.directionalShadowMatrix,d.spotShadowMap.value=i.state.spotShadowMap,d.spotShadowMatrix.value=i.state.spotShadowMatrix,d.pointShadowMap.value=i.state.pointShadowMap,d.pointShadowMatrix.value=i.state.pointShadowMatrix);var m=n.program.getUniforms(),g=WebGLUniforms.seqWithValue(m.seq,d);n.uniformsList=g}function setProgram(e,t,r,n){Pt=0;var i=w.get(r),o=h.state.lights;if(Ft&&(jt||e!==wt)){var a=e===wt&&r.id===gt;Nt.setState(r.clippingPlanes,r.clipIntersection,r.clipShadows,e,i,a)}!1===r.needsUpdate&&(void 0===i.program?r.needsUpdate=!0:r.fog&&i.fog!==t?r.needsUpdate=!0:r.lights&&i.lightsHash!==o.state.hash?r.needsUpdate=!0:void 0===i.numClippingPlanes||i.numClippingPlanes===Nt.numPlanes&&i.numIntersection===Nt.numIntersection||(r.needsUpdate=!0)),r.needsUpdate&&(initMaterial(r,t,n),r.needsUpdate=!1);var s=!1,c=!1,u=!1,l=i.program,f=l.getUniforms(),d=i.shader.uniforms;if(_.useProgram(l.program)&&(s=!0,c=!0,u=!0),r.id!==gt&&(gt=r.id,c=!0),s||e!==wt){if(f.setValue(p,"projectionMatrix",e.projectionMatrix),v.logarithmicDepthBuffer&&f.setValue(p,"logDepthBufFC",2/(Math.log(e.far+1)/Math.LN2)),wt!==(xt||e)&&(wt=xt||e,c=!0,u=!0),r.isShaderMaterial||r.isMeshPhongMaterial||r.isMeshStandardMaterial||r.envMap){var m=f.map.cameraPosition;void 0!==m&&m.setValue(p,Vt.setFromMatrixPosition(e.matrixWorld))}(r.isMeshPhongMaterial||r.isMeshLambertMaterial||r.isMeshBasicMaterial||r.isMeshStandardMaterial||r.isShaderMaterial||r.skinning)&&f.setValue(p,"viewMatrix",e.matrixWorldInverse)}if(r.skinning){f.setOptional(p,n,"bindMatrix"),f.setOptional(p,n,"bindMatrixInverse");var g=n.skeleton;if(g){var y=g.bones;if(v.floatVertexTextures){if(void 0===g.boneTexture){var b=Math.sqrt(4*y.length);b=At.ceilPowerOfTwo(b),b=Math.max(b,4);var x=new Float32Array(b*b*4);x.set(g.boneMatrices);var M=new DataTexture(x,b,b,Ue,Re);M.needsUpdate=!0,g.boneMatrices=x,g.boneTexture=M,g.boneTextureSize=b}f.setValue(p,"boneTexture",g.boneTexture),f.setValue(p,"boneTextureSize",g.boneTextureSize)}else f.setOptional(p,g,"boneMatrices")}}return c&&(f.setValue(p,"toneMappingExposure",me.toneMappingExposure),f.setValue(p,"toneMappingWhitePoint",me.toneMappingWhitePoint),r.lights&&function markUniformsLightsNeedsUpdate(e,t){e.ambientLightColor.needsUpdate=t,e.directionalLights.needsUpdate=t,e.pointLights.needsUpdate=t,e.spotLights.needsUpdate=t,e.rectAreaLights.needsUpdate=t,e.hemisphereLights.needsUpdate=t}(d,u),t&&r.fog&&function refreshUniformsFog(e,t){e.fogColor.value=t.color,t.isFog?(e.fogNear.value=t.near,e.fogFar.value=t.far):t.isFogExp2&&(e.fogDensity.value=t.density)}(d,t),r.isMeshBasicMaterial?refreshUniformsCommon(d,r):r.isMeshLambertMaterial?(refreshUniformsCommon(d,r),function refreshUniformsLambert(e,t){t.emissiveMap&&(e.emissiveMap.value=t.emissiveMap)}(d,r)):r.isMeshPhongMaterial?(refreshUniformsCommon(d,r),r.isMeshToonMaterial?function refreshUniformsToon(e,t){refreshUniformsPhong(e,t),t.gradientMap&&(e.gradientMap.value=t.gradientMap)}(d,r):refreshUniformsPhong(d,r)):r.isMeshStandardMaterial?(refreshUniformsCommon(d,r),r.isMeshPhysicalMaterial?function refreshUniformsPhysical(e,t){e.clearCoat.value=t.clearCoat,e.clearCoatRoughness.value=t.clearCoatRoughness,refreshUniformsStandard(e,t)}(d,r):refreshUniformsStandard(d,r)):r.isMeshDepthMaterial?(refreshUniformsCommon(d,r),function refreshUniformsDepth(e,t){t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}(d,r)):r.isMeshDistanceMaterial?(refreshUniformsCommon(d,r),function refreshUniformsDistance(e,t){t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias);e.referencePosition.value.copy(t.referencePosition),e.nearDistance.value=t.nearDistance,e.farDistance.value=t.farDistance}(d,r)):r.isMeshNormalMaterial?(refreshUniformsCommon(d,r),function refreshUniformsNormal(e,t){t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale);t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale));t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}(d,r)):r.isLineBasicMaterial?(!function refreshUniformsLine(e,t){e.diffuse.value=t.color,e.opacity.value=t.opacity}(d,r),r.isLineDashedMaterial&&function refreshUniformsDash(e,t){e.dashSize.value=t.dashSize,e.totalSize.value=t.dashSize+t.gapSize,e.scale.value=t.scale}(d,r)):r.isPointsMaterial?function refreshUniformsPoints(e,t){if(e.diffuse.value=t.color,e.opacity.value=t.opacity,e.size.value=t.size*Ot,e.scale.value=.5*Tt,e.map.value=t.map,null!==t.map){if(!0===t.map.matrixAutoUpdate){var r=t.map.offset,n=t.map.repeat,i=t.map.rotation,o=t.map.center;t.map.matrix.setUvTransform(r.x,r.y,n.x,n.y,i,o.x,o.y)}e.uvTransform.value.copy(t.map.matrix)}}(d,r):r.isShadowMaterial&&(d.color.value=r.color,d.opacity.value=r.opacity),void 0!==d.ltc_1&&(d.ltc_1.value=zt.LTC_1),void 0!==d.ltc_2&&(d.ltc_2.value=zt.LTC_2),WebGLUniforms.upload(p,i.uniformsList,d,me)),r.isShaderMaterial&&!0===r.uniformsNeedUpdate&&(WebGLUniforms.upload(p,i.uniformsList,d,me),r.uniformsNeedUpdate=!1),f.setValue(p,"modelViewMatrix",n.modelViewMatrix),f.setValue(p,"normalMatrix",n.normalMatrix),f.setValue(p,"modelMatrix",n.matrixWorld),l}function refreshUniformsCommon(e,t){var r;if(e.opacity.value=t.opacity,t.color&&(e.diffuse.value=t.color),t.emissive&&e.emissive.value.copy(t.emissive).multiplyScalar(t.emissiveIntensity),t.map&&(e.map.value=t.map),t.alphaMap&&(e.alphaMap.value=t.alphaMap),t.specularMap&&(e.specularMap.value=t.specularMap),t.envMap&&(e.envMap.value=t.envMap,e.flipEnvMap.value=t.envMap&&t.envMap.isCubeTexture?-1:1,e.reflectivity.value=t.reflectivity,e.refractionRatio.value=t.refractionRatio,e.maxMipLevel.value=w.get(t.envMap).__maxMipLevel),t.lightMap&&(e.lightMap.value=t.lightMap,e.lightMapIntensity.value=t.lightMapIntensity),t.aoMap&&(e.aoMap.value=t.aoMap,e.aoMapIntensity.value=t.aoMapIntensity),t.map?r=t.map:t.specularMap?r=t.specularMap:t.displacementMap?r=t.displacementMap:t.normalMap?r=t.normalMap:t.bumpMap?r=t.bumpMap:t.roughnessMap?r=t.roughnessMap:t.metalnessMap?r=t.metalnessMap:t.alphaMap?r=t.alphaMap:t.emissiveMap&&(r=t.emissiveMap),void 0!==r){if(r.isWebGLRenderTarget&&(r=r.texture),!0===r.matrixAutoUpdate){var n=r.offset,i=r.repeat,o=r.rotation,a=r.center;r.matrix.setUvTransform(n.x,n.y,i.x,i.y,o,a.x,a.y)}e.uvTransform.value.copy(r.matrix)}}function refreshUniformsPhong(e,t){e.specular.value=t.specular,e.shininess.value=Math.max(t.shininess,1e-4),t.emissiveMap&&(e.emissiveMap.value=t.emissiveMap),t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale),t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale)),t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}function refreshUniformsStandard(e,t){e.roughness.value=t.roughness,e.metalness.value=t.metalness,t.roughnessMap&&(e.roughnessMap.value=t.roughnessMap),t.metalnessMap&&(e.metalnessMap.value=t.metalnessMap),t.emissiveMap&&(e.emissiveMap.value=t.emissiveMap),t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale),t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale)),t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias),t.envMap&&(e.envMapIntensity.value=t.envMapIntensity)}this.animate=function(e){null!==(Yt=e)?function startAnimation(){Xt||(requestAnimationLoopFrame(),Xt=!0)}():stopAnimation()},this.render=function(e,t,r,n){if(t&&t.isCamera){if(!ge){yt="",gt=-1,wt=null,!0===e.autoUpdate&&e.updateMatrixWorld(),null===t.parent&&t.updateMatrixWorld(),Gt.enabled&&(t=Gt.getCamera(t)),(h=ce.get(e,t)).init(),e.onBeforeRender(me,e,t,r),Bt.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),It.setFromMatrix(Bt),jt=this.localClippingEnabled,Ft=Nt.init(this.clippingPlanes,jt,t),(l=ae.get(e,t)).init(),function projectObject(e,t,r){if(!1===e.visible)return;var n=e.layers.test(t.layers);if(n)if(e.isLight)h.pushLight(e),e.castShadow&&h.pushShadow(e);else if(e.isSprite)e.frustumCulled&&!It.intersectsSprite(e)||h.pushSprite(e);else if(e.isImmediateRenderObject)r&&Vt.setFromMatrixPosition(e.matrixWorld).applyMatrix4(Bt),l.push(e,null,e.material,Vt.z,null);else if((e.isMesh||e.isLine||e.isPoints)&&(e.isSkinnedMesh&&e.skeleton.update(),!e.frustumCulled||It.intersectsObject(e))){r&&Vt.setFromMatrixPosition(e.matrixWorld).applyMatrix4(Bt);var i=ie.update(e),o=e.material;if(Array.isArray(o))for(var a=i.groups,s=0,c=a.length;s<c;s++){var u=a[s],p=o[u.materialIndex];p&&p.visible&&l.push(e,i,p,Vt.z,u)}else o.visible&&l.push(e,i,o,Vt.z,null)}var f=e.children;for(var s=0,c=f.length;s<c;s++)projectObject(f[s],t,r)}(e,t,me.sortObjects),!0===me.sortObjects&&l.sort(),Ft&&Nt.beginShadows();var i=h.state.shadowsArray;Wt.render(i,e,t),h.setupLights(t),Ft&&Nt.endShadows(),this.info.autoReset&&this.info.reset(),void 0===r&&(r=null),this.setRenderTarget(r),ue.render(l,e,t,n);var o=l.opaque,a=l.transparent;if(e.overrideMaterial){var s=e.overrideMaterial;o.length&&renderObjects(o,e,t,s),a.length&&renderObjects(a,e,t,s)}else o.length&&renderObjects(o,e,t),a.length&&renderObjects(a,e,t);var c=h.state.spritesArray;fe.render(c,e,t),r&&C.updateRenderTargetMipmap(r),_.buffers.depth.setTest(!0),_.buffers.depth.setMask(!0),_.buffers.color.setMask(!0),_.setPolygonOffset(!1),e.onAfterRender(me,e,t),Gt.enabled&&Gt.submitFrame(),l=null,h=null}}else console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.")},this.allocTextureUnit=function allocTextureUnit(){var e=Pt;return e>=v.maxTextures&&console.warn("THREE.WebGLRenderer: Trying to use "+e+" texture units while this GPU supports only "+v.maxTextures),Pt+=1,e},this.setTexture2D=(qt=!1,function setTexture2D(e,t){e&&e.isWebGLRenderTarget&&(qt||(console.warn("THREE.WebGLRenderer.setTexture2D: don't use render targets as textures. Use their .texture property instead."),qt=!0),e=e.texture),C.setTexture2D(e,t)}),this.setTexture=function(){var e=!1;return function setTexture(t,r){e||(console.warn("THREE.WebGLRenderer: .setTexture is deprecated, use setTexture2D instead."),e=!0),C.setTexture2D(t,r)}}(),this.setTextureCube=function(){var e=!1;return function setTextureCube(t,r){t&&t.isWebGLRenderTargetCube&&(e||(console.warn("THREE.WebGLRenderer.setTextureCube: don't use cube render targets as textures. Use their .texture property instead."),e=!0),t=t.texture),t&&t.isCubeTexture||Array.isArray(t.image)&&6===t.image.length?C.setTextureCube(t,r):C.setTextureCubeDynamic(t,r)}}(),this.getRenderTarget=function(){return ye},this.setRenderTarget=function(e){ye=e,e&&void 0===w.get(e).__webglFramebuffer&&C.setupRenderTarget(e);var t=null,r=!1;if(e){var n=w.get(e).__webglFramebuffer;e.isWebGLRenderTargetCube?(t=n[e.activeCubeFace],r=!0):t=n,Mt.copy(e.viewport),St.copy(e.scissor),Ct=e.scissorTest}else Mt.copy(Lt).multiplyScalar(Ot),St.copy(kt).multiplyScalar(Ot),Ct=Rt;if(at!==t&&(p.bindFramebuffer(p.FRAMEBUFFER,t),at=t),_.viewport(Mt),_.scissor(St),_.setScissorTest(Ct),r){var i=w.get(e.texture);p.framebufferTexture2D(p.FRAMEBUFFER,p.COLOR_ATTACHMENT0,p.TEXTURE_CUBE_MAP_POSITIVE_X+e.activeCubeFace,i.__webglTexture,e.activeMipMapLevel)}},this.readRenderTargetPixels=function(e,t,r,n,i,o){if(e&&e.isWebGLRenderTarget){var a=w.get(e).__webglFramebuffer;if(a){var s=!1;a!==at&&(p.bindFramebuffer(p.FRAMEBUFFER,a),s=!0);try{var c=e.texture,u=c.format,l=c.type;if(u!==Ue&&de.convert(u)!==p.getParameter(p.IMPLEMENTATION_COLOR_READ_FORMAT))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");if(!(l===Ee||de.convert(l)===p.getParameter(p.IMPLEMENTATION_COLOR_READ_TYPE)||l===Re&&(d.get("OES_texture_float")||d.get("WEBGL_color_buffer_float"))||l===Ie&&d.get("EXT_color_buffer_half_float")))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");p.checkFramebufferStatus(p.FRAMEBUFFER)===p.FRAMEBUFFER_COMPLETE?t>=0&&t<=e.width-n&&r>=0&&r<=e.height-i&&p.readPixels(t,r,n,i,de.convert(u),de.convert(l),o):console.error("THREE.WebGLRenderer.readRenderTargetPixels: readPixels from renderTarget failed. Framebuffer not complete.")}finally{s&&p.bindFramebuffer(p.FRAMEBUFFER,at)}}}else console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.")},this.copyFramebufferToTexture=function(e,t,r){var n=t.image.width,i=t.image.height,o=de.convert(t.format);this.setTexture2D(t,0),p.copyTexImage2D(p.TEXTURE_2D,r||0,o,e.x,e.y,n,i,0)},this.copyTextureToTexture=function(e,t,r,n){var i=t.image.width,o=t.image.height,a=de.convert(r.format),s=de.convert(r.type),c=t.isDataTexture?t.image.data:t.image;this.setTexture2D(r,0),p.texSubImage2D(p.TEXTURE_2D,n||0,e.x,e.y,i,o,a,s,c)}}function FogExp2(e,t){this.name="",this.color=new Color(e),this.density=void 0!==t?t:25e-5}function Fog(e,t,r){this.name="",this.color=new Color(e),this.near=void 0!==t?t:1,this.far=void 0!==r?r:1e3}function Scene(){Object3D.call(this),this.type="Scene",this.background=null,this.fog=null,this.overrideMaterial=null,this.autoUpdate=!0}function SpriteMaterial(e){Material.call(this),this.type="SpriteMaterial",this.color=new Color(16777215),this.map=null,this.rotation=0,this.fog=!1,this.lights=!1,this.setValues(e)}function Sprite(e){Object3D.call(this),this.type="Sprite",this.material=void 0!==e?e:new SpriteMaterial,this.center=new Vector2(.5,.5)}function LOD(){Object3D.call(this),this.type="LOD",Object.defineProperties(this,{levels:{enumerable:!0,value:[]}})}function Skeleton(e,t){if(e=e||[],this.bones=e.slice(0),this.boneMatrices=new Float32Array(16*this.bones.length),void 0===t)this.calculateInverses();else if(this.bones.length===t.length)this.boneInverses=t.slice(0);else{console.warn("THREE.Skeleton boneInverses is the wrong length."),this.boneInverses=[];for(var r=0,n=this.bones.length;r<n;r++)this.boneInverses.push(new Matrix4)}}function Bone(){Object3D.call(this),this.type="Bone"}function SkinnedMesh(e,t){Mesh.call(this,e,t),this.type="SkinnedMesh",this.bindMode="attached",this.bindMatrix=new Matrix4,this.bindMatrixInverse=new Matrix4;var r=new Skeleton(this.initBones());this.bind(r,this.matrixWorld),this.normalizeSkinWeights()}function LineBasicMaterial(e){Material.call(this),this.type="LineBasicMaterial",this.color=new Color(16777215),this.linewidth=1,this.linecap="round",this.linejoin="round",this.lights=!1,this.setValues(e)}function Line(e,t,r){if(1===r)return console.warn("THREE.Line: parameter THREE.LinePieces no longer supported. Created THREE.LineSegments instead."),new LineSegments(e,t);Object3D.call(this),this.type="Line",this.geometry=void 0!==e?e:new BufferGeometry,this.material=void 0!==t?t:new LineBasicMaterial({color:16777215*Math.random()})}function LineSegments(e,t){Line.call(this,e,t),this.type="LineSegments"}function LineLoop(e,t){Line.call(this,e,t),this.type="LineLoop"}function PointsMaterial(e){Material.call(this),this.type="PointsMaterial",this.color=new Color(16777215),this.map=null,this.size=1,this.sizeAttenuation=!0,this.lights=!1,this.setValues(e)}function Points(e,t){Object3D.call(this),this.type="Points",this.geometry=void 0!==e?e:new BufferGeometry,this.material=void 0!==t?t:new PointsMaterial({color:16777215*Math.random()})}function Group(){Object3D.call(this),this.type="Group"}function VideoTexture(e,t,r,n,i,o,a,s,c){Texture.call(this,e,t,r,n,i,o,a,s,c),this.generateMipmaps=!1}function CompressedTexture(e,t,r,n,i,o,a,s,c,u,l,h){Texture.call(this,null,o,a,s,c,u,n,i,l,h),this.image={width:t,height:r},this.mipmaps=e,this.flipY=!1,this.generateMipmaps=!1}function DepthTexture(e,t,r,n,i,o,a,s,c,u){if((u=void 0!==u?u:He)!==He&&u!==We)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");void 0===r&&u===He&&(r=Ae),void 0===r&&u===We&&(r=Be),Texture.call(this,null,n,i,o,a,s,u,r,c),this.image={width:e,height:t},this.magFilter=void 0!==a?a:we,this.minFilter=void 0!==s?s:we,this.flipY=!1,this.generateMipmaps=!1}function WireframeGeometry(e){BufferGeometry.call(this),this.type="WireframeGeometry";var t,r,n,i,o,a,s,c,u,l,h=[],p=[0,0],f={},d=["a","b","c"];if(e&&e.isGeometry){var m=e.faces;for(t=0,n=m.length;t<n;t++){var g=m[t];for(r=0;r<3;r++)s=g[d[r]],c=g[d[(r+1)%3]],p[0]=Math.min(s,c),p[1]=Math.max(s,c),void 0===f[u=p[0]+","+p[1]]&&(f[u]={index1:p[0],index2:p[1]})}for(u in f)a=f[u],l=e.vertices[a.index1],h.push(l.x,l.y,l.z),l=e.vertices[a.index2],h.push(l.x,l.y,l.z)}else if(e&&e.isBufferGeometry){var y,v,_,b,w,x,M;if(l=new Vector3,null!==e.index){for(y=e.attributes.position,v=e.index,0===(_=e.groups).length&&(_=[{start:0,count:v.count,materialIndex:0}]),i=0,o=_.length;i<o;++i)for(t=w=(b=_[i]).start,n=w+b.count;t<n;t+=3)for(r=0;r<3;r++)s=v.getX(t+r),c=v.getX(t+(r+1)%3),p[0]=Math.min(s,c),p[1]=Math.max(s,c),void 0===f[u=p[0]+","+p[1]]&&(f[u]={index1:p[0],index2:p[1]});for(u in f)a=f[u],l.fromBufferAttribute(y,a.index1),h.push(l.x,l.y,l.z),l.fromBufferAttribute(y,a.index2),h.push(l.x,l.y,l.z)}else for(t=0,n=(y=e.attributes.position).count/3;t<n;t++)for(r=0;r<3;r++)x=3*t+r,l.fromBufferAttribute(y,x),h.push(l.x,l.y,l.z),M=3*t+(r+1)%3,l.fromBufferAttribute(y,M),h.push(l.x,l.y,l.z)}this.addAttribute("position",new Float32BufferAttribute(h,3))}function ParametricGeometry(e,t,r){Geometry.call(this),this.type="ParametricGeometry",this.parameters={func:e,slices:t,stacks:r},this.fromBufferGeometry(new ParametricBufferGeometry(e,t,r)),this.mergeVertices()}function ParametricBufferGeometry(e,t,r){BufferGeometry.call(this),this.type="ParametricBufferGeometry",this.parameters={func:e,slices:t,stacks:r};var n,i,o=[],a=[],s=[],c=[],u=new Vector3,l=new Vector3,h=new Vector3,p=new Vector3,f=new Vector3,d=t+1;for(n=0;n<=r;n++){var m=n/r;for(i=0;i<=t;i++){var g=i/t;e(g,m,l),a.push(l.x,l.y,l.z),g-1e-5>=0?(e(g-1e-5,m,h),p.subVectors(l,h)):(e(g+1e-5,m,h),p.subVectors(h,l)),m-1e-5>=0?(e(g,m-1e-5,h),f.subVectors(l,h)):(e(g,m+1e-5,h),f.subVectors(h,l)),u.crossVectors(p,f).normalize(),s.push(u.x,u.y,u.z),c.push(g,m)}}for(n=0;n<r;n++)for(i=0;i<t;i++){var y=n*d+i,v=n*d+i+1,_=(n+1)*d+i+1,b=(n+1)*d+i;o.push(y,v,b),o.push(v,_,b)}this.setIndex(o),this.addAttribute("position",new Float32BufferAttribute(a,3)),this.addAttribute("normal",new Float32BufferAttribute(s,3)),this.addAttribute("uv",new Float32BufferAttribute(c,2))}function PolyhedronGeometry(e,t,r,n){Geometry.call(this),this.type="PolyhedronGeometry",this.parameters={vertices:e,indices:t,radius:r,detail:n},this.fromBufferGeometry(new PolyhedronBufferGeometry(e,t,r,n)),this.mergeVertices()}function PolyhedronBufferGeometry(e,t,r,n){BufferGeometry.call(this),this.type="PolyhedronBufferGeometry",this.parameters={vertices:e,indices:t,radius:r,detail:n},r=r||1;var i=[],o=[];function subdivideFace(e,t,r,n){var i,o,a=Math.pow(2,n),s=[];for(i=0;i<=a;i++){s[i]=[];var c=e.clone().lerp(r,i/a),u=t.clone().lerp(r,i/a),l=a-i;for(o=0;o<=l;o++)s[i][o]=0===o&&i===a?c:c.clone().lerp(u,o/l)}for(i=0;i<a;i++)for(o=0;o<2*(a-i)-1;o++){var h=Math.floor(o/2);o%2==0?(pushVertex(s[i][h+1]),pushVertex(s[i+1][h]),pushVertex(s[i][h])):(pushVertex(s[i][h+1]),pushVertex(s[i+1][h+1]),pushVertex(s[i+1][h]))}}function pushVertex(e){i.push(e.x,e.y,e.z)}function getVertexByIndex(t,r){var n=3*t;r.x=e[n+0],r.y=e[n+1],r.z=e[n+2]}function correctUV(e,t,r,n){n<0&&1===e.x&&(o[t]=e.x-1),0===r.x&&0===r.z&&(o[t]=n/2/Math.PI+.5)}function azimuth(e){return Math.atan2(e.z,-e.x)}!function subdivide(e){for(var r=new Vector3,n=new Vector3,i=new Vector3,o=0;o<t.length;o+=3)getVertexByIndex(t[o+0],r),getVertexByIndex(t[o+1],n),getVertexByIndex(t[o+2],i),subdivideFace(r,n,i,e)}(n=n||0),function appplyRadius(e){for(var t=new Vector3,r=0;r<i.length;r+=3)t.x=i[r+0],t.y=i[r+1],t.z=i[r+2],t.normalize().multiplyScalar(e),i[r+0]=t.x,i[r+1]=t.y,i[r+2]=t.z}(r),function generateUVs(){for(var e=new Vector3,t=0;t<i.length;t+=3){e.x=i[t+0],e.y=i[t+1],e.z=i[t+2];var r=azimuth(e)/2/Math.PI+.5,n=(a=e,Math.atan2(-a.y,Math.sqrt(a.x*a.x+a.z*a.z))/Math.PI+.5);o.push(r,1-n)}var a;(function correctUVs(){for(var e=new Vector3,t=new Vector3,r=new Vector3,n=new Vector3,a=new Vector2,s=new Vector2,c=new Vector2,u=0,l=0;u<i.length;u+=9,l+=6){e.set(i[u+0],i[u+1],i[u+2]),t.set(i[u+3],i[u+4],i[u+5]),r.set(i[u+6],i[u+7],i[u+8]),a.set(o[l+0],o[l+1]),s.set(o[l+2],o[l+3]),c.set(o[l+4],o[l+5]),n.copy(e).add(t).add(r).divideScalar(3);var h=azimuth(n);correctUV(a,l+0,e,h),correctUV(s,l+2,t,h),correctUV(c,l+4,r,h)}})(),function correctSeam(){for(var e=0;e<o.length;e+=6){var t=o[e+0],r=o[e+2],n=o[e+4],i=Math.max(t,r,n),a=Math.min(t,r,n);i>.9&&a<.1&&(t<.2&&(o[e+0]+=1),r<.2&&(o[e+2]+=1),n<.2&&(o[e+4]+=1))}}()}(),this.addAttribute("position",new Float32BufferAttribute(i,3)),this.addAttribute("normal",new Float32BufferAttribute(i.slice(),3)),this.addAttribute("uv",new Float32BufferAttribute(o,2)),0===n?this.computeVertexNormals():this.normalizeNormals()}function TetrahedronGeometry(e,t){Geometry.call(this),this.type="TetrahedronGeometry",this.parameters={radius:e,detail:t},this.fromBufferGeometry(new TetrahedronBufferGeometry(e,t)),this.mergeVertices()}function TetrahedronBufferGeometry(e,t){PolyhedronBufferGeometry.call(this,[1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],[2,1,0,0,3,2,1,3,0,2,3,1],e,t),this.type="TetrahedronBufferGeometry",this.parameters={radius:e,detail:t}}function OctahedronGeometry(e,t){Geometry.call(this),this.type="OctahedronGeometry",this.parameters={radius:e,detail:t},this.fromBufferGeometry(new OctahedronBufferGeometry(e,t)),this.mergeVertices()}function OctahedronBufferGeometry(e,t){PolyhedronBufferGeometry.call(this,[1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2],e,t),this.type="OctahedronBufferGeometry",this.parameters={radius:e,detail:t}}function IcosahedronGeometry(e,t){Geometry.call(this),this.type="IcosahedronGeometry",this.parameters={radius:e,detail:t},this.fromBufferGeometry(new IcosahedronBufferGeometry(e,t)),this.mergeVertices()}function IcosahedronBufferGeometry(e,t){var r=(1+Math.sqrt(5))/2,n=[-1,r,0,1,r,0,-1,-r,0,1,-r,0,0,-1,r,0,1,r,0,-1,-r,0,1,-r,r,0,-1,r,0,1,-r,0,-1,-r,0,1];PolyhedronBufferGeometry.call(this,n,[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1],e,t),this.type="IcosahedronBufferGeometry",this.parameters={radius:e,detail:t}}function DodecahedronGeometry(e,t){Geometry.call(this),this.type="DodecahedronGeometry",this.parameters={radius:e,detail:t},this.fromBufferGeometry(new DodecahedronBufferGeometry(e,t)),this.mergeVertices()}function DodecahedronBufferGeometry(e,t){var r=(1+Math.sqrt(5))/2,n=1/r,i=[-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-n,-r,0,-n,r,0,n,-r,0,n,r,-n,-r,0,-n,r,0,n,-r,0,n,r,0,-r,0,-n,r,0,-n,-r,0,n,r,0,n];PolyhedronBufferGeometry.call(this,i,[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9],e,t),this.type="DodecahedronBufferGeometry",this.parameters={radius:e,detail:t}}function TubeGeometry(e,t,r,n,i,o){Geometry.call(this),this.type="TubeGeometry",this.parameters={path:e,tubularSegments:t,radius:r,radialSegments:n,closed:i},void 0!==o&&console.warn("THREE.TubeGeometry: taper has been removed.");var a=new TubeBufferGeometry(e,t,r,n,i);this.tangents=a.tangents,this.normals=a.normals,this.binormals=a.binormals,this.fromBufferGeometry(a),this.mergeVertices()}function TubeBufferGeometry(e,t,r,n,i){BufferGeometry.call(this),this.type="TubeBufferGeometry",this.parameters={path:e,tubularSegments:t,radius:r,radialSegments:n,closed:i},t=t||64,r=r||1,n=n||8,i=i||!1;var o=e.computeFrenetFrames(t,i);this.tangents=o.tangents,this.normals=o.normals,this.binormals=o.binormals;var a,s,c=new Vector3,u=new Vector3,l=new Vector2,h=new Vector3,p=[],f=[],d=[],m=[];function generateSegment(i){h=e.getPointAt(i/t,h);var a=o.normals[i],l=o.binormals[i];for(s=0;s<=n;s++){var d=s/n*Math.PI*2,m=Math.sin(d),g=-Math.cos(d);u.x=g*a.x+m*l.x,u.y=g*a.y+m*l.y,u.z=g*a.z+m*l.z,u.normalize(),f.push(u.x,u.y,u.z),c.x=h.x+r*u.x,c.y=h.y+r*u.y,c.z=h.z+r*u.z,p.push(c.x,c.y,c.z)}}!function generateBufferData(){for(a=0;a<t;a++)generateSegment(a);generateSegment(!1===i?t:0),function generateUVs(){for(a=0;a<=t;a++)for(s=0;s<=n;s++)l.x=a/t,l.y=s/n,d.push(l.x,l.y)}(),function generateIndices(){for(s=1;s<=t;s++)for(a=1;a<=n;a++){var e=(n+1)*(s-1)+(a-1),r=(n+1)*s+(a-1),i=(n+1)*s+a,o=(n+1)*(s-1)+a;m.push(e,r,o),m.push(r,i,o)}}()}(),this.setIndex(m),this.addAttribute("position",new Float32BufferAttribute(p,3)),this.addAttribute("normal",new Float32BufferAttribute(f,3)),this.addAttribute("uv",new Float32BufferAttribute(d,2))}function TorusKnotGeometry(e,t,r,n,i,o,a){Geometry.call(this),this.type="TorusKnotGeometry",this.parameters={radius:e,tube:t,tubularSegments:r,radialSegments:n,p:i,q:o},void 0!==a&&console.warn("THREE.TorusKnotGeometry: heightScale has been deprecated. Use .scale( x, y, z ) instead."),this.fromBufferGeometry(new TorusKnotBufferGeometry(e,t,r,n,i,o)),this.mergeVertices()}function TorusKnotBufferGeometry(e,t,r,n,i,o){BufferGeometry.call(this),this.type="TorusKnotBufferGeometry",this.parameters={radius:e,tube:t,tubularSegments:r,radialSegments:n,p:i,q:o},e=e||1,t=t||.4,r=Math.floor(r)||64,n=Math.floor(n)||8,i=i||2,o=o||3;var a,s,c=[],u=[],l=[],h=[],p=new Vector3,f=new Vector3,d=new Vector3,m=new Vector3,g=new Vector3,y=new Vector3,v=new Vector3;for(a=0;a<=r;++a){var _=a/r*i*Math.PI*2;for(calculatePositionOnCurve(_,i,o,e,d),calculatePositionOnCurve(_+.01,i,o,e,m),y.subVectors(m,d),v.addVectors(m,d),g.crossVectors(y,v),v.crossVectors(g,y),g.normalize(),v.normalize(),s=0;s<=n;++s){var b=s/n*Math.PI*2,w=-t*Math.cos(b),x=t*Math.sin(b);p.x=d.x+(w*v.x+x*g.x),p.y=d.y+(w*v.y+x*g.y),p.z=d.z+(w*v.z+x*g.z),u.push(p.x,p.y,p.z),f.subVectors(p,d).normalize(),l.push(f.x,f.y,f.z),h.push(a/r),h.push(s/n)}}for(s=1;s<=r;s++)for(a=1;a<=n;a++){var M=(n+1)*(s-1)+(a-1),S=(n+1)*s+(a-1),C=(n+1)*s+a,P=(n+1)*(s-1)+a;c.push(M,S,P),c.push(S,C,P)}function calculatePositionOnCurve(e,t,r,n,i){var o=Math.cos(e),a=Math.sin(e),s=r/t*e,c=Math.cos(s);i.x=n*(2+c)*.5*o,i.y=n*(2+c)*a*.5,i.z=n*Math.sin(s)*.5}this.setIndex(c),this.addAttribute("position",new Float32BufferAttribute(u,3)),this.addAttribute("normal",new Float32BufferAttribute(l,3)),this.addAttribute("uv",new Float32BufferAttribute(h,2))}function TorusGeometry(e,t,r,n,i){Geometry.call(this),this.type="TorusGeometry",this.parameters={radius:e,tube:t,radialSegments:r,tubularSegments:n,arc:i},this.fromBufferGeometry(new TorusBufferGeometry(e,t,r,n,i)),this.mergeVertices()}function TorusBufferGeometry(e,t,r,n,i){BufferGeometry.call(this),this.type="TorusBufferGeometry",this.parameters={radius:e,tube:t,radialSegments:r,tubularSegments:n,arc:i},e=e||1,t=t||.4,r=Math.floor(r)||8,n=Math.floor(n)||6,i=i||2*Math.PI;var o,a,s=[],c=[],u=[],l=[],h=new Vector3,p=new Vector3,f=new Vector3;for(o=0;o<=r;o++)for(a=0;a<=n;a++){var d=a/n*i,m=o/r*Math.PI*2;p.x=(e+t*Math.cos(m))*Math.cos(d),p.y=(e+t*Math.cos(m))*Math.sin(d),p.z=t*Math.sin(m),c.push(p.x,p.y,p.z),h.x=e*Math.cos(d),h.y=e*Math.sin(d),f.subVectors(p,h).normalize(),u.push(f.x,f.y,f.z),l.push(a/n),l.push(o/r)}for(o=1;o<=r;o++)for(a=1;a<=n;a++){var g=(n+1)*o+a-1,y=(n+1)*(o-1)+a-1,v=(n+1)*(o-1)+a,_=(n+1)*o+a;s.push(g,y,_),s.push(y,v,_)}this.setIndex(s),this.addAttribute("position",new Float32BufferAttribute(c,3)),this.addAttribute("normal",new Float32BufferAttribute(u,3)),this.addAttribute("uv",new Float32BufferAttribute(l,2))}MeshDepthMaterial.prototype=Object.create(Material.prototype),MeshDepthMaterial.prototype.constructor=MeshDepthMaterial,MeshDepthMaterial.prototype.isMeshDepthMaterial=!0,MeshDepthMaterial.prototype.copy=function(e){return Material.prototype.copy.call(this,e),this.depthPacking=e.depthPacking,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this},MeshDistanceMaterial.prototype=Object.create(Material.prototype),MeshDistanceMaterial.prototype.constructor=MeshDistanceMaterial,MeshDistanceMaterial.prototype.isMeshDistanceMaterial=!0,MeshDistanceMaterial.prototype.copy=function(e){return Material.prototype.copy.call(this,e),this.referencePosition.copy(e.referencePosition),this.nearDistance=e.nearDistance,this.farDistance=e.farDistance,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this},CanvasTexture.prototype=Object.create(Texture.prototype),CanvasTexture.prototype.constructor=CanvasTexture,PerspectiveCamera.prototype=Object.assign(Object.create(Camera.prototype),{constructor:PerspectiveCamera,isPerspectiveCamera:!0,copy:function copy(e,t){return Camera.prototype.copy.call(this,e,t),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=null===e.view?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this},setFocalLength:function setFocalLength(e){var t=.5*this.getFilmHeight()/e;this.fov=2*At.RAD2DEG*Math.atan(t),this.updateProjectionMatrix()},getFocalLength:function getFocalLength(){var e=Math.tan(.5*At.DEG2RAD*this.fov);return.5*this.getFilmHeight()/e},getEffectiveFOV:function getEffectiveFOV(){return 2*At.RAD2DEG*Math.atan(Math.tan(.5*At.DEG2RAD*this.fov)/this.zoom)},getFilmWidth:function getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)},getFilmHeight:function getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)},setViewOffset:function setViewOffset(e,t,r,n,i,o){this.aspect=e/t,null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=r,this.view.offsetY=n,this.view.width=i,this.view.height=o,this.updateProjectionMatrix()},clearViewOffset:function clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()},updateProjectionMatrix:function updateProjectionMatrix(){var e=this.near,t=e*Math.tan(.5*At.DEG2RAD*this.fov)/this.zoom,r=2*t,n=this.aspect*r,i=-.5*n,o=this.view;if(null!==this.view&&this.view.enabled){var a=o.fullWidth,s=o.fullHeight;i+=o.offsetX*n/a,t-=o.offsetY*r/s,n*=o.width/a,r*=o.height/s}var c=this.filmOffset;0!==c&&(i+=e*c/this.getFilmWidth()),this.projectionMatrix.makePerspective(i,i+n,t,t-r,e,this.far)},toJSON:function toJSON(e){var t=Object3D.prototype.toJSON.call(this,e);return t.object.fov=this.fov,t.object.zoom=this.zoom,t.object.near=this.near,t.object.far=this.far,t.object.focus=this.focus,t.object.aspect=this.aspect,null!==this.view&&(t.object.view=Object.assign({},this.view)),t.object.filmGauge=this.filmGauge,t.object.filmOffset=this.filmOffset,t}}),ArrayCamera.prototype=Object.assign(Object.create(PerspectiveCamera.prototype),{constructor:ArrayCamera,isArrayCamera:!0}),FogExp2.prototype.isFogExp2=!0,FogExp2.prototype.clone=function(){return new FogExp2(this.color.getHex(),this.density)},FogExp2.prototype.toJSON=function(){return{type:"FogExp2",color:this.color.getHex(),density:this.density}},Fog.prototype.isFog=!0,Fog.prototype.clone=function(){return new Fog(this.color.getHex(),this.near,this.far)},Fog.prototype.toJSON=function(){return{type:"Fog",color:this.color.getHex(),near:this.near,far:this.far}},Scene.prototype=Object.assign(Object.create(Object3D.prototype),{constructor:Scene,copy:function copy(e,t){return Object3D.prototype.copy.call(this,e,t),null!==e.background&&(this.background=e.background.clone()),null!==e.fog&&(this.fog=e.fog.clone()),null!==e.overrideMaterial&&(this.overrideMaterial=e.overrideMaterial.clone()),this.autoUpdate=e.autoUpdate,this.matrixAutoUpdate=e.matrixAutoUpdate,this},toJSON:function toJSON(e){var t=Object3D.prototype.toJSON.call(this,e);return null!==this.background&&(t.object.background=this.background.toJSON(e)),null!==this.fog&&(t.object.fog=this.fog.toJSON()),t}}),SpriteMaterial.prototype=Object.create(Material.prototype),SpriteMaterial.prototype.constructor=SpriteMaterial,SpriteMaterial.prototype.isSpriteMaterial=!0,SpriteMaterial.prototype.copy=function(e){return Material.prototype.copy.call(this,e),this.color.copy(e.color),this.map=e.map,this.rotation=e.rotation,this},Sprite.prototype=Object.assign(Object.create(Object3D.prototype),{constructor:Sprite,isSprite:!0,raycast:(gr=new Vector3,yr=new Vector3,vr=new Vector3,function raycast(e,t){yr.setFromMatrixPosition(this.matrixWorld),e.ray.closestPointToPoint(yr,gr),vr.setFromMatrixScale(this.matrixWorld);var r=vr.x*vr.y/4;if(!(yr.distanceToSquared(gr)>r)){var n=e.ray.origin.distanceTo(gr);n<e.near||n>e.far||t.push({distance:n,point:gr.clone(),face:null,object:this})}}),clone:function clone(){return new this.constructor(this.material).copy(this)},copy:function copy(e){return Object3D.prototype.copy.call(this,e),void 0!==e.center&&this.center.copy(e.center),this}}),LOD.prototype=Object.assign(Object.create(Object3D.prototype),{constructor:LOD,copy:function copy(e){Object3D.prototype.copy.call(this,e,!1);for(var t=e.levels,r=0,n=t.length;r<n;r++){var i=t[r];this.addLevel(i.object.clone(),i.distance)}return this},addLevel:function addLevel(e,t){void 0===t&&(t=0),t=Math.abs(t);for(var r=this.levels,n=0;n<r.length&&!(t<r[n].distance);n++);r.splice(n,0,{distance:t,object:e}),this.add(e)},getObjectForDistance:function getObjectForDistance(e){for(var t=this.levels,r=1,n=t.length;r<n&&!(e<t[r].distance);r++);return t[r-1].object},raycast:(_r=new Vector3,function raycast(e,t){_r.setFromMatrixPosition(this.matrixWorld);var r=e.ray.origin.distanceTo(_r);this.getObjectForDistance(r).raycast(e,t)}),update:function(){var e=new Vector3,t=new Vector3;return function update(r){var n=this.levels;if(n.length>1){e.setFromMatrixPosition(r.matrixWorld),t.setFromMatrixPosition(this.matrixWorld);var i=e.distanceTo(t);n[0].object.visible=!0;for(var o=1,a=n.length;o<a&&i>=n[o].distance;o++)n[o-1].object.visible=!1,n[o].object.visible=!0;for(;o<a;o++)n[o].object.visible=!1}}}(),toJSON:function toJSON(e){var t=Object3D.prototype.toJSON.call(this,e);t.object.levels=[];for(var r=this.levels,n=0,i=r.length;n<i;n++){var o=r[n];t.object.levels.push({object:o.object.uuid,distance:o.distance})}return t}}),Object.assign(Skeleton.prototype,{calculateInverses:function calculateInverses(){this.boneInverses=[];for(var e=0,t=this.bones.length;e<t;e++){var r=new Matrix4;this.bones[e]&&r.getInverse(this.bones[e].matrixWorld),this.boneInverses.push(r)}},pose:function pose(){var e,t,r;for(t=0,r=this.bones.length;t<r;t++)(e=this.bones[t])&&e.matrixWorld.getInverse(this.boneInverses[t]);for(t=0,r=this.bones.length;t<r;t++)(e=this.bones[t])&&(e.parent&&e.parent.isBone?(e.matrix.getInverse(e.parent.matrixWorld),e.matrix.multiply(e.matrixWorld)):e.matrix.copy(e.matrixWorld),e.matrix.decompose(e.position,e.quaternion,e.scale))},update:(br=new Matrix4,wr=new Matrix4,function update(){for(var e=this.bones,t=this.boneInverses,r=this.boneMatrices,n=this.boneTexture,i=0,o=e.length;i<o;i++){var a=e[i]?e[i].matrixWorld:wr;br.multiplyMatrices(a,t[i]),br.toArray(r,16*i)}void 0!==n&&(n.needsUpdate=!0)}),clone:function clone(){return new Skeleton(this.bones,this.boneInverses)},getBoneByName:function getBoneByName(e){for(var t=0,r=this.bones.length;t<r;t++){var n=this.bones[t];if(n.name===e)return n}}}),Bone.prototype=Object.assign(Object.create(Object3D.prototype),{constructor:Bone,isBone:!0}),SkinnedMesh.prototype=Object.assign(Object.create(Mesh.prototype),{constructor:SkinnedMesh,isSkinnedMesh:!0,initBones:function initBones(){var e,t,r,n,i=[];if(this.geometry&&void 0!==this.geometry.bones){for(r=0,n=this.geometry.bones.length;r<n;r++)t=this.geometry.bones[r],e=new Bone,i.push(e),e.name=t.name,e.position.fromArray(t.pos),e.quaternion.fromArray(t.rotq),void 0!==t.scl&&e.scale.fromArray(t.scl);for(r=0,n=this.geometry.bones.length;r<n;r++)-1!==(t=this.geometry.bones[r]).parent&&null!==t.parent&&void 0!==i[t.parent]?i[t.parent].add(i[r]):this.add(i[r])}return this.updateMatrixWorld(!0),i},bind:function bind(e,t){this.skeleton=e,void 0===t&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),t=this.matrixWorld),this.bindMatrix.copy(t),this.bindMatrixInverse.getInverse(t)},pose:function pose(){this.skeleton.pose()},normalizeSkinWeights:function normalizeSkinWeights(){var e,t;if(this.geometry&&this.geometry.isGeometry)for(t=0;t<this.geometry.skinWeights.length;t++){var r=this.geometry.skinWeights[t];(e=1/r.manhattanLength())!==1/0?r.multiplyScalar(e):r.set(1,0,0,0)}else if(this.geometry&&this.geometry.isBufferGeometry){var n=new Vector4,i=this.geometry.attributes.skinWeight;for(t=0;t<i.count;t++)n.x=i.getX(t),n.y=i.getY(t),n.z=i.getZ(t),n.w=i.getW(t),(e=1/n.manhattanLength())!==1/0?n.multiplyScalar(e):n.set(1,0,0,0),i.setXYZW(t,n.x,n.y,n.z,n.w)}},updateMatrixWorld:function updateMatrixWorld(e){Mesh.prototype.updateMatrixWorld.call(this,e),"attached"===this.bindMode?this.bindMatrixInverse.getInverse(this.matrixWorld):"detached"===this.bindMode?this.bindMatrixInverse.getInverse(this.bindMatrix):console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)},clone:function clone(){return new this.constructor(this.geometry,this.material).copy(this)}}),LineBasicMaterial.prototype=Object.create(Material.prototype),LineBasicMaterial.prototype.constructor=LineBasicMaterial,LineBasicMaterial.prototype.isLineBasicMaterial=!0,LineBasicMaterial.prototype.copy=function(e){return Material.prototype.copy.call(this,e),this.color.copy(e.color),this.linewidth=e.linewidth,this.linecap=e.linecap,this.linejoin=e.linejoin,this},Line.prototype=Object.assign(Object.create(Object3D.prototype),{constructor:Line,isLine:!0,computeLineDistances:(xr=new Vector3,Mr=new Vector3,function computeLineDistances(){var e=this.geometry;if(e.isBufferGeometry)if(null===e.index){for(var t=e.attributes.position,r=[0],n=1,i=t.count;n<i;n++)xr.fromBufferAttribute(t,n-1),Mr.fromBufferAttribute(t,n),r[n]=r[n-1],r[n]+=xr.distanceTo(Mr);e.addAttribute("lineDistance",new THREE.Float32BufferAttribute(r,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else if(e.isGeometry){var o=e.vertices;for((r=e.lineDistances)[0]=0,n=1,i=o.length;n<i;n++)r[n]=r[n-1],r[n]+=o[n-1].distanceTo(o[n])}return this}),raycast:function(){var e=new Matrix4,t=new Ray,r=new Sphere;return function raycast(n,i){var o=n.linePrecision,a=o*o,s=this.geometry,c=this.matrixWorld;if(null===s.boundingSphere&&s.computeBoundingSphere(),r.copy(s.boundingSphere),r.applyMatrix4(c),!1!==n.ray.intersectsSphere(r)){e.getInverse(c),t.copy(n.ray).applyMatrix4(e);var u=new Vector3,l=new Vector3,h=new Vector3,p=new Vector3,f=this&&this.isLineSegments?2:1;if(s.isBufferGeometry){var d=s.index,m=s.attributes.position.array;if(null!==d)for(var g=d.array,y=0,v=g.length-1;y<v;y+=f){var _=g[y],b=g[y+1];if(u.fromArray(m,3*_),l.fromArray(m,3*b),!(t.distanceSqToSegment(u,l,p,h)>a))p.applyMatrix4(this.matrixWorld),(M=n.ray.origin.distanceTo(p))<n.near||M>n.far||i.push({distance:M,point:h.clone().applyMatrix4(this.matrixWorld),index:y,face:null,faceIndex:null,object:this})}else for(y=0,v=m.length/3-1;y<v;y+=f){if(u.fromArray(m,3*y),l.fromArray(m,3*y+3),!(t.distanceSqToSegment(u,l,p,h)>a))p.applyMatrix4(this.matrixWorld),(M=n.ray.origin.distanceTo(p))<n.near||M>n.far||i.push({distance:M,point:h.clone().applyMatrix4(this.matrixWorld),index:y,face:null,faceIndex:null,object:this})}}else if(s.isGeometry){var w=s.vertices,x=w.length;for(y=0;y<x-1;y+=f){var M;if(!(t.distanceSqToSegment(w[y],w[y+1],p,h)>a))p.applyMatrix4(this.matrixWorld),(M=n.ray.origin.distanceTo(p))<n.near||M>n.far||i.push({distance:M,point:h.clone().applyMatrix4(this.matrixWorld),index:y,face:null,faceIndex:null,object:this})}}}}}(),clone:function clone(){return new this.constructor(this.geometry,this.material).copy(this)}}),LineSegments.prototype=Object.assign(Object.create(Line.prototype),{constructor:LineSegments,isLineSegments:!0,computeLineDistances:function(){var e=new Vector3,t=new Vector3;return function computeLineDistances(){var r=this.geometry;if(r.isBufferGeometry)if(null===r.index){for(var n=r.attributes.position,i=[],o=0,a=n.count;o<a;o+=2)e.fromBufferAttribute(n,o),t.fromBufferAttribute(n,o+1),i[o]=0===o?0:i[o-1],i[o+1]=i[o]+e.distanceTo(t);r.addAttribute("lineDistance",new THREE.Float32BufferAttribute(i,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else if(r.isGeometry){var s=r.vertices;for(i=r.lineDistances,o=0,a=s.length;o<a;o+=2)e.copy(s[o]),t.copy(s[o+1]),i[o]=0===o?0:i[o-1],i[o+1]=i[o]+e.distanceTo(t)}return this}}()}),LineLoop.prototype=Object.assign(Object.create(Line.prototype),{constructor:LineLoop,isLineLoop:!0}),PointsMaterial.prototype=Object.create(Material.prototype),PointsMaterial.prototype.constructor=PointsMaterial,PointsMaterial.prototype.isPointsMaterial=!0,PointsMaterial.prototype.copy=function(e){return Material.prototype.copy.call(this,e),this.color.copy(e.color),this.map=e.map,this.size=e.size,this.sizeAttenuation=e.sizeAttenuation,this},Points.prototype=Object.assign(Object.create(Object3D.prototype),{constructor:Points,isPoints:!0,raycast:function(){var e=new Matrix4,t=new Ray,r=new Sphere;return function raycast(n,i){var o=this,a=this.geometry,s=this.matrixWorld,c=n.params.Points.threshold;if(null===a.boundingSphere&&a.computeBoundingSphere(),r.copy(a.boundingSphere),r.applyMatrix4(s),r.radius+=c,!1!==n.ray.intersectsSphere(r)){e.getInverse(s),t.copy(n.ray).applyMatrix4(e);var u=c/((this.scale.x+this.scale.y+this.scale.z)/3),l=u*u,h=new Vector3,p=new Vector3;if(a.isBufferGeometry){var f=a.index,d=a.attributes.position.array;if(null!==f)for(var m=f.array,g=0,y=m.length;g<y;g++){var v=m[g];h.fromArray(d,3*v),testPoint(h,v)}else{g=0;for(var _=d.length/3;g<_;g++)h.fromArray(d,3*g),testPoint(h,g)}}else{var b=a.vertices;for(g=0,_=b.length;g<_;g++)testPoint(b[g],g)}}function testPoint(e,r){var a=t.distanceSqToPoint(e);if(a<l){t.closestPointToPoint(e,p),p.applyMatrix4(s);var c=n.ray.origin.distanceTo(p);if(c<n.near||c>n.far)return;i.push({distance:c,distanceToRay:Math.sqrt(a),point:p.clone(),index:r,face:null,object:o})}}}}(),clone:function clone(){return new this.constructor(this.geometry,this.material).copy(this)}}),Group.prototype=Object.assign(Object.create(Object3D.prototype),{constructor:Group,isGroup:!0}),VideoTexture.prototype=Object.assign(Object.create(Texture.prototype),{constructor:VideoTexture,isVideoTexture:!0,update:function update(){var e=this.image;e.readyState>=e.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}}),CompressedTexture.prototype=Object.create(Texture.prototype),CompressedTexture.prototype.constructor=CompressedTexture,CompressedTexture.prototype.isCompressedTexture=!0,DepthTexture.prototype=Object.create(Texture.prototype),DepthTexture.prototype.constructor=DepthTexture,DepthTexture.prototype.isDepthTexture=!0,WireframeGeometry.prototype=Object.create(BufferGeometry.prototype),WireframeGeometry.prototype.constructor=WireframeGeometry,ParametricGeometry.prototype=Object.create(Geometry.prototype),ParametricGeometry.prototype.constructor=ParametricGeometry,ParametricBufferGeometry.prototype=Object.create(BufferGeometry.prototype),ParametricBufferGeometry.prototype.constructor=ParametricBufferGeometry,PolyhedronGeometry.prototype=Object.create(Geometry.prototype),PolyhedronGeometry.prototype.constructor=PolyhedronGeometry,PolyhedronBufferGeometry.prototype=Object.create(BufferGeometry.prototype),PolyhedronBufferGeometry.prototype.constructor=PolyhedronBufferGeometry,TetrahedronGeometry.prototype=Object.create(Geometry.prototype),TetrahedronGeometry.prototype.constructor=TetrahedronGeometry,TetrahedronBufferGeometry.prototype=Object.create(PolyhedronBufferGeometry.prototype),TetrahedronBufferGeometry.prototype.constructor=TetrahedronBufferGeometry,OctahedronGeometry.prototype=Object.create(Geometry.prototype),OctahedronGeometry.prototype.constructor=OctahedronGeometry,OctahedronBufferGeometry.prototype=Object.create(PolyhedronBufferGeometry.prototype),OctahedronBufferGeometry.prototype.constructor=OctahedronBufferGeometry,IcosahedronGeometry.prototype=Object.create(Geometry.prototype),IcosahedronGeometry.prototype.constructor=IcosahedronGeometry,IcosahedronBufferGeometry.prototype=Object.create(PolyhedronBufferGeometry.prototype),IcosahedronBufferGeometry.prototype.constructor=IcosahedronBufferGeometry,DodecahedronGeometry.prototype=Object.create(Geometry.prototype),DodecahedronGeometry.prototype.constructor=DodecahedronGeometry,DodecahedronBufferGeometry.prototype=Object.create(PolyhedronBufferGeometry.prototype),DodecahedronBufferGeometry.prototype.constructor=DodecahedronBufferGeometry,TubeGeometry.prototype=Object.create(Geometry.prototype),TubeGeometry.prototype.constructor=TubeGeometry,TubeBufferGeometry.prototype=Object.create(BufferGeometry.prototype),TubeBufferGeometry.prototype.constructor=TubeBufferGeometry,TorusKnotGeometry.prototype=Object.create(Geometry.prototype),TorusKnotGeometry.prototype.constructor=TorusKnotGeometry,TorusKnotBufferGeometry.prototype=Object.create(BufferGeometry.prototype),TorusKnotBufferGeometry.prototype.constructor=TorusKnotBufferGeometry,TorusGeometry.prototype=Object.create(Geometry.prototype),TorusGeometry.prototype.constructor=TorusGeometry,TorusBufferGeometry.prototype=Object.create(BufferGeometry.prototype),TorusBufferGeometry.prototype.constructor=TorusBufferGeometry;var Cr=function triangulate(e,t,r){r=r||2;var n,i,o,a,s,c,u,l=t&&t.length,h=l?t[0]*r:e.length,p=linkedList(e,0,h,r,!0),f=[];if(!p)return f;if(l&&(p=function eliminateHoles(e,t,r,n){var i,o,a,s,c,u=[];for(i=0,o=t.length;i<o;i++)a=t[i]*n,s=i<o-1?t[i+1]*n:e.length,(c=linkedList(e,a,s,n,!1))===c.next&&(c.steiner=!0),u.push(getLeftmost(c));for(u.sort(compareX),i=0;i<u.length;i++)eliminateHole(u[i],r),r=filterPoints(r,r.next);return r}(e,t,p,r)),e.length>80*r){n=o=e[0],i=a=e[1];for(var d=r;d<h;d+=r)s=e[d],c=e[d+1],s<n&&(n=s),c<i&&(i=c),s>o&&(o=s),c>a&&(a=c);u=0!==(u=Math.max(o-n,a-i))?1/u:0}return earcutLinked(p,f,r,n,i,u),f};function linkedList(e,t,r,n,i){var o,a;if(i===function signedArea(e,t,r,n){for(var i=0,o=t,a=r-n;o<r;o+=n)i+=(e[a]-e[o])*(e[o+1]+e[a+1]),a=o;return i}(e,t,r,n)>0)for(o=t;o<r;o+=n)a=insertNode(o,e[o],e[o+1],a);else for(o=r-n;o>=t;o-=n)a=insertNode(o,e[o],e[o+1],a);return a&&equals(a,a.next)&&(removeNode(a),a=a.next),a}function filterPoints(e,t){if(!e)return e;t||(t=e);var r,n=e;do{if(r=!1,n.steiner||!equals(n,n.next)&&0!==area(n.prev,n,n.next))n=n.next;else{if(removeNode(n),(n=t=n.prev)===n.next)break;r=!0}}while(r||n!==t);return t}function earcutLinked(e,t,r,n,i,o,a){if(e){!a&&o&&function indexCurve(e,t,r,n){var i=e;do{null===i.z&&(i.z=zOrder(i.x,i.y,t,r,n)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next}while(i!==e);i.prevZ.nextZ=null,i.prevZ=null,function sortLinked(e){var t,r,n,i,o,a,s,c,u=1;do{for(r=e,e=null,o=null,a=0;r;){for(a++,n=r,s=0,t=0;t<u&&(s++,n=n.nextZ);t++);for(c=u;s>0||c>0&&n;)0!==s&&(0===c||!n||r.z<=n.z)?(i=r,r=r.nextZ,s--):(i=n,n=n.nextZ,c--),o?o.nextZ=i:e=i,i.prevZ=o,o=i;r=n}o.nextZ=null,u*=2}while(a>1);return e}(i)}(e,n,i,o);for(var s,c,u=e;e.prev!==e.next;)if(s=e.prev,c=e.next,o?isEarHashed(e,n,i,o):isEar(e))t.push(s.i/r),t.push(e.i/r),t.push(c.i/r),removeNode(e),e=c.next,u=c.next;else if((e=c)===u){a?1===a?earcutLinked(e=cureLocalIntersections(e,t,r),t,r,n,i,o,2):2===a&&splitEarcut(e,t,r,n,i,o):earcutLinked(filterPoints(e),t,r,n,i,o,1);break}}}function isEar(e){var t=e.prev,r=e,n=e.next;if(area(t,r,n)>=0)return!1;for(var i=e.next.next;i!==e.prev;){if(pointInTriangle(t.x,t.y,r.x,r.y,n.x,n.y,i.x,i.y)&&area(i.prev,i,i.next)>=0)return!1;i=i.next}return!0}function isEarHashed(e,t,r,n){var i=e.prev,o=e,a=e.next;if(area(i,o,a)>=0)return!1;for(var s=i.x<o.x?i.x<a.x?i.x:a.x:o.x<a.x?o.x:a.x,c=i.y<o.y?i.y<a.y?i.y:a.y:o.y<a.y?o.y:a.y,u=i.x>o.x?i.x>a.x?i.x:a.x:o.x>a.x?o.x:a.x,l=i.y>o.y?i.y>a.y?i.y:a.y:o.y>a.y?o.y:a.y,h=zOrder(s,c,t,r,n),p=zOrder(u,l,t,r,n),f=e.nextZ;f&&f.z<=p;){if(f!==e.prev&&f!==e.next&&pointInTriangle(i.x,i.y,o.x,o.y,a.x,a.y,f.x,f.y)&&area(f.prev,f,f.next)>=0)return!1;f=f.nextZ}for(f=e.prevZ;f&&f.z>=h;){if(f!==e.prev&&f!==e.next&&pointInTriangle(i.x,i.y,o.x,o.y,a.x,a.y,f.x,f.y)&&area(f.prev,f,f.next)>=0)return!1;f=f.prevZ}return!0}function cureLocalIntersections(e,t,r){var n=e;do{var i=n.prev,o=n.next.next;!equals(i,o)&&intersects(i,n,n.next,o)&&locallyInside(i,o)&&locallyInside(o,i)&&(t.push(i.i/r),t.push(n.i/r),t.push(o.i/r),removeNode(n),removeNode(n.next),n=e=o),n=n.next}while(n!==e);return n}function splitEarcut(e,t,r,n,i,o){var a=e;do{for(var s=a.next.next;s!==a.prev;){if(a.i!==s.i&&isValidDiagonal(a,s)){var c=splitPolygon(a,s);return a=filterPoints(a,a.next),c=filterPoints(c,c.next),earcutLinked(a,t,r,n,i,o),void earcutLinked(c,t,r,n,i,o)}s=s.next}a=a.next}while(a!==e)}function compareX(e,t){return e.x-t.x}function eliminateHole(e,t){if(t=function findHoleBridge(e,t){var r,n=t,i=e.x,o=e.y,a=-1/0;do{if(o<=n.y&&o>=n.next.y&&n.next.y!==n.y){var s=n.x+(o-n.y)*(n.next.x-n.x)/(n.next.y-n.y);if(s<=i&&s>a){if(a=s,s===i){if(o===n.y)return n;if(o===n.next.y)return n.next}r=n.x<n.next.x?n:n.next}}n=n.next}while(n!==t);if(!r)return null;if(i===a)return r.prev;var c,u=r,l=r.x,h=r.y,p=1/0;n=r.next;for(;n!==u;)i>=n.x&&n.x>=l&&i!==n.x&&pointInTriangle(o<h?i:a,o,l,h,o<h?a:i,o,n.x,n.y)&&((c=Math.abs(o-n.y)/(i-n.x))<p||c===p&&n.x>r.x)&&locallyInside(n,e)&&(r=n,p=c),n=n.next;return r}(e,t)){var r=splitPolygon(t,e);filterPoints(r,r.next)}}function zOrder(e,t,r,n,i){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-r)*i)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-n)*i)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function getLeftmost(e){var t=e,r=e;do{t.x<r.x&&(r=t),t=t.next}while(t!==e);return r}function pointInTriangle(e,t,r,n,i,o,a,s){return(i-a)*(t-s)-(e-a)*(o-s)>=0&&(e-a)*(n-s)-(r-a)*(t-s)>=0&&(r-a)*(o-s)-(i-a)*(n-s)>=0}function isValidDiagonal(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!function intersectsPolygon(e,t){var r=e;do{if(r.i!==e.i&&r.next.i!==e.i&&r.i!==t.i&&r.next.i!==t.i&&intersects(r,r.next,e,t))return!0;r=r.next}while(r!==e);return!1}(e,t)&&locallyInside(e,t)&&locallyInside(t,e)&&function middleInside(e,t){var r=e,n=!1,i=(e.x+t.x)/2,o=(e.y+t.y)/2;do{r.y>o!=r.next.y>o&&r.next.y!==r.y&&i<(r.next.x-r.x)*(o-r.y)/(r.next.y-r.y)+r.x&&(n=!n),r=r.next}while(r!==e);return n}(e,t)}function area(e,t,r){return(t.y-e.y)*(r.x-t.x)-(t.x-e.x)*(r.y-t.y)}function equals(e,t){return e.x===t.x&&e.y===t.y}function intersects(e,t,r,n){return!!(equals(e,t)&&equals(r,n)||equals(e,n)&&equals(r,t))||area(e,t,r)>0!=area(e,t,n)>0&&area(r,n,e)>0!=area(r,n,t)>0}function locallyInside(e,t){return area(e.prev,e,e.next)<0?area(e,t,e.next)>=0&&area(e,e.prev,t)>=0:area(e,t,e.prev)<0||area(e,e.next,t)<0}function splitPolygon(e,t){var r=new Node(e.i,e.x,e.y),n=new Node(t.i,t.x,t.y),i=e.next,o=t.prev;return e.next=t,t.prev=e,r.next=i,i.prev=r,n.next=r,r.prev=n,o.next=n,n.prev=o,n}function insertNode(e,t,r,n){var i=new Node(e,t,r);return n?(i.next=n.next,i.prev=n,n.next.prev=i,n.next=i):(i.prev=i,i.next=i),i}function removeNode(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function Node(e,t,r){this.i=e,this.x=t,this.y=r,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}var Pr={area:function area(e){for(var t=e.length,r=0,n=t-1,i=0;i<t;n=i++)r+=e[n].x*e[i].y-e[i].x*e[n].y;return.5*r},isClockWise:function isClockWise(e){return Pr.area(e)<0},triangulateShape:function triangulateShape(e,t){var r=[],n=[],i=[];removeDupEndPts(e),addContour(r,e);var o=e.length;t.forEach(removeDupEndPts);for(var a=0;a<t.length;a++)n.push(o),o+=t[a].length,addContour(r,t[a]);var s=Cr(r,n);for(a=0;a<s.length;a+=3)i.push(s.slice(a,a+3));return i}};function removeDupEndPts(e){var t=e.length;t>2&&e[t-1].equals(e[0])&&e.pop()}function addContour(e,t){for(var r=0;r<t.length;r++)e.push(t[r].x),e.push(t[r].y)}function ExtrudeGeometry(e,t){Geometry.call(this),this.type="ExtrudeGeometry",this.parameters={shapes:e,options:t},this.fromBufferGeometry(new ExtrudeBufferGeometry(e,t)),this.mergeVertices()}function ExtrudeBufferGeometry(e,t){void 0!==e&&(BufferGeometry.call(this),this.type="ExtrudeBufferGeometry",e=Array.isArray(e)?e:[e],this.addShapeList(e,t),this.computeVertexNormals())}function TextGeometry(e,t){Geometry.call(this),this.type="TextGeometry",this.parameters={text:e,parameters:t},this.fromBufferGeometry(new TextBufferGeometry(e,t)),this.mergeVertices()}function TextBufferGeometry(e,t){var r=(t=t||{}).font;if(!r||!r.isFont)return console.error("THREE.TextGeometry: font parameter is not an instance of THREE.Font."),new Geometry;var n=r.generateShapes(e,t.size,t.curveSegments);t.amount=void 0!==t.height?t.height:50,void 0===t.bevelThickness&&(t.bevelThickness=10),void 0===t.bevelSize&&(t.bevelSize=8),void 0===t.bevelEnabled&&(t.bevelEnabled=!1),ExtrudeBufferGeometry.call(this,n,t),this.type="TextBufferGeometry"}function SphereGeometry(e,t,r,n,i,o,a){Geometry.call(this),this.type="SphereGeometry",this.parameters={radius:e,widthSegments:t,heightSegments:r,phiStart:n,phiLength:i,thetaStart:o,thetaLength:a},this.fromBufferGeometry(new SphereBufferGeometry(e,t,r,n,i,o,a)),this.mergeVertices()}function SphereBufferGeometry(e,t,r,n,i,o,a){BufferGeometry.call(this),this.type="SphereBufferGeometry",this.parameters={radius:e,widthSegments:t,heightSegments:r,phiStart:n,phiLength:i,thetaStart:o,thetaLength:a},e=e||1,t=Math.max(3,Math.floor(t)||8),r=Math.max(2,Math.floor(r)||6),n=void 0!==n?n:0,i=void 0!==i?i:2*Math.PI;var s,c,u=(o=void 0!==o?o:0)+(a=void 0!==a?a:Math.PI),l=0,h=[],p=new Vector3,f=new Vector3,d=[],m=[],g=[],y=[];for(c=0;c<=r;c++){var v=[],_=c/r;for(s=0;s<=t;s++){var b=s/t;p.x=-e*Math.cos(n+b*i)*Math.sin(o+_*a),p.y=e*Math.cos(o+_*a),p.z=e*Math.sin(n+b*i)*Math.sin(o+_*a),m.push(p.x,p.y,p.z),f.set(p.x,p.y,p.z).normalize(),g.push(f.x,f.y,f.z),y.push(b,1-_),v.push(l++)}h.push(v)}for(c=0;c<r;c++)for(s=0;s<t;s++){var w=h[c][s+1],x=h[c][s],M=h[c+1][s],S=h[c+1][s+1];(0!==c||o>0)&&d.push(w,x,S),(c!==r-1||u<Math.PI)&&d.push(x,M,S)}this.setIndex(d),this.addAttribute("position",new Float32BufferAttribute(m,3)),this.addAttribute("normal",new Float32BufferAttribute(g,3)),this.addAttribute("uv",new Float32BufferAttribute(y,2))}function RingGeometry(e,t,r,n,i,o){Geometry.call(this),this.type="RingGeometry",this.parameters={innerRadius:e,outerRadius:t,thetaSegments:r,phiSegments:n,thetaStart:i,thetaLength:o},this.fromBufferGeometry(new RingBufferGeometry(e,t,r,n,i,o)),this.mergeVertices()}function RingBufferGeometry(e,t,r,n,i,o){BufferGeometry.call(this),this.type="RingBufferGeometry",this.parameters={innerRadius:e,outerRadius:t,thetaSegments:r,phiSegments:n,thetaStart:i,thetaLength:o},e=e||.5,t=t||1,i=void 0!==i?i:0,o=void 0!==o?o:2*Math.PI,r=void 0!==r?Math.max(3,r):8;var a,s,c,u=[],l=[],h=[],p=[],f=e,d=(t-e)/(n=void 0!==n?Math.max(1,n):1),m=new Vector3,g=new Vector2;for(s=0;s<=n;s++){for(c=0;c<=r;c++)a=i+c/r*o,m.x=f*Math.cos(a),m.y=f*Math.sin(a),l.push(m.x,m.y,m.z),h.push(0,0,1),g.x=(m.x/t+1)/2,g.y=(m.y/t+1)/2,p.push(g.x,g.y);f+=d}for(s=0;s<n;s++){var y=s*(r+1);for(c=0;c<r;c++){var v=a=c+y,_=a+r+1,b=a+r+2,w=a+1;u.push(v,_,w),u.push(_,b,w)}}this.setIndex(u),this.addAttribute("position",new Float32BufferAttribute(l,3)),this.addAttribute("normal",new Float32BufferAttribute(h,3)),this.addAttribute("uv",new Float32BufferAttribute(p,2))}function LatheGeometry(e,t,r,n){Geometry.call(this),this.type="LatheGeometry",this.parameters={points:e,segments:t,phiStart:r,phiLength:n},this.fromBufferGeometry(new LatheBufferGeometry(e,t,r,n)),this.mergeVertices()}function LatheBufferGeometry(e,t,r,n){BufferGeometry.call(this),this.type="LatheBufferGeometry",this.parameters={points:e,segments:t,phiStart:r,phiLength:n},t=Math.floor(t)||12,r=r||0,n=n||2*Math.PI,n=At.clamp(n,0,2*Math.PI);var i,o,a,s=[],c=[],u=[],l=1/t,h=new Vector3,p=new Vector2;for(o=0;o<=t;o++){var f=r+o*l*n,d=Math.sin(f),m=Math.cos(f);for(a=0;a<=e.length-1;a++)h.x=e[a].x*d,h.y=e[a].y,h.z=e[a].x*m,c.push(h.x,h.y,h.z),p.x=o/t,p.y=a/(e.length-1),u.push(p.x,p.y)}for(o=0;o<t;o++)for(a=0;a<e.length-1;a++){var g=i=a+o*e.length,y=i+e.length,v=i+e.length+1,_=i+1;s.push(g,y,_),s.push(y,v,_)}if(this.setIndex(s),this.addAttribute("position",new Float32BufferAttribute(c,3)),this.addAttribute("uv",new Float32BufferAttribute(u,2)),this.computeVertexNormals(),n===2*Math.PI){var b=this.attributes.normal.array,w=new Vector3,x=new Vector3,M=new Vector3;for(i=t*e.length*3,o=0,a=0;o<e.length;o++,a+=3)w.x=b[a+0],w.y=b[a+1],w.z=b[a+2],x.x=b[i+a+0],x.y=b[i+a+1],x.z=b[i+a+2],M.addVectors(w,x).normalize(),b[a+0]=b[i+a+0]=M.x,b[a+1]=b[i+a+1]=M.y,b[a+2]=b[i+a+2]=M.z}}function ShapeGeometry(e,t){Geometry.call(this),this.type="ShapeGeometry","object"===(void 0===t?"undefined":n(t))&&(console.warn("THREE.ShapeGeometry: Options parameter has been removed."),t=t.curveSegments),this.parameters={shapes:e,curveSegments:t},this.fromBufferGeometry(new ShapeBufferGeometry(e,t)),this.mergeVertices()}function ShapeBufferGeometry(e,t){BufferGeometry.call(this),this.type="ShapeBufferGeometry",this.parameters={shapes:e,curveSegments:t},t=t||12;var r=[],n=[],i=[],o=[],a=0,s=0;if(!1===Array.isArray(e))addShape(e);else for(var c=0;c<e.length;c++)addShape(e[c]),this.addGroup(a,s,c),a+=s,s=0;function addShape(e){var a,c,u,l=n.length/3,h=e.extractPoints(t),p=h.shape,f=h.holes;if(!1===Pr.isClockWise(p))for(p=p.reverse(),a=0,c=f.length;a<c;a++)u=f[a],!0===Pr.isClockWise(u)&&(f[a]=u.reverse());var d=Pr.triangulateShape(p,f);for(a=0,c=f.length;a<c;a++)u=f[a],p=p.concat(u);for(a=0,c=p.length;a<c;a++){var m=p[a];n.push(m.x,m.y,0),i.push(0,0,1),o.push(m.x,m.y)}for(a=0,c=d.length;a<c;a++){var g=d[a],y=g[0]+l,v=g[1]+l,_=g[2]+l;r.push(y,v,_),s+=3}}this.setIndex(r),this.addAttribute("position",new Float32BufferAttribute(n,3)),this.addAttribute("normal",new Float32BufferAttribute(i,3)),this.addAttribute("uv",new Float32BufferAttribute(o,2))}function toJSON(e,t){if(t.shapes=[],Array.isArray(e))for(var r=0,n=e.length;r<n;r++){var i=e[r];t.shapes.push(i.uuid)}else t.shapes.push(e.uuid);return t}function EdgesGeometry(e,t){BufferGeometry.call(this),this.type="EdgesGeometry",this.parameters={thresholdAngle:t},t=void 0!==t?t:1;var r,n,i,o,a=[],s=Math.cos(At.DEG2RAD*t),c=[0,0],u={},l=["a","b","c"];e.isBufferGeometry?(o=new Geometry).fromBufferGeometry(e):o=e.clone(),o.mergeVertices(),o.computeFaceNormals();for(var h=o.vertices,p=o.faces,f=0,d=p.length;f<d;f++)for(var m=p[f],g=0;g<3;g++)r=m[l[g]],n=m[l[(g+1)%3]],c[0]=Math.min(r,n),c[1]=Math.max(r,n),void 0===u[i=c[0]+","+c[1]]?u[i]={index1:c[0],index2:c[1],face1:f,face2:void 0}:u[i].face2=f;for(i in u){var y=u[i];if(void 0===y.face2||p[y.face1].normal.dot(p[y.face2].normal)<=s){var v=h[y.index1];a.push(v.x,v.y,v.z),v=h[y.index2],a.push(v.x,v.y,v.z)}}this.addAttribute("position",new Float32BufferAttribute(a,3))}function CylinderGeometry(e,t,r,n,i,o,a,s){Geometry.call(this),this.type="CylinderGeometry",this.parameters={radiusTop:e,radiusBottom:t,height:r,radialSegments:n,heightSegments:i,openEnded:o,thetaStart:a,thetaLength:s},this.fromBufferGeometry(new CylinderBufferGeometry(e,t,r,n,i,o,a,s)),this.mergeVertices()}function CylinderBufferGeometry(e,t,r,n,i,o,a,s){BufferGeometry.call(this),this.type="CylinderBufferGeometry",this.parameters={radiusTop:e,radiusBottom:t,height:r,radialSegments:n,heightSegments:i,openEnded:o,thetaStart:a,thetaLength:s};var c=this;e=void 0!==e?e:1,t=void 0!==t?t:1,r=r||1,n=Math.floor(n)||8,i=Math.floor(i)||1,o=void 0!==o&&o,a=void 0!==a?a:0,s=void 0!==s?s:2*Math.PI;var u=[],l=[],h=[],p=[],f=0,d=[],m=r/2,g=0;function generateCap(r){var i,o,d,y=new Vector2,v=new Vector3,_=0,b=!0===r?e:t,w=!0===r?1:-1;for(o=f,i=1;i<=n;i++)l.push(0,m*w,0),h.push(0,w,0),p.push(.5,.5),f++;for(d=f,i=0;i<=n;i++){var x=i/n*s+a,M=Math.cos(x),S=Math.sin(x);v.x=b*S,v.y=m*w,v.z=b*M,l.push(v.x,v.y,v.z),h.push(0,w,0),y.x=.5*M+.5,y.y=.5*S*w+.5,p.push(y.x,y.y),f++}for(i=0;i<n;i++){var C=o+i,P=d+i;!0===r?u.push(P,P+1,C):u.push(P+1,P,C),_+=3}c.addGroup(g,_,!0===r?1:2),g+=_}!function generateTorso(){var o,y,v=new Vector3,_=new Vector3,b=0,w=(t-e)/r;for(y=0;y<=i;y++){var x=[],M=y/i,S=M*(t-e)+e;for(o=0;o<=n;o++){var C=o/n,P=C*s+a,E=Math.sin(P),T=Math.cos(P);_.x=S*E,_.y=-M*r+m,_.z=S*T,l.push(_.x,_.y,_.z),v.set(E,w,T).normalize(),h.push(v.x,v.y,v.z),p.push(C,1-M),x.push(f++)}d.push(x)}for(o=0;o<n;o++)for(y=0;y<i;y++){var O=d[y][o],A=d[y+1][o],L=d[y+1][o+1],k=d[y][o+1];u.push(O,A,k),u.push(A,L,k),b+=6}c.addGroup(g,b,0),g+=b}(),!1===o&&(e>0&&generateCap(!0),t>0&&generateCap(!1)),this.setIndex(u),this.addAttribute("position",new Float32BufferAttribute(l,3)),this.addAttribute("normal",new Float32BufferAttribute(h,3)),this.addAttribute("uv",new Float32BufferAttribute(p,2))}function ConeGeometry(e,t,r,n,i,o,a){CylinderGeometry.call(this,0,e,t,r,n,i,o,a),this.type="ConeGeometry",this.parameters={radius:e,height:t,radialSegments:r,heightSegments:n,openEnded:i,thetaStart:o,thetaLength:a}}function ConeBufferGeometry(e,t,r,n,i,o,a){CylinderBufferGeometry.call(this,0,e,t,r,n,i,o,a),this.type="ConeBufferGeometry",this.parameters={radius:e,height:t,radialSegments:r,heightSegments:n,openEnded:i,thetaStart:o,thetaLength:a}}function CircleGeometry(e,t,r,n){Geometry.call(this),this.type="CircleGeometry",this.parameters={radius:e,segments:t,thetaStart:r,thetaLength:n},this.fromBufferGeometry(new CircleBufferGeometry(e,t,r,n)),this.mergeVertices()}function CircleBufferGeometry(e,t,r,n){BufferGeometry.call(this),this.type="CircleBufferGeometry",this.parameters={radius:e,segments:t,thetaStart:r,thetaLength:n},e=e||1,t=void 0!==t?Math.max(3,t):8,r=void 0!==r?r:0,n=void 0!==n?n:2*Math.PI;var i,o,a=[],s=[],c=[],u=[],l=new Vector3,h=new Vector2;for(s.push(0,0,0),c.push(0,0,1),u.push(.5,.5),o=0,i=3;o<=t;o++,i+=3){var p=r+o/t*n;l.x=e*Math.cos(p),l.y=e*Math.sin(p),s.push(l.x,l.y,l.z),c.push(0,0,1),h.x=(s[i]/e+1)/2,h.y=(s[i+1]/e+1)/2,u.push(h.x,h.y)}for(i=1;i<=t;i++)a.push(i,i+1,0);this.setIndex(a),this.addAttribute("position",new Float32BufferAttribute(s,3)),this.addAttribute("normal",new Float32BufferAttribute(c,3)),this.addAttribute("uv",new Float32BufferAttribute(u,2))}ExtrudeGeometry.prototype=Object.create(Geometry.prototype),ExtrudeGeometry.prototype.constructor=ExtrudeGeometry,ExtrudeBufferGeometry.prototype=Object.create(BufferGeometry.prototype),ExtrudeBufferGeometry.prototype.constructor=ExtrudeBufferGeometry,ExtrudeBufferGeometry.prototype.getArrays=function(){var e=this.getAttribute("position"),t=e?Array.prototype.slice.call(e.array):[],r=this.getAttribute("uv"),n=r?Array.prototype.slice.call(r.array):[],i=this.index;return{position:t,uv:n,index:i?Array.prototype.slice.call(i.array):[]}},ExtrudeBufferGeometry.prototype.addShapeList=function(e,t){var r=e.length;t.arrays=this.getArrays();for(var n=0;n<r;n++){var i=e[n];this.addShape(i,t)}this.setIndex(t.arrays.index),this.addAttribute("position",new Float32BufferAttribute(t.arrays.position,3)),this.addAttribute("uv",new Float32BufferAttribute(t.arrays.uv,2))},ExtrudeBufferGeometry.prototype.addShape=function(e,t){var r,n,i,o,a,s,c,u,l=t.arrays?t.arrays:this.getArrays(),h=l.position,p=l.index,f=l.uv,d=[],m=void 0!==t.amount?t.amount:100,g=void 0!==t.bevelThickness?t.bevelThickness:6,y=void 0!==t.bevelSize?t.bevelSize:g-2,_=void 0!==t.bevelSegments?t.bevelSegments:3,b=void 0===t.bevelEnabled||t.bevelEnabled,w=void 0!==t.curveSegments?t.curveSegments:12,x=void 0!==t.steps?t.steps:1,M=t.extrudePath,S=!1,C=void 0!==t.UVGenerator?t.UVGenerator:ExtrudeGeometry.WorldUVGenerator;M&&(r=M.getSpacedPoints(x),S=!0,b=!1,n=void 0!==t.frames?t.frames:M.computeFrenetFrames(x,!1),i=new Vector3,o=new Vector3,a=new Vector3),b||(_=0,g=0,y=0);var P=this,E=e.extractPoints(w),T=E.shape,O=E.holes;if(!Pr.isClockWise(T))for(T=T.reverse(),c=0,u=O.length;c<u;c++)s=O[c],Pr.isClockWise(s)&&(O[c]=s.reverse());var A=Pr.triangulateShape(T,O),L=T;for(c=0,u=O.length;c<u;c++)s=O[c],T=T.concat(s);function scalePt2(e,t,r){return t||console.error("THREE.ExtrudeGeometry: vec does not exist"),t.clone().multiplyScalar(r).add(e)}var k,R,I,N,F,j,B=T.length,V=A.length;function getBevelVec(e,t,r){var n,i,o,a=e.x-t.x,s=e.y-t.y,c=r.x-e.x,u=r.y-e.y,l=a*a+s*s,h=a*u-s*c;if(Math.abs(h)>Number.EPSILON){var p=Math.sqrt(l),f=Math.sqrt(c*c+u*u),d=t.x-s/p,m=t.y+a/p,g=((r.x-u/f-d)*u-(r.y+c/f-m)*c)/(a*u-s*c),y=(n=d+a*g-e.x)*n+(i=m+s*g-e.y)*i;if(y<=2)return new Vector2(n,i);o=Math.sqrt(y/2)}else{var v=!1;a>Number.EPSILON?c>Number.EPSILON&&(v=!0):a<-Number.EPSILON?c<-Number.EPSILON&&(v=!0):Math.sign(s)===Math.sign(u)&&(v=!0),v?(n=-s,i=a,o=Math.sqrt(l)):(n=a,i=s,o=Math.sqrt(l/2))}return new Vector2(n/o,i/o)}for(var D=[],U=0,G=L.length,z=G-1,H=U+1;U<G;U++,z++,H++)z===G&&(z=0),H===G&&(H=0),D[U]=getBevelVec(L[U],L[z],L[H]);var W,q,X=[],Y=D.concat();for(c=0,u=O.length;c<u;c++){for(s=O[c],W=[],U=0,z=(G=s.length)-1,H=U+1;U<G;U++,z++,H++)z===G&&(z=0),H===G&&(H=0),W[U]=getBevelVec(s[U],s[z],s[H]);X.push(W),Y=Y.concat(W)}for(k=0;k<_;k++){for(I=k/_,N=g*Math.cos(I*Math.PI/2),R=y*Math.sin(I*Math.PI/2),U=0,G=L.length;U<G;U++)v((F=scalePt2(L[U],D[U],R)).x,F.y,-N);for(c=0,u=O.length;c<u;c++)for(s=O[c],W=X[c],U=0,G=s.length;U<G;U++)v((F=scalePt2(s[U],W[U],R)).x,F.y,-N)}for(R=y,U=0;U<B;U++)F=b?scalePt2(T[U],Y[U],R):T[U],S?(o.copy(n.normals[0]).multiplyScalar(F.x),i.copy(n.binormals[0]).multiplyScalar(F.y),a.copy(r[0]).add(o).add(i),v(a.x,a.y,a.z)):v(F.x,F.y,0);for(q=1;q<=x;q++)for(U=0;U<B;U++)F=b?scalePt2(T[U],Y[U],R):T[U],S?(o.copy(n.normals[q]).multiplyScalar(F.x),i.copy(n.binormals[q]).multiplyScalar(F.y),a.copy(r[q]).add(o).add(i),v(a.x,a.y,a.z)):v(F.x,F.y,m/x*q);for(k=_-1;k>=0;k--){for(I=k/_,N=g*Math.cos(I*Math.PI/2),R=y*Math.sin(I*Math.PI/2),U=0,G=L.length;U<G;U++)v((F=scalePt2(L[U],D[U],R)).x,F.y,m+N);for(c=0,u=O.length;c<u;c++)for(s=O[c],W=X[c],U=0,G=s.length;U<G;U++)F=scalePt2(s[U],W[U],R),S?v(F.x,F.y+r[x-1].y,r[x-1].x+N):v(F.x,F.y,m+N)}function sidewalls(e,t){var r,n;for(U=e.length;--U>=0;){r=U,(n=U-1)<0&&(n=e.length-1);var i=0,o=x+2*_;for(i=0;i<o;i++){var a=B*i,s=B*(i+1);f4(t+r+a,t+n+a,t+n+s,t+r+s)}}}function v(e,t,r){d.push(e),d.push(t),d.push(r)}function f3(e,t,r){addVertex(e),addVertex(t),addVertex(r);var n=h.length/3,i=C.generateTopUV(P,h,n-3,n-2,n-1);addUV(i[0]),addUV(i[1]),addUV(i[2])}function f4(e,t,r,n){addVertex(e),addVertex(t),addVertex(n),addVertex(t),addVertex(r),addVertex(n);var i=h.length/3,o=C.generateSideWallUV(P,h,i-6,i-3,i-2,i-1);addUV(o[0]),addUV(o[1]),addUV(o[3]),addUV(o[1]),addUV(o[2]),addUV(o[3])}function addVertex(e){p.push(h.length/3),h.push(d[3*e+0]),h.push(d[3*e+1]),h.push(d[3*e+2])}function addUV(e){f.push(e.x),f.push(e.y)}!function buildLidFaces(){var e=h.length/3;if(b){var t=0,r=B*t;for(U=0;U<V;U++)f3((j=A[U])[2]+r,j[1]+r,j[0]+r);for(r=B*(t=x+2*_),U=0;U<V;U++)f3((j=A[U])[0]+r,j[1]+r,j[2]+r)}else{for(U=0;U<V;U++)f3((j=A[U])[2],j[1],j[0]);for(U=0;U<V;U++)f3((j=A[U])[0]+B*x,j[1]+B*x,j[2]+B*x)}P.addGroup(e,h.length/3-e,0)}(),function buildSideFaces(){var e=h.length/3,t=0;for(sidewalls(L,t),t+=L.length,c=0,u=O.length;c<u;c++)sidewalls(s=O[c],t),t+=s.length;P.addGroup(e,h.length/3-e,1)}(),t.arrays||(this.setIndex(p),this.addAttribute("position",new Float32BufferAttribute(h,3)),this.addAttribute("uv",new Float32BufferAttribute(f,2)))},ExtrudeGeometry.WorldUVGenerator={generateTopUV:function generateTopUV(e,t,r,n,i){var o=t[3*r],a=t[3*r+1],s=t[3*n],c=t[3*n+1],u=t[3*i],l=t[3*i+1];return[new Vector2(o,a),new Vector2(s,c),new Vector2(u,l)]},generateSideWallUV:function generateSideWallUV(e,t,r,n,i,o){var a=t[3*r],s=t[3*r+1],c=t[3*r+2],u=t[3*n],l=t[3*n+1],h=t[3*n+2],p=t[3*i],f=t[3*i+1],d=t[3*i+2],m=t[3*o],g=t[3*o+1],y=t[3*o+2];return Math.abs(s-l)<.01?[new Vector2(a,1-c),new Vector2(u,1-h),new Vector2(p,1-d),new Vector2(m,1-y)]:[new Vector2(s,1-c),new Vector2(l,1-h),new Vector2(f,1-d),new Vector2(g,1-y)]}},TextGeometry.prototype=Object.create(Geometry.prototype),TextGeometry.prototype.constructor=TextGeometry,TextBufferGeometry.prototype=Object.create(ExtrudeBufferGeometry.prototype),TextBufferGeometry.prototype.constructor=TextBufferGeometry,SphereGeometry.prototype=Object.create(Geometry.prototype),SphereGeometry.prototype.constructor=SphereGeometry,SphereBufferGeometry.prototype=Object.create(BufferGeometry.prototype),SphereBufferGeometry.prototype.constructor=SphereBufferGeometry,RingGeometry.prototype=Object.create(Geometry.prototype),RingGeometry.prototype.constructor=RingGeometry,RingBufferGeometry.prototype=Object.create(BufferGeometry.prototype),RingBufferGeometry.prototype.constructor=RingBufferGeometry,LatheGeometry.prototype=Object.create(Geometry.prototype),LatheGeometry.prototype.constructor=LatheGeometry,LatheBufferGeometry.prototype=Object.create(BufferGeometry.prototype),LatheBufferGeometry.prototype.constructor=LatheBufferGeometry,ShapeGeometry.prototype=Object.create(Geometry.prototype),ShapeGeometry.prototype.constructor=ShapeGeometry,ShapeGeometry.prototype.toJSON=function(){var e=Geometry.prototype.toJSON.call(this);return toJSON(this.parameters.shapes,e)},ShapeBufferGeometry.prototype=Object.create(BufferGeometry.prototype),ShapeBufferGeometry.prototype.constructor=ShapeBufferGeometry,ShapeBufferGeometry.prototype.toJSON=function(){var e=BufferGeometry.prototype.toJSON.call(this);return toJSON(this.parameters.shapes,e)},EdgesGeometry.prototype=Object.create(BufferGeometry.prototype),EdgesGeometry.prototype.constructor=EdgesGeometry,CylinderGeometry.prototype=Object.create(Geometry.prototype),CylinderGeometry.prototype.constructor=CylinderGeometry,CylinderBufferGeometry.prototype=Object.create(BufferGeometry.prototype),CylinderBufferGeometry.prototype.constructor=CylinderBufferGeometry,ConeGeometry.prototype=Object.create(CylinderGeometry.prototype),ConeGeometry.prototype.constructor=ConeGeometry,ConeBufferGeometry.prototype=Object.create(CylinderBufferGeometry.prototype),ConeBufferGeometry.prototype.constructor=ConeBufferGeometry,CircleGeometry.prototype=Object.create(Geometry.prototype),CircleGeometry.prototype.constructor=CircleGeometry,CircleBufferGeometry.prototype=Object.create(BufferGeometry.prototype),CircleBufferGeometry.prototype.constructor=CircleBufferGeometry;var Er=Object.freeze({WireframeGeometry:WireframeGeometry,ParametricGeometry:ParametricGeometry,ParametricBufferGeometry:ParametricBufferGeometry,TetrahedronGeometry:TetrahedronGeometry,TetrahedronBufferGeometry:TetrahedronBufferGeometry,OctahedronGeometry:OctahedronGeometry,OctahedronBufferGeometry:OctahedronBufferGeometry,IcosahedronGeometry:IcosahedronGeometry,IcosahedronBufferGeometry:IcosahedronBufferGeometry,DodecahedronGeometry:DodecahedronGeometry,DodecahedronBufferGeometry:DodecahedronBufferGeometry,PolyhedronGeometry:PolyhedronGeometry,PolyhedronBufferGeometry:PolyhedronBufferGeometry,TubeGeometry:TubeGeometry,TubeBufferGeometry:TubeBufferGeometry,TorusKnotGeometry:TorusKnotGeometry,TorusKnotBufferGeometry:TorusKnotBufferGeometry,TorusGeometry:TorusGeometry,TorusBufferGeometry:TorusBufferGeometry,TextGeometry:TextGeometry,TextBufferGeometry:TextBufferGeometry,SphereGeometry:SphereGeometry,SphereBufferGeometry:SphereBufferGeometry,RingGeometry:RingGeometry,RingBufferGeometry:RingBufferGeometry,PlaneGeometry:PlaneGeometry,PlaneBufferGeometry:PlaneBufferGeometry,LatheGeometry:LatheGeometry,LatheBufferGeometry:LatheBufferGeometry,ShapeGeometry:ShapeGeometry,ShapeBufferGeometry:ShapeBufferGeometry,ExtrudeGeometry:ExtrudeGeometry,ExtrudeBufferGeometry:ExtrudeBufferGeometry,EdgesGeometry:EdgesGeometry,ConeGeometry:ConeGeometry,ConeBufferGeometry:ConeBufferGeometry,CylinderGeometry:CylinderGeometry,CylinderBufferGeometry:CylinderBufferGeometry,CircleGeometry:CircleGeometry,CircleBufferGeometry:CircleBufferGeometry,BoxGeometry:BoxGeometry,BoxBufferGeometry:BoxBufferGeometry});function ShadowMaterial(e){Material.call(this),this.type="ShadowMaterial",this.color=new Color(0),this.transparent=!0,this.setValues(e)}function RawShaderMaterial(e){ShaderMaterial.call(this,e),this.type="RawShaderMaterial"}function MeshStandardMaterial(e){Material.call(this),this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new Color(16777215),this.roughness=.5,this.metalness=.5,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Color(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalScale=new Vector2(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapIntensity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)}function MeshPhysicalMaterial(e){MeshStandardMaterial.call(this),this.defines={PHYSICAL:""},this.type="MeshPhysicalMaterial",this.reflectivity=.5,this.clearCoat=0,this.clearCoatRoughness=0,this.setValues(e)}function MeshPhongMaterial(e){Material.call(this),this.type="MeshPhongMaterial",this.color=new Color(16777215),this.specular=new Color(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Color(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalScale=new Vector2(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=ne,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)}function MeshToonMaterial(e){MeshPhongMaterial.call(this),this.defines={TOON:""},this.type="MeshToonMaterial",this.gradientMap=null,this.setValues(e)}function MeshNormalMaterial(e){Material.call(this),this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalScale=new Vector2(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)}function MeshLambertMaterial(e){Material.call(this),this.type="MeshLambertMaterial",this.color=new Color(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Color(0),this.emissiveIntensity=1,this.emissiveMap=null,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=ne,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)}function LineDashedMaterial(e){LineBasicMaterial.call(this),this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(e)}ShadowMaterial.prototype=Object.create(Material.prototype),ShadowMaterial.prototype.constructor=ShadowMaterial,ShadowMaterial.prototype.isShadowMaterial=!0,ShadowMaterial.prototype.copy=function(e){return Material.prototype.copy.call(this,e),this.color.copy(e.color),this},RawShaderMaterial.prototype=Object.create(ShaderMaterial.prototype),RawShaderMaterial.prototype.constructor=RawShaderMaterial,RawShaderMaterial.prototype.isRawShaderMaterial=!0,MeshStandardMaterial.prototype=Object.create(Material.prototype),MeshStandardMaterial.prototype.constructor=MeshStandardMaterial,MeshStandardMaterial.prototype.isMeshStandardMaterial=!0,MeshStandardMaterial.prototype.copy=function(e){return Material.prototype.copy.call(this,e),this.defines={STANDARD:""},this.color.copy(e.color),this.roughness=e.roughness,this.metalness=e.metalness,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.roughnessMap=e.roughnessMap,this.metalnessMap=e.metalnessMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapIntensity=e.envMapIntensity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this},MeshPhysicalMaterial.prototype=Object.create(MeshStandardMaterial.prototype),MeshPhysicalMaterial.prototype.constructor=MeshPhysicalMaterial,MeshPhysicalMaterial.prototype.isMeshPhysicalMaterial=!0,MeshPhysicalMaterial.prototype.copy=function(e){return MeshStandardMaterial.prototype.copy.call(this,e),this.defines={PHYSICAL:""},this.reflectivity=e.reflectivity,this.clearCoat=e.clearCoat,this.clearCoatRoughness=e.clearCoatRoughness,this},MeshPhongMaterial.prototype=Object.create(Material.prototype),MeshPhongMaterial.prototype.constructor=MeshPhongMaterial,MeshPhongMaterial.prototype.isMeshPhongMaterial=!0,MeshPhongMaterial.prototype.copy=function(e){return Material.prototype.copy.call(this,e),this.color.copy(e.color),this.specular.copy(e.specular),this.shininess=e.shininess,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this},MeshToonMaterial.prototype=Object.create(MeshPhongMaterial.prototype),MeshToonMaterial.prototype.constructor=MeshToonMaterial,MeshToonMaterial.prototype.isMeshToonMaterial=!0,MeshToonMaterial.prototype.copy=function(e){return MeshPhongMaterial.prototype.copy.call(this,e),this.gradientMap=e.gradientMap,this},MeshNormalMaterial.prototype=Object.create(Material.prototype),MeshNormalMaterial.prototype.constructor=MeshNormalMaterial,MeshNormalMaterial.prototype.isMeshNormalMaterial=!0,MeshNormalMaterial.prototype.copy=function(e){return Material.prototype.copy.call(this,e),this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this},MeshLambertMaterial.prototype=Object.create(Material.prototype),MeshLambertMaterial.prototype.constructor=MeshLambertMaterial,MeshLambertMaterial.prototype.isMeshLambertMaterial=!0,MeshLambertMaterial.prototype.copy=function(e){return Material.prototype.copy.call(this,e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this},LineDashedMaterial.prototype=Object.create(LineBasicMaterial.prototype),LineDashedMaterial.prototype.constructor=LineDashedMaterial,LineDashedMaterial.prototype.isLineDashedMaterial=!0,LineDashedMaterial.prototype.copy=function(e){return LineBasicMaterial.prototype.copy.call(this,e),this.scale=e.scale,this.dashSize=e.dashSize,this.gapSize=e.gapSize,this};var Tr=Object.freeze({ShadowMaterial:ShadowMaterial,SpriteMaterial:SpriteMaterial,RawShaderMaterial:RawShaderMaterial,ShaderMaterial:ShaderMaterial,PointsMaterial:PointsMaterial,MeshPhysicalMaterial:MeshPhysicalMaterial,MeshStandardMaterial:MeshStandardMaterial,MeshPhongMaterial:MeshPhongMaterial,MeshToonMaterial:MeshToonMaterial,MeshNormalMaterial:MeshNormalMaterial,MeshLambertMaterial:MeshLambertMaterial,MeshDepthMaterial:MeshDepthMaterial,MeshDistanceMaterial:MeshDistanceMaterial,MeshBasicMaterial:MeshBasicMaterial,LineDashedMaterial:LineDashedMaterial,LineBasicMaterial:LineBasicMaterial,Material:Material}),Or={enabled:!1,files:{},add:function add(e,t){!1!==this.enabled&&(this.files[e]=t)},get:function get(e){if(!1!==this.enabled)return this.files[e]},remove:function remove(e){delete this.files[e]},clear:function clear(){this.files={}}};function LoadingManager(e,t,r){var n=this,i=!1,o=0,a=0,s=void 0;this.onStart=void 0,this.onLoad=e,this.onProgress=t,this.onError=r,this.itemStart=function(e){a++,!1===i&&void 0!==n.onStart&&n.onStart(e,o,a),i=!0},this.itemEnd=function(e){o++,void 0!==n.onProgress&&n.onProgress(e,o,a),o===a&&(i=!1,void 0!==n.onLoad&&n.onLoad())},this.itemError=function(e){void 0!==n.onError&&n.onError(e)},this.resolveURL=function(e){return s?s(e):e},this.setURLModifier=function(e){return s=e,this}}var Ar=new LoadingManager,Lr={};function FileLoader(e){this.manager=void 0!==e?e:Ar}function DataTextureLoader(e){this.manager=void 0!==e?e:Ar,this._parser=null}function ImageLoader(e){this.manager=void 0!==e?e:Ar}function CubeTextureLoader(e){this.manager=void 0!==e?e:Ar}function TextureLoader(e){this.manager=void 0!==e?e:Ar}function Curve(){this.type="Curve",this.arcLengthDivisions=200}function EllipseCurve(e,t,r,n,i,o,a,s){Curve.call(this),this.type="EllipseCurve",this.aX=e||0,this.aY=t||0,this.xRadius=r||1,this.yRadius=n||1,this.aStartAngle=i||0,this.aEndAngle=o||2*Math.PI,this.aClockwise=a||!1,this.aRotation=s||0}function ArcCurve(e,t,r,n,i,o){EllipseCurve.call(this,e,t,r,r,n,i,o),this.type="ArcCurve"}function CubicPoly(){var e=0,t=0,r=0,n=0;function init(i,o,a,s){e=i,t=a,r=-3*i+3*o-2*a-s,n=2*i-2*o+a+s}return{initCatmullRom:function initCatmullRom(e,t,r,n,i){init(t,r,i*(r-e),i*(n-t))},initNonuniformCatmullRom:function initNonuniformCatmullRom(e,t,r,n,i,o,a){var s=(t-e)/i-(r-e)/(i+o)+(r-t)/o,c=(r-t)/o-(n-t)/(o+a)+(n-r)/a;init(t,r,s*=o,c*=o)},calc:function calc(i){var o=i*i;return e+t*i+r*o+n*(o*i)}}}Object.assign(FileLoader.prototype,{load:function load(e,t,r,n){void 0===e&&(e=""),void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);var i=this,o=Or.get(e);if(void 0!==o)return i.manager.itemStart(e),setTimeout(function(){t&&t(o),i.manager.itemEnd(e)},0),o;if(void 0===Lr[e]){var a=e.match(/^data:(.*?)(;base64)?,(.*)$/);if(a){var s=a[1],c=!!a[2],u=a[3];u=window.decodeURIComponent(u),c&&(u=window.atob(u));try{var l,h=(this.responseType||"").toLowerCase();switch(h){case"arraybuffer":case"blob":for(var p=new Uint8Array(u.length),f=0;f<u.length;f++)p[f]=u.charCodeAt(f);l="blob"===h?new Blob([p.buffer],{type:s}):p.buffer;break;case"document":var d=new DOMParser;l=d.parseFromString(u,s);break;case"json":l=JSON.parse(u);break;default:l=u}window.setTimeout(function(){t&&t(l),i.manager.itemEnd(e)},0)}catch(t){window.setTimeout(function(){n&&n(t),i.manager.itemEnd(e),i.manager.itemError(e)},0)}}else{Lr[e]=[],Lr[e].push({onLoad:t,onProgress:r,onError:n});var m=new XMLHttpRequest;for(var g in m.open("GET",e,!0),m.addEventListener("load",function(t){var r=this.response;Or.add(e,r);var n=Lr[e];if(delete Lr[e],200===this.status){for(var o=0,a=n.length;o<a;o++){(s=n[o]).onLoad&&s.onLoad(r)}i.manager.itemEnd(e)}else if(0===this.status){console.warn("THREE.FileLoader: HTTP Status 0 received.");for(o=0,a=n.length;o<a;o++){(s=n[o]).onLoad&&s.onLoad(r)}i.manager.itemEnd(e)}else{for(o=0,a=n.length;o<a;o++){var s;(s=n[o]).onError&&s.onError(t)}i.manager.itemEnd(e),i.manager.itemError(e)}},!1),m.addEventListener("progress",function(t){for(var r=Lr[e],n=0,i=r.length;n<i;n++){var o=r[n];o.onProgress&&o.onProgress(t)}},!1),m.addEventListener("error",function(t){var r=Lr[e];delete Lr[e];for(var n=0,o=r.length;n<o;n++){var a=r[n];a.onError&&a.onError(t)}i.manager.itemEnd(e),i.manager.itemError(e)},!1),void 0!==this.responseType&&(m.responseType=this.responseType),void 0!==this.withCredentials&&(m.withCredentials=this.withCredentials),m.overrideMimeType&&m.overrideMimeType(void 0!==this.mimeType?this.mimeType:"text/plain"),this.requestHeader)m.setRequestHeader(g,this.requestHeader[g]);m.send(null)}return i.manager.itemStart(e),m}Lr[e].push({onLoad:t,onProgress:r,onError:n})},setPath:function setPath(e){return this.path=e,this},setResponseType:function setResponseType(e){return this.responseType=e,this},setWithCredentials:function setWithCredentials(e){return this.withCredentials=e,this},setMimeType:function setMimeType(e){return this.mimeType=e,this},setRequestHeader:function setRequestHeader(e){return this.requestHeader=e,this}}),Object.assign(function CompressedTextureLoader(e){this.manager=void 0!==e?e:Ar,this._parser=null}.prototype,{load:function load(e,t,r,n){var i=this,o=[],a=new CompressedTexture;a.image=o;var s=new FileLoader(this.manager);function loadTexture(u){s.load(e[u],function(e){var r=i._parser(e,!0);o[u]={width:r.width,height:r.height,format:r.format,mipmaps:r.mipmaps},6===(c+=1)&&(1===r.mipmapCount&&(a.minFilter=Se),a.format=r.format,a.needsUpdate=!0,t&&t(a))},r,n)}if(s.setPath(this.path),s.setResponseType("arraybuffer"),Array.isArray(e))for(var c=0,u=0,l=e.length;u<l;++u)loadTexture(u);else s.load(e,function(e){var r=i._parser(e,!0);if(r.isCubemap)for(var n=r.mipmaps.length/r.mipmapCount,s=0;s<n;s++){o[s]={mipmaps:[]};for(var c=0;c<r.mipmapCount;c++)o[s].mipmaps.push(r.mipmaps[s*r.mipmapCount+c]),o[s].format=r.format,o[s].width=r.width,o[s].height=r.height}else a.image.width=r.width,a.image.height=r.height,a.mipmaps=r.mipmaps;1===r.mipmapCount&&(a.minFilter=Se),a.format=r.format,a.needsUpdate=!0,t&&t(a)},r,n);return a},setPath:function setPath(e){return this.path=e,this}}),Object.assign(DataTextureLoader.prototype,{load:function load(e,t,r,n){var i=this,o=new DataTexture,a=new FileLoader(this.manager);return a.setResponseType("arraybuffer"),a.load(e,function(e){var r=i._parser(e);r&&(void 0!==r.image?o.image=r.image:void 0!==r.data&&(o.image.width=r.width,o.image.height=r.height,o.image.data=r.data),o.wrapS=void 0!==r.wrapS?r.wrapS:_e,o.wrapT=void 0!==r.wrapT?r.wrapT:_e,o.magFilter=void 0!==r.magFilter?r.magFilter:Se,o.minFilter=void 0!==r.minFilter?r.minFilter:Pe,o.anisotropy=void 0!==r.anisotropy?r.anisotropy:1,void 0!==r.format&&(o.format=r.format),void 0!==r.type&&(o.type=r.type),void 0!==r.mipmaps&&(o.mipmaps=r.mipmaps),1===r.mipmapCount&&(o.minFilter=Se),o.needsUpdate=!0,t&&t(o,r))},r,n),o}}),Object.assign(ImageLoader.prototype,{crossOrigin:"Anonymous",load:function load(e,t,r,n){void 0===e&&(e=""),void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);var i=this,o=Or.get(e);if(void 0!==o)return i.manager.itemStart(e),setTimeout(function(){t&&t(o),i.manager.itemEnd(e)},0),o;var a=document.createElementNS("http://www.w3.org/1999/xhtml","img");return a.addEventListener("load",function(){Or.add(e,this),t&&t(this),i.manager.itemEnd(e)},!1),a.addEventListener("error",function(t){n&&n(t),i.manager.itemEnd(e),i.manager.itemError(e)},!1),"data:"!==e.substr(0,5)&&void 0!==this.crossOrigin&&(a.crossOrigin=this.crossOrigin),i.manager.itemStart(e),a.src=e,a},setCrossOrigin:function setCrossOrigin(e){return this.crossOrigin=e,this},setPath:function setPath(e){return this.path=e,this}}),Object.assign(CubeTextureLoader.prototype,{crossOrigin:"Anonymous",load:function load(e,t,r,n){var i=new CubeTexture,o=new ImageLoader(this.manager);o.setCrossOrigin(this.crossOrigin),o.setPath(this.path);var a=0;function loadTexture(r){o.load(e[r],function(e){i.images[r]=e,6===++a&&(i.needsUpdate=!0,t&&t(i))},void 0,n)}for(var s=0;s<e.length;++s)loadTexture(s);return i},setCrossOrigin:function setCrossOrigin(e){return this.crossOrigin=e,this},setPath:function setPath(e){return this.path=e,this}}),Object.assign(TextureLoader.prototype,{crossOrigin:"Anonymous",load:function load(e,t,r,n){var i=new Texture,o=new ImageLoader(this.manager);return o.setCrossOrigin(this.crossOrigin),o.setPath(this.path),o.load(e,function(r){i.image=r;var n=e.search(/\.(jpg|jpeg)$/)>0||0===e.search(/^data\:image\/jpeg/);i.format=n?De:Ue,i.needsUpdate=!0,void 0!==t&&t(i)},r,n),i},setCrossOrigin:function setCrossOrigin(e){return this.crossOrigin=e,this},setPath:function setPath(e){return this.path=e,this}}),Object.assign(Curve.prototype,{getPoint:function getPoint(){return console.warn("THREE.Curve: .getPoint() not implemented."),null},getPointAt:function getPointAt(e,t){var r=this.getUtoTmapping(e);return this.getPoint(r,t)},getPoints:function getPoints(e){void 0===e&&(e=5);for(var t=[],r=0;r<=e;r++)t.push(this.getPoint(r/e));return t},getSpacedPoints:function getSpacedPoints(e){void 0===e&&(e=5);for(var t=[],r=0;r<=e;r++)t.push(this.getPointAt(r/e));return t},getLength:function getLength(){var e=this.getLengths();return e[e.length-1]},getLengths:function getLengths(e){if(void 0===e&&(e=this.arcLengthDivisions),this.cacheArcLengths&&this.cacheArcLengths.length===e+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;var t,r,n=[],i=this.getPoint(0),o=0;for(n.push(0),r=1;r<=e;r++)o+=(t=this.getPoint(r/e)).distanceTo(i),n.push(o),i=t;return this.cacheArcLengths=n,n},updateArcLengths:function updateArcLengths(){this.needsUpdate=!0,this.getLengths()},getUtoTmapping:function getUtoTmapping(e,t){var r,n=this.getLengths(),i=0,o=n.length;r=t||e*n[o-1];for(var a,s=0,c=o-1;s<=c;)if((a=n[i=Math.floor(s+(c-s)/2)]-r)<0)s=i+1;else{if(!(a>0)){c=i;break}c=i-1}if(n[i=c]===r)return i/(o-1);var u=n[i];return(i+(r-u)/(n[i+1]-u))/(o-1)},getTangent:function getTangent(e){var t=e-1e-4,r=e+1e-4;t<0&&(t=0),r>1&&(r=1);var n=this.getPoint(t);return this.getPoint(r).clone().sub(n).normalize()},getTangentAt:function getTangentAt(e){var t=this.getUtoTmapping(e);return this.getTangent(t)},computeFrenetFrames:function computeFrenetFrames(e,t){var r,n,i,o=new Vector3,a=[],s=[],c=[],u=new Vector3,l=new Matrix4;for(r=0;r<=e;r++)n=r/e,a[r]=this.getTangentAt(n),a[r].normalize();s[0]=new Vector3,c[0]=new Vector3;var h=Number.MAX_VALUE,p=Math.abs(a[0].x),f=Math.abs(a[0].y),d=Math.abs(a[0].z);for(p<=h&&(h=p,o.set(1,0,0)),f<=h&&(h=f,o.set(0,1,0)),d<=h&&o.set(0,0,1),u.crossVectors(a[0],o).normalize(),s[0].crossVectors(a[0],u),c[0].crossVectors(a[0],s[0]),r=1;r<=e;r++)s[r]=s[r-1].clone(),c[r]=c[r-1].clone(),u.crossVectors(a[r-1],a[r]),u.length()>Number.EPSILON&&(u.normalize(),i=Math.acos(At.clamp(a[r-1].dot(a[r]),-1,1)),s[r].applyMatrix4(l.makeRotationAxis(u,i))),c[r].crossVectors(a[r],s[r]);if(!0===t)for(i=Math.acos(At.clamp(s[0].dot(s[e]),-1,1)),i/=e,a[0].dot(u.crossVectors(s[0],s[e]))>0&&(i=-i),r=1;r<=e;r++)s[r].applyMatrix4(l.makeRotationAxis(a[r],i*r)),c[r].crossVectors(a[r],s[r]);return{tangents:a,normals:s,binormals:c}},clone:function clone(){return(new this.constructor).copy(this)},copy:function copy(e){return this.arcLengthDivisions=e.arcLengthDivisions,this},toJSON:function toJSON(){var e={metadata:{version:4.5,type:"Curve",generator:"Curve.toJSON"}};return e.arcLengthDivisions=this.arcLengthDivisions,e.type=this.type,e},fromJSON:function fromJSON(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}}),EllipseCurve.prototype=Object.create(Curve.prototype),EllipseCurve.prototype.constructor=EllipseCurve,EllipseCurve.prototype.isEllipseCurve=!0,EllipseCurve.prototype.getPoint=function(e,t){for(var r=t||new Vector2,n=2*Math.PI,i=this.aEndAngle-this.aStartAngle,o=Math.abs(i)<Number.EPSILON;i<0;)i+=n;for(;i>n;)i-=n;i<Number.EPSILON&&(i=o?0:n),!0!==this.aClockwise||o||(i===n?i=-n:i-=n);var a=this.aStartAngle+e*i,s=this.aX+this.xRadius*Math.cos(a),c=this.aY+this.yRadius*Math.sin(a);if(0!==this.aRotation){var u=Math.cos(this.aRotation),l=Math.sin(this.aRotation),h=s-this.aX,p=c-this.aY;s=h*u-p*l+this.aX,c=h*l+p*u+this.aY}return r.set(s,c)},EllipseCurve.prototype.copy=function(e){return Curve.prototype.copy.call(this,e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this},EllipseCurve.prototype.toJSON=function(){var e=Curve.prototype.toJSON.call(this);return e.aX=this.aX,e.aY=this.aY,e.xRadius=this.xRadius,e.yRadius=this.yRadius,e.aStartAngle=this.aStartAngle,e.aEndAngle=this.aEndAngle,e.aClockwise=this.aClockwise,e.aRotation=this.aRotation,e},EllipseCurve.prototype.fromJSON=function(e){return Curve.prototype.fromJSON.call(this,e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this},ArcCurve.prototype=Object.create(EllipseCurve.prototype),ArcCurve.prototype.constructor=ArcCurve,ArcCurve.prototype.isArcCurve=!0;var kr=new Vector3,Rr=new CubicPoly,Ir=new CubicPoly,Nr=new CubicPoly;function CatmullRomCurve3(e,t,r,n){Curve.call(this),this.type="CatmullRomCurve3",this.points=e||[],this.closed=t||!1,this.curveType=r||"centripetal",this.tension=n||.5}function CatmullRom(e,t,r,n,i){var o=.5*(n-t),a=.5*(i-r),s=e*e;return(2*r-2*n+o+a)*(e*s)+(-3*r+3*n-2*o-a)*s+o*e+r}function QuadraticBezier(e,t,r,n){return function QuadraticBezierP0(e,t){var r=1-e;return r*r*t}(e,t)+function QuadraticBezierP1(e,t){return 2*(1-e)*e*t}(e,r)+function QuadraticBezierP2(e,t){return e*e*t}(e,n)}function CubicBezier(e,t,r,n,i){return function CubicBezierP0(e,t){var r=1-e;return r*r*r*t}(e,t)+function CubicBezierP1(e,t){var r=1-e;return 3*r*r*e*t}(e,r)+function CubicBezierP2(e,t){return 3*(1-e)*e*e*t}(e,n)+function CubicBezierP3(e,t){return e*e*e*t}(e,i)}function CubicBezierCurve(e,t,r,n){Curve.call(this),this.type="CubicBezierCurve",this.v0=e||new Vector2,this.v1=t||new Vector2,this.v2=r||new Vector2,this.v3=n||new Vector2}function CubicBezierCurve3(e,t,r,n){Curve.call(this),this.type="CubicBezierCurve3",this.v0=e||new Vector3,this.v1=t||new Vector3,this.v2=r||new Vector3,this.v3=n||new Vector3}function LineCurve(e,t){Curve.call(this),this.type="LineCurve",this.v1=e||new Vector2,this.v2=t||new Vector2}function LineCurve3(e,t){Curve.call(this),this.type="LineCurve3",this.v1=e||new Vector3,this.v2=t||new Vector3}function QuadraticBezierCurve(e,t,r){Curve.call(this),this.type="QuadraticBezierCurve",this.v0=e||new Vector2,this.v1=t||new Vector2,this.v2=r||new Vector2}function QuadraticBezierCurve3(e,t,r){Curve.call(this),this.type="QuadraticBezierCurve3",this.v0=e||new Vector3,this.v1=t||new Vector3,this.v2=r||new Vector3}function SplineCurve(e){Curve.call(this),this.type="SplineCurve",this.points=e||[]}CatmullRomCurve3.prototype=Object.create(Curve.prototype),CatmullRomCurve3.prototype.constructor=CatmullRomCurve3,CatmullRomCurve3.prototype.isCatmullRomCurve3=!0,CatmullRomCurve3.prototype.getPoint=function(e,t){var r,n,i,o,a=t||new Vector3,s=this.points,c=s.length,u=(c-(this.closed?0:1))*e,l=Math.floor(u),h=u-l;if(this.closed?l+=l>0?0:(Math.floor(Math.abs(l)/s.length)+1)*s.length:0===h&&l===c-1&&(l=c-2,h=1),this.closed||l>0?r=s[(l-1)%c]:(kr.subVectors(s[0],s[1]).add(s[0]),r=kr),n=s[l%c],i=s[(l+1)%c],this.closed||l+2<c?o=s[(l+2)%c]:(kr.subVectors(s[c-1],s[c-2]).add(s[c-1]),o=kr),"centripetal"===this.curveType||"chordal"===this.curveType){var p="chordal"===this.curveType?.5:.25,f=Math.pow(r.distanceToSquared(n),p),d=Math.pow(n.distanceToSquared(i),p),m=Math.pow(i.distanceToSquared(o),p);d<1e-4&&(d=1),f<1e-4&&(f=d),m<1e-4&&(m=d),Rr.initNonuniformCatmullRom(r.x,n.x,i.x,o.x,f,d,m),Ir.initNonuniformCatmullRom(r.y,n.y,i.y,o.y,f,d,m),Nr.initNonuniformCatmullRom(r.z,n.z,i.z,o.z,f,d,m)}else"catmullrom"===this.curveType&&(Rr.initCatmullRom(r.x,n.x,i.x,o.x,this.tension),Ir.initCatmullRom(r.y,n.y,i.y,o.y,this.tension),Nr.initCatmullRom(r.z,n.z,i.z,o.z,this.tension));return a.set(Rr.calc(h),Ir.calc(h),Nr.calc(h)),a},CatmullRomCurve3.prototype.copy=function(e){Curve.prototype.copy.call(this,e),this.points=[];for(var t=0,r=e.points.length;t<r;t++){var n=e.points[t];this.points.push(n.clone())}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this},CatmullRomCurve3.prototype.toJSON=function(){var e=Curve.prototype.toJSON.call(this);e.points=[];for(var t=0,r=this.points.length;t<r;t++){var n=this.points[t];e.points.push(n.toArray())}return e.closed=this.closed,e.curveType=this.curveType,e.tension=this.tension,e},CatmullRomCurve3.prototype.fromJSON=function(e){Curve.prototype.fromJSON.call(this,e),this.points=[];for(var t=0,r=e.points.length;t<r;t++){var n=e.points[t];this.points.push((new Vector3).fromArray(n))}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this},CubicBezierCurve.prototype=Object.create(Curve.prototype),CubicBezierCurve.prototype.constructor=CubicBezierCurve,CubicBezierCurve.prototype.isCubicBezierCurve=!0,CubicBezierCurve.prototype.getPoint=function(e,t){var r=t||new Vector2,n=this.v0,i=this.v1,o=this.v2,a=this.v3;return r.set(CubicBezier(e,n.x,i.x,o.x,a.x),CubicBezier(e,n.y,i.y,o.y,a.y)),r},CubicBezierCurve.prototype.copy=function(e){return Curve.prototype.copy.call(this,e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this},CubicBezierCurve.prototype.toJSON=function(){var e=Curve.prototype.toJSON.call(this);return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e},CubicBezierCurve.prototype.fromJSON=function(e){return Curve.prototype.fromJSON.call(this,e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this},CubicBezierCurve3.prototype=Object.create(Curve.prototype),CubicBezierCurve3.prototype.constructor=CubicBezierCurve3,CubicBezierCurve3.prototype.isCubicBezierCurve3=!0,CubicBezierCurve3.prototype.getPoint=function(e,t){var r=t||new Vector3,n=this.v0,i=this.v1,o=this.v2,a=this.v3;return r.set(CubicBezier(e,n.x,i.x,o.x,a.x),CubicBezier(e,n.y,i.y,o.y,a.y),CubicBezier(e,n.z,i.z,o.z,a.z)),r},CubicBezierCurve3.prototype.copy=function(e){return Curve.prototype.copy.call(this,e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this},CubicBezierCurve3.prototype.toJSON=function(){var e=Curve.prototype.toJSON.call(this);return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e},CubicBezierCurve3.prototype.fromJSON=function(e){return Curve.prototype.fromJSON.call(this,e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this},LineCurve.prototype=Object.create(Curve.prototype),LineCurve.prototype.constructor=LineCurve,LineCurve.prototype.isLineCurve=!0,LineCurve.prototype.getPoint=function(e,t){var r=t||new Vector2;return 1===e?r.copy(this.v2):(r.copy(this.v2).sub(this.v1),r.multiplyScalar(e).add(this.v1)),r},LineCurve.prototype.getPointAt=function(e,t){return this.getPoint(e,t)},LineCurve.prototype.getTangent=function(){return this.v2.clone().sub(this.v1).normalize()},LineCurve.prototype.copy=function(e){return Curve.prototype.copy.call(this,e),this.v1.copy(e.v1),this.v2.copy(e.v2),this},LineCurve.prototype.toJSON=function(){var e=Curve.prototype.toJSON.call(this);return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e},LineCurve.prototype.fromJSON=function(e){return Curve.prototype.fromJSON.call(this,e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this},LineCurve3.prototype=Object.create(Curve.prototype),LineCurve3.prototype.constructor=LineCurve3,LineCurve3.prototype.isLineCurve3=!0,LineCurve3.prototype.getPoint=function(e,t){var r=t||new Vector3;return 1===e?r.copy(this.v2):(r.copy(this.v2).sub(this.v1),r.multiplyScalar(e).add(this.v1)),r},LineCurve3.prototype.getPointAt=function(e,t){return this.getPoint(e,t)},LineCurve3.prototype.copy=function(e){return Curve.prototype.copy.call(this,e),this.v1.copy(e.v1),this.v2.copy(e.v2),this},LineCurve3.prototype.toJSON=function(){var e=Curve.prototype.toJSON.call(this);return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e},LineCurve3.prototype.fromJSON=function(e){return Curve.prototype.fromJSON.call(this,e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this},QuadraticBezierCurve.prototype=Object.create(Curve.prototype),QuadraticBezierCurve.prototype.constructor=QuadraticBezierCurve,QuadraticBezierCurve.prototype.isQuadraticBezierCurve=!0,QuadraticBezierCurve.prototype.getPoint=function(e,t){var r=t||new Vector2,n=this.v0,i=this.v1,o=this.v2;return r.set(QuadraticBezier(e,n.x,i.x,o.x),QuadraticBezier(e,n.y,i.y,o.y)),r},QuadraticBezierCurve.prototype.copy=function(e){return Curve.prototype.copy.call(this,e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this},QuadraticBezierCurve.prototype.toJSON=function(){var e=Curve.prototype.toJSON.call(this);return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e},QuadraticBezierCurve.prototype.fromJSON=function(e){return Curve.prototype.fromJSON.call(this,e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this},QuadraticBezierCurve3.prototype=Object.create(Curve.prototype),QuadraticBezierCurve3.prototype.constructor=QuadraticBezierCurve3,QuadraticBezierCurve3.prototype.isQuadraticBezierCurve3=!0,QuadraticBezierCurve3.prototype.getPoint=function(e,t){var r=t||new Vector3,n=this.v0,i=this.v1,o=this.v2;return r.set(QuadraticBezier(e,n.x,i.x,o.x),QuadraticBezier(e,n.y,i.y,o.y),QuadraticBezier(e,n.z,i.z,o.z)),r},QuadraticBezierCurve3.prototype.copy=function(e){return Curve.prototype.copy.call(this,e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this},QuadraticBezierCurve3.prototype.toJSON=function(){var e=Curve.prototype.toJSON.call(this);return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e},QuadraticBezierCurve3.prototype.fromJSON=function(e){return Curve.prototype.fromJSON.call(this,e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this},SplineCurve.prototype=Object.create(Curve.prototype),SplineCurve.prototype.constructor=SplineCurve,SplineCurve.prototype.isSplineCurve=!0,SplineCurve.prototype.getPoint=function(e,t){var r=t||new Vector2,n=this.points,i=(n.length-1)*e,o=Math.floor(i),a=i-o,s=n[0===o?o:o-1],c=n[o],u=n[o>n.length-2?n.length-1:o+1],l=n[o>n.length-3?n.length-1:o+2];return r.set(CatmullRom(a,s.x,c.x,u.x,l.x),CatmullRom(a,s.y,c.y,u.y,l.y)),r},SplineCurve.prototype.copy=function(e){Curve.prototype.copy.call(this,e),this.points=[];for(var t=0,r=e.points.length;t<r;t++){var n=e.points[t];this.points.push(n.clone())}return this},SplineCurve.prototype.toJSON=function(){var e=Curve.prototype.toJSON.call(this);e.points=[];for(var t=0,r=this.points.length;t<r;t++){var n=this.points[t];e.points.push(n.toArray())}return e},SplineCurve.prototype.fromJSON=function(e){Curve.prototype.fromJSON.call(this,e),this.points=[];for(var t=0,r=e.points.length;t<r;t++){var n=e.points[t];this.points.push((new Vector2).fromArray(n))}return this};var Fr=Object.freeze({ArcCurve:ArcCurve,CatmullRomCurve3:CatmullRomCurve3,CubicBezierCurve:CubicBezierCurve,CubicBezierCurve3:CubicBezierCurve3,EllipseCurve:EllipseCurve,LineCurve:LineCurve,LineCurve3:LineCurve3,QuadraticBezierCurve:QuadraticBezierCurve,QuadraticBezierCurve3:QuadraticBezierCurve3,SplineCurve:SplineCurve});function CurvePath(){Curve.call(this),this.type="CurvePath",this.curves=[],this.autoClose=!1}function Path(e){CurvePath.call(this),this.type="Path",this.currentPoint=new Vector2,e&&this.setFromPoints(e)}function Shape(e){Path.call(this,e),this.uuid=At.generateUUID(),this.type="Shape",this.holes=[]}function Light(e,t){Object3D.call(this),this.type="Light",this.color=new Color(e),this.intensity=void 0!==t?t:1,this.receiveShadow=void 0}function HemisphereLight(e,t,r){Light.call(this,e,r),this.type="HemisphereLight",this.castShadow=void 0,this.position.copy(Object3D.DefaultUp),this.updateMatrix(),this.groundColor=new Color(t)}function LightShadow(e){this.camera=e,this.bias=0,this.radius=1,this.mapSize=new Vector2(512,512),this.map=null,this.matrix=new Matrix4}function SpotLightShadow(){LightShadow.call(this,new PerspectiveCamera(50,1,.5,500))}function SpotLight(e,t,r,n,i,o){Light.call(this,e,t),this.type="SpotLight",this.position.copy(Object3D.DefaultUp),this.updateMatrix(),this.target=new Object3D,Object.defineProperty(this,"power",{get:function get(){return this.intensity*Math.PI},set:function set(e){this.intensity=e/Math.PI}}),this.distance=void 0!==r?r:0,this.angle=void 0!==n?n:Math.PI/3,this.penumbra=void 0!==i?i:0,this.decay=void 0!==o?o:1,this.shadow=new SpotLightShadow}function PointLight(e,t,r,n){Light.call(this,e,t),this.type="PointLight",Object.defineProperty(this,"power",{get:function get(){return 4*this.intensity*Math.PI},set:function set(e){this.intensity=e/(4*Math.PI)}}),this.distance=void 0!==r?r:0,this.decay=void 0!==n?n:1,this.shadow=new LightShadow(new PerspectiveCamera(90,1,.5,500))}function DirectionalLightShadow(){LightShadow.call(this,new OrthographicCamera(-5,5,5,-5,.5,500))}function DirectionalLight(e,t){Light.call(this,e,t),this.type="DirectionalLight",this.position.copy(Object3D.DefaultUp),this.updateMatrix(),this.target=new Object3D,this.shadow=new DirectionalLightShadow}function AmbientLight(e,t){Light.call(this,e,t),this.type="AmbientLight",this.castShadow=void 0}function RectAreaLight(e,t,r,n){Light.call(this,e,t),this.type="RectAreaLight",this.width=void 0!==r?r:10,this.height=void 0!==n?n:10}function StringKeyframeTrack(e,t,r,n){KeyframeTrack.call(this,e,t,r,n)}function BooleanKeyframeTrack(e,t,r){KeyframeTrack.call(this,e,t,r)}function Interpolant(e,t,r,n){this.parameterPositions=e,this._cachedIndex=0,this.resultBuffer=void 0!==n?n:new t.constructor(r),this.sampleValues=t,this.valueSize=r}function QuaternionLinearInterpolant(e,t,r,n){Interpolant.call(this,e,t,r,n)}function QuaternionKeyframeTrack(e,t,r,n){KeyframeTrack.call(this,e,t,r,n)}function ColorKeyframeTrack(e,t,r,n){KeyframeTrack.call(this,e,t,r,n)}function NumberKeyframeTrack(e,t,r,n){KeyframeTrack.call(this,e,t,r,n)}function CubicInterpolant(e,t,r,n){Interpolant.call(this,e,t,r,n),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0}function LinearInterpolant(e,t,r,n){Interpolant.call(this,e,t,r,n)}function DiscreteInterpolant(e,t,r,n){Interpolant.call(this,e,t,r,n)}CurvePath.prototype=Object.assign(Object.create(Curve.prototype),{constructor:CurvePath,add:function add(e){this.curves.push(e)},closePath:function closePath(){var e=this.curves[0].getPoint(0),t=this.curves[this.curves.length-1].getPoint(1);e.equals(t)||this.curves.push(new LineCurve(t,e))},getPoint:function getPoint(e){for(var t=e*this.getLength(),r=this.getCurveLengths(),n=0;n<r.length;){if(r[n]>=t){var i=r[n]-t,o=this.curves[n],a=o.getLength(),s=0===a?0:1-i/a;return o.getPointAt(s)}n++}return null},getLength:function getLength(){var e=this.getCurveLengths();return e[e.length-1]},updateArcLengths:function updateArcLengths(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()},getCurveLengths:function getCurveLengths(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;for(var e=[],t=0,r=0,n=this.curves.length;r<n;r++)t+=this.curves[r].getLength(),e.push(t);return this.cacheLengths=e,e},getSpacedPoints:function getSpacedPoints(e){void 0===e&&(e=40);for(var t=[],r=0;r<=e;r++)t.push(this.getPoint(r/e));return this.autoClose&&t.push(t[0]),t},getPoints:function getPoints(e){e=e||12;for(var t,r=[],n=0,i=this.curves;n<i.length;n++)for(var o=i[n],a=o&&o.isEllipseCurve?2*e:o&&o.isLineCurve?1:o&&o.isSplineCurve?e*o.points.length:e,s=o.getPoints(a),c=0;c<s.length;c++){var u=s[c];t&&t.equals(u)||(r.push(u),t=u)}return this.autoClose&&r.length>1&&!r[r.length-1].equals(r[0])&&r.push(r[0]),r},copy:function copy(e){Curve.prototype.copy.call(this,e),this.curves=[];for(var t=0,r=e.curves.length;t<r;t++){var n=e.curves[t];this.curves.push(n.clone())}return this.autoClose=e.autoClose,this},toJSON:function toJSON(){var e=Curve.prototype.toJSON.call(this);e.autoClose=this.autoClose,e.curves=[];for(var t=0,r=this.curves.length;t<r;t++){var n=this.curves[t];e.curves.push(n.toJSON())}return e},fromJSON:function fromJSON(e){Curve.prototype.fromJSON.call(this,e),this.autoClose=e.autoClose,this.curves=[];for(var t=0,r=e.curves.length;t<r;t++){var n=e.curves[t];this.curves.push((new Fr[n.type]).fromJSON(n))}return this}}),Path.prototype=Object.assign(Object.create(CurvePath.prototype),{constructor:Path,setFromPoints:function setFromPoints(e){this.moveTo(e[0].x,e[0].y);for(var t=1,r=e.length;t<r;t++)this.lineTo(e[t].x,e[t].y)},moveTo:function moveTo(e,t){this.currentPoint.set(e,t)},lineTo:function lineTo(e,t){var r=new LineCurve(this.currentPoint.clone(),new Vector2(e,t));this.curves.push(r),this.currentPoint.set(e,t)},quadraticCurveTo:function quadraticCurveTo(e,t,r,n){var i=new QuadraticBezierCurve(this.currentPoint.clone(),new Vector2(e,t),new Vector2(r,n));this.curves.push(i),this.currentPoint.set(r,n)},bezierCurveTo:function bezierCurveTo(e,t,r,n,i,o){var a=new CubicBezierCurve(this.currentPoint.clone(),new Vector2(e,t),new Vector2(r,n),new Vector2(i,o));this.curves.push(a),this.currentPoint.set(i,o)},splineThru:function splineThru(e){var t=new SplineCurve([this.currentPoint.clone()].concat(e));this.curves.push(t),this.currentPoint.copy(e[e.length-1])},arc:function arc(e,t,r,n,i,o){var a=this.currentPoint.x,s=this.currentPoint.y;this.absarc(e+a,t+s,r,n,i,o)},absarc:function absarc(e,t,r,n,i,o){this.absellipse(e,t,r,r,n,i,o)},ellipse:function ellipse(e,t,r,n,i,o,a,s){var c=this.currentPoint.x,u=this.currentPoint.y;this.absellipse(e+c,t+u,r,n,i,o,a,s)},absellipse:function absellipse(e,t,r,n,i,o,a,s){var c=new EllipseCurve(e,t,r,n,i,o,a,s);if(this.curves.length>0){var u=c.getPoint(0);u.equals(this.currentPoint)||this.lineTo(u.x,u.y)}this.curves.push(c);var l=c.getPoint(1);this.currentPoint.copy(l)},copy:function copy(e){return CurvePath.prototype.copy.call(this,e),this.currentPoint.copy(e.currentPoint),this},toJSON:function toJSON(){var e=CurvePath.prototype.toJSON.call(this);return e.currentPoint=this.currentPoint.toArray(),e},fromJSON:function fromJSON(e){return CurvePath.prototype.fromJSON.call(this,e),this.currentPoint.fromArray(e.currentPoint),this}}),Shape.prototype=Object.assign(Object.create(Path.prototype),{constructor:Shape,getPointsHoles:function getPointsHoles(e){for(var t=[],r=0,n=this.holes.length;r<n;r++)t[r]=this.holes[r].getPoints(e);return t},extractPoints:function extractPoints(e){return{shape:this.getPoints(e),holes:this.getPointsHoles(e)}},copy:function copy(e){Path.prototype.copy.call(this,e),this.holes=[];for(var t=0,r=e.holes.length;t<r;t++){var n=e.holes[t];this.holes.push(n.clone())}return this},toJSON:function toJSON(){var e=Path.prototype.toJSON.call(this);e.uuid=this.uuid,e.holes=[];for(var t=0,r=this.holes.length;t<r;t++){var n=this.holes[t];e.holes.push(n.toJSON())}return e},fromJSON:function fromJSON(e){Path.prototype.fromJSON.call(this,e),this.uuid=e.uuid,this.holes=[];for(var t=0,r=e.holes.length;t<r;t++){var n=e.holes[t];this.holes.push((new Path).fromJSON(n))}return this}}),Light.prototype=Object.assign(Object.create(Object3D.prototype),{constructor:Light,isLight:!0,copy:function copy(e){return Object3D.prototype.copy.call(this,e),this.color.copy(e.color),this.intensity=e.intensity,this},toJSON:function toJSON(e){var t=Object3D.prototype.toJSON.call(this,e);return t.object.color=this.color.getHex(),t.object.intensity=this.intensity,void 0!==this.groundColor&&(t.object.groundColor=this.groundColor.getHex()),void 0!==this.distance&&(t.object.distance=this.distance),void 0!==this.angle&&(t.object.angle=this.angle),void 0!==this.decay&&(t.object.decay=this.decay),void 0!==this.penumbra&&(t.object.penumbra=this.penumbra),void 0!==this.shadow&&(t.object.shadow=this.shadow.toJSON()),t}}),HemisphereLight.prototype=Object.assign(Object.create(Light.prototype),{constructor:HemisphereLight,isHemisphereLight:!0,copy:function copy(e){return Light.prototype.copy.call(this,e),this.groundColor.copy(e.groundColor),this}}),Object.assign(LightShadow.prototype,{copy:function copy(e){return this.camera=e.camera.clone(),this.bias=e.bias,this.radius=e.radius,this.mapSize.copy(e.mapSize),this},clone:function clone(){return(new this.constructor).copy(this)},toJSON:function toJSON(){var e={};return 0!==this.bias&&(e.bias=this.bias),1!==this.radius&&(e.radius=this.radius),512===this.mapSize.x&&512===this.mapSize.y||(e.mapSize=this.mapSize.toArray()),e.camera=this.camera.toJSON(!1).object,delete e.camera.matrix,e}}),SpotLightShadow.prototype=Object.assign(Object.create(LightShadow.prototype),{constructor:SpotLightShadow,isSpotLightShadow:!0,update:function update(e){var t=this.camera,r=2*At.RAD2DEG*e.angle,n=this.mapSize.width/this.mapSize.height,i=e.distance||t.far;r===t.fov&&n===t.aspect&&i===t.far||(t.fov=r,t.aspect=n,t.far=i,t.updateProjectionMatrix())}}),SpotLight.prototype=Object.assign(Object.create(Light.prototype),{constructor:SpotLight,isSpotLight:!0,copy:function copy(e){return Light.prototype.copy.call(this,e),this.distance=e.distance,this.angle=e.angle,this.penumbra=e.penumbra,this.decay=e.decay,this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}),PointLight.prototype=Object.assign(Object.create(Light.prototype),{constructor:PointLight,isPointLight:!0,copy:function copy(e){return Light.prototype.copy.call(this,e),this.distance=e.distance,this.decay=e.decay,this.shadow=e.shadow.clone(),this}}),DirectionalLightShadow.prototype=Object.assign(Object.create(LightShadow.prototype),{constructor:DirectionalLightShadow}),DirectionalLight.prototype=Object.assign(Object.create(Light.prototype),{constructor:DirectionalLight,isDirectionalLight:!0,copy:function copy(e){return Light.prototype.copy.call(this,e),this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}),AmbientLight.prototype=Object.assign(Object.create(Light.prototype),{constructor:AmbientLight,isAmbientLight:!0}),RectAreaLight.prototype=Object.assign(Object.create(Light.prototype),{constructor:RectAreaLight,isRectAreaLight:!0,copy:function copy(e){return Light.prototype.copy.call(this,e),this.width=e.width,this.height=e.height,this},toJSON:function toJSON(e){var t=Light.prototype.toJSON.call(this,e);return t.object.width=this.width,t.object.height=this.height,t}}),StringKeyframeTrack.prototype=Object.assign(Object.create(KeyframeTrack.prototype),{constructor:StringKeyframeTrack,ValueTypeName:"string",ValueBufferType:Array,DefaultInterpolation:2300,InterpolantFactoryMethodLinear:void 0,InterpolantFactoryMethodSmooth:void 0}),BooleanKeyframeTrack.prototype=Object.assign(Object.create(KeyframeTrack.prototype),{constructor:BooleanKeyframeTrack,ValueTypeName:"bool",ValueBufferType:Array,DefaultInterpolation:2300,InterpolantFactoryMethodLinear:void 0,InterpolantFactoryMethodSmooth:void 0}),Object.assign(Interpolant.prototype,{evaluate:function evaluate(e){var t=this.parameterPositions,r=this._cachedIndex,n=t[r],i=t[r-1];e:{t:{var o;r:{n:if(!(e<n)){for(var a=r+2;;){if(void 0===n){if(e<i)break n;return r=t.length,this._cachedIndex=r,this.afterEnd_(r-1,e,i)}if(r===a)break;if(i=n,e<(n=t[++r]))break t}o=t.length;break r}if(e>=i)break e;var s=t[1];e<s&&(r=2,i=s);for(a=r-2;;){if(void 0===i)return this._cachedIndex=0,this.beforeStart_(0,e,n);if(r===a)break;if(n=i,e>=(i=t[--r-1]))break t}o=r,r=0}for(;r<o;){var c=r+o>>>1;e<t[c]?o=c:r=c+1}if(n=t[r],void 0===(i=t[r-1]))return this._cachedIndex=0,this.beforeStart_(0,e,n);if(void 0===n)return r=t.length,this._cachedIndex=r,this.afterEnd_(r-1,i,e)}this._cachedIndex=r,this.intervalChanged_(r,i,n)}return this.interpolate_(r,i,e,n)},settings:null,DefaultSettings_:{},getSettings_:function getSettings_(){return this.settings||this.DefaultSettings_},copySampleValue_:function copySampleValue_(e){for(var t=this.resultBuffer,r=this.sampleValues,n=this.valueSize,i=e*n,o=0;o!==n;++o)t[o]=r[i+o];return t},interpolate_:function interpolate_(){throw new Error("call to abstract method")},intervalChanged_:function intervalChanged_(){}}),//!\ DECLARE ALIAS AFTER assign prototype !
Object.assign(Interpolant.prototype,{beforeStart_:Interpolant.prototype.copySampleValue_,afterEnd_:Interpolant.prototype.copySampleValue_}),QuaternionLinearInterpolant.prototype=Object.assign(Object.create(Interpolant.prototype),{constructor:QuaternionLinearInterpolant,interpolate_:function interpolate_(e,t,r,n){for(var i=this.resultBuffer,o=this.sampleValues,a=this.valueSize,s=e*a,c=(r-t)/(n-t),u=s+a;s!==u;s+=4)Quaternion.slerpFlat(i,0,o,s-a,o,s,c);return i}}),QuaternionKeyframeTrack.prototype=Object.assign(Object.create(KeyframeTrack.prototype),{constructor:QuaternionKeyframeTrack,ValueTypeName:"quaternion",DefaultInterpolation:2301,InterpolantFactoryMethodLinear:function InterpolantFactoryMethodLinear(e){return new QuaternionLinearInterpolant(this.times,this.values,this.getValueSize(),e)},InterpolantFactoryMethodSmooth:void 0}),ColorKeyframeTrack.prototype=Object.assign(Object.create(KeyframeTrack.prototype),{constructor:ColorKeyframeTrack,ValueTypeName:"color"}),NumberKeyframeTrack.prototype=Object.assign(Object.create(KeyframeTrack.prototype),{constructor:NumberKeyframeTrack,ValueTypeName:"number"}),CubicInterpolant.prototype=Object.assign(Object.create(Interpolant.prototype),{constructor:CubicInterpolant,DefaultSettings_:{endingStart:yt,endingEnd:yt},intervalChanged_:function intervalChanged_(e,t,r){var n=this.parameterPositions,i=e-2,o=e+1,a=n[i],s=n[o];if(void 0===a)switch(this.getSettings_().endingStart){case 2401:i=e,a=2*t-r;break;case 2402:a=t+n[i=n.length-2]-n[i+1];break;default:i=e,a=r}if(void 0===s)switch(this.getSettings_().endingEnd){case 2401:o=e,s=2*r-t;break;case 2402:o=1,s=r+n[1]-n[0];break;default:o=e-1,s=t}var c=.5*(r-t),u=this.valueSize;this._weightPrev=c/(t-a),this._weightNext=c/(s-r),this._offsetPrev=i*u,this._offsetNext=o*u},interpolate_:function interpolate_(e,t,r,n){for(var i=this.resultBuffer,o=this.sampleValues,a=this.valueSize,s=e*a,c=s-a,u=this._offsetPrev,l=this._offsetNext,h=this._weightPrev,p=this._weightNext,f=(r-t)/(n-t),d=f*f,m=d*f,g=-h*m+2*h*d-h*f,y=(1+h)*m+(-1.5-2*h)*d+(-.5+h)*f+1,v=(-1-p)*m+(1.5+p)*d+.5*f,_=p*m-p*d,b=0;b!==a;++b)i[b]=g*o[u+b]+y*o[c+b]+v*o[s+b]+_*o[l+b];return i}}),LinearInterpolant.prototype=Object.assign(Object.create(Interpolant.prototype),{constructor:LinearInterpolant,interpolate_:function interpolate_(e,t,r,n){for(var i=this.resultBuffer,o=this.sampleValues,a=this.valueSize,s=e*a,c=s-a,u=(r-t)/(n-t),l=1-u,h=0;h!==a;++h)i[h]=o[c+h]*l+o[s+h]*u;return i}}),DiscreteInterpolant.prototype=Object.assign(Object.create(Interpolant.prototype),{constructor:DiscreteInterpolant,interpolate_:function interpolate_(e){return this.copySampleValue_(e-1)}});var jr={arraySlice:function arraySlice(e,t,r){return jr.isTypedArray(e)?new e.constructor(e.subarray(t,void 0!==r?r:e.length)):e.slice(t,r)},convertArray:function convertArray(e,t,r){return!e||!r&&e.constructor===t?e:"number"==typeof t.BYTES_PER_ELEMENT?new t(e):Array.prototype.slice.call(e)},isTypedArray:function isTypedArray(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)},getKeyframeOrder:function getKeyframeOrder(e){for(var t=e.length,r=new Array(t),n=0;n!==t;++n)r[n]=n;return r.sort(function compareTime(t,r){return e[t]-e[r]}),r},sortedArray:function sortedArray(e,t,r){for(var n=e.length,i=new e.constructor(n),o=0,a=0;a!==n;++o)for(var s=r[o]*t,c=0;c!==t;++c)i[a++]=e[s+c];return i},flattenJSON:function flattenJSON(e,t,r,n){for(var i=1,o=e[0];void 0!==o&&void 0===o[n];)o=e[i++];if(void 0!==o){var a=o[n];if(void 0!==a)if(Array.isArray(a))do{void 0!==(a=o[n])&&(t.push(o.time),r.push.apply(r,a)),o=e[i++]}while(void 0!==o);else if(void 0!==a.toArray)do{void 0!==(a=o[n])&&(t.push(o.time),a.toArray(r,r.length)),o=e[i++]}while(void 0!==o);else do{void 0!==(a=o[n])&&(t.push(o.time),r.push(a)),o=e[i++]}while(void 0!==o)}}};function KeyframeTrack(e,t,r,n){if(void 0===e)throw new Error("THREE.KeyframeTrack: track name is undefined");if(void 0===t||0===t.length)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+e);this.name=e,this.times=jr.convertArray(t,this.TimeBufferType),this.values=jr.convertArray(r,this.ValueBufferType),this.setInterpolation(n||this.DefaultInterpolation),this.validate(),this.optimize()}function VectorKeyframeTrack(e,t,r,n){KeyframeTrack.call(this,e,t,r,n)}function AnimationClip(e,t,r){this.name=e,this.tracks=r,this.duration=void 0!==t?t:-1,this.uuid=At.generateUUID(),this.duration<0&&this.resetDuration(),this.optimize()}function MaterialLoader(e){this.manager=void 0!==e?e:Ar,this.textures={}}function BufferGeometryLoader(e){this.manager=void 0!==e?e:Ar}Object.assign(KeyframeTrack,{parse:function parse(e){if(void 0===e.type)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");var t=KeyframeTrack._getTrackTypeForValueTypeName(e.type);if(void 0===e.times){var r=[],n=[];jr.flattenJSON(e.keys,r,n,"value"),e.times=r,e.values=n}return void 0!==t.parse?t.parse(e):new t(e.name,e.times,e.values,e.interpolation)},toJSON:function toJSON(e){var t,r=e.constructor;if(void 0!==r.toJSON)t=r.toJSON(e);else{t={name:e.name,times:jr.convertArray(e.times,Array),values:jr.convertArray(e.values,Array)};var n=e.getInterpolation();n!==e.DefaultInterpolation&&(t.interpolation=n)}return t.type=e.ValueTypeName,t},_getTrackTypeForValueTypeName:function _getTrackTypeForValueTypeName(e){switch(e.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return NumberKeyframeTrack;case"vector":case"vector2":case"vector3":case"vector4":return VectorKeyframeTrack;case"color":return ColorKeyframeTrack;case"quaternion":return QuaternionKeyframeTrack;case"bool":case"boolean":return BooleanKeyframeTrack;case"string":return StringKeyframeTrack}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+e)}}),Object.assign(KeyframeTrack.prototype,{constructor:KeyframeTrack,TimeBufferType:Float32Array,ValueBufferType:Float32Array,DefaultInterpolation:2301,InterpolantFactoryMethodDiscrete:function InterpolantFactoryMethodDiscrete(e){return new DiscreteInterpolant(this.times,this.values,this.getValueSize(),e)},InterpolantFactoryMethodLinear:function InterpolantFactoryMethodLinear(e){return new LinearInterpolant(this.times,this.values,this.getValueSize(),e)},InterpolantFactoryMethodSmooth:function InterpolantFactoryMethodSmooth(e){return new CubicInterpolant(this.times,this.values,this.getValueSize(),e)},setInterpolation:function setInterpolation(e){var t;switch(e){case 2300:t=this.InterpolantFactoryMethodDiscrete;break;case 2301:t=this.InterpolantFactoryMethodLinear;break;case 2302:t=this.InterpolantFactoryMethodSmooth}if(void 0!==t)this.createInterpolant=t;else{var r="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(void 0===this.createInterpolant){if(e===this.DefaultInterpolation)throw new Error(r);this.setInterpolation(this.DefaultInterpolation)}console.warn("THREE.KeyframeTrack:",r)}},getInterpolation:function getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return 2300;case this.InterpolantFactoryMethodLinear:return 2301;case this.InterpolantFactoryMethodSmooth:return 2302}},getValueSize:function getValueSize(){return this.values.length/this.times.length},shift:function shift(e){if(0!==e)for(var t=this.times,r=0,n=t.length;r!==n;++r)t[r]+=e;return this},scale:function scale(e){if(1!==e)for(var t=this.times,r=0,n=t.length;r!==n;++r)t[r]*=e;return this},trim:function trim(e,t){for(var r=this.times,n=r.length,i=0,o=n-1;i!==n&&r[i]<e;)++i;for(;-1!==o&&r[o]>t;)--o;if(++o,0!==i||o!==n){i>=o&&(i=(o=Math.max(o,1))-1);var a=this.getValueSize();this.times=jr.arraySlice(r,i,o),this.values=jr.arraySlice(this.values,i*a,o*a)}return this},validate:function validate(){var e=!0,t=this.getValueSize();t-Math.floor(t)!=0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),e=!1);var r=this.times,n=this.values,i=r.length;0===i&&(console.error("THREE.KeyframeTrack: Track is empty.",this),e=!1);for(var o=null,a=0;a!==i;a++){var s=r[a];if("number"==typeof s&&isNaN(s)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,a,s),e=!1;break}if(null!==o&&o>s){console.error("THREE.KeyframeTrack: Out of order keys.",this,a,s,o),e=!1;break}o=s}if(void 0!==n&&jr.isTypedArray(n)){a=0;for(var c=n.length;a!==c;++a){var u=n[a];if(isNaN(u)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,a,u),e=!1;break}}}return e},optimize:function optimize(){for(var e=this.times,t=this.values,r=this.getValueSize(),n=2302===this.getInterpolation(),i=1,o=e.length-1,a=1;a<o;++a){var s=!1,c=e[a];if(c!==e[a+1]&&(1!==a||c!==c[0]))if(n)s=!0;else for(var u=a*r,l=u-r,h=u+r,p=0;p!==r;++p){var f=t[u+p];if(f!==t[l+p]||f!==t[h+p]){s=!0;break}}if(s){if(a!==i){e[i]=e[a];var d=a*r,m=i*r;for(p=0;p!==r;++p)t[m+p]=t[d+p]}++i}}if(o>0){e[i]=e[o];for(d=o*r,m=i*r,p=0;p!==r;++p)t[m+p]=t[d+p];++i}return i!==e.length&&(this.times=jr.arraySlice(e,0,i),this.values=jr.arraySlice(t,0,i*r)),this}}),VectorKeyframeTrack.prototype=Object.assign(Object.create(KeyframeTrack.prototype),{constructor:VectorKeyframeTrack,ValueTypeName:"vector"}),Object.assign(AnimationClip,{parse:function parse(e){for(var t=[],r=e.tracks,n=1/(e.fps||1),i=0,o=r.length;i!==o;++i)t.push(KeyframeTrack.parse(r[i]).scale(n));return new AnimationClip(e.name,e.duration,t)},toJSON:function toJSON(e){for(var t=[],r=e.tracks,n={name:e.name,duration:e.duration,tracks:t},i=0,o=r.length;i!==o;++i)t.push(KeyframeTrack.toJSON(r[i]));return n},CreateFromMorphTargetSequence:function CreateFromMorphTargetSequence(e,t,r,n){for(var i=t.length,o=[],a=0;a<i;a++){var s=[],c=[];s.push((a+i-1)%i,a,(a+1)%i),c.push(0,1,0);var u=jr.getKeyframeOrder(s);s=jr.sortedArray(s,1,u),c=jr.sortedArray(c,1,u),n||0!==s[0]||(s.push(i),c.push(c[0])),o.push(new NumberKeyframeTrack(".morphTargetInfluences["+t[a].name+"]",s,c).scale(1/r))}return new AnimationClip(e,-1,o)},findByName:function findByName(e,t){var r=e;if(!Array.isArray(e)){var n=e;r=n.geometry&&n.geometry.animations||n.animations}for(var i=0;i<r.length;i++)if(r[i].name===t)return r[i];return null},CreateClipsFromMorphTargetSequences:function CreateClipsFromMorphTargetSequences(e,t,r){for(var n={},i=/^([\w-]*?)([\d]+)$/,o=0,a=e.length;o<a;o++){var s=e[o],c=s.name.match(i);if(c&&c.length>1){var u=n[h=c[1]];u||(n[h]=u=[]),u.push(s)}}var l=[];for(var h in n)l.push(AnimationClip.CreateFromMorphTargetSequence(h,n[h],t,r));return l},parseAnimation:function parseAnimation(e,t){if(!e)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;for(var r=function addNonemptyTrack(e,t,r,n,i){if(0!==r.length){var o=[],a=[];jr.flattenJSON(r,o,a,n),0!==o.length&&i.push(new e(t,o,a))}},n=[],i=e.name||"default",o=e.length||-1,a=e.fps||30,s=e.hierarchy||[],c=0;c<s.length;c++){var u=s[c].keys;if(u&&0!==u.length)if(u[0].morphTargets){for(var l={},h=0;h<u.length;h++)if(u[h].morphTargets)for(var p=0;p<u[h].morphTargets.length;p++)l[u[h].morphTargets[p]]=-1;for(var f in l){var d=[],m=[];for(p=0;p!==u[h].morphTargets.length;++p){var g=u[h];d.push(g.time),m.push(g.morphTarget===f?1:0)}n.push(new NumberKeyframeTrack(".morphTargetInfluence["+f+"]",d,m))}o=l.length*(a||1)}else{var y=".bones["+t[c].name+"]";r(VectorKeyframeTrack,y+".position",u,"pos",n),r(QuaternionKeyframeTrack,y+".quaternion",u,"rot",n),r(VectorKeyframeTrack,y+".scale",u,"scl",n)}}return 0===n.length?null:new AnimationClip(i,o,n)}}),Object.assign(AnimationClip.prototype,{resetDuration:function resetDuration(){for(var e=0,t=0,r=this.tracks.length;t!==r;++t){var n=this.tracks[t];e=Math.max(e,n.times[n.times.length-1])}this.duration=e},trim:function trim(){for(var e=0;e<this.tracks.length;e++)this.tracks[e].trim(0,this.duration);return this},optimize:function optimize(){for(var e=0;e<this.tracks.length;e++)this.tracks[e].optimize();return this}}),Object.assign(MaterialLoader.prototype,{load:function load(e,t,r,n){var i=this;new FileLoader(i.manager).load(e,function(e){t(i.parse(JSON.parse(e)))},r,n)},setTextures:function setTextures(e){this.textures=e},parse:function parse(e){var t=this.textures;function getTexture(e){return void 0===t[e]&&console.warn("THREE.MaterialLoader: Undefined texture",e),t[e]}var r=new Tr[e.type];if(void 0!==e.uuid&&(r.uuid=e.uuid),void 0!==e.name&&(r.name=e.name),void 0!==e.color&&r.color.setHex(e.color),void 0!==e.roughness&&(r.roughness=e.roughness),void 0!==e.metalness&&(r.metalness=e.metalness),void 0!==e.emissive&&r.emissive.setHex(e.emissive),void 0!==e.specular&&r.specular.setHex(e.specular),void 0!==e.shininess&&(r.shininess=e.shininess),void 0!==e.clearCoat&&(r.clearCoat=e.clearCoat),void 0!==e.clearCoatRoughness&&(r.clearCoatRoughness=e.clearCoatRoughness),void 0!==e.uniforms&&(r.uniforms=e.uniforms),void 0!==e.vertexShader&&(r.vertexShader=e.vertexShader),void 0!==e.fragmentShader&&(r.fragmentShader=e.fragmentShader),void 0!==e.vertexColors&&(r.vertexColors=e.vertexColors),void 0!==e.fog&&(r.fog=e.fog),void 0!==e.flatShading&&(r.flatShading=e.flatShading),void 0!==e.blending&&(r.blending=e.blending),void 0!==e.side&&(r.side=e.side),void 0!==e.opacity&&(r.opacity=e.opacity),void 0!==e.transparent&&(r.transparent=e.transparent),void 0!==e.alphaTest&&(r.alphaTest=e.alphaTest),void 0!==e.depthTest&&(r.depthTest=e.depthTest),void 0!==e.depthWrite&&(r.depthWrite=e.depthWrite),void 0!==e.colorWrite&&(r.colorWrite=e.colorWrite),void 0!==e.wireframe&&(r.wireframe=e.wireframe),void 0!==e.wireframeLinewidth&&(r.wireframeLinewidth=e.wireframeLinewidth),void 0!==e.wireframeLinecap&&(r.wireframeLinecap=e.wireframeLinecap),void 0!==e.wireframeLinejoin&&(r.wireframeLinejoin=e.wireframeLinejoin),void 0!==e.rotation&&(r.rotation=e.rotation),1!==e.linewidth&&(r.linewidth=e.linewidth),void 0!==e.dashSize&&(r.dashSize=e.dashSize),void 0!==e.gapSize&&(r.gapSize=e.gapSize),void 0!==e.scale&&(r.scale=e.scale),void 0!==e.polygonOffset&&(r.polygonOffset=e.polygonOffset),void 0!==e.polygonOffsetFactor&&(r.polygonOffsetFactor=e.polygonOffsetFactor),void 0!==e.polygonOffsetUnits&&(r.polygonOffsetUnits=e.polygonOffsetUnits),void 0!==e.skinning&&(r.skinning=e.skinning),void 0!==e.morphTargets&&(r.morphTargets=e.morphTargets),void 0!==e.dithering&&(r.dithering=e.dithering),void 0!==e.visible&&(r.visible=e.visible),void 0!==e.userData&&(r.userData=e.userData),void 0!==e.shading&&(r.flatShading=1===e.shading),void 0!==e.size&&(r.size=e.size),void 0!==e.sizeAttenuation&&(r.sizeAttenuation=e.sizeAttenuation),void 0!==e.map&&(r.map=getTexture(e.map)),void 0!==e.alphaMap&&(r.alphaMap=getTexture(e.alphaMap),r.transparent=!0),void 0!==e.bumpMap&&(r.bumpMap=getTexture(e.bumpMap)),void 0!==e.bumpScale&&(r.bumpScale=e.bumpScale),void 0!==e.normalMap&&(r.normalMap=getTexture(e.normalMap)),void 0!==e.normalScale){var n=e.normalScale;!1===Array.isArray(n)&&(n=[n,n]),r.normalScale=(new Vector2).fromArray(n)}return void 0!==e.displacementMap&&(r.displacementMap=getTexture(e.displacementMap)),void 0!==e.displacementScale&&(r.displacementScale=e.displacementScale),void 0!==e.displacementBias&&(r.displacementBias=e.displacementBias),void 0!==e.roughnessMap&&(r.roughnessMap=getTexture(e.roughnessMap)),void 0!==e.metalnessMap&&(r.metalnessMap=getTexture(e.metalnessMap)),void 0!==e.emissiveMap&&(r.emissiveMap=getTexture(e.emissiveMap)),void 0!==e.emissiveIntensity&&(r.emissiveIntensity=e.emissiveIntensity),void 0!==e.specularMap&&(r.specularMap=getTexture(e.specularMap)),void 0!==e.envMap&&(r.envMap=getTexture(e.envMap)),void 0!==e.reflectivity&&(r.reflectivity=e.reflectivity),void 0!==e.lightMap&&(r.lightMap=getTexture(e.lightMap)),void 0!==e.lightMapIntensity&&(r.lightMapIntensity=e.lightMapIntensity),void 0!==e.aoMap&&(r.aoMap=getTexture(e.aoMap)),void 0!==e.aoMapIntensity&&(r.aoMapIntensity=e.aoMapIntensity),void 0!==e.gradientMap&&(r.gradientMap=getTexture(e.gradientMap)),r}}),Object.assign(BufferGeometryLoader.prototype,{load:function load(e,t,r,n){var i=this;new FileLoader(i.manager).load(e,function(e){t(i.parse(JSON.parse(e)))},r,n)},parse:function parse(e){var t=new BufferGeometry,r=e.data.index;if(void 0!==r){var n=new Gr[r.type](r.array);t.setIndex(new BufferAttribute(n,1))}var i=e.data.attributes;for(var o in i){var a=i[o];n=new Gr[a.type](a.array);t.addAttribute(o,new BufferAttribute(n,a.itemSize,a.normalized))}var s=e.data.groups||e.data.drawcalls||e.data.offsets;if(void 0!==s)for(var c=0,u=s.length;c!==u;++c){var l=s[c];t.addGroup(l.start,l.count,l.materialIndex)}var h=e.data.boundingSphere;if(void 0!==h){var p=new Vector3;void 0!==h.center&&p.fromArray(h.center),t.boundingSphere=new Sphere(p,h.radius)}return t}});var Br,Vr,Dr,Ur,Gr={Int8Array:Int8Array,Uint8Array:Uint8Array,Uint8ClampedArray:"undefined"!=typeof Uint8ClampedArray?Uint8ClampedArray:Uint8Array,Int16Array:Int16Array,Uint16Array:Uint16Array,Int32Array:Int32Array,Uint32Array:Uint32Array,Float32Array:Float32Array,Float64Array:Float64Array};function Loader(){}Loader.Handlers={handlers:[],add:function add(e,t){this.handlers.push(e,t)},get:function get(e){for(var t=this.handlers,r=0,n=t.length;r<n;r+=2){var i=t[r],o=t[r+1];if(i.test(e))return o}return null}},Object.assign(Loader.prototype,{crossOrigin:void 0,onLoadStart:function onLoadStart(){},onLoadProgress:function onLoadProgress(){},onLoadComplete:function onLoadComplete(){},initMaterials:function initMaterials(e,t,r){for(var n=[],i=0;i<e.length;++i)n[i]=this.createMaterial(e[i],t,r);return n},createMaterial:(Br={NoBlending:E,NormalBlending:T,AdditiveBlending:O,SubtractiveBlending:A,MultiplyBlending:L,CustomBlending:k},Vr=new Color,Dr=new TextureLoader,Ur=new MaterialLoader,function createMaterial(e,t,r){var n={};function loadTexture(e,i,o,a,s){var c,u=t+e,l=Loader.Handlers.get(u);null!==l?c=l.load(u):(Dr.setCrossOrigin(r),c=Dr.load(u)),void 0!==i&&(c.repeat.fromArray(i),1!==i[0]&&(c.wrapS=ve),1!==i[1]&&(c.wrapT=ve)),void 0!==o&&c.offset.fromArray(o),void 0!==a&&("repeat"===a[0]&&(c.wrapS=ve),"mirror"===a[0]&&(c.wrapS=be),"repeat"===a[1]&&(c.wrapT=ve),"mirror"===a[1]&&(c.wrapT=be)),void 0!==s&&(c.anisotropy=s);var h=At.generateUUID();return n[h]=c,h}var i={uuid:At.generateUUID(),type:"MeshLambertMaterial"};for(var o in e){var a=e[o];switch(o){case"DbgColor":case"DbgIndex":case"opticalDensity":case"illumination":break;case"DbgName":i.name=a;break;case"blending":i.blending=Br[a];break;case"colorAmbient":case"mapAmbient":console.warn("THREE.Loader.createMaterial:",o,"is no longer supported.");break;case"colorDiffuse":i.color=Vr.fromArray(a).getHex();break;case"colorSpecular":i.specular=Vr.fromArray(a).getHex();break;case"colorEmissive":i.emissive=Vr.fromArray(a).getHex();break;case"specularCoef":i.shininess=a;break;case"shading":"basic"===a.toLowerCase()&&(i.type="MeshBasicMaterial"),"phong"===a.toLowerCase()&&(i.type="MeshPhongMaterial"),"standard"===a.toLowerCase()&&(i.type="MeshStandardMaterial");break;case"mapDiffuse":i.map=loadTexture(a,e.mapDiffuseRepeat,e.mapDiffuseOffset,e.mapDiffuseWrap,e.mapDiffuseAnisotropy);break;case"mapDiffuseRepeat":case"mapDiffuseOffset":case"mapDiffuseWrap":case"mapDiffuseAnisotropy":break;case"mapEmissive":i.emissiveMap=loadTexture(a,e.mapEmissiveRepeat,e.mapEmissiveOffset,e.mapEmissiveWrap,e.mapEmissiveAnisotropy);break;case"mapEmissiveRepeat":case"mapEmissiveOffset":case"mapEmissiveWrap":case"mapEmissiveAnisotropy":break;case"mapLight":i.lightMap=loadTexture(a,e.mapLightRepeat,e.mapLightOffset,e.mapLightWrap,e.mapLightAnisotropy);break;case"mapLightRepeat":case"mapLightOffset":case"mapLightWrap":case"mapLightAnisotropy":break;case"mapAO":i.aoMap=loadTexture(a,e.mapAORepeat,e.mapAOOffset,e.mapAOWrap,e.mapAOAnisotropy);break;case"mapAORepeat":case"mapAOOffset":case"mapAOWrap":case"mapAOAnisotropy":break;case"mapBump":i.bumpMap=loadTexture(a,e.mapBumpRepeat,e.mapBumpOffset,e.mapBumpWrap,e.mapBumpAnisotropy);break;case"mapBumpScale":i.bumpScale=a;break;case"mapBumpRepeat":case"mapBumpOffset":case"mapBumpWrap":case"mapBumpAnisotropy":break;case"mapNormal":i.normalMap=loadTexture(a,e.mapNormalRepeat,e.mapNormalOffset,e.mapNormalWrap,e.mapNormalAnisotropy);break;case"mapNormalFactor":i.normalScale=a;break;case"mapNormalRepeat":case"mapNormalOffset":case"mapNormalWrap":case"mapNormalAnisotropy":break;case"mapSpecular":i.specularMap=loadTexture(a,e.mapSpecularRepeat,e.mapSpecularOffset,e.mapSpecularWrap,e.mapSpecularAnisotropy);break;case"mapSpecularRepeat":case"mapSpecularOffset":case"mapSpecularWrap":case"mapSpecularAnisotropy":break;case"mapMetalness":i.metalnessMap=loadTexture(a,e.mapMetalnessRepeat,e.mapMetalnessOffset,e.mapMetalnessWrap,e.mapMetalnessAnisotropy);break;case"mapMetalnessRepeat":case"mapMetalnessOffset":case"mapMetalnessWrap":case"mapMetalnessAnisotropy":break;case"mapRoughness":i.roughnessMap=loadTexture(a,e.mapRoughnessRepeat,e.mapRoughnessOffset,e.mapRoughnessWrap,e.mapRoughnessAnisotropy);break;case"mapRoughnessRepeat":case"mapRoughnessOffset":case"mapRoughnessWrap":case"mapRoughnessAnisotropy":break;case"mapAlpha":i.alphaMap=loadTexture(a,e.mapAlphaRepeat,e.mapAlphaOffset,e.mapAlphaWrap,e.mapAlphaAnisotropy);break;case"mapAlphaRepeat":case"mapAlphaOffset":case"mapAlphaWrap":case"mapAlphaAnisotropy":break;case"flipSided":i.side=x;break;case"doubleSided":i.side=M;break;case"transparency":console.warn("THREE.Loader.createMaterial: transparency has been renamed to opacity"),i.opacity=a;break;case"depthTest":case"depthWrite":case"colorWrite":case"opacity":case"reflectivity":case"transparent":case"visible":case"wireframe":i[o]=a;break;case"vertexColors":!0===a&&(i.vertexColors=P),"face"===a&&(i.vertexColors=C);break;default:console.error("THREE.Loader.createMaterial: Unsupported",o,a)}}return"MeshBasicMaterial"===i.type&&delete i.emissive,"MeshPhongMaterial"!==i.type&&delete i.specular,i.opacity<1&&(i.transparent=!0),Ur.setTextures(n),Ur.parse(i)})});var zr=function extractUrlBase(e){var t=e.split("/");return 1===t.length?"./":(t.pop(),t.join("/")+"/")};function JSONLoader(e){"boolean"==typeof e&&(console.warn("THREE.JSONLoader: showStatus parameter has been removed from constructor."),e=void 0),this.manager=void 0!==e?e:Ar,this.withCredentials=!1}Object.assign(JSONLoader.prototype,{load:function load(e,t,r,n){var i=this,o=this.texturePath&&"string"==typeof this.texturePath?this.texturePath:zr(e),a=new FileLoader(this.manager);a.setWithCredentials(this.withCredentials),a.load(e,function(r){var n=JSON.parse(r),a=n.metadata;if(void 0!==a){var s=a.type;if(void 0!==s&&"object"===s.toLowerCase())return void console.error("THREE.JSONLoader: "+e+" should be loaded with THREE.ObjectLoader instead.")}var c=i.parse(n,o);t(c.geometry,c.materials)},r,n)},setTexturePath:function setTexturePath(e){this.texturePath=e},parse:function(){return function parse(e,t){void 0!==e.data&&(e=e.data),void 0!==e.scale?e.scale=1/e.scale:e.scale=1;var r=new Geometry;return function parseModel(e,t){function isBitSet(e,t){return e&1<<t}var r,n,i,o,a,s,c,u,l,h,p,f,d,m,g,y,v,_,b,w,x,M,S,C,P,E=e.faces,T=e.vertices,O=e.normals,A=e.colors,L=e.scale,k=0;if(void 0!==e.uvs){for(r=0;r<e.uvs.length;r++)e.uvs[r].length&&k++;for(r=0;r<k;r++)t.faceVertexUvs[r]=[]}for(o=0,a=T.length;o<a;)(_=new Vector3).x=T[o++]*L,_.y=T[o++]*L,_.z=T[o++]*L,t.vertices.push(_);for(o=0,a=E.length;o<a;)if(p=isBitSet(h=E[o++],0),f=isBitSet(h,1),d=isBitSet(h,3),m=isBitSet(h,4),g=isBitSet(h,5),y=isBitSet(h,6),v=isBitSet(h,7),p){if((w=new Face3).a=E[o],w.b=E[o+1],w.c=E[o+3],(x=new Face3).a=E[o+1],x.b=E[o+2],x.c=E[o+3],o+=4,f&&(l=E[o++],w.materialIndex=l,x.materialIndex=l),i=t.faces.length,d)for(r=0;r<k;r++)for(C=e.uvs[r],t.faceVertexUvs[r][i]=[],t.faceVertexUvs[r][i+1]=[],n=0;n<4;n++)P=new Vector2(C[2*(u=E[o++])],C[2*u+1]),2!==n&&t.faceVertexUvs[r][i].push(P),0!==n&&t.faceVertexUvs[r][i+1].push(P);if(m&&(c=3*E[o++],w.normal.set(O[c++],O[c++],O[c]),x.normal.copy(w.normal)),g)for(r=0;r<4;r++)c=3*E[o++],S=new Vector3(O[c++],O[c++],O[c]),2!==r&&w.vertexNormals.push(S),0!==r&&x.vertexNormals.push(S);if(y&&(M=A[s=E[o++]],w.color.setHex(M),x.color.setHex(M)),v)for(r=0;r<4;r++)M=A[s=E[o++]],2!==r&&w.vertexColors.push(new Color(M)),0!==r&&x.vertexColors.push(new Color(M));t.faces.push(w),t.faces.push(x)}else{if((b=new Face3).a=E[o++],b.b=E[o++],b.c=E[o++],f&&(l=E[o++],b.materialIndex=l),i=t.faces.length,d)for(r=0;r<k;r++)for(C=e.uvs[r],t.faceVertexUvs[r][i]=[],n=0;n<3;n++)P=new Vector2(C[2*(u=E[o++])],C[2*u+1]),t.faceVertexUvs[r][i].push(P);if(m&&(c=3*E[o++],b.normal.set(O[c++],O[c++],O[c])),g)for(r=0;r<3;r++)c=3*E[o++],S=new Vector3(O[c++],O[c++],O[c]),b.vertexNormals.push(S);if(y&&(s=E[o++],b.color.setHex(A[s])),v)for(r=0;r<3;r++)s=E[o++],b.vertexColors.push(new Color(A[s]));t.faces.push(b)}}(e,r),function parseSkin(e,t){var r=void 0!==e.influencesPerVertex?e.influencesPerVertex:2;if(e.skinWeights)for(var n=0,i=e.skinWeights.length;n<i;n+=r){var o=e.skinWeights[n],a=r>1?e.skinWeights[n+1]:0,s=r>2?e.skinWeights[n+2]:0,c=r>3?e.skinWeights[n+3]:0;t.skinWeights.push(new Vector4(o,a,s,c))}if(e.skinIndices)for(n=0,i=e.skinIndices.length;n<i;n+=r){var u=e.skinIndices[n],l=r>1?e.skinIndices[n+1]:0,h=r>2?e.skinIndices[n+2]:0,p=r>3?e.skinIndices[n+3]:0;t.skinIndices.push(new Vector4(u,l,h,p))}t.bones=e.bones,t.bones&&t.bones.length>0&&(t.skinWeights.length!==t.skinIndices.length||t.skinIndices.length!==t.vertices.length)&&console.warn("When skinning, number of vertices ("+t.vertices.length+"), skinIndices ("+t.skinIndices.length+"), and skinWeights ("+t.skinWeights.length+") should match.")}(e,r),function parseMorphing(e,t){var r=e.scale;if(void 0!==e.morphTargets)for(var n=0,i=e.morphTargets.length;n<i;n++){t.morphTargets[n]={},t.morphTargets[n].name=e.morphTargets[n].name,t.morphTargets[n].vertices=[];for(var o=t.morphTargets[n].vertices,a=e.morphTargets[n].vertices,s=0,c=a.length;s<c;s+=3){var u=new Vector3;u.x=a[s]*r,u.y=a[s+1]*r,u.z=a[s+2]*r,o.push(u)}}if(void 0!==e.morphColors&&e.morphColors.length>0){console.warn('THREE.JSONLoader: "morphColors" no longer supported. Using them as face colors.');var l=t.faces,h=e.morphColors[0].colors;for(n=0,i=l.length;n<i;n++)l[n].color.fromArray(h,3*n)}}(e,r),function parseAnimations(e,t){var r=[],n=[];void 0!==e.animation&&n.push(e.animation),void 0!==e.animations&&(e.animations.length?n=n.concat(e.animations):n.push(e.animations));for(var i=0;i<n.length;i++){var o=AnimationClip.parseAnimation(n[i],t.bones);o&&r.push(o)}if(t.morphTargets){var a=AnimationClip.CreateClipsFromMorphTargetSequences(t.morphTargets,10);r=r.concat(a)}r.length>0&&(t.animations=r)}(e,r),r.computeFaceNormals(),r.computeBoundingSphere(),void 0===e.materials||0===e.materials.length?{geometry:r}:{geometry:r,materials:Loader.prototype.initMaterials(e.materials,t,this.crossOrigin)}}}()}),Object.assign(function ObjectLoader(e){this.manager=void 0!==e?e:Ar,this.texturePath=""}.prototype,{load:function load(e,t,r,n){""===this.texturePath&&(this.texturePath=e.substring(0,e.lastIndexOf("/")+1));var i=this;new FileLoader(i.manager).load(e,function(r){var o=null;try{o=JSON.parse(r)}catch(t){return void 0!==n&&n(t),void console.error("THREE:ObjectLoader: Can't parse "+e+".",t.message)}var a=o.metadata;void 0!==a&&void 0!==a.type&&"geometry"!==a.type.toLowerCase()?i.parse(o,t):console.error("THREE.ObjectLoader: Can't load "+e+". Use THREE.JSONLoader instead.")},r,n)},setTexturePath:function setTexturePath(e){this.texturePath=e},setCrossOrigin:function setCrossOrigin(e){this.crossOrigin=e},parse:function parse(e,t){var r=this.parseShape(e.shapes),n=this.parseGeometries(e.geometries,r),i=this.parseImages(e.images,function(){void 0!==t&&t(s)}),o=this.parseTextures(e.textures,i),a=this.parseMaterials(e.materials,o),s=this.parseObject(e.object,n,a);return e.animations&&(s.animations=this.parseAnimations(e.animations)),void 0!==e.images&&0!==e.images.length||void 0!==t&&t(s),s},parseShape:function parseShape(e){var t={};if(void 0!==e)for(var r=0,n=e.length;r<n;r++){var i=(new Shape).fromJSON(e[r]);t[i.uuid]=i}return t},parseGeometries:function parseGeometries(e,t){var r={};if(void 0!==e)for(var n=new JSONLoader,i=new BufferGeometryLoader,o=0,a=e.length;o<a;o++){var s,c=e[o];switch(c.type){case"PlaneGeometry":case"PlaneBufferGeometry":s=new Er[c.type](c.width,c.height,c.widthSegments,c.heightSegments);break;case"BoxGeometry":case"BoxBufferGeometry":case"CubeGeometry":s=new Er[c.type](c.width,c.height,c.depth,c.widthSegments,c.heightSegments,c.depthSegments);break;case"CircleGeometry":case"CircleBufferGeometry":s=new Er[c.type](c.radius,c.segments,c.thetaStart,c.thetaLength);break;case"CylinderGeometry":case"CylinderBufferGeometry":s=new Er[c.type](c.radiusTop,c.radiusBottom,c.height,c.radialSegments,c.heightSegments,c.openEnded,c.thetaStart,c.thetaLength);break;case"ConeGeometry":case"ConeBufferGeometry":s=new Er[c.type](c.radius,c.height,c.radialSegments,c.heightSegments,c.openEnded,c.thetaStart,c.thetaLength);break;case"SphereGeometry":case"SphereBufferGeometry":s=new Er[c.type](c.radius,c.widthSegments,c.heightSegments,c.phiStart,c.phiLength,c.thetaStart,c.thetaLength);break;case"DodecahedronGeometry":case"DodecahedronBufferGeometry":case"IcosahedronGeometry":case"IcosahedronBufferGeometry":case"OctahedronGeometry":case"OctahedronBufferGeometry":case"TetrahedronGeometry":case"TetrahedronBufferGeometry":s=new Er[c.type](c.radius,c.detail);break;case"RingGeometry":case"RingBufferGeometry":s=new Er[c.type](c.innerRadius,c.outerRadius,c.thetaSegments,c.phiSegments,c.thetaStart,c.thetaLength);break;case"TorusGeometry":case"TorusBufferGeometry":s=new Er[c.type](c.radius,c.tube,c.radialSegments,c.tubularSegments,c.arc);break;case"TorusKnotGeometry":case"TorusKnotBufferGeometry":s=new Er[c.type](c.radius,c.tube,c.tubularSegments,c.radialSegments,c.p,c.q);break;case"LatheGeometry":case"LatheBufferGeometry":s=new Er[c.type](c.points,c.segments,c.phiStart,c.phiLength);break;case"PolyhedronGeometry":case"PolyhedronBufferGeometry":s=new Er[c.type](c.vertices,c.indices,c.radius,c.details);break;case"ShapeGeometry":case"ShapeBufferGeometry":var u=[];for(o=0,a=c.shapes.length;o<a;o++){var l=t[c.shapes[o]];u.push(l)}s=new Er[c.type](u,c.curveSegments);break;case"BufferGeometry":s=i.parse(c);break;case"Geometry":s=n.parse(c,this.texturePath).geometry;break;default:console.warn('THREE.ObjectLoader: Unsupported geometry type "'+c.type+'"');continue}s.uuid=c.uuid,void 0!==c.name&&(s.name=c.name),r[c.uuid]=s}return r},parseMaterials:function parseMaterials(e,t){var r={};if(void 0!==e){var n=new MaterialLoader;n.setTextures(t);for(var i=0,o=e.length;i<o;i++){var a=e[i];if("MultiMaterial"===a.type){for(var s=[],c=0;c<a.materials.length;c++)s.push(n.parse(a.materials[c]));r[a.uuid]=s}else r[a.uuid]=n.parse(a)}}return r},parseAnimations:function parseAnimations(e){for(var t=[],r=0;r<e.length;r++){var n=AnimationClip.parse(e[r]);t.push(n)}return t},parseImages:function parseImages(e,t){var r=this,n={};function loadImage(e){return r.manager.itemStart(e),i.load(e,function(){r.manager.itemEnd(e)},void 0,function(){r.manager.itemEnd(e),r.manager.itemError(e)})}if(void 0!==e&&e.length>0){var i=new ImageLoader(new LoadingManager(t));i.setCrossOrigin(this.crossOrigin);for(var o=0,a=e.length;o<a;o++){var s=e[o],c=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(s.url)?s.url:r.texturePath+s.url;n[s.uuid]=loadImage(c)}}return n},parseTextures:function parseTextures(e,t){function parseConstant(e,t){return"number"==typeof e?e:(console.warn("THREE.ObjectLoader.parseTexture: Constant should be in numeric form.",e),t[e])}var r={};if(void 0!==e)for(var n=0,i=e.length;n<i;n++){var o=e[n];void 0===o.image&&console.warn('THREE.ObjectLoader: No "image" specified for',o.uuid),void 0===t[o.image]&&console.warn("THREE.ObjectLoader: Undefined image",o.image);var a=new Texture(t[o.image]);a.needsUpdate=!0,a.uuid=o.uuid,void 0!==o.name&&(a.name=o.name),void 0!==o.mapping&&(a.mapping=parseConstant(o.mapping,Wr)),void 0!==o.offset&&a.offset.fromArray(o.offset),void 0!==o.repeat&&a.repeat.fromArray(o.repeat),void 0!==o.center&&a.center.fromArray(o.center),void 0!==o.rotation&&(a.rotation=o.rotation),void 0!==o.wrap&&(a.wrapS=parseConstant(o.wrap[0],qr),a.wrapT=parseConstant(o.wrap[1],qr)),void 0!==o.format&&(a.format=o.format),void 0!==o.minFilter&&(a.minFilter=parseConstant(o.minFilter,Xr)),void 0!==o.magFilter&&(a.magFilter=parseConstant(o.magFilter,Xr)),void 0!==o.anisotropy&&(a.anisotropy=o.anisotropy),void 0!==o.flipY&&(a.flipY=o.flipY),r[o.uuid]=a}return r},parseObject:function parseObject(e,t,r){var n;function getGeometry(e){return void 0===t[e]&&console.warn("THREE.ObjectLoader: Undefined geometry",e),t[e]}function getMaterial(e){if(void 0!==e){if(Array.isArray(e)){for(var t=[],n=0,i=e.length;n<i;n++){var o=e[n];void 0===r[o]&&console.warn("THREE.ObjectLoader: Undefined material",o),t.push(r[o])}return t}return void 0===r[e]&&console.warn("THREE.ObjectLoader: Undefined material",e),r[e]}}switch(e.type){case"Scene":n=new Scene,void 0!==e.background&&Number.isInteger(e.background)&&(n.background=new Color(e.background)),void 0!==e.fog&&("Fog"===e.fog.type?n.fog=new Fog(e.fog.color,e.fog.near,e.fog.far):"FogExp2"===e.fog.type&&(n.fog=new FogExp2(e.fog.color,e.fog.density)));break;case"PerspectiveCamera":n=new PerspectiveCamera(e.fov,e.aspect,e.near,e.far),void 0!==e.focus&&(n.focus=e.focus),void 0!==e.zoom&&(n.zoom=e.zoom),void 0!==e.filmGauge&&(n.filmGauge=e.filmGauge),void 0!==e.filmOffset&&(n.filmOffset=e.filmOffset),void 0!==e.view&&(n.view=Object.assign({},e.view));break;case"OrthographicCamera":n=new OrthographicCamera(e.left,e.right,e.top,e.bottom,e.near,e.far),void 0!==e.zoom&&(n.zoom=e.zoom),void 0!==e.view&&(n.view=Object.assign({},e.view));break;case"AmbientLight":n=new AmbientLight(e.color,e.intensity);break;case"DirectionalLight":n=new DirectionalLight(e.color,e.intensity);break;case"PointLight":n=new PointLight(e.color,e.intensity,e.distance,e.decay);break;case"RectAreaLight":n=new RectAreaLight(e.color,e.intensity,e.width,e.height);break;case"SpotLight":n=new SpotLight(e.color,e.intensity,e.distance,e.angle,e.penumbra,e.decay);break;case"HemisphereLight":n=new HemisphereLight(e.color,e.groundColor,e.intensity);break;case"SkinnedMesh":console.warn("THREE.ObjectLoader.parseObject() does not support SkinnedMesh yet.");case"Mesh":var i=getGeometry(e.geometry),o=getMaterial(e.material);n=i.bones&&i.bones.length>0?new SkinnedMesh(i,o):new Mesh(i,o);break;case"LOD":n=new LOD;break;case"Line":n=new Line(getGeometry(e.geometry),getMaterial(e.material),e.mode);break;case"LineLoop":n=new LineLoop(getGeometry(e.geometry),getMaterial(e.material));break;case"LineSegments":n=new LineSegments(getGeometry(e.geometry),getMaterial(e.material));break;case"PointCloud":case"Points":n=new Points(getGeometry(e.geometry),getMaterial(e.material));break;case"Sprite":n=new Sprite(getMaterial(e.material));break;case"Group":n=new Group;break;default:n=new Object3D}if(n.uuid=e.uuid,void 0!==e.name&&(n.name=e.name),void 0!==e.matrix?(n.matrix.fromArray(e.matrix),n.matrix.decompose(n.position,n.quaternion,n.scale)):(void 0!==e.position&&n.position.fromArray(e.position),void 0!==e.rotation&&n.rotation.fromArray(e.rotation),void 0!==e.quaternion&&n.quaternion.fromArray(e.quaternion),void 0!==e.scale&&n.scale.fromArray(e.scale)),void 0!==e.castShadow&&(n.castShadow=e.castShadow),void 0!==e.receiveShadow&&(n.receiveShadow=e.receiveShadow),e.shadow&&(void 0!==e.shadow.bias&&(n.shadow.bias=e.shadow.bias),void 0!==e.shadow.radius&&(n.shadow.radius=e.shadow.radius),void 0!==e.shadow.mapSize&&n.shadow.mapSize.fromArray(e.shadow.mapSize),void 0!==e.shadow.camera&&(n.shadow.camera=this.parseObject(e.shadow.camera))),void 0!==e.visible&&(n.visible=e.visible),void 0!==e.frustumCulled&&(n.frustumCulled=e.frustumCulled),void 0!==e.renderOrder&&(n.renderOrder=e.renderOrder),void 0!==e.userData&&(n.userData=e.userData),void 0!==e.children)for(var a=e.children,s=0;s<a.length;s++)n.add(this.parseObject(a[s],t,r));if("LOD"===e.type)for(var c=e.levels,u=0;u<c.length;u++){var l=c[u],h=n.getObjectByProperty("uuid",l.object);void 0!==h&&n.addLevel(h,l.distance)}return n}});var Hr,Wr={UVMapping:300,CubeReflectionMapping:he,CubeRefractionMapping:pe,EquirectangularReflectionMapping:fe,EquirectangularRefractionMapping:de,SphericalReflectionMapping:me,CubeUVReflectionMapping:ge,CubeUVRefractionMapping:ye},qr={RepeatWrapping:ve,ClampToEdgeWrapping:_e,MirroredRepeatWrapping:be},Xr={NearestFilter:we,NearestMipMapNearestFilter:xe,NearestMipMapLinearFilter:Me,LinearFilter:Se,LinearMipMapNearestFilter:Ce,LinearMipMapLinearFilter:Pe};function ImageBitmapLoader(e){"undefined"==typeof createImageBitmap&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),"undefined"==typeof fetch&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),this.manager=void 0!==e?e:Ar,this.options=void 0}function ShapePath(){this.type="ShapePath",this.subPaths=[],this.currentPath=null}function Font(e){this.type="Font",this.data=e}function createPath(e,t,r,n,i,o){var a=o.glyphs[e]||o.glyphs["?"];if(a){var s,c,u,l,h,p,f,d,m=new ShapePath;if(a.o)for(var g=a._cachedOutline||(a._cachedOutline=a.o.split(" ")),y=0,v=g.length;y<v;){switch(g[y++]){case"m":s=g[y++]*r+n,c=g[y++]*r+i,m.moveTo(s,c);break;case"l":s=g[y++]*r+n,c=g[y++]*r+i,m.lineTo(s,c);break;case"q":u=g[y++]*r+n,l=g[y++]*r+i,h=g[y++]*r+n,p=g[y++]*r+i,m.quadraticCurveTo(h,p,u,l);break;case"b":u=g[y++]*r+n,l=g[y++]*r+i,h=g[y++]*r+n,p=g[y++]*r+i,f=g[y++]*r+n,d=g[y++]*r+i,m.bezierCurveTo(h,p,f,d,u,l)}}return{offsetX:a.ha*r,path:m}}}ImageBitmapLoader.prototype={constructor:ImageBitmapLoader,setOptions:function setOptions(e){return this.options=e,this},load:function load(e,t,r,n){void 0===e&&(e=""),void 0!==this.path&&(e=this.path+e);var i=this,o=Or.get(e);if(void 0!==o)return i.manager.itemStart(e),setTimeout(function(){t&&t(o),i.manager.itemEnd(e)},0),o;fetch(e).then(function(e){return e.blob()}).then(function(e){return createImageBitmap(e,i.options)}).then(function(r){Or.add(e,r),t&&t(r),i.manager.itemEnd(e)}).catch(function(t){n&&n(t),i.manager.itemEnd(e),i.manager.itemError(e)})},setCrossOrigin:function setCrossOrigin(){return this},setPath:function setPath(e){return this.path=e,this}},Object.assign(ShapePath.prototype,{moveTo:function moveTo(e,t){this.currentPath=new Path,this.subPaths.push(this.currentPath),this.currentPath.moveTo(e,t)},lineTo:function lineTo(e,t){this.currentPath.lineTo(e,t)},quadraticCurveTo:function quadraticCurveTo(e,t,r,n){this.currentPath.quadraticCurveTo(e,t,r,n)},bezierCurveTo:function bezierCurveTo(e,t,r,n,i,o){this.currentPath.bezierCurveTo(e,t,r,n,i,o)},splineThru:function splineThru(e){this.currentPath.splineThru(e)},toShapes:function toShapes(e,t){function toShapesNoHoles(e){for(var t=[],r=0,n=e.length;r<n;r++){var i=e[r],o=new Shape;o.curves=i.curves,t.push(o)}return t}function isPointInsidePolygon(e,t){for(var r=t.length,n=!1,i=r-1,o=0;o<r;i=o++){var a=t[i],s=t[o],c=s.x-a.x,u=s.y-a.y;if(Math.abs(u)>Number.EPSILON){if(u<0&&(a=t[o],c=-c,s=t[i],u=-u),e.y<a.y||e.y>s.y)continue;if(e.y===a.y){if(e.x===a.x)return!0}else{var l=u*(e.x-a.x)-c*(e.y-a.y);if(0===l)return!0;if(l<0)continue;n=!n}}else{if(e.y!==a.y)continue;if(s.x<=e.x&&e.x<=a.x||a.x<=e.x&&e.x<=s.x)return!0}}return n}var r=Pr.isClockWise,n=this.subPaths;if(0===n.length)return[];if(!0===t)return toShapesNoHoles(n);var i,o,a,s=[];if(1===n.length)return o=n[0],(a=new Shape).curves=o.curves,s.push(a),s;var c=!r(n[0].getPoints());c=e?!c:c;var u,l,h=[],p=[],f=[],d=0;p[d]=void 0,f[d]=[];for(var m=0,g=n.length;m<g;m++)i=r(u=(o=n[m]).getPoints()),(i=e?!i:i)?(!c&&p[d]&&d++,p[d]={s:new Shape,p:u},p[d].s.curves=o.curves,c&&d++,f[d]=[]):f[d].push({h:o,p:u[0]});if(!p[0])return toShapesNoHoles(n);if(p.length>1){for(var y=!1,v=[],_=0,b=p.length;_<b;_++)h[_]=[];for(_=0,b=p.length;_<b;_++)for(var w=f[_],x=0;x<w.length;x++){for(var M=w[x],S=!0,C=0;C<p.length;C++)isPointInsidePolygon(M.p,p[C].p)&&(_!==C&&v.push({froms:_,tos:C,hole:x}),S?(S=!1,h[C].push(M)):y=!0);S&&h[_].push(M)}v.length>0&&(y||(f=h))}m=0;for(var P=p.length;m<P;m++){a=p[m].s,s.push(a);for(var E=0,T=(l=f[m]).length;E<T;E++)a.holes.push(l[E].h)}return s}}),Object.assign(Font.prototype,{isFont:!0,generateShapes:function generateShapes(e,t,r){void 0===t&&(t=100),void 0===r&&(r=4);for(var n=[],i=function createPaths(e,t,r,n){for(var i=String(e).split(""),o=t/n.resolution,a=(n.boundingBox.yMax-n.boundingBox.yMin+n.underlineThickness)*o,s=[],c=0,u=0,l=0;l<i.length;l++){var h=i[l];if("\n"===h)c=0,u-=a;else{var p=createPath(h,r,o,c,u,n);c+=p.offsetX,s.push(p.path)}}return s}(e,t,r,this.data),o=0,a=i.length;o<a;o++)Array.prototype.push.apply(n,i[o].toShapes());return n}}),Object.assign(function FontLoader(e){this.manager=void 0!==e?e:Ar}.prototype,{load:function load(e,t,r,n){var i=this,o=new FileLoader(this.manager);o.setPath(this.path),o.load(e,function(e){var r;try{r=JSON.parse(e)}catch(t){console.warn("THREE.FontLoader: typeface.js support is being deprecated. Use typeface.json instead."),r=JSON.parse(e.substring(65,e.length-2))}var n=i.parse(r);t&&t(n)},r,n)},parse:function parse(e){return new Font(e)},setPath:function setPath(e){return this.path=e,this}});var Yr,Jr,Zr,Kr,Qr,$r,en,tn,rn,nn,on={getContext:function getContext(){return void 0===Hr&&(Hr=new(window.AudioContext||window.webkitAudioContext)),Hr},setContext:function setContext(e){Hr=e}};function AudioLoader(e){this.manager=void 0!==e?e:Ar}function CubeCamera(e,t,r){Object3D.call(this),this.type="CubeCamera";var n=new PerspectiveCamera(90,1,e,t);n.up.set(0,-1,0),n.lookAt(new Vector3(1,0,0)),this.add(n);var i=new PerspectiveCamera(90,1,e,t);i.up.set(0,-1,0),i.lookAt(new Vector3(-1,0,0)),this.add(i);var o=new PerspectiveCamera(90,1,e,t);o.up.set(0,0,1),o.lookAt(new Vector3(0,1,0)),this.add(o);var a=new PerspectiveCamera(90,1,e,t);a.up.set(0,0,-1),a.lookAt(new Vector3(0,-1,0)),this.add(a);var s=new PerspectiveCamera(90,1,e,t);s.up.set(0,-1,0),s.lookAt(new Vector3(0,0,1)),this.add(s);var c=new PerspectiveCamera(90,1,e,t);c.up.set(0,-1,0),c.lookAt(new Vector3(0,0,-1)),this.add(c);var u={format:De,magFilter:Se,minFilter:Se};this.renderTarget=new WebGLRenderTargetCube(r,r,u),this.renderTarget.texture.name="CubeCamera",this.update=function(e,t){null===this.parent&&this.updateMatrixWorld();var r=this.renderTarget,u=r.texture.generateMipmaps;r.texture.generateMipmaps=!1,r.activeCubeFace=0,e.render(t,n,r),r.activeCubeFace=1,e.render(t,i,r),r.activeCubeFace=2,e.render(t,o,r),r.activeCubeFace=3,e.render(t,a,r),r.activeCubeFace=4,e.render(t,s,r),r.texture.generateMipmaps=u,r.activeCubeFace=5,e.render(t,c,r),e.setRenderTarget(null)},this.clear=function(e,t,r,n){for(var i=this.renderTarget,o=0;o<6;o++)i.activeCubeFace=o,e.setRenderTarget(i),e.clear(t,r,n);e.setRenderTarget(null)}}function AudioListener(){Object3D.call(this),this.type="AudioListener",this.context=on.getContext(),this.gain=this.context.createGain(),this.gain.connect(this.context.destination),this.filter=null}function Audio(e){Object3D.call(this),this.type="Audio",this.context=e.context,this.gain=this.context.createGain(),this.gain.connect(e.getInput()),this.autoplay=!1,this.buffer=null,this.loop=!1,this.startTime=0,this.offset=0,this.playbackRate=1,this.isPlaying=!1,this.hasPlaybackControl=!0,this.sourceType="empty",this.filters=[]}function PositionalAudio(e){Audio.call(this,e),this.panner=this.context.createPanner(),this.panner.connect(this.gain)}function AudioAnalyser(e,t){this.analyser=e.context.createAnalyser(),this.analyser.fftSize=void 0!==t?t:2048,this.data=new Uint8Array(this.analyser.frequencyBinCount),e.getOutput().connect(this.analyser)}function PropertyMixer(e,t,r){this.binding=e,this.valueSize=r;var n,i=Float64Array;switch(t){case"quaternion":n=this._slerp;break;case"string":case"bool":i=Array,n=this._select;break;default:n=this._lerp}this.buffer=new i(4*r),this._mixBufferRegion=n,this.cumulativeWeight=0,this.useCount=0,this.referenceCount=0}Object.assign(AudioLoader.prototype,{load:function load(e,t,r,n){var i=new FileLoader(this.manager);i.setResponseType("arraybuffer"),i.load(e,function(e){on.getContext().decodeAudioData(e,function(e){t(e)})},r,n)}}),Object.assign(function StereoCamera(){this.type="StereoCamera",this.aspect=1,this.eyeSep=.064,this.cameraL=new PerspectiveCamera,this.cameraL.layers.enable(1),this.cameraL.matrixAutoUpdate=!1,this.cameraR=new PerspectiveCamera,this.cameraR.layers.enable(2),this.cameraR.matrixAutoUpdate=!1}.prototype,{update:(rn=new Matrix4,nn=new Matrix4,function update(e){if(Yr!==this||Jr!==e.focus||Zr!==e.fov||Kr!==e.aspect*this.aspect||Qr!==e.near||$r!==e.far||en!==e.zoom||tn!==this.eyeSep){Yr=this,Jr=e.focus,Zr=e.fov,Kr=e.aspect*this.aspect,Qr=e.near,$r=e.far,en=e.zoom;var t,r,n=e.projectionMatrix.clone(),i=(tn=this.eyeSep/2)*Qr/Jr,o=Qr*Math.tan(At.DEG2RAD*Zr*.5)/en;nn.elements[12]=-tn,rn.elements[12]=tn,t=-o*Kr+i,r=o*Kr+i,n.elements[0]=2*Qr/(r-t),n.elements[8]=(r+t)/(r-t),this.cameraL.projectionMatrix.copy(n),t=-o*Kr-i,r=o*Kr-i,n.elements[0]=2*Qr/(r-t),n.elements[8]=(r+t)/(r-t),this.cameraR.projectionMatrix.copy(n)}this.cameraL.matrixWorld.copy(e.matrixWorld).multiply(nn),this.cameraR.matrixWorld.copy(e.matrixWorld).multiply(rn)})}),CubeCamera.prototype=Object.create(Object3D.prototype),CubeCamera.prototype.constructor=CubeCamera,AudioListener.prototype=Object.assign(Object.create(Object3D.prototype),{constructor:AudioListener,getInput:function getInput(){return this.gain},removeFilter:function removeFilter(){null!==this.filter&&(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination),this.gain.connect(this.context.destination),this.filter=null)},getFilter:function getFilter(){return this.filter},setFilter:function setFilter(e){null!==this.filter?(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination)):this.gain.disconnect(this.context.destination),this.filter=e,this.gain.connect(this.filter),this.filter.connect(this.context.destination)},getMasterVolume:function getMasterVolume(){return this.gain.gain.value},setMasterVolume:function setMasterVolume(e){this.gain.gain.value=e},updateMatrixWorld:function(){var e=new Vector3,t=new Quaternion,r=new Vector3,n=new Vector3;return function updateMatrixWorld(i){Object3D.prototype.updateMatrixWorld.call(this,i);var o=this.context.listener,a=this.up;this.matrixWorld.decompose(e,t,r),n.set(0,0,-1).applyQuaternion(t),o.positionX?(o.positionX.setValueAtTime(e.x,this.context.currentTime),o.positionY.setValueAtTime(e.y,this.context.currentTime),o.positionZ.setValueAtTime(e.z,this.context.currentTime),o.forwardX.setValueAtTime(n.x,this.context.currentTime),o.forwardY.setValueAtTime(n.y,this.context.currentTime),o.forwardZ.setValueAtTime(n.z,this.context.currentTime),o.upX.setValueAtTime(a.x,this.context.currentTime),o.upY.setValueAtTime(a.y,this.context.currentTime),o.upZ.setValueAtTime(a.z,this.context.currentTime)):(o.setPosition(e.x,e.y,e.z),o.setOrientation(n.x,n.y,n.z,a.x,a.y,a.z))}}()}),Audio.prototype=Object.assign(Object.create(Object3D.prototype),{constructor:Audio,getOutput:function getOutput(){return this.gain},setNodeSource:function setNodeSource(e){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=e,this.connect(),this},setBuffer:function setBuffer(e){return this.buffer=e,this.sourceType="buffer",this.autoplay&&this.play(),this},play:function play(){if(!0!==this.isPlaying){if(!1!==this.hasPlaybackControl){var e=this.context.createBufferSource();return e.buffer=this.buffer,e.loop=this.loop,e.onended=this.onEnded.bind(this),e.playbackRate.setValueAtTime(this.playbackRate,this.startTime),this.startTime=this.context.currentTime,e.start(this.startTime,this.offset),this.isPlaying=!0,this.source=e,this.connect()}console.warn("THREE.Audio: this Audio has no playback control.")}else console.warn("THREE.Audio: Audio is already playing.")},pause:function pause(){if(!1!==this.hasPlaybackControl)return!0===this.isPlaying&&(this.source.stop(),this.offset+=(this.context.currentTime-this.startTime)*this.playbackRate,this.isPlaying=!1),this;console.warn("THREE.Audio: this Audio has no playback control.")},stop:function stop(){if(!1!==this.hasPlaybackControl)return this.source.stop(),this.offset=0,this.isPlaying=!1,this;console.warn("THREE.Audio: this Audio has no playback control.")},connect:function connect(){if(this.filters.length>0){this.source.connect(this.filters[0]);for(var e=1,t=this.filters.length;e<t;e++)this.filters[e-1].connect(this.filters[e]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this},disconnect:function disconnect(){if(this.filters.length>0){this.source.disconnect(this.filters[0]);for(var e=1,t=this.filters.length;e<t;e++)this.filters[e-1].disconnect(this.filters[e]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this},getFilters:function getFilters(){return this.filters},setFilters:function setFilters(e){return e||(e=[]),!0===this.isPlaying?(this.disconnect(),this.filters=e,this.connect()):this.filters=e,this},getFilter:function getFilter(){return this.getFilters()[0]},setFilter:function setFilter(e){return this.setFilters(e?[e]:[])},setPlaybackRate:function setPlaybackRate(e){if(!1!==this.hasPlaybackControl)return this.playbackRate=e,!0===this.isPlaying&&this.source.playbackRate.setValueAtTime(this.playbackRate,this.context.currentTime),this;console.warn("THREE.Audio: this Audio has no playback control.")},getPlaybackRate:function getPlaybackRate(){return this.playbackRate},onEnded:function onEnded(){this.isPlaying=!1},getLoop:function getLoop(){return!1===this.hasPlaybackControl?(console.warn("THREE.Audio: this Audio has no playback control."),!1):this.loop},setLoop:function setLoop(e){if(!1!==this.hasPlaybackControl)return this.loop=e,!0===this.isPlaying&&(this.source.loop=this.loop),this;console.warn("THREE.Audio: this Audio has no playback control.")},getVolume:function getVolume(){return this.gain.gain.value},setVolume:function setVolume(e){return this.gain.gain.value=e,this}}),PositionalAudio.prototype=Object.assign(Object.create(Audio.prototype),{constructor:PositionalAudio,getOutput:function getOutput(){return this.panner},getRefDistance:function getRefDistance(){return this.panner.refDistance},setRefDistance:function setRefDistance(e){this.panner.refDistance=e},getRolloffFactor:function getRolloffFactor(){return this.panner.rolloffFactor},setRolloffFactor:function setRolloffFactor(e){this.panner.rolloffFactor=e},getDistanceModel:function getDistanceModel(){return this.panner.distanceModel},setDistanceModel:function setDistanceModel(e){this.panner.distanceModel=e},getMaxDistance:function getMaxDistance(){return this.panner.maxDistance},setMaxDistance:function setMaxDistance(e){this.panner.maxDistance=e},updateMatrixWorld:function(){var e=new Vector3;return function updateMatrixWorld(t){Object3D.prototype.updateMatrixWorld.call(this,t),e.setFromMatrixPosition(this.matrixWorld),this.panner.setPosition(e.x,e.y,e.z)}}()}),Object.assign(AudioAnalyser.prototype,{getFrequencyData:function getFrequencyData(){return this.analyser.getByteFrequencyData(this.data),this.data},getAverageFrequency:function getAverageFrequency(){for(var e=0,t=this.getFrequencyData(),r=0;r<t.length;r++)e+=t[r];return e/t.length}}),Object.assign(PropertyMixer.prototype,{accumulate:function accumulate(e,t){var r=this.buffer,n=this.valueSize,i=e*n+n,o=this.cumulativeWeight;if(0===o){for(var a=0;a!==n;++a)r[i+a]=r[a];o=t}else{var s=t/(o+=t);this._mixBufferRegion(r,i,0,s,n)}this.cumulativeWeight=o},apply:function apply(e){var t=this.valueSize,r=this.buffer,n=e*t+t,i=this.cumulativeWeight,o=this.binding;if(this.cumulativeWeight=0,i<1){var a=3*t;this._mixBufferRegion(r,n,a,1-i,t)}for(var s=t,c=t+t;s!==c;++s)if(r[s]!==r[s+t]){o.setValue(r,n);break}},saveOriginalState:function saveOriginalState(){var e=this.binding,t=this.buffer,r=this.valueSize,n=3*r;e.getValue(t,n);for(var i=r,o=n;i!==o;++i)t[i]=t[n+i%r];this.cumulativeWeight=0},restoreOriginalState:function restoreOriginalState(){var e=3*this.valueSize;this.binding.setValue(this.buffer,e)},_select:function _select(e,t,r,n,i){if(n>=.5)for(var o=0;o!==i;++o)e[t+o]=e[r+o]},_slerp:function _slerp(e,t,r,n){Quaternion.slerpFlat(e,t,e,t,e,r,n)},_lerp:function _lerp(e,t,r,n,i){for(var o=1-n,a=0;a!==i;++a){var s=t+a;e[s]=e[s]*o+e[r+a]*n}}});var an,sn,cn,un,ln,hn,pn,fn,dn,mn,gn,yn,vn;function Composite(e,t,r){var n=r||PropertyBinding.parseTrackName(t);this._targetGroup=e,this._bindings=e.subscribe_(t,n)}function PropertyBinding(e,t,r){this.path=t,this.parsedPath=r||PropertyBinding.parseTrackName(t),this.node=PropertyBinding.findNode(e,this.parsedPath.nodeName)||e,this.rootNode=e}function AnimationAction(e,t,r){this._mixer=e,this._clip=t,this._localRoot=r||null;for(var n=t.tracks,i=n.length,o=new Array(i),a={endingStart:yt,endingEnd:yt},s=0;s!==i;++s){var c=n[s].createInterpolant(null);o[s]=c,c.settings=a}this._interpolantSettings=a,this._interpolants=o,this._propertyBindings=new Array(i),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=gt,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}function AnimationMixer(e){this._root=e,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}function Uniform(e){"string"==typeof e&&(console.warn("THREE.Uniform: Type parameter is no longer needed."),e=arguments[1]),this.value=e}function InstancedBufferGeometry(){BufferGeometry.call(this),this.type="InstancedBufferGeometry",this.maxInstancedCount=void 0}function InterleavedBufferAttribute(e,t,r,n){this.data=e,this.itemSize=t,this.offset=r,this.normalized=!0===n}function InterleavedBuffer(e,t){this.array=e,this.stride=t,this.count=void 0!==e?e.length/t:0,this.dynamic=!1,this.updateRange={offset:0,count:-1},this.version=0}function InstancedInterleavedBuffer(e,t,r){InterleavedBuffer.call(this,e,t),this.meshPerAttribute=r||1}function InstancedBufferAttribute(e,t,r){BufferAttribute.call(this,e,t),this.meshPerAttribute=r||1}function Raycaster(e,t,r,n){this.ray=new Ray(e,t),this.near=r||0,this.far=n||1/0,this.params={Mesh:{},Line:{},LOD:{},Points:{threshold:1},Sprite:{}},Object.defineProperties(this.params,{PointCloud:{get:function get(){return console.warn("THREE.Raycaster: params.PointCloud has been renamed to params.Points."),this.Points}}})}function ascSort(e,t){return e.distance-t.distance}function _intersectObject(e,t,r,n){if(!1!==e.visible&&(e.raycast(t,r),!0===n))for(var i=e.children,o=0,a=i.length;o<a;o++)_intersectObject(i[o],t,r,!0)}function Spherical(e,t,r){return this.radius=void 0!==e?e:1,this.phi=void 0!==t?t:0,this.theta=void 0!==r?r:0,this}function Box2(e,t){this.min=void 0!==e?e:new Vector2(1/0,1/0),this.max=void 0!==t?t:new Vector2(-1/0,-1/0)}function ImmediateRenderObject(e){Object3D.call(this),this.material=e,this.render=function(){}}function VertexNormalsHelper(e,t,r,n){this.object=e,this.size=void 0!==t?t:1;var i=void 0!==r?r:16711680,o=void 0!==n?n:1,a=0,s=this.object.geometry;s&&s.isGeometry?a=3*s.faces.length:s&&s.isBufferGeometry&&(a=s.attributes.normal.count);var c=new BufferGeometry,u=new Float32BufferAttribute(2*a*3,3);c.addAttribute("position",u),LineSegments.call(this,c,new LineBasicMaterial({color:i,linewidth:o})),this.matrixAutoUpdate=!1,this.update()}function SpotLightHelper(e,t){Object3D.call(this),this.light=e,this.light.updateMatrixWorld(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=t;for(var r=new BufferGeometry,n=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1],i=0,o=1;i<32;i++,o++){var a=i/32*Math.PI*2,s=o/32*Math.PI*2;n.push(Math.cos(a),Math.sin(a),1,Math.cos(s),Math.sin(s),1)}r.addAttribute("position",new Float32BufferAttribute(n,3));var c=new LineBasicMaterial({fog:!1});this.cone=new LineSegments(r,c),this.add(this.cone),this.update()}function SkeletonHelper(e){for(var t=function getBoneList(e){var t=[];e&&e.isBone&&t.push(e);for(var r=0;r<e.children.length;r++)t.push.apply(t,getBoneList(e.children[r]));return t}(e),r=new BufferGeometry,n=[],i=[],o=new Color(0,0,1),a=new Color(0,1,0),s=0;s<t.length;s++){var c=t[s];c.parent&&c.parent.isBone&&(n.push(0,0,0),n.push(0,0,0),i.push(o.r,o.g,o.b),i.push(a.r,a.g,a.b))}r.addAttribute("position",new Float32BufferAttribute(n,3)),r.addAttribute("color",new Float32BufferAttribute(i,3));var u=new LineBasicMaterial({vertexColors:P,depthTest:!1,depthWrite:!1,transparent:!0});LineSegments.call(this,r,u),this.root=e,this.bones=t,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1}function PointLightHelper(e,t,r){this.light=e,this.light.updateMatrixWorld(),this.color=r;var n=new SphereBufferGeometry(t,4,2),i=new MeshBasicMaterial({wireframe:!0,fog:!1});Mesh.call(this,n,i),this.matrix=this.light.matrixWorld,this.matrixAutoUpdate=!1,this.update()}function RectAreaLightHelper(e,t){Object3D.call(this),this.light=e,this.light.updateMatrixWorld(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=t;var r=new LineBasicMaterial({fog:!1}),n=new BufferGeometry;n.addAttribute("position",new BufferAttribute(new Float32Array(15),3)),this.line=new Line(n,r),this.add(this.line),this.update()}function HemisphereLightHelper(e,t,r){Object3D.call(this),this.light=e,this.light.updateMatrixWorld(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=r;var n=new OctahedronBufferGeometry(t);n.rotateY(.5*Math.PI),this.material=new MeshBasicMaterial({wireframe:!0,fog:!1}),void 0===this.color&&(this.material.vertexColors=P);var i=n.getAttribute("position"),o=new Float32Array(3*i.count);n.addAttribute("color",new BufferAttribute(o,3)),this.add(new Mesh(n,this.material)),this.update()}function GridHelper(e,t,r,n){e=e||10,t=t||10,r=new Color(void 0!==r?r:4473924),n=new Color(void 0!==n?n:8947848);for(var i=t/2,o=e/t,a=e/2,s=[],c=[],u=0,l=0,h=-a;u<=t;u++,h+=o){s.push(-a,0,h,a,0,h),s.push(h,0,-a,h,0,a);var p=u===i?r:n;p.toArray(c,l),l+=3,p.toArray(c,l),l+=3,p.toArray(c,l),l+=3,p.toArray(c,l),l+=3}var f=new BufferGeometry;f.addAttribute("position",new Float32BufferAttribute(s,3)),f.addAttribute("color",new Float32BufferAttribute(c,3));var d=new LineBasicMaterial({vertexColors:P});LineSegments.call(this,f,d)}function PolarGridHelper(e,t,r,n,i,o){e=e||10,t=t||16,r=r||8,n=n||64,i=new Color(void 0!==i?i:4473924),o=new Color(void 0!==o?o:8947848);var a,s,c,u,l,h,p,f=[],d=[];for(u=0;u<=t;u++)c=u/t*(2*Math.PI),a=Math.sin(c)*e,s=Math.cos(c)*e,f.push(0,0,0),f.push(a,0,s),p=1&u?i:o,d.push(p.r,p.g,p.b),d.push(p.r,p.g,p.b);for(u=0;u<=r;u++)for(p=1&u?i:o,h=e-e/r*u,l=0;l<n;l++)c=l/n*(2*Math.PI),a=Math.sin(c)*h,s=Math.cos(c)*h,f.push(a,0,s),d.push(p.r,p.g,p.b),c=(l+1)/n*(2*Math.PI),a=Math.sin(c)*h,s=Math.cos(c)*h,f.push(a,0,s),d.push(p.r,p.g,p.b);var m=new BufferGeometry;m.addAttribute("position",new Float32BufferAttribute(f,3)),m.addAttribute("color",new Float32BufferAttribute(d,3));var g=new LineBasicMaterial({vertexColors:P});LineSegments.call(this,m,g)}function FaceNormalsHelper(e,t,r,n){this.object=e,this.size=void 0!==t?t:1;var i=void 0!==r?r:16776960,o=void 0!==n?n:1,a=0,s=this.object.geometry;s&&s.isGeometry?a=s.faces.length:console.warn("THREE.FaceNormalsHelper: only THREE.Geometry is supported. Use THREE.VertexNormalsHelper, instead.");var c=new BufferGeometry,u=new Float32BufferAttribute(2*a*3,3);c.addAttribute("position",u),LineSegments.call(this,c,new LineBasicMaterial({color:i,linewidth:o})),this.matrixAutoUpdate=!1,this.update()}function DirectionalLightHelper(e,t,r){Object3D.call(this),this.light=e,this.light.updateMatrixWorld(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=r,void 0===t&&(t=1);var n=new BufferGeometry;n.addAttribute("position",new Float32BufferAttribute([-t,t,0,t,t,0,t,-t,0,-t,-t,0,-t,t,0],3));var i=new LineBasicMaterial({fog:!1});this.lightPlane=new Line(n,i),this.add(this.lightPlane),(n=new BufferGeometry).addAttribute("position",new Float32BufferAttribute([0,0,0,0,0,1],3)),this.targetLine=new Line(n,i),this.add(this.targetLine),this.update()}function CameraHelper(e){var t=new BufferGeometry,r=new LineBasicMaterial({color:16777215,vertexColors:C}),n=[],i=[],o={},a=new Color(16755200),s=new Color(16711680),c=new Color(43775),u=new Color(16777215),l=new Color(3355443);function addLine(e,t,r){addPoint(e,r),addPoint(t,r)}function addPoint(e,t){n.push(0,0,0),i.push(t.r,t.g,t.b),void 0===o[e]&&(o[e]=[]),o[e].push(n.length/3-1)}addLine("n1","n2",a),addLine("n2","n4",a),addLine("n4","n3",a),addLine("n3","n1",a),addLine("f1","f2",a),addLine("f2","f4",a),addLine("f4","f3",a),addLine("f3","f1",a),addLine("n1","f1",a),addLine("n2","f2",a),addLine("n3","f3",a),addLine("n4","f4",a),addLine("p","n1",s),addLine("p","n2",s),addLine("p","n3",s),addLine("p","n4",s),addLine("u1","u2",c),addLine("u2","u3",c),addLine("u3","u1",c),addLine("c","t",u),addLine("p","c",l),addLine("cn1","cn2",l),addLine("cn3","cn4",l),addLine("cf1","cf2",l),addLine("cf3","cf4",l),t.addAttribute("position",new Float32BufferAttribute(n,3)),t.addAttribute("color",new Float32BufferAttribute(i,3)),LineSegments.call(this,t,r),this.camera=e,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=o,this.update()}function BoxHelper(e,t){this.object=e,void 0===t&&(t=16776960);var r=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),n=new Float32Array(24),i=new BufferGeometry;i.setIndex(new BufferAttribute(r,1)),i.addAttribute("position",new BufferAttribute(n,3)),LineSegments.call(this,i,new LineBasicMaterial({color:t})),this.matrixAutoUpdate=!1,this.update()}function Box3Helper(e,t){this.type="Box3Helper",this.box=e;var r=void 0!==t?t:16776960,n=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),i=new BufferGeometry;i.setIndex(new BufferAttribute(n,1)),i.addAttribute("position",new Float32BufferAttribute([1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1],3)),LineSegments.call(this,i,new LineBasicMaterial({color:r})),this.geometry.computeBoundingSphere()}function PlaneHelper(e,t,r){this.type="PlaneHelper",this.plane=e,this.size=void 0===t?1:t;var n=void 0!==r?r:16776960,i=new BufferGeometry;i.addAttribute("position",new Float32BufferAttribute([1,-1,1,-1,1,1,-1,-1,1,1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,0,0,1,0,0,0],3)),i.computeBoundingSphere(),Line.call(this,i,new LineBasicMaterial({color:n}));var o=new BufferGeometry;o.addAttribute("position",new Float32BufferAttribute([1,1,1,-1,1,1,-1,-1,1,1,1,1,-1,-1,1,1,-1,1],3)),o.computeBoundingSphere(),this.add(new Mesh(o,new MeshBasicMaterial({color:n,opacity:.2,transparent:!0,depthWrite:!1})))}function ArrowHelper(e,t,r,n,i,o){Object3D.call(this),void 0===n&&(n=16776960),void 0===r&&(r=1),void 0===i&&(i=.2*r),void 0===o&&(o=.2*i),void 0===mn&&((mn=new BufferGeometry).addAttribute("position",new Float32BufferAttribute([0,0,0,0,1,0],3)),(gn=new CylinderBufferGeometry(0,.5,1,5,1)).translate(0,-.5,0)),this.position.copy(t),this.line=new Line(mn,new LineBasicMaterial({color:n})),this.line.matrixAutoUpdate=!1,this.add(this.line),this.cone=new Mesh(gn,new MeshBasicMaterial({color:n})),this.cone.matrixAutoUpdate=!1,this.add(this.cone),this.setDirection(e),this.setLength(r,i,o)}function AxesHelper(e){var t=[0,0,0,e=e||1,0,0,0,0,0,0,e,0,0,0,0,0,0,e],r=new BufferGeometry;r.addAttribute("position",new Float32BufferAttribute(t,3)),r.addAttribute("color",new Float32BufferAttribute([1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],3));var n=new LineBasicMaterial({vertexColors:P});LineSegments.call(this,r,n)}Object.assign(Composite.prototype,{getValue:function getValue(e,t){this.bind();var r=this._targetGroup.nCachedObjects_,n=this._bindings[r];void 0!==n&&n.getValue(e,t)},setValue:function setValue(e,t){for(var r=this._bindings,n=this._targetGroup.nCachedObjects_,i=r.length;n!==i;++n)r[n].setValue(e,t)},bind:function bind(){for(var e=this._bindings,t=this._targetGroup.nCachedObjects_,r=e.length;t!==r;++t)e[t].bind()},unbind:function unbind(){for(var e=this._bindings,t=this._targetGroup.nCachedObjects_,r=e.length;t!==r;++t)e[t].unbind()}}),Object.assign(PropertyBinding,{Composite:Composite,create:function create(e,t,r){return e&&e.isAnimationObjectGroup?new PropertyBinding.Composite(e,t,r):new PropertyBinding(e,t,r)},sanitizeNodeName:(dn=new RegExp("[\\[\\]\\.:\\/]","g"),function sanitizeNodeName(e){return e.replace(/\s/g,"_").replace(dn,"")}),parseTrackName:(an="[^\\[\\]\\.:\\/]",sn="[^"+"\\[\\]\\.:\\/".replace("\\.","")+"]",cn=/((?:WC+[\/:])*)/.source.replace("WC",an),un=/(WCOD+)?/.source.replace("WCOD",sn),ln=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",an),hn=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",an),pn=new RegExp("^"+cn+un+ln+hn+"$"),fn=["material","materials","bones"],function parseTrackName(e){var t=pn.exec(e);if(!t)throw new Error("PropertyBinding: Cannot parse trackName: "+e);var r={nodeName:t[2],objectName:t[3],objectIndex:t[4],propertyName:t[5],propertyIndex:t[6]},n=r.nodeName&&r.nodeName.lastIndexOf(".");if(void 0!==n&&-1!==n){var i=r.nodeName.substring(n+1);-1!==fn.indexOf(i)&&(r.nodeName=r.nodeName.substring(0,n),r.objectName=i)}if(null===r.propertyName||0===r.propertyName.length)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+e);return r}),findNode:function findNode(e,t){if(!t||""===t||"root"===t||"."===t||-1===t||t===e.name||t===e.uuid)return e;if(e.skeleton){var r=e.skeleton.getBoneByName(t);if(void 0!==r)return r}if(e.children){var n=function searchNodeSubtree(e){for(var r=0;r<e.length;r++){var n=e[r];if(n.name===t||n.uuid===t)return n;var i=searchNodeSubtree(n.children);if(i)return i}return null}(e.children);if(n)return n}return null}}),Object.assign(PropertyBinding.prototype,{_getValue_unavailable:function _getValue_unavailable(){},_setValue_unavailable:function _setValue_unavailable(){},BindingType:{Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},Versioning:{None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},GetterByBindingType:[function getValue_direct(e,t){e[t]=this.node[this.propertyName]},function getValue_array(e,t){for(var r=this.resolvedProperty,n=0,i=r.length;n!==i;++n)e[t++]=r[n]},function getValue_arrayElement(e,t){e[t]=this.resolvedProperty[this.propertyIndex]},function getValue_toArray(e,t){this.resolvedProperty.toArray(e,t)}],SetterByBindingTypeAndVersioning:[[function setValue_direct(e,t){this.targetObject[this.propertyName]=e[t]},function setValue_direct_setNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.needsUpdate=!0},function setValue_direct_setMatrixWorldNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}],[function setValue_array(e,t){for(var r=this.resolvedProperty,n=0,i=r.length;n!==i;++n)r[n]=e[t++]},function setValue_array_setNeedsUpdate(e,t){for(var r=this.resolvedProperty,n=0,i=r.length;n!==i;++n)r[n]=e[t++];this.targetObject.needsUpdate=!0},function setValue_array_setMatrixWorldNeedsUpdate(e,t){for(var r=this.resolvedProperty,n=0,i=r.length;n!==i;++n)r[n]=e[t++];this.targetObject.matrixWorldNeedsUpdate=!0}],[function setValue_arrayElement(e,t){this.resolvedProperty[this.propertyIndex]=e[t]},function setValue_arrayElement_setNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.needsUpdate=!0},function setValue_arrayElement_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}],[function setValue_fromArray(e,t){this.resolvedProperty.fromArray(e,t)},function setValue_fromArray_setNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.needsUpdate=!0},function setValue_fromArray_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.matrixWorldNeedsUpdate=!0}]],getValue:function getValue_unbound(e,t){this.bind(),this.getValue(e,t)},setValue:function getValue_unbound(e,t){this.bind(),this.setValue(e,t)},bind:function bind(){var e=this.node,t=this.parsedPath,r=t.objectName,n=t.propertyName,i=t.propertyIndex;if(e||(e=PropertyBinding.findNode(this.rootNode,t.nodeName)||this.rootNode,this.node=e),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,e){if(r){var o=t.objectIndex;switch(r){case"materials":if(!e.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!e.material.materials)return void console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);e=e.material.materials;break;case"bones":if(!e.skeleton)return void console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);e=e.skeleton.bones;for(var a=0;a<e.length;a++)if(e[a].name===o){o=a;break}break;default:if(void 0===e[r])return void console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);e=e[r]}if(void 0!==o){if(void 0===e[o])return void console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,e);e=e[o]}}var s=e[n];if(void 0!==s){var c=this.Versioning.None;void 0!==e.needsUpdate?(c=this.Versioning.NeedsUpdate,this.targetObject=e):void 0!==e.matrixWorldNeedsUpdate&&(c=this.Versioning.MatrixWorldNeedsUpdate,this.targetObject=e);var u=this.BindingType.Direct;if(void 0!==i){if("morphTargetInfluences"===n){if(!e.geometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);if(e.geometry.isBufferGeometry){if(!e.geometry.morphAttributes)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);for(a=0;a<this.node.geometry.morphAttributes.position.length;a++)if(e.geometry.morphAttributes.position[a].name===i){i=a;break}}else{if(!e.geometry.morphTargets)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphTargets.",this);for(a=0;a<this.node.geometry.morphTargets.length;a++)if(e.geometry.morphTargets[a].name===i){i=a;break}}}u=this.BindingType.ArrayElement,this.resolvedProperty=s,this.propertyIndex=i}else void 0!==s.fromArray&&void 0!==s.toArray?(u=this.BindingType.HasFromToArray,this.resolvedProperty=s):Array.isArray(s)?(u=this.BindingType.EntireArray,this.resolvedProperty=s):this.propertyName=n;this.getValue=this.GetterByBindingType[u],this.setValue=this.SetterByBindingTypeAndVersioning[u][c]}else{var l=t.nodeName;console.error("THREE.PropertyBinding: Trying to update property for track: "+l+"."+n+" but it wasn't found.",e)}}else console.error("THREE.PropertyBinding: Trying to update node for track: "+this.path+" but it wasn't found.")},unbind:function unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}),//!\ DECLARE ALIAS AFTER assign prototype !
Object.assign(PropertyBinding.prototype,{_getValue_unbound:PropertyBinding.prototype.getValue,_setValue_unbound:PropertyBinding.prototype.setValue}),Object.assign(function AnimationObjectGroup(){this.uuid=At.generateUUID(),this._objects=Array.prototype.slice.call(arguments),this.nCachedObjects_=0;var e={};this._indicesByUUID=e;for(var t=0,r=arguments.length;t!==r;++t)e[arguments[t].uuid]=t;this._paths=[],this._parsedPaths=[],this._bindings=[],this._bindingsIndicesByPath={};var n=this;this.stats={objects:{get total(){return n._objects.length},get inUse(){return this.total-n.nCachedObjects_}},get bindingsPerObject(){return n._bindings.length}}}.prototype,{isAnimationObjectGroup:!0,add:function add(){for(var e=this._objects,t=e.length,r=this.nCachedObjects_,n=this._indicesByUUID,i=this._paths,o=this._parsedPaths,a=this._bindings,s=a.length,c=void 0,u=0,l=arguments.length;u!==l;++u){var h=arguments[u],p=h.uuid,f=n[p];if(void 0===f){f=t++,n[p]=f,e.push(h);for(var d=0,m=s;d!==m;++d)a[d].push(new PropertyBinding(h,i[d],o[d]))}else if(f<r){c=e[f];var g=--r,y=e[g];n[y.uuid]=f,e[f]=y,n[p]=g,e[g]=h;for(d=0,m=s;d!==m;++d){var v=a[d],_=v[g],b=v[f];v[f]=_,void 0===b&&(b=new PropertyBinding(h,i[d],o[d])),v[g]=b}}else e[f]!==c&&console.error("THREE.AnimationObjectGroup: Different objects with the same UUID detected. Clean the caches or recreate your infrastructure when reloading scenes.")}this.nCachedObjects_=r},remove:function remove(){for(var e=this._objects,t=this.nCachedObjects_,r=this._indicesByUUID,n=this._bindings,i=n.length,o=0,a=arguments.length;o!==a;++o){var s=arguments[o],c=s.uuid,u=r[c];if(void 0!==u&&u>=t){var l=t++,h=e[l];r[h.uuid]=u,e[u]=h,r[c]=l,e[l]=s;for(var p=0,f=i;p!==f;++p){var d=n[p],m=d[l],g=d[u];d[u]=m,d[l]=g}}}this.nCachedObjects_=t},uncache:function uncache(){for(var e=this._objects,t=e.length,r=this.nCachedObjects_,n=this._indicesByUUID,i=this._bindings,o=i.length,a=0,s=arguments.length;a!==s;++a){var c=arguments[a].uuid,u=n[c];if(void 0!==u)if(delete n[c],u<r){var l=--r,h=e[l],p=e[y=--t];n[h.uuid]=u,e[u]=h,n[p.uuid]=l,e[l]=p,e.pop();for(var f=0,d=o;f!==d;++f){var m=(v=i[f])[l],g=v[y];v[u]=m,v[l]=g,v.pop()}}else{var y;n[(p=e[y=--t]).uuid]=u,e[u]=p,e.pop();for(f=0,d=o;f!==d;++f){var v;(v=i[f])[u]=v[y],v.pop()}}}this.nCachedObjects_=r},subscribe_:function subscribe_(e,t){var r=this._bindingsIndicesByPath,n=r[e],i=this._bindings;if(void 0!==n)return i[n];var o=this._paths,a=this._parsedPaths,s=this._objects,c=s.length,u=this.nCachedObjects_,l=new Array(c);n=i.length,r[e]=n,o.push(e),a.push(t),i.push(l);for(var h=u,p=s.length;h!==p;++h){var f=s[h];l[h]=new PropertyBinding(f,e,t)}return l},unsubscribe_:function unsubscribe_(e){var t=this._bindingsIndicesByPath,r=t[e];if(void 0!==r){var n=this._paths,i=this._parsedPaths,o=this._bindings,a=o.length-1,s=o[a];t[e[a]]=r,o[r]=s,o.pop(),i[r]=i[a],i.pop(),n[r]=n[a],n.pop()}}}),Object.assign(AnimationAction.prototype,{play:function play(){return this._mixer._activateAction(this),this},stop:function stop(){return this._mixer._deactivateAction(this),this.reset()},reset:function reset(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()},isRunning:function isRunning(){return this.enabled&&!this.paused&&0!==this.timeScale&&null===this._startTime&&this._mixer._isActiveAction(this)},isScheduled:function isScheduled(){return this._mixer._isActiveAction(this)},startAt:function startAt(e){return this._startTime=e,this},setLoop:function setLoop(e,t){return this.loop=e,this.repetitions=t,this},setEffectiveWeight:function setEffectiveWeight(e){return this.weight=e,this._effectiveWeight=this.enabled?e:0,this.stopFading()},getEffectiveWeight:function getEffectiveWeight(){return this._effectiveWeight},fadeIn:function fadeIn(e){return this._scheduleFading(e,0,1)},fadeOut:function fadeOut(e){return this._scheduleFading(e,1,0)},crossFadeFrom:function crossFadeFrom(e,t,r){if(e.fadeOut(t),this.fadeIn(t),r){var n=this._clip.duration,i=e._clip.duration,o=i/n,a=n/i;e.warp(1,o,t),this.warp(a,1,t)}return this},crossFadeTo:function crossFadeTo(e,t,r){return e.crossFadeFrom(this,t,r)},stopFading:function stopFading(){var e=this._weightInterpolant;return null!==e&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this},setEffectiveTimeScale:function setEffectiveTimeScale(e){return this.timeScale=e,this._effectiveTimeScale=this.paused?0:e,this.stopWarping()},getEffectiveTimeScale:function getEffectiveTimeScale(){return this._effectiveTimeScale},setDuration:function setDuration(e){return this.timeScale=this._clip.duration/e,this.stopWarping()},syncWith:function syncWith(e){return this.time=e.time,this.timeScale=e.timeScale,this.stopWarping()},halt:function halt(e){return this.warp(this._effectiveTimeScale,0,e)},warp:function warp(e,t,r){var n=this._mixer,i=n.time,o=this._timeScaleInterpolant,a=this.timeScale;null===o&&(o=n._lendControlInterpolant(),this._timeScaleInterpolant=o);var s=o.parameterPositions,c=o.sampleValues;return s[0]=i,s[1]=i+r,c[0]=e/a,c[1]=t/a,this},stopWarping:function stopWarping(){var e=this._timeScaleInterpolant;return null!==e&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this},getMixer:function getMixer(){return this._mixer},getClip:function getClip(){return this._clip},getRoot:function getRoot(){return this._localRoot||this._mixer._root},_update:function _update(e,t,r,n){if(this.enabled){var i=this._startTime;if(null!==i){var o=(e-i)*r;if(o<0||0===r)return;this._startTime=null,t=r*o}t*=this._updateTimeScale(e);var a=this._updateTime(t),s=this._updateWeight(e);if(s>0)for(var c=this._interpolants,u=this._propertyBindings,l=0,h=c.length;l!==h;++l)c[l].evaluate(a),u[l].accumulate(n,s)}else this._updateWeight(e)},_updateWeight:function _updateWeight(e){var t=0;if(this.enabled){t=this.weight;var r=this._weightInterpolant;if(null!==r){var n=r.evaluate(e)[0];t*=n,e>r.parameterPositions[1]&&(this.stopFading(),0===n&&(this.enabled=!1))}}return this._effectiveWeight=t,t},_updateTimeScale:function _updateTimeScale(e){var t=0;if(!this.paused){t=this.timeScale;var r=this._timeScaleInterpolant;if(null!==r)t*=r.evaluate(e)[0],e>r.parameterPositions[1]&&(this.stopWarping(),0===t?this.paused=!0:this.timeScale=t)}return this._effectiveTimeScale=t,t},_updateTime:function _updateTime(e){var t=this.time+e;if(0===e)return t;var r=this._clip.duration,n=this.loop,i=this._loopCount;if(2200===n){-1===i&&(this._loopCount=0,this._setEndings(!0,!0,!1));e:{if(t>=r)t=r;else{if(!(t<0))break e;t=0}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this._mixer.dispatchEvent({type:"finished",action:this,direction:e<0?-1:1})}}else{var o=2202===n;if(-1===i&&(e>=0?(i=0,this._setEndings(!0,0===this.repetitions,o)):this._setEndings(0===this.repetitions,!0,o)),t>=r||t<0){var a=Math.floor(t/r);t-=r*a,i+=Math.abs(a);var s=this.repetitions-i;if(s<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,t=e>0?r:0,this._mixer.dispatchEvent({type:"finished",action:this,direction:e>0?1:-1});else{if(1===s){var c=e<0;this._setEndings(c,!c,o)}else this._setEndings(!1,!1,o);this._loopCount=i,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:a})}}if(o&&1==(1&i))return this.time=t,r-t}return this.time=t,t},_setEndings:function _setEndings(e,t,r){var n=this._interpolantSettings;r?(n.endingStart=2401,n.endingEnd=2401):(n.endingStart=e?this.zeroSlopeAtStart?2401:yt:2402,n.endingEnd=t?this.zeroSlopeAtEnd?2401:yt:2402)},_scheduleFading:function _scheduleFading(e,t,r){var n=this._mixer,i=n.time,o=this._weightInterpolant;null===o&&(o=n._lendControlInterpolant(),this._weightInterpolant=o);var a=o.parameterPositions,s=o.sampleValues;return a[0]=i,s[0]=t,a[1]=i+e,s[1]=r,this}}),AnimationMixer.prototype=Object.assign(Object.create(EventDispatcher.prototype),{constructor:AnimationMixer,_bindAction:function _bindAction(e,t){var r=e._localRoot||this._root,n=e._clip.tracks,i=n.length,o=e._propertyBindings,a=e._interpolants,s=r.uuid,c=this._bindingsByRootAndName,u=c[s];void 0===u&&(u={},c[s]=u);for(var l=0;l!==i;++l){var h=n[l],p=h.name,f=u[p];if(void 0!==f)o[l]=f;else{if(void 0!==(f=o[l])){null===f._cacheIndex&&(++f.referenceCount,this._addInactiveBinding(f,s,p));continue}var d=t&&t._propertyBindings[l].binding.parsedPath;++(f=new PropertyMixer(PropertyBinding.create(r,p,d),h.ValueTypeName,h.getValueSize())).referenceCount,this._addInactiveBinding(f,s,p),o[l]=f}a[l].resultBuffer=f.buffer}},_activateAction:function _activateAction(e){if(!this._isActiveAction(e)){if(null===e._cacheIndex){var t=(e._localRoot||this._root).uuid,r=e._clip.uuid,n=this._actionsByClip[r];this._bindAction(e,n&&n.knownActions[0]),this._addInactiveAction(e,r,t)}for(var i=e._propertyBindings,o=0,a=i.length;o!==a;++o){var s=i[o];0==s.useCount++&&(this._lendBinding(s),s.saveOriginalState())}this._lendAction(e)}},_deactivateAction:function _deactivateAction(e){if(this._isActiveAction(e)){for(var t=e._propertyBindings,r=0,n=t.length;r!==n;++r){var i=t[r];0==--i.useCount&&(i.restoreOriginalState(),this._takeBackBinding(i))}this._takeBackAction(e)}},_initMemoryManager:function _initMemoryManager(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;var e=this;this.stats={actions:{get total(){return e._actions.length},get inUse(){return e._nActiveActions}},bindings:{get total(){return e._bindings.length},get inUse(){return e._nActiveBindings}},controlInterpolants:{get total(){return e._controlInterpolants.length},get inUse(){return e._nActiveControlInterpolants}}}},_isActiveAction:function _isActiveAction(e){var t=e._cacheIndex;return null!==t&&t<this._nActiveActions},_addInactiveAction:function _addInactiveAction(e,t,r){var n=this._actions,i=this._actionsByClip,o=i[t];if(void 0===o)o={knownActions:[e],actionByRoot:{}},e._byClipCacheIndex=0,i[t]=o;else{var a=o.knownActions;e._byClipCacheIndex=a.length,a.push(e)}e._cacheIndex=n.length,n.push(e),o.actionByRoot[r]=e},_removeInactiveAction:function _removeInactiveAction(e){var t=this._actions,r=t[t.length-1],n=e._cacheIndex;r._cacheIndex=n,t[n]=r,t.pop(),e._cacheIndex=null;var i=e._clip.uuid,o=this._actionsByClip,a=o[i],s=a.knownActions,c=s[s.length-1],u=e._byClipCacheIndex;c._byClipCacheIndex=u,s[u]=c,s.pop(),e._byClipCacheIndex=null,delete a.actionByRoot[(e._localRoot||this._root).uuid],0===s.length&&delete o[i],this._removeInactiveBindingsForAction(e)},_removeInactiveBindingsForAction:function _removeInactiveBindingsForAction(e){for(var t=e._propertyBindings,r=0,n=t.length;r!==n;++r){var i=t[r];0==--i.referenceCount&&this._removeInactiveBinding(i)}},_lendAction:function _lendAction(e){var t=this._actions,r=e._cacheIndex,n=this._nActiveActions++,i=t[n];e._cacheIndex=n,t[n]=e,i._cacheIndex=r,t[r]=i},_takeBackAction:function _takeBackAction(e){var t=this._actions,r=e._cacheIndex,n=--this._nActiveActions,i=t[n];e._cacheIndex=n,t[n]=e,i._cacheIndex=r,t[r]=i},_addInactiveBinding:function _addInactiveBinding(e,t,r){var n=this._bindingsByRootAndName,i=n[t],o=this._bindings;void 0===i&&(i={},n[t]=i),i[r]=e,e._cacheIndex=o.length,o.push(e)},_removeInactiveBinding:function _removeInactiveBinding(e){var t=this._bindings,r=e.binding,n=r.rootNode.uuid,i=r.path,o=this._bindingsByRootAndName,a=o[n],s=t[t.length-1],c=e._cacheIndex;s._cacheIndex=c,t[c]=s,t.pop(),delete a[i];e:{for(var u in a)break e;delete o[n]}},_lendBinding:function _lendBinding(e){var t=this._bindings,r=e._cacheIndex,n=this._nActiveBindings++,i=t[n];e._cacheIndex=n,t[n]=e,i._cacheIndex=r,t[r]=i},_takeBackBinding:function _takeBackBinding(e){var t=this._bindings,r=e._cacheIndex,n=--this._nActiveBindings,i=t[n];e._cacheIndex=n,t[n]=e,i._cacheIndex=r,t[r]=i},_lendControlInterpolant:function _lendControlInterpolant(){var e=this._controlInterpolants,t=this._nActiveControlInterpolants++,r=e[t];return void 0===r&&((r=new LinearInterpolant(new Float32Array(2),new Float32Array(2),1,this._controlInterpolantsResultBuffer)).__cacheIndex=t,e[t]=r),r},_takeBackControlInterpolant:function _takeBackControlInterpolant(e){var t=this._controlInterpolants,r=e.__cacheIndex,n=--this._nActiveControlInterpolants,i=t[n];e.__cacheIndex=n,t[n]=e,i.__cacheIndex=r,t[r]=i},_controlInterpolantsResultBuffer:new Float32Array(1),clipAction:function clipAction(e,t){var r=t||this._root,n=r.uuid,i="string"==typeof e?AnimationClip.findByName(r,e):e,o=null!==i?i.uuid:e,a=this._actionsByClip[o],s=null;if(void 0!==a){var c=a.actionByRoot[n];if(void 0!==c)return c;s=a.knownActions[0],null===i&&(i=s._clip)}if(null===i)return null;var u=new AnimationAction(this,i,t);return this._bindAction(u,s),this._addInactiveAction(u,o,n),u},existingAction:function existingAction(e,t){var r=t||this._root,n=r.uuid,i="string"==typeof e?AnimationClip.findByName(r,e):e,o=i?i.uuid:e,a=this._actionsByClip[o];return void 0!==a&&a.actionByRoot[n]||null},stopAllAction:function stopAllAction(){var e=this._actions,t=this._nActiveActions,r=this._bindings,n=this._nActiveBindings;this._nActiveActions=0,this._nActiveBindings=0;for(var i=0;i!==t;++i)e[i].reset();for(i=0;i!==n;++i)r[i].useCount=0;return this},update:function update(e){e*=this.timeScale;for(var t=this._actions,r=this._nActiveActions,n=this.time+=e,i=Math.sign(e),o=this._accuIndex^=1,a=0;a!==r;++a){t[a]._update(n,e,i,o)}var s=this._bindings,c=this._nActiveBindings;for(a=0;a!==c;++a)s[a].apply(o);return this},getRoot:function getRoot(){return this._root},uncacheClip:function uncacheClip(e){var t=this._actions,r=e.uuid,n=this._actionsByClip,i=n[r];if(void 0!==i){for(var o=i.knownActions,a=0,s=o.length;a!==s;++a){var c=o[a];this._deactivateAction(c);var u=c._cacheIndex,l=t[t.length-1];c._cacheIndex=null,c._byClipCacheIndex=null,l._cacheIndex=u,t[u]=l,t.pop(),this._removeInactiveBindingsForAction(c)}delete n[r]}},uncacheRoot:function uncacheRoot(e){var t=e.uuid,r=this._actionsByClip;for(var n in r){var i=r[n].actionByRoot[t];void 0!==i&&(this._deactivateAction(i),this._removeInactiveAction(i))}var o=this._bindingsByRootAndName[t];if(void 0!==o)for(var a in o){var s=o[a];s.restoreOriginalState(),this._removeInactiveBinding(s)}},uncacheAction:function uncacheAction(e,t){var r=this.existingAction(e,t);null!==r&&(this._deactivateAction(r),this._removeInactiveAction(r))}}),Uniform.prototype.clone=function(){return new Uniform(void 0===this.value.clone?this.value:this.value.clone())},InstancedBufferGeometry.prototype=Object.assign(Object.create(BufferGeometry.prototype),{constructor:InstancedBufferGeometry,isInstancedBufferGeometry:!0,copy:function copy(e){return BufferGeometry.prototype.copy.call(this,e),this.maxInstancedCount=e.maxInstancedCount,this},clone:function clone(){return(new this.constructor).copy(this)}}),Object.defineProperties(InterleavedBufferAttribute.prototype,{count:{get:function get(){return this.data.count}},array:{get:function get(){return this.data.array}}}),Object.assign(InterleavedBufferAttribute.prototype,{isInterleavedBufferAttribute:!0,setX:function setX(e,t){return this.data.array[e*this.data.stride+this.offset]=t,this},setY:function setY(e,t){return this.data.array[e*this.data.stride+this.offset+1]=t,this},setZ:function setZ(e,t){return this.data.array[e*this.data.stride+this.offset+2]=t,this},setW:function setW(e,t){return this.data.array[e*this.data.stride+this.offset+3]=t,this},getX:function getX(e){return this.data.array[e*this.data.stride+this.offset]},getY:function getY(e){return this.data.array[e*this.data.stride+this.offset+1]},getZ:function getZ(e){return this.data.array[e*this.data.stride+this.offset+2]},getW:function getW(e){return this.data.array[e*this.data.stride+this.offset+3]},setXY:function setXY(e,t,r){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=r,this},setXYZ:function setXYZ(e,t,r,n){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=r,this.data.array[e+2]=n,this},setXYZW:function setXYZW(e,t,r,n,i){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=r,this.data.array[e+2]=n,this.data.array[e+3]=i,this}}),Object.defineProperty(InterleavedBuffer.prototype,"needsUpdate",{set:function set(e){!0===e&&this.version++}}),Object.assign(InterleavedBuffer.prototype,{isInterleavedBuffer:!0,onUploadCallback:function onUploadCallback(){},setArray:function setArray(e){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.count=void 0!==e?e.length/this.stride:0,this.array=e},setDynamic:function setDynamic(e){return this.dynamic=e,this},copy:function copy(e){return this.array=new e.array.constructor(e.array),this.count=e.count,this.stride=e.stride,this.dynamic=e.dynamic,this},copyAt:function copyAt(e,t,r){e*=this.stride,r*=t.stride;for(var n=0,i=this.stride;n<i;n++)this.array[e+n]=t.array[r+n];return this},set:function set(e,t){return void 0===t&&(t=0),this.array.set(e,t),this},clone:function clone(){return(new this.constructor).copy(this)},onUpload:function onUpload(e){return this.onUploadCallback=e,this}}),InstancedInterleavedBuffer.prototype=Object.assign(Object.create(InterleavedBuffer.prototype),{constructor:InstancedInterleavedBuffer,isInstancedInterleavedBuffer:!0,copy:function copy(e){return InterleavedBuffer.prototype.copy.call(this,e),this.meshPerAttribute=e.meshPerAttribute,this}}),InstancedBufferAttribute.prototype=Object.assign(Object.create(BufferAttribute.prototype),{constructor:InstancedBufferAttribute,isInstancedBufferAttribute:!0,copy:function copy(e){return BufferAttribute.prototype.copy.call(this,e),this.meshPerAttribute=e.meshPerAttribute,this}}),Object.assign(Raycaster.prototype,{linePrecision:1,set:function set(e,t){this.ray.set(e,t)},setFromCamera:function setFromCamera(e,t){t&&t.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(t.matrixWorld),this.ray.direction.set(e.x,e.y,.5).unproject(t).sub(this.ray.origin).normalize()):t&&t.isOrthographicCamera?(this.ray.origin.set(e.x,e.y,(t.near+t.far)/(t.near-t.far)).unproject(t),this.ray.direction.set(0,0,-1).transformDirection(t.matrixWorld)):console.error("THREE.Raycaster: Unsupported camera type.")},intersectObject:function intersectObject(e,t,r){var n=r||[];return _intersectObject(e,this,n,t),n.sort(ascSort),n},intersectObjects:function intersectObjects(e,t,r){var n=r||[];if(!1===Array.isArray(e))return console.warn("THREE.Raycaster.intersectObjects: objects is not an Array."),n;for(var i=0,o=e.length;i<o;i++)_intersectObject(e[i],this,n,t);return n.sort(ascSort),n}}),Object.assign(function Clock(e){this.autoStart=void 0===e||e,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}.prototype,{start:function start(){this.startTime=("undefined"==typeof performance?Date:performance).now(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0},stop:function stop(){this.getElapsedTime(),this.running=!1,this.autoStart=!1},getElapsedTime:function getElapsedTime(){return this.getDelta(),this.elapsedTime},getDelta:function getDelta(){var e=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){var t=("undefined"==typeof performance?Date:performance).now();e=(t-this.oldTime)/1e3,this.oldTime=t,this.elapsedTime+=e}return e}}),Object.assign(Spherical.prototype,{set:function set(e,t,r){return this.radius=e,this.phi=t,this.theta=r,this},clone:function clone(){return(new this.constructor).copy(this)},copy:function copy(e){return this.radius=e.radius,this.phi=e.phi,this.theta=e.theta,this},makeSafe:function makeSafe(){return this.phi=Math.max(1e-6,Math.min(Math.PI-1e-6,this.phi)),this},setFromVector3:function setFromVector3(e){return this.radius=e.length(),0===this.radius?(this.theta=0,this.phi=0):(this.theta=Math.atan2(e.x,e.z),this.phi=Math.acos(At.clamp(e.y/this.radius,-1,1))),this}}),Object.assign(function Cylindrical(e,t,r){return this.radius=void 0!==e?e:1,this.theta=void 0!==t?t:0,this.y=void 0!==r?r:0,this}.prototype,{set:function set(e,t,r){return this.radius=e,this.theta=t,this.y=r,this},clone:function clone(){return(new this.constructor).copy(this)},copy:function copy(e){return this.radius=e.radius,this.theta=e.theta,this.y=e.y,this},setFromVector3:function setFromVector3(e){return this.radius=Math.sqrt(e.x*e.x+e.z*e.z),this.theta=Math.atan2(e.x,e.z),this.y=e.y,this}}),Object.assign(Box2.prototype,{set:function set(e,t){return this.min.copy(e),this.max.copy(t),this},setFromPoints:function setFromPoints(e){this.makeEmpty();for(var t=0,r=e.length;t<r;t++)this.expandByPoint(e[t]);return this},setFromCenterAndSize:function(){var e=new Vector2;return function setFromCenterAndSize(t,r){var n=e.copy(r).multiplyScalar(.5);return this.min.copy(t).sub(n),this.max.copy(t).add(n),this}}(),clone:function clone(){return(new this.constructor).copy(this)},copy:function copy(e){return this.min.copy(e.min),this.max.copy(e.max),this},makeEmpty:function makeEmpty(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this},isEmpty:function isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y},getCenter:function getCenter(e){return void 0===e&&(console.warn("THREE.Box2: .getCenter() target is now required"),e=new Vector2),this.isEmpty()?e.set(0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)},getSize:function getSize(e){return void 0===e&&(console.warn("THREE.Box2: .getSize() target is now required"),e=new Vector2),this.isEmpty()?e.set(0,0):e.subVectors(this.max,this.min)},expandByPoint:function expandByPoint(e){return this.min.min(e),this.max.max(e),this},expandByVector:function expandByVector(e){return this.min.sub(e),this.max.add(e),this},expandByScalar:function expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this},containsPoint:function containsPoint(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y)},containsBox:function containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y},getParameter:function getParameter(e,t){return void 0===t&&(console.warn("THREE.Box2: .getParameter() target is now required"),t=new Vector2),t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y))},intersectsBox:function intersectsBox(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y)},clampPoint:function clampPoint(e,t){return void 0===t&&(console.warn("THREE.Box2: .clampPoint() target is now required"),t=new Vector2),t.copy(e).clamp(this.min,this.max)},distanceToPoint:function(){var e=new Vector2;return function distanceToPoint(t){return e.copy(t).clamp(this.min,this.max).sub(t).length()}}(),intersect:function intersect(e){return this.min.max(e.min),this.max.min(e.max),this},union:function union(e){return this.min.min(e.min),this.max.max(e.max),this},translate:function translate(e){return this.min.add(e),this.max.add(e),this},equals:function equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}),ImmediateRenderObject.prototype=Object.create(Object3D.prototype),ImmediateRenderObject.prototype.constructor=ImmediateRenderObject,ImmediateRenderObject.prototype.isImmediateRenderObject=!0,VertexNormalsHelper.prototype=Object.create(LineSegments.prototype),VertexNormalsHelper.prototype.constructor=VertexNormalsHelper,VertexNormalsHelper.prototype.update=function(){var e=new Vector3,t=new Vector3,r=new Matrix3;return function update(){var n=["a","b","c"];this.object.updateMatrixWorld(!0),r.getNormalMatrix(this.object.matrixWorld);var i=this.object.matrixWorld,o=this.geometry.attributes.position,a=this.object.geometry;if(a&&a.isGeometry)for(var s=a.vertices,c=a.faces,u=0,l=0,h=c.length;l<h;l++)for(var p=c[l],f=0,d=p.vertexNormals.length;f<d;f++){var m=s[p[n[f]]],g=p.vertexNormals[f];e.copy(m).applyMatrix4(i),t.copy(g).applyMatrix3(r).normalize().multiplyScalar(this.size).add(e),o.setXYZ(u,e.x,e.y,e.z),u+=1,o.setXYZ(u,t.x,t.y,t.z),u+=1}else if(a&&a.isBufferGeometry){var y=a.attributes.position,v=a.attributes.normal;for(u=0,f=0,d=y.count;f<d;f++)e.set(y.getX(f),y.getY(f),y.getZ(f)).applyMatrix4(i),t.set(v.getX(f),v.getY(f),v.getZ(f)),t.applyMatrix3(r).normalize().multiplyScalar(this.size).add(e),o.setXYZ(u,e.x,e.y,e.z),u+=1,o.setXYZ(u,t.x,t.y,t.z),u+=1}o.needsUpdate=!0}}(),SpotLightHelper.prototype=Object.create(Object3D.prototype),SpotLightHelper.prototype.constructor=SpotLightHelper,SpotLightHelper.prototype.dispose=function(){this.cone.geometry.dispose(),this.cone.material.dispose()},SpotLightHelper.prototype.update=function(){var e=new Vector3,t=new Vector3;return function update(){this.light.updateMatrixWorld();var r=this.light.distance?this.light.distance:1e3,n=r*Math.tan(this.light.angle);this.cone.scale.set(n,n,r),e.setFromMatrixPosition(this.light.matrixWorld),t.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(t.sub(e)),void 0!==this.color?this.cone.material.color.set(this.color):this.cone.material.color.copy(this.light.color)}}(),SkeletonHelper.prototype=Object.create(LineSegments.prototype),SkeletonHelper.prototype.constructor=SkeletonHelper,SkeletonHelper.prototype.updateMatrixWorld=function(){var e=new Vector3,t=new Matrix4,r=new Matrix4;return function updateMatrixWorld(n){var i=this.bones,o=this.geometry,a=o.getAttribute("position");r.getInverse(this.root.matrixWorld);for(var s=0,c=0;s<i.length;s++){var u=i[s];u.parent&&u.parent.isBone&&(t.multiplyMatrices(r,u.matrixWorld),e.setFromMatrixPosition(t),a.setXYZ(c,e.x,e.y,e.z),t.multiplyMatrices(r,u.parent.matrixWorld),e.setFromMatrixPosition(t),a.setXYZ(c+1,e.x,e.y,e.z),c+=2)}o.getAttribute("position").needsUpdate=!0,Object3D.prototype.updateMatrixWorld.call(this,n)}}(),PointLightHelper.prototype=Object.create(Mesh.prototype),PointLightHelper.prototype.constructor=PointLightHelper,PointLightHelper.prototype.dispose=function(){this.geometry.dispose(),this.material.dispose()},PointLightHelper.prototype.update=function(){void 0!==this.color?this.material.color.set(this.color):this.material.color.copy(this.light.color)},RectAreaLightHelper.prototype=Object.create(Object3D.prototype),RectAreaLightHelper.prototype.constructor=RectAreaLightHelper,RectAreaLightHelper.prototype.dispose=function(){this.children[0].geometry.dispose(),this.children[0].material.dispose()},RectAreaLightHelper.prototype.update=function(){var e=.5*this.light.width,t=.5*this.light.height,r=this.line.geometry.attributes.position,n=r.array;n[0]=e,n[1]=-t,n[2]=0,n[3]=e,n[4]=t,n[5]=0,n[6]=-e,n[7]=t,n[8]=0,n[9]=-e,n[10]=-t,n[11]=0,n[12]=e,n[13]=-t,n[14]=0,r.needsUpdate=!0,void 0!==this.color?this.line.material.color.set(this.color):this.line.material.color.copy(this.light.color)},HemisphereLightHelper.prototype=Object.create(Object3D.prototype),HemisphereLightHelper.prototype.constructor=HemisphereLightHelper,HemisphereLightHelper.prototype.dispose=function(){this.children[0].geometry.dispose(),this.children[0].material.dispose()},HemisphereLightHelper.prototype.update=function(){var e=new Vector3,t=new Color,r=new Color;return function update(){var n=this.children[0];if(void 0!==this.color)this.material.color.set(this.color);else{var i=n.geometry.getAttribute("color");t.copy(this.light.color),r.copy(this.light.groundColor);for(var o=0,a=i.count;o<a;o++){var s=o<a/2?t:r;i.setXYZ(o,s.r,s.g,s.b)}i.needsUpdate=!0}n.lookAt(e.setFromMatrixPosition(this.light.matrixWorld).negate())}}(),GridHelper.prototype=Object.create(LineSegments.prototype),GridHelper.prototype.constructor=GridHelper,PolarGridHelper.prototype=Object.create(LineSegments.prototype),PolarGridHelper.prototype.constructor=PolarGridHelper,FaceNormalsHelper.prototype=Object.create(LineSegments.prototype),FaceNormalsHelper.prototype.constructor=FaceNormalsHelper,FaceNormalsHelper.prototype.update=function(){var e=new Vector3,t=new Vector3,r=new Matrix3;return function update(){this.object.updateMatrixWorld(!0),r.getNormalMatrix(this.object.matrixWorld);for(var n=this.object.matrixWorld,i=this.geometry.attributes.position,o=this.object.geometry,a=o.vertices,s=o.faces,c=0,u=0,l=s.length;u<l;u++){var h=s[u],p=h.normal;e.copy(a[h.a]).add(a[h.b]).add(a[h.c]).divideScalar(3).applyMatrix4(n),t.copy(p).applyMatrix3(r).normalize().multiplyScalar(this.size).add(e),i.setXYZ(c,e.x,e.y,e.z),c+=1,i.setXYZ(c,t.x,t.y,t.z),c+=1}i.needsUpdate=!0}}(),DirectionalLightHelper.prototype=Object.create(Object3D.prototype),DirectionalLightHelper.prototype.constructor=DirectionalLightHelper,DirectionalLightHelper.prototype.dispose=function(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()},DirectionalLightHelper.prototype.update=function(){var e=new Vector3,t=new Vector3,r=new Vector3;return function update(){e.setFromMatrixPosition(this.light.matrixWorld),t.setFromMatrixPosition(this.light.target.matrixWorld),r.subVectors(t,e),this.lightPlane.lookAt(r),void 0!==this.color?(this.lightPlane.material.color.set(this.color),this.targetLine.material.color.set(this.color)):(this.lightPlane.material.color.copy(this.light.color),this.targetLine.material.color.copy(this.light.color)),this.targetLine.lookAt(r),this.targetLine.scale.z=r.length()}}(),CameraHelper.prototype=Object.create(LineSegments.prototype),CameraHelper.prototype.constructor=CameraHelper,CameraHelper.prototype.update=function(){var e,t,r=new Vector3,n=new Camera;function setPoint(i,o,a,s){r.set(o,a,s).unproject(n);var c=t[i];if(void 0!==c)for(var u=e.getAttribute("position"),l=0,h=c.length;l<h;l++)u.setXYZ(c[l],r.x,r.y,r.z)}return function update(){e=this.geometry,t=this.pointMap;n.projectionMatrix.copy(this.camera.projectionMatrix),setPoint("c",0,0,-1),setPoint("t",0,0,1),setPoint("n1",-1,-1,-1),setPoint("n2",1,-1,-1),setPoint("n3",-1,1,-1),setPoint("n4",1,1,-1),setPoint("f1",-1,-1,1),setPoint("f2",1,-1,1),setPoint("f3",-1,1,1),setPoint("f4",1,1,1),setPoint("u1",.7,1.1,-1),setPoint("u2",-.7,1.1,-1),setPoint("u3",0,2,-1),setPoint("cf1",-1,0,1),setPoint("cf2",1,0,1),setPoint("cf3",0,-1,1),setPoint("cf4",0,1,1),setPoint("cn1",-1,0,-1),setPoint("cn2",1,0,-1),setPoint("cn3",0,-1,-1),setPoint("cn4",0,1,-1),e.getAttribute("position").needsUpdate=!0}}(),BoxHelper.prototype=Object.create(LineSegments.prototype),BoxHelper.prototype.constructor=BoxHelper,BoxHelper.prototype.update=function(){var e=new Box3;return function update(t){if(void 0!==t&&console.warn("THREE.BoxHelper: .update() has no longer arguments."),void 0!==this.object&&e.setFromObject(this.object),!e.isEmpty()){var r=e.min,n=e.max,i=this.geometry.attributes.position,o=i.array;o[0]=n.x,o[1]=n.y,o[2]=n.z,o[3]=r.x,o[4]=n.y,o[5]=n.z,o[6]=r.x,o[7]=r.y,o[8]=n.z,o[9]=n.x,o[10]=r.y,o[11]=n.z,o[12]=n.x,o[13]=n.y,o[14]=r.z,o[15]=r.x,o[16]=n.y,o[17]=r.z,o[18]=r.x,o[19]=r.y,o[20]=r.z,o[21]=n.x,o[22]=r.y,o[23]=r.z,i.needsUpdate=!0,this.geometry.computeBoundingSphere()}}}(),BoxHelper.prototype.setFromObject=function(e){return this.object=e,this.update(),this},Box3Helper.prototype=Object.create(LineSegments.prototype),Box3Helper.prototype.constructor=Box3Helper,Box3Helper.prototype.updateMatrixWorld=function(e){var t=this.box;t.isEmpty()||(t.getCenter(this.position),t.getSize(this.scale),this.scale.multiplyScalar(.5),Object3D.prototype.updateMatrixWorld.call(this,e))},PlaneHelper.prototype=Object.create(Line.prototype),PlaneHelper.prototype.constructor=PlaneHelper,PlaneHelper.prototype.updateMatrixWorld=function(e){var t=-this.plane.constant;Math.abs(t)<1e-8&&(t=1e-8),this.scale.set(.5*this.size,.5*this.size,t),this.lookAt(this.plane.normal),Object3D.prototype.updateMatrixWorld.call(this,e)},ArrowHelper.prototype=Object.create(Object3D.prototype),ArrowHelper.prototype.constructor=ArrowHelper,ArrowHelper.prototype.setDirection=(vn=new Vector3,function setDirection(e){e.y>.99999?this.quaternion.set(0,0,0,1):e.y<-.99999?this.quaternion.set(1,0,0,0):(vn.set(e.z,0,-e.x).normalize(),yn=Math.acos(e.y),this.quaternion.setFromAxisAngle(vn,yn))}),ArrowHelper.prototype.setLength=function(e,t,r){void 0===t&&(t=.2*e),void 0===r&&(r=.2*t),this.line.scale.set(1,Math.max(0,e-t),1),this.line.updateMatrix(),this.cone.scale.set(r,t,r),this.cone.position.y=e,this.cone.updateMatrix()},ArrowHelper.prototype.setColor=function(e){this.line.material.color.copy(e),this.cone.material.color.copy(e)},AxesHelper.prototype=Object.create(LineSegments.prototype),AxesHelper.prototype.constructor=AxesHelper;function MultiMaterial(e){return void 0===e&&(e=[]),console.warn("THREE.MultiMaterial has been removed. Use an Array instead."),e.isMultiMaterial=!0,e.materials=e,e.clone=function(){return e.slice()},e}function Spline(e){console.warn("THREE.Spline has been removed. Use THREE.CatmullRomCurve3 instead."),CatmullRomCurve3.call(this,e),this.type="catmullrom"}Curve.create=function(e,t){return console.log("THREE.Curve.create() has been deprecated"),e.prototype=Object.create(Curve.prototype),e.prototype.constructor=e,e.prototype.getPoint=t,e},Object.assign(CurvePath.prototype,{createPointsGeometry:function createPointsGeometry(e){console.warn("THREE.CurvePath: .createPointsGeometry() has been removed. Use new THREE.Geometry().setFromPoints( points ) instead.");var t=this.getPoints(e);return this.createGeometry(t)},createSpacedPointsGeometry:function createSpacedPointsGeometry(e){console.warn("THREE.CurvePath: .createSpacedPointsGeometry() has been removed. Use new THREE.Geometry().setFromPoints( points ) instead.");var t=this.getSpacedPoints(e);return this.createGeometry(t)},createGeometry:function createGeometry(e){console.warn("THREE.CurvePath: .createGeometry() has been removed. Use new THREE.Geometry().setFromPoints( points ) instead.");for(var t=new Geometry,r=0,n=e.length;r<n;r++){var i=e[r];t.vertices.push(new Vector3(i.x,i.y,i.z||0))}return t}}),Object.assign(Path.prototype,{fromPoints:function fromPoints(e){console.warn("THREE.Path: .fromPoints() has been renamed to .setFromPoints()."),this.setFromPoints(e)}}),Object.create(CatmullRomCurve3.prototype),Object.create(CatmullRomCurve3.prototype),Spline.prototype=Object.create(CatmullRomCurve3.prototype),Object.assign(Spline.prototype,{initFromArray:function initFromArray(){console.error("THREE.Spline: .initFromArray() has been removed.")},getControlPointsArray:function getControlPointsArray(){console.error("THREE.Spline: .getControlPointsArray() has been removed.")},reparametrizeByArcLength:function reparametrizeByArcLength(){console.error("THREE.Spline: .reparametrizeByArcLength() has been removed.")}}),GridHelper.prototype.setColors=function(){console.error("THREE.GridHelper: setColors() has been deprecated, pass them in the constructor instead.")},SkeletonHelper.prototype.update=function(){console.error("THREE.SkeletonHelper: update() no longer needs to be called.")},Object.assign(Loader.prototype,{extractUrlBase:function extractUrlBase(e){return console.warn("THREE.Loader: .extractUrlBase() has been deprecated. Use THREE.LoaderUtils.extractUrlBase() instead."),zr(e)}}),Object.assign(Box2.prototype,{center:function center(e){return console.warn("THREE.Box2: .center() has been renamed to .getCenter()."),this.getCenter(e)},empty:function empty(){return console.warn("THREE.Box2: .empty() has been renamed to .isEmpty()."),this.isEmpty()},isIntersectionBox:function isIntersectionBox(e){return console.warn("THREE.Box2: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(e)},size:function size(e){return console.warn("THREE.Box2: .size() has been renamed to .getSize()."),this.getSize(e)}}),Object.assign(Box3.prototype,{center:function center(e){return console.warn("THREE.Box3: .center() has been renamed to .getCenter()."),this.getCenter(e)},empty:function empty(){return console.warn("THREE.Box3: .empty() has been renamed to .isEmpty()."),this.isEmpty()},isIntersectionBox:function isIntersectionBox(e){return console.warn("THREE.Box3: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(e)},isIntersectionSphere:function isIntersectionSphere(e){return console.warn("THREE.Box3: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(e)},size:function size(e){return console.warn("THREE.Box3: .size() has been renamed to .getSize()."),this.getSize(e)}}),Line3.prototype.center=function(e){return console.warn("THREE.Line3: .center() has been renamed to .getCenter()."),this.getCenter(e)},Object.assign(At,{random16:function random16(){return console.warn("THREE.Math: .random16() has been deprecated. Use Math.random() instead."),Math.random()},nearestPowerOfTwo:function nearestPowerOfTwo(e){return console.warn("THREE.Math: .nearestPowerOfTwo() has been renamed to .floorPowerOfTwo()."),At.floorPowerOfTwo(e)},nextPowerOfTwo:function nextPowerOfTwo(e){return console.warn("THREE.Math: .nextPowerOfTwo() has been renamed to .ceilPowerOfTwo()."),At.ceilPowerOfTwo(e)}}),Object.assign(Matrix3.prototype,{flattenToArrayOffset:function flattenToArrayOffset(e,t){return console.warn("THREE.Matrix3: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(e,t)},multiplyVector3:function multiplyVector3(e){return console.warn("THREE.Matrix3: .multiplyVector3() has been removed. Use vector.applyMatrix3( matrix ) instead."),e.applyMatrix3(this)},multiplyVector3Array:function multiplyVector3Array(){console.error("THREE.Matrix3: .multiplyVector3Array() has been removed.")},applyToBuffer:function applyToBuffer(e){return console.warn("THREE.Matrix3: .applyToBuffer() has been removed. Use matrix.applyToBufferAttribute( attribute ) instead."),this.applyToBufferAttribute(e)},applyToVector3Array:function applyToVector3Array(){console.error("THREE.Matrix3: .applyToVector3Array() has been removed.")}}),Object.assign(Matrix4.prototype,{extractPosition:function extractPosition(e){return console.warn("THREE.Matrix4: .extractPosition() has been renamed to .copyPosition()."),this.copyPosition(e)},flattenToArrayOffset:function flattenToArrayOffset(e,t){return console.warn("THREE.Matrix4: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(e,t)},getPosition:function(){var e;return function getPosition(){return void 0===e&&(e=new Vector3),console.warn("THREE.Matrix4: .getPosition() has been removed. Use Vector3.setFromMatrixPosition( matrix ) instead."),e.setFromMatrixColumn(this,3)}}(),setRotationFromQuaternion:function setRotationFromQuaternion(e){return console.warn("THREE.Matrix4: .setRotationFromQuaternion() has been renamed to .makeRotationFromQuaternion()."),this.makeRotationFromQuaternion(e)},multiplyToArray:function multiplyToArray(){console.warn("THREE.Matrix4: .multiplyToArray() has been removed.")},multiplyVector3:function multiplyVector3(e){return console.warn("THREE.Matrix4: .multiplyVector3() has been removed. Use vector.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},multiplyVector4:function multiplyVector4(e){return console.warn("THREE.Matrix4: .multiplyVector4() has been removed. Use vector.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},multiplyVector3Array:function multiplyVector3Array(){console.error("THREE.Matrix4: .multiplyVector3Array() has been removed.")},rotateAxis:function rotateAxis(e){console.warn("THREE.Matrix4: .rotateAxis() has been removed. Use Vector3.transformDirection( matrix ) instead."),e.transformDirection(this)},crossVector:function crossVector(e){return console.warn("THREE.Matrix4: .crossVector() has been removed. Use vector.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},translate:function translate(){console.error("THREE.Matrix4: .translate() has been removed.")},rotateX:function rotateX(){console.error("THREE.Matrix4: .rotateX() has been removed.")},rotateY:function rotateY(){console.error("THREE.Matrix4: .rotateY() has been removed.")},rotateZ:function rotateZ(){console.error("THREE.Matrix4: .rotateZ() has been removed.")},rotateByAxis:function rotateByAxis(){console.error("THREE.Matrix4: .rotateByAxis() has been removed.")},applyToBuffer:function applyToBuffer(e){return console.warn("THREE.Matrix4: .applyToBuffer() has been removed. Use matrix.applyToBufferAttribute( attribute ) instead."),this.applyToBufferAttribute(e)},applyToVector3Array:function applyToVector3Array(){console.error("THREE.Matrix4: .applyToVector3Array() has been removed.")},makeFrustum:function makeFrustum(e,t,r,n,i,o){return console.warn("THREE.Matrix4: .makeFrustum() has been removed. Use .makePerspective( left, right, top, bottom, near, far ) instead."),this.makePerspective(e,t,n,r,i,o)}}),Plane.prototype.isIntersectionLine=function(e){return console.warn("THREE.Plane: .isIntersectionLine() has been renamed to .intersectsLine()."),this.intersectsLine(e)},Quaternion.prototype.multiplyVector3=function(e){return console.warn("THREE.Quaternion: .multiplyVector3() has been removed. Use is now vector.applyQuaternion( quaternion ) instead."),e.applyQuaternion(this)},Object.assign(Ray.prototype,{isIntersectionBox:function isIntersectionBox(e){return console.warn("THREE.Ray: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(e)},isIntersectionPlane:function isIntersectionPlane(e){return console.warn("THREE.Ray: .isIntersectionPlane() has been renamed to .intersectsPlane()."),this.intersectsPlane(e)},isIntersectionSphere:function isIntersectionSphere(e){return console.warn("THREE.Ray: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(e)}}),Object.assign(Triangle.prototype,{area:function area(){return console.warn("THREE.Triangle: .area() has been renamed to .getArea()."),this.getArea()},barycoordFromPoint:function barycoordFromPoint(e,t){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),this.getBarycoord(e,t)},midpoint:function midpoint(e){return console.warn("THREE.Triangle: .midpoint() has been renamed to .getMidpoint()."),this.getMidpoint(e)},normal:function normal(e){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),this.getNormal(e)},plane:function plane(e){return console.warn("THREE.Triangle: .plane() has been renamed to .getPlane()."),this.getPlane(e)}}),Object.assign(Triangle,{barycoordFromPoint:function barycoordFromPoint(e,t,r,n,i){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),Triangle.getBarycoord(e,t,r,n,i)},normal:function normal(e,t,r,n){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),Triangle.getNormal(e,t,r,n)}}),Object.assign(Shape.prototype,{extractAllPoints:function extractAllPoints(e){return console.warn("THREE.Shape: .extractAllPoints() has been removed. Use .extractPoints() instead."),this.extractPoints(e)},extrude:function extrude(e){return console.warn("THREE.Shape: .extrude() has been removed. Use ExtrudeGeometry() instead."),new ExtrudeGeometry(this,e)},makeGeometry:function makeGeometry(e){return console.warn("THREE.Shape: .makeGeometry() has been removed. Use ShapeGeometry() instead."),new ShapeGeometry(this,e)}}),Object.assign(Vector2.prototype,{fromAttribute:function fromAttribute(e,t,r){return console.warn("THREE.Vector2: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(e,t,r)},distanceToManhattan:function distanceToManhattan(e){return console.warn("THREE.Vector2: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(e)},lengthManhattan:function lengthManhattan(){return console.warn("THREE.Vector2: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()}}),Object.assign(Vector3.prototype,{setEulerFromRotationMatrix:function setEulerFromRotationMatrix(){console.error("THREE.Vector3: .setEulerFromRotationMatrix() has been removed. Use Euler.setFromRotationMatrix() instead.")},setEulerFromQuaternion:function setEulerFromQuaternion(){console.error("THREE.Vector3: .setEulerFromQuaternion() has been removed. Use Euler.setFromQuaternion() instead.")},getPositionFromMatrix:function getPositionFromMatrix(e){return console.warn("THREE.Vector3: .getPositionFromMatrix() has been renamed to .setFromMatrixPosition()."),this.setFromMatrixPosition(e)},getScaleFromMatrix:function getScaleFromMatrix(e){return console.warn("THREE.Vector3: .getScaleFromMatrix() has been renamed to .setFromMatrixScale()."),this.setFromMatrixScale(e)},getColumnFromMatrix:function getColumnFromMatrix(e,t){return console.warn("THREE.Vector3: .getColumnFromMatrix() has been renamed to .setFromMatrixColumn()."),this.setFromMatrixColumn(t,e)},applyProjection:function applyProjection(e){return console.warn("THREE.Vector3: .applyProjection() has been removed. Use .applyMatrix4( m ) instead."),this.applyMatrix4(e)},fromAttribute:function fromAttribute(e,t,r){return console.warn("THREE.Vector3: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(e,t,r)},distanceToManhattan:function distanceToManhattan(e){return console.warn("THREE.Vector3: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(e)},lengthManhattan:function lengthManhattan(){return console.warn("THREE.Vector3: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()}}),Object.assign(Vector4.prototype,{fromAttribute:function fromAttribute(e,t,r){return console.warn("THREE.Vector4: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(e,t,r)},lengthManhattan:function lengthManhattan(){return console.warn("THREE.Vector4: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()}}),Object.assign(Geometry.prototype,{computeTangents:function computeTangents(){console.error("THREE.Geometry: .computeTangents() has been removed.")},computeLineDistances:function computeLineDistances(){console.error("THREE.Geometry: .computeLineDistances() has been removed. Use THREE.Line.computeLineDistances() instead.")}}),Object.assign(Object3D.prototype,{getChildByName:function getChildByName(e){return console.warn("THREE.Object3D: .getChildByName() has been renamed to .getObjectByName()."),this.getObjectByName(e)},renderDepth:function renderDepth(){console.warn("THREE.Object3D: .renderDepth has been removed. Use .renderOrder, instead.")},translate:function translate(e,t){return console.warn("THREE.Object3D: .translate() has been removed. Use .translateOnAxis( axis, distance ) instead."),this.translateOnAxis(t,e)},getWorldRotation:function getWorldRotation(){console.error("THREE.Object3D: .getWorldRotation() has been removed. Use THREE.Object3D.getWorldQuaternion( target ) instead.")}}),Object.defineProperties(Object3D.prototype,{eulerOrder:{get:function get(){return console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order},set:function set(e){console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order=e}},useQuaternion:{get:function get(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")},set:function set(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")}}}),Object.defineProperties(LOD.prototype,{objects:{get:function get(){return console.warn("THREE.LOD: .objects has been renamed to .levels."),this.levels}}}),Object.defineProperty(Skeleton.prototype,"useVertexTexture",{get:function get(){console.warn("THREE.Skeleton: useVertexTexture has been removed.")},set:function set(){console.warn("THREE.Skeleton: useVertexTexture has been removed.")}}),Object.defineProperty(Curve.prototype,"__arcLengthDivisions",{get:function get(){return console.warn("THREE.Curve: .__arcLengthDivisions is now .arcLengthDivisions."),this.arcLengthDivisions},set:function set(e){console.warn("THREE.Curve: .__arcLengthDivisions is now .arcLengthDivisions."),this.arcLengthDivisions=e}}),PerspectiveCamera.prototype.setLens=function(e,t){console.warn("THREE.PerspectiveCamera.setLens is deprecated. Use .setFocalLength and .filmGauge for a photographic setup."),void 0!==t&&(this.filmGauge=t),this.setFocalLength(e)},Object.defineProperties(Light.prototype,{onlyShadow:{set:function set(){console.warn("THREE.Light: .onlyShadow has been removed.")}},shadowCameraFov:{set:function set(e){console.warn("THREE.Light: .shadowCameraFov is now .shadow.camera.fov."),this.shadow.camera.fov=e}},shadowCameraLeft:{set:function set(e){console.warn("THREE.Light: .shadowCameraLeft is now .shadow.camera.left."),this.shadow.camera.left=e}},shadowCameraRight:{set:function set(e){console.warn("THREE.Light: .shadowCameraRight is now .shadow.camera.right."),this.shadow.camera.right=e}},shadowCameraTop:{set:function set(e){console.warn("THREE.Light: .shadowCameraTop is now .shadow.camera.top."),this.shadow.camera.top=e}},shadowCameraBottom:{set:function set(e){console.warn("THREE.Light: .shadowCameraBottom is now .shadow.camera.bottom."),this.shadow.camera.bottom=e}},shadowCameraNear:{set:function set(e){console.warn("THREE.Light: .shadowCameraNear is now .shadow.camera.near."),this.shadow.camera.near=e}},shadowCameraFar:{set:function set(e){console.warn("THREE.Light: .shadowCameraFar is now .shadow.camera.far."),this.shadow.camera.far=e}},shadowCameraVisible:{set:function set(){console.warn("THREE.Light: .shadowCameraVisible has been removed. Use new THREE.CameraHelper( light.shadow.camera ) instead.")}},shadowBias:{set:function set(e){console.warn("THREE.Light: .shadowBias is now .shadow.bias."),this.shadow.bias=e}},shadowDarkness:{set:function set(){console.warn("THREE.Light: .shadowDarkness has been removed.")}},shadowMapWidth:{set:function set(e){console.warn("THREE.Light: .shadowMapWidth is now .shadow.mapSize.width."),this.shadow.mapSize.width=e}},shadowMapHeight:{set:function set(e){console.warn("THREE.Light: .shadowMapHeight is now .shadow.mapSize.height."),this.shadow.mapSize.height=e}}}),Object.defineProperties(BufferAttribute.prototype,{length:{get:function get(){return console.warn("THREE.BufferAttribute: .length has been deprecated. Use .count instead."),this.array.length}},copyIndicesArray:function copyIndicesArray(){console.error("THREE.BufferAttribute: .copyIndicesArray() has been removed.")}}),Object.assign(BufferGeometry.prototype,{addIndex:function addIndex(e){console.warn("THREE.BufferGeometry: .addIndex() has been renamed to .setIndex()."),this.setIndex(e)},addDrawCall:function addDrawCall(e,t,r){void 0!==r&&console.warn("THREE.BufferGeometry: .addDrawCall() no longer supports indexOffset."),console.warn("THREE.BufferGeometry: .addDrawCall() is now .addGroup()."),this.addGroup(e,t)},clearDrawCalls:function clearDrawCalls(){console.warn("THREE.BufferGeometry: .clearDrawCalls() is now .clearGroups()."),this.clearGroups()},computeTangents:function computeTangents(){console.warn("THREE.BufferGeometry: .computeTangents() has been removed.")},computeOffsets:function computeOffsets(){console.warn("THREE.BufferGeometry: .computeOffsets() has been removed.")}}),Object.defineProperties(BufferGeometry.prototype,{drawcalls:{get:function get(){return console.error("THREE.BufferGeometry: .drawcalls has been renamed to .groups."),this.groups}},offsets:{get:function get(){return console.warn("THREE.BufferGeometry: .offsets has been renamed to .groups."),this.groups}}}),Object.defineProperties(Uniform.prototype,{dynamic:{set:function set(){console.warn("THREE.Uniform: .dynamic has been removed. Use object.onBeforeRender() instead.")}},onUpdate:{value:function value(){return console.warn("THREE.Uniform: .onUpdate() has been removed. Use object.onBeforeRender() instead."),this}}}),Object.defineProperties(Material.prototype,{wrapAround:{get:function get(){console.warn("THREE.Material: .wrapAround has been removed.")},set:function set(){console.warn("THREE.Material: .wrapAround has been removed.")}},wrapRGB:{get:function get(){return console.warn("THREE.Material: .wrapRGB has been removed."),new Color}},shading:{get:function get(){console.error("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead.")},set:function set(e){console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=1===e}}}),Object.defineProperties(MeshPhongMaterial.prototype,{metal:{get:function get(){return console.warn("THREE.MeshPhongMaterial: .metal has been removed. Use THREE.MeshStandardMaterial instead."),!1},set:function set(){console.warn("THREE.MeshPhongMaterial: .metal has been removed. Use THREE.MeshStandardMaterial instead")}}}),Object.defineProperties(ShaderMaterial.prototype,{derivatives:{get:function get(){return console.warn("THREE.ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives},set:function set(e){console.warn("THREE. ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives=e}}}),Object.assign(WebGLRenderer.prototype,{getCurrentRenderTarget:function getCurrentRenderTarget(){return console.warn("THREE.WebGLRenderer: .getCurrentRenderTarget() is now .getRenderTarget()."),this.getRenderTarget()},getMaxAnisotropy:function getMaxAnisotropy(){return console.warn("THREE.WebGLRenderer: .getMaxAnisotropy() is now .capabilities.getMaxAnisotropy()."),this.capabilities.getMaxAnisotropy()},getPrecision:function getPrecision(){return console.warn("THREE.WebGLRenderer: .getPrecision() is now .capabilities.precision."),this.capabilities.precision},resetGLState:function resetGLState(){return console.warn("THREE.WebGLRenderer: .resetGLState() is now .state.reset()."),this.state.reset()},supportsFloatTextures:function supportsFloatTextures(){return console.warn("THREE.WebGLRenderer: .supportsFloatTextures() is now .extensions.get( 'OES_texture_float' )."),this.extensions.get("OES_texture_float")},supportsHalfFloatTextures:function supportsHalfFloatTextures(){return console.warn("THREE.WebGLRenderer: .supportsHalfFloatTextures() is now .extensions.get( 'OES_texture_half_float' )."),this.extensions.get("OES_texture_half_float")},supportsStandardDerivatives:function supportsStandardDerivatives(){return console.warn("THREE.WebGLRenderer: .supportsStandardDerivatives() is now .extensions.get( 'OES_standard_derivatives' )."),this.extensions.get("OES_standard_derivatives")},supportsCompressedTextureS3TC:function supportsCompressedTextureS3TC(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTextureS3TC() is now .extensions.get( 'WEBGL_compressed_texture_s3tc' )."),this.extensions.get("WEBGL_compressed_texture_s3tc")},supportsCompressedTexturePVRTC:function supportsCompressedTexturePVRTC(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTexturePVRTC() is now .extensions.get( 'WEBGL_compressed_texture_pvrtc' )."),this.extensions.get("WEBGL_compressed_texture_pvrtc")},supportsBlendMinMax:function supportsBlendMinMax(){return console.warn("THREE.WebGLRenderer: .supportsBlendMinMax() is now .extensions.get( 'EXT_blend_minmax' )."),this.extensions.get("EXT_blend_minmax")},supportsVertexTextures:function supportsVertexTextures(){return console.warn("THREE.WebGLRenderer: .supportsVertexTextures() is now .capabilities.vertexTextures."),this.capabilities.vertexTextures},supportsInstancedArrays:function supportsInstancedArrays(){return console.warn("THREE.WebGLRenderer: .supportsInstancedArrays() is now .extensions.get( 'ANGLE_instanced_arrays' )."),this.extensions.get("ANGLE_instanced_arrays")},enableScissorTest:function enableScissorTest(e){console.warn("THREE.WebGLRenderer: .enableScissorTest() is now .setScissorTest()."),this.setScissorTest(e)},initMaterial:function initMaterial(){console.warn("THREE.WebGLRenderer: .initMaterial() has been removed.")},addPrePlugin:function addPrePlugin(){console.warn("THREE.WebGLRenderer: .addPrePlugin() has been removed.")},addPostPlugin:function addPostPlugin(){console.warn("THREE.WebGLRenderer: .addPostPlugin() has been removed.")},updateShadowMap:function updateShadowMap(){console.warn("THREE.WebGLRenderer: .updateShadowMap() has been removed.")},setFaceCulling:function setFaceCulling(){console.warn("THREE.WebGLRenderer: .setFaceCulling() has been removed.")}}),Object.defineProperties(WebGLRenderer.prototype,{shadowMapEnabled:{get:function get(){return this.shadowMap.enabled},set:function set(e){console.warn("THREE.WebGLRenderer: .shadowMapEnabled is now .shadowMap.enabled."),this.shadowMap.enabled=e}},shadowMapType:{get:function get(){return this.shadowMap.type},set:function set(e){console.warn("THREE.WebGLRenderer: .shadowMapType is now .shadowMap.type."),this.shadowMap.type=e}},shadowMapCullFace:{get:function get(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")},set:function set(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")}}}),Object.defineProperties(WebGLShadowMap.prototype,{cullFace:{get:function get(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")},set:function set(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")}},renderReverseSided:{get:function get(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")},set:function set(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")}},renderSingleSided:{get:function get(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")},set:function set(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")}}}),Object.defineProperties(WebGLRenderTarget.prototype,{wrapS:{get:function get(){return console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS},set:function set(e){console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS=e}},wrapT:{get:function get(){return console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT},set:function set(e){console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT=e}},magFilter:{get:function get(){return console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter},set:function set(e){console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter=e}},minFilter:{get:function get(){return console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter},set:function set(e){console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter=e}},anisotropy:{get:function get(){return console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy},set:function set(e){console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy=e}},offset:{get:function get(){return console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset},set:function set(e){console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset=e}},repeat:{get:function get(){return console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat},set:function set(e){console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat=e}},format:{get:function get(){return console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format},set:function set(e){console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format=e}},type:{get:function get(){return console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type},set:function set(e){console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type=e}},generateMipmaps:{get:function get(){return console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps},set:function set(e){console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps=e}}}),Object.defineProperties(WebVRManager.prototype,{standing:{set:function set(){console.warn("THREE.WebVRManager: .standing has been removed.")}}}),Audio.prototype.load=function(e){console.warn("THREE.Audio: .load has been deprecated. Use THREE.AudioLoader instead.");var t=this;return(new AudioLoader).load(e,function(e){t.setBuffer(e)}),this},AudioAnalyser.prototype.getData=function(){return console.warn("THREE.AudioAnalyser: .getData() is now .getFrequencyData()."),this.getFrequencyData()},CubeCamera.prototype.updateCubeMap=function(e,t){return console.warn("THREE.CubeCamera: .updateCubeMap() is now .update()."),this.update(e,t)}},function(e,t,r){(function(r,i){var o,a,s,u,l="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};u=function(o){"use strict";function _(e){return(_="function"==typeof Symbol&&"symbol"==l(Symbol.iterator)?function(e){return void 0===e?"undefined":l(e)}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":void 0===e?"undefined":l(e)})(e)}function n(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function e(e,t,r){return t&&n(e.prototype,t),r&&n(e,r),e}function f(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter(function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable}))),n.forEach(function(t){var n,i,o;n=e,o=r[i=t],i in n?Object.defineProperty(n,i,{value:o,enumerable:!0,configurable:!0,writable:!0}):n[i]=o})}return e}function c(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=[],n=!0,i=!1,o=void 0;try{for(var a,s=e[Symbol.iterator]();!(n=(a=s.next()).done)&&(r.push(a.value),!t||r.length!==t);n=!0);}catch(e){i=!0,o=e}finally{try{n||null==s.return||s.return()}finally{if(i)throw o}}return r}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}"function"==typeof Symbol&&Symbol.asyncIterator&&Symbol.asyncIterator;var a,s="undefined"!=typeof window?window:void 0!==r?r:this,u=s.requestAnimationFrame||function(e){return s.setTimeout(e,16)},h=s.cancelAnimationFrame||function(e){return s.clearTimeout(e)},m=function(){if(void 0===i||void 0===i.hrtime||i.versions&&void 0!==i.versions.electron){if(void 0!==s.performance&&void 0!==s.performance.now)return s.performance.now.bind(s.performance);var e=s.performance&&s.performance.timing&&s.performance.timing.navigationStart?s.performance.timing.navigationStart:Date.now();return function(){return Date.now()-e}}return function(){var e=i.hrtime();return 1e3*e[0]+e[1]/1e6}}(),g=[],y=!1,v=!1,b=u,w=h,M=0,C=function p(e){var t=g.indexOf(e);-1<t&&g.splice(t,1),g.push(e),M=0,v&&!y&&(a=b(T),y=!0)},P=function d(e){for(var t=0;t<g.length;t++)if(e===g[t])return g[t];return null},E=function x(e){var t=g.indexOf(e);-1!==t&&g.splice(t,1)},T=function t(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:m(),r=1<arguments.length?arguments[1]:void 0;if(v&&y&&(a=b(t)),g.length||M++,120<M)return w(a),M=0,y=!1;for(var n=0;n<g.length;)g[n++].update(e,r);return!0},O={},L={Linear:{None:function None(e){return e}},Quadratic:{In:function In(e){return e*e},Out:function Out(e){return e*(2-e)},InOut:function InOut(e){return(e*=2)<1?.5*e*e:-.5*(--e*(e-2)-1)}},Cubic:{In:function In(e){return e*e*e},Out:function Out(e){return--e*e*e+1},InOut:function InOut(e){return(e*=2)<1?.5*e*e*e:.5*((e-=2)*e*e+2)}},Quartic:{In:function In(e){return e*e*e*e},Out:function Out(e){return 1- --e*e*e*e},InOut:function InOut(e){return(e*=2)<1?.5*e*e*e*e:-.5*((e-=2)*e*e*e-2)}},Quintic:{In:function In(e){return e*e*e*e*e},Out:function Out(e){return--e*e*e*e*e+1},InOut:function InOut(e){return(e*=2)<1?.5*e*e*e*e*e:.5*((e-=2)*e*e*e*e+2)}},Sinusoidal:{In:function In(e){return 1-Math.cos(e*Math.PI/2)},Out:function Out(e){return Math.sin(e*Math.PI/2)},InOut:function InOut(e){return.5*(1-Math.cos(Math.PI*e))}},Exponential:{In:function In(e){return 0===e?0:Math.pow(1024,e-1)},Out:function Out(e){return 1===e?1:1-Math.pow(2,-10*e)},InOut:function InOut(e){return 0===e?0:1===e?1:(e*=2)<1?.5*Math.pow(1024,e-1):.5*(2-Math.pow(2,-10*(e-1)))}},Circular:{In:function In(e){return 1-Math.sqrt(1-e*e)},Out:function Out(e){return Math.sqrt(1- --e*e)},InOut:function InOut(e){return(e*=2)<1?-.5*(Math.sqrt(1-e*e)-1):.5*(Math.sqrt(1-(e-=2)*e)+1)}},Elastic:{In:function In(e){return 0===e?0:1===e?1:-Math.pow(2,10*(e-1))*Math.sin(5*(e-1.1)*Math.PI)},Out:function Out(e){return 0===e?0:1===e?1:Math.pow(2,-10*e)*Math.sin(5*(e-.1)*Math.PI)+1},InOut:function InOut(e){return 0===e?0:1===e?1:(e*=2)<1?-.5*Math.pow(2,10*(e-1))*Math.sin(5*(e-1.1)*Math.PI):.5*Math.pow(2,-10*(e-1))*Math.sin(5*(e-1.1)*Math.PI)+1}},Back:{In:function In(e){return e*e*(2.70158*e-1.70158)},Out:function Out(e){return--e*e*(2.70158*e+1.70158)+1},InOut:function InOut(e){var t=2.5949095;return(e*=2)<1?e*e*((t+1)*e-t)*.5:.5*((e-=2)*e*((t+1)*e+t)+2)}},Bounce:{In:function In(e){return 1-L.Bounce.Out(1-e)},Out:function Out(e){return e<1/2.75?7.5625*e*e:e<2/2.75?7.5625*(e-=1.5/2.75)*e+.75:e<2.5/2.75?7.5625*(e-=2.25/2.75)*e+.9375:7.5625*(e-=2.625/2.75)*e+.984375},InOut:function InOut(e){return e<.5?.5*L.Bounce.In(2*e):.5*L.Bounce.Out(2*e-1)+.5}},Stepped:{steps:function steps(e){return function(t){return(t*e|0)/e}}}},R="_chainedTweens",I="Callback",F="STRING_PROP",j=/\s+|([A-Za-z?().,{}:""[\]#%]+)|([-+]=+)?([-+]+)?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]=?\d+)?/g;function k(e){if(e&&e.nodeType||void 0===e||"object"!==_(e))return e;if(Array.isArray(e))return[].concat(e);if("object"===_(e)){var t={};for(var r in e)t[r]=k(e[r]);return t}return e}var V=function w(e){return isNaN(+e)||("+"===e[0]||"-"===e[0])&&"="===e[1]||""===e||" "===e},D=/^#([0-9a-f]{6}|[0-9a-f]{3})$/i,G=function I(e,t){var r,n,i;3===t.length&&(t=(r=t[0])+r+(n=t[1])+n+(i=t[2])+i);var o=parseInt(t,16);return"rgb("+(r=o>>16&255)+","+(n=o>>8&255)+","+(i=255&o)+")"};function A(e){return"string"!=typeof e?e:e.replace(D,G).match(j).map(function(e){return V(e)?e:+e})}function S(e,t,r,n,i){var o=r[e],a=n[e];if("string"==typeof o||"string"==typeof a){for(var s=Array.isArray(o)&&o[0]===F?o:A(o),c=Array.isArray(a)&&a[0]===F?a:A(a),u=1;u<s.length;)s[u]===c[u]&&"string"==typeof s[u-1]?(s.splice(u-1,2,s[u-1]+s[u]),c.splice(u-1,2,c[u-1]+c[u])):u++;s[u=0]===F&&s.shift(),c[0]===F&&c.shift();for(var l={isString:!0,length:s.length},h={isString:!0,length:c.length};u<l.length;)l[u]=s[u],h[u]=c[u],u++;return r[e]=l,n[e]=h,!0}if("object"===_(o)&&"object"===_(a)){if(Array.isArray(o))return o.map(function(r,n){return S(n,t[e],o,a)});for(var p in a)S(p,t[e],o,a);return!0}return!1}var H=Math.pow(10,4),W="rgba(",X=function P(e,t){var r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:"rgb(";return"number"==typeof e[t]&&(e[t-1]===r||e[t-3]===r||e[t-5]===r)};function U(e,t,r,n,i,o,a){var s=a?r:r[e],c=a?n:n[e];if(void 0===c)return s;if(void 0===s||"string"==typeof s||s===c)return c;if("object"===_(s)&&"object"===_(c)){if(!s||!c)return t[e];if("object"===_(s)&&s&&s.isString){for(var u="",l=0,h=s.length;l<h;l++){var p="number"==typeof s[l]&&"string"==typeof c[l]&&"="===c[l][1],f="number"!=typeof s[l]?s[l]:((p?s[l]+parseFloat(c[l][0]+c[l].substr(2))*i:s[l]+(c[l]-s[l])*i)*H|0)/H;(X(s,l)||X(s,l,W))&&(f|=0),u+=f,p&&1===o&&(s[l]=s[l]+parseFloat(c[l][0]+c[l].substr(2)))}return a||(t[e]=u),u}if(Array.isArray(s)&&s[0]!==F)for(var d=0,m=s.length;d<m;d++)s[d]!==c[d]&&U(d,t[e],s,c,i,o);else if("object"===_(s)&&s&&!s.isString)for(var g in s)s[g]!==c[g]&&U(g,t[e],s,c,i,o)}else if("number"==typeof s){var y="string"==typeof c;t[e]=((y?s+parseFloat(c[0]+c.substr(2))*i:s+(c-s)*i)*H|0)/H,y&&1===o&&(r[e]=t[e])}else"function"==typeof c&&(t[e]=c(i));return t[e]}var Y,J=/([.[])/g,Z=/\]/g,K=function N(e,t){var r=e[t],n=t.replace(Z,"").split(J),i=n.length-1,o=Array.isArray(e),a="object"===_(e)&&!o;return a?(e[t]=null,delete e[t]):o&&e.splice(t,1),n.reduce(function(e,t,s){o&&"."!==t&&"["!==t&&(t*=1);var c="["===n[s+1];if("."===t||"["===t)return"."===t?o=!(a=!0):"["===t&&(o=!(a=!1)),e;if(void 0===e[t]){if(o||a)return e[t]=s===i?r:o||c?[]:a?{}:null,a=o=!1,e[t]}else if(void 0!==e[t])return s===i&&(e[t]=r),e[t];return e},e)},Q=function B(e){if("object"===_(e)&&e)for(var t in e)if(-1!==t.indexOf(".")||-1!==t.indexOf("["))K(e,t);else if("object"===_(e[t])&&e[t]){var r=e[t];for(var n in r)if(-1!==n.indexOf(".")||-1!==n.indexOf("["))K(r,n);else if("object"===_(r[n])&&r[n]){var i=r[n];for(var o in i)-1===o.indexOf(".")&&-1===o.indexOf("[")||K(i,o)}}return e},$={Linear:function Linear(e,t,r){var n=e.length-1,i=n*t,o=Math.floor(i),a=$.Utils.Linear;return t<0?a(e[0],e[1],i,r):1<t?a(e[n],e[n-1],n-i,r):a(e[o],e[n<o+1?n:o+1],i-o,r)},Bezier:function Bezier(e,t,r){for(var n=$.Utils.Reset(r),i=e.length-1,o=Math.pow,a=$.Utils.Bernstein,s=Array.isArray(n),c=0;c<=i;c++)if("number"==typeof n)n+=o(1-t,i-c)*o(t,c)*e[c]*a(i,c);else if(s)for(var u=0,l=n.length;u<l;u++)"number"==typeof n[u]?n[u]+=o(1-t,i-c)*o(t,c)*e[c][u]*a(i,c):n[u]=e[c][u];else if("object"===_(n))for(var h in n)"number"==typeof n[h]?n[h]+=o(1-t,i-c)*o(t,c)*e[c][h]*a(i,c):n[h]=e[c][h];else if("string"==typeof n){for(var p="",f=e[Math.round(i*t)],d=1,m=f.length;d<m;d++)p+=f[d];return p}return n},CatmullRom:function CatmullRom(e,t,r){var n=e.length-1,i=n*t,o=Math.floor(i),a=$.Utils.CatmullRom;return e[0]===e[n]?(t<0&&(o=Math.floor(i=n*(1+t))),a(e[(o-1+n)%n],e[o],e[(o+1)%n],e[(o+2)%n],i-o,r)):t<0?a(e[1],e[1],e[0],e[0],-t,r):1<t?a(e[n-1],e[n-1],e[n],e[n],(0|t)-t,r):a(e[o?o-1:0],e[o],e[n<o+1?n:o+1],e[n<o+2?n:o+2],i-o,r)},Utils:{Linear:function Linear(e,t,r,n){if("string"==typeof e)return t;if("number"==typeof e)return"function"==typeof e?e(r):e+(t-e)*r;if("object"===_(e)){if(void 0!==e.length){if(e[0]===F){for(var i="",o=1,a=e.length;o<a;o++){var s="number"==typeof e[o]?e[o]+(t[o]-e[o])*r:t[o];(X(e,o)||X(e,o,W))&&(s|=0),i+=s}return i}for(var c=0,u=n.length;c<u;c++)n[c]=$.Utils.Linear(e[c],t[c],r,n[c])}else for(var l in n)n[l]=$.Utils.Linear(e[l],t[l],r,n[l]);return n}},Reset:function Reset(e){if(Array.isArray(e)){for(var t=0,r=e.length;t<r;t++)e[t]=$.Utils.Reset(e[t]);return e}if("object"===_(e)){for(var n in e)e[n]=$.Utils.Reset(e[n]);return e}return"number"==typeof e?0:e},Bernstein:function Bernstein(e,t){var r=$.Utils.Factorial;return r(e)/r(t)/r(e-t)},Factorial:(Y=[1],function(e){var t=1;if(Y[e])return Y[e];for(var r=e;1<r;r--)t*=r;return Y[e]=t}),CatmullRom:function CatmullRom(e,t,r,n,i,o){if("string"==typeof e)return t;if("number"==typeof e){var a=.5*(r-e),s=.5*(n-t),c=i*i;return(2*t-2*r+a+s)*(i*c)+(-3*t+3*r-2*a-s)*c+a*i+t}if("object"===_(e)){if(void 0!==e.length){if(e[0]===F){for(var u="",l=1,h=e.length;l<h;l++){var p="number"==typeof e[l]?$.Utils.CatmullRom(e[l],t[l],r[l],n[l],i):n[l];(X(e,l)||X(e,l,W))&&(p|=0),u+=p}return u}for(var f=0,d=o.length;f<d;f++)o[f]=$.Utils.CatmullRom(e[f],t[f],r[f],n[f],i,o[f])}else for(var m in o)o[m]=$.Utils.CatmullRom(e[m],t[m],r[m],n[m],i,o[m]);return o}}}},ee={},te=function z(e,t,r){if(!e||!e.nodeType)return t;var n=e.queueID||"q_"+Date.now();e.queueID||(e.queueID=n);var i=ee[n];if(i){if(i.object===t&&e===i.tween.node&&r._startTime===i.tween._startTime)E(i.tween);else if("object"===_(t)&&t&&i.object){for(var o in t)o in i.object&&(r._startTime===i.tween._startTime?delete i.object[o]:i.propNormaliseRequired=!0);i.object=f({},i.object,t)}return i.object}return"object"===_(t)&&t?(ee[n]={tween:r,object:t,propNormaliseRequired:!1},ee[n].object):t},re=function G(e,t){return t?e?e===window||e===document?[e]:"string"==typeof e?!!document.querySelectorAll&&document.querySelectorAll(e):Array.isArray(e)?e:e.nodeType?[e]:[]:null:e?e===window||e===document?e:"string"==typeof e?!!document.querySelector&&document.querySelector(e):Array.isArray(e)?e[0]:e.nodeType?e:null:null},ne=0,ie=L.Linear.None,oe=function(){function q(e,t){return function(e,t){if(!(e instanceof q))throw new TypeError("Cannot call a class as a function")}(this),this.id=ne++,!e||"object"!==_(e)||t||e.nodeType?e&&(e.nodeType||e.length||"string"==typeof e)&&(e=this.node=re(e),t=this.object=te(e,t,this)):(t=this.object=e,e=null),this._valuesEnd=null,this._valuesStart={},this._duration=1e3,this._easingFunction=ie,this._easingReverse=ie,this._interpolationFunction=$.Linear,this._startTime=0,this._initTime=0,this._delayTime=0,this._repeat=0,this._r=0,this._isPlaying=!1,this._yoyo=!1,this._reversed=!1,this._onStartCallbackFired=!1,this._pausedTime=null,this._isFinite=!0,this._maxListener=15,this._chainedTweensCount=0,this._prevTime=null,this}return e(q,null,[{key:"fromTo",value:function value(e,t,r){var n=3<arguments.length&&void 0!==arguments[3]?arguments[3]:{};n.quickRender=n.quickRender?n.quickRender:!r;var i=new q(e,t).to(r,n);return n.quickRender&&(i.render().update(i._startTime),i._rendered=!1,i._onStartCallbackFired=!1),i}},{key:"to",value:function value(e,t,r){return q.fromTo(e,null,t,r)}},{key:"from",value:function value(e,t,r){return q.fromTo(e,t,null,r)}}]),e(q,[{key:"setMaxListener",value:function value(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:15;return this._maxListener=e,this}},{key:"on",value:function value(e,t){for(var r=this._maxListener,n=e+I,i=0;i<r;i++){var o=n+i;if(!this[o]){this[o]=t;break}}return this}},{key:"once",value:function value(e,t){return this}},{key:"off",value:function value(e,t){for(var r=this._maxListener,n=e+I,i=0;i<r;i++){var o=n+i;this[o]===t&&(this[o]=null)}return this}},{key:"emit",value:function value(e,t,r,n,i){var o=this._maxListener,a=e+I;if(!this[a+0])return this;for(var s=0;s<o;s++){var c=a+s;this[c]&&this[c](t,r,n,i)}return this}},{key:"isPlaying",value:function value(){return this._isPlaying}},{key:"isStarted",value:function value(){return this._onStartCallbackFired}},{key:"reverse",value:function value(e){var t=this._reversed;return this._reversed=void 0!==e?e:!t,this}},{key:"reversed",value:function value(){return this._reversed}},{key:"pause",value:function value(){return this._isPlaying?(this._isPlaying=!1,E(this),this._pausedTime=m(),this.emit("pause",this.object)):this}},{key:"play",value:function value(){return this._isPlaying?this:(this._isPlaying=!0,this._startTime+=m()-this._pausedTime,this._initTime=this._startTime,C(this),this._pausedTime=m(),this.emit("play",this.object))}},{key:"restart",value:function value(e){return this._repeat=this._r,this.reassignValues(),C(this),this.emit("restart",this.object)}},{key:"seek",value:function value(e,t){var r=this._duration,n=this._initTime,i=this._startTime,o=this._reversed,a=n+e;return this._isPlaying=!0,a<i&&n<=i&&(this._startTime-=r,this._reversed=!o),this.update(e,!1),this.emit("seek",e,this.object),t?this:this.pause()}},{key:"duration",value:function value(e){return this._duration="function"==typeof e?e(this._duration):e,this}},{key:"to",value:function value(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:1e3;if(this._valuesEnd=e,"number"==typeof t||"function"==typeof t)this._duration="function"==typeof t?t(this._duration):t;else if("object"===_(t))for(var r in t)if("function"==typeof this[r]){var n=c(Array.isArray(t[r])?t[r]:[t[r]],4),i=n[0],o=void 0===i?null:i,a=n[1],s=void 0===a?null:a,u=n[2],l=void 0===u?null:u,h=n[3],p=void 0===h?null:h;this[r](o,s,l,p)}return this}},{key:"render",value:function value(){if(this._rendered)return this;var e=this._valuesStart,t=this._valuesEnd,r=this.object,n=this.node,i=this.InitialValues;if(Q(r),Q(t),n&&n.queueID&&ee[n.queueID]){var o=ee[n.queueID];o.propNormaliseRequired&&o.tween!==this&&(o.normalisedProp=!0,o.propNormaliseRequired=!1)}for(var a in n&&i&&(r&&0!==Object.keys(r).length?t&&0!==Object.keys(t).length||(t=this._valuesEnd=i(n,r)):r=this.object=te(n,i(n,t),this)),t){var s=r&&r[a]&&k(r[a]),c=t[a];if(!(O[a]&&O[a].init&&(O[a].init.call(this,s,c,a,r),void 0===s&&e[a]&&(s=e[a]),O[a].skipProcess)||"number"==typeof s&&isNaN(s)||null===s||null===c||!1===s||!1===c||void 0===s||void 0===c||s===c)){if(Array.isArray(c)&&!Array.isArray(s)){c.unshift(s);for(var u=0,l=c.length;u<l;u++)if("string"==typeof c[u]){for(var h=A(c[u]),p={length:h.length,isString:!0},f=0,d=h.length;f<d;f++)p[f]=h[f];c[u]=p}}"number"==typeof(e[a]=s)&&"string"==typeof c&&"="===c[1]||S(a,r,e,t)}}return q.Renderer&&this.node&&q.Renderer.init&&(q.Renderer.init.call(this,r,e,t),this.__render=!0),this}},{key:"start",value:function value(e){return this._startTime=void 0!==e?"string"==typeof e?m()+parseFloat(e):e:m(),this._startTime+=this._delayTime,this._initTime=this._prevTime=this._startTime,this._onStartCallbackFired=!1,this._rendered=!1,this._isPlaying=!0,C(this),this}},{key:"stop",value:function value(){var e=this._isPlaying,t=this._isFinite,r=this.object,n=this._startTime,i=this._duration,o=this._r,a=this._yoyo,s=this._reversed;if(!e)return this;var c=t?(o+1)%2==1:!s;return this._reversed=!1,a&&c?this.update(n):this.update(n+i),E(this),this.emit("stop",r)}},{key:"delay",value:function value(e){return this._delayTime="function"==typeof e?e(this._delayTime):e,this}},{key:"chainedTweens",value:function value(){if(this._chainedTweensCount=arguments.length,!this._chainedTweensCount)return this;for(var e=0,t=this._chainedTweensCount;e<t;e++)this[R+e]=arguments[e];return this}},{key:"repeat",value:function value(e){return this._repeat=this._duration?"function"==typeof e?e(this._repeat):e:0,this._r=this._repeat,this._isFinite=isFinite(e),this}},{key:"reverseDelay",value:function value(e){return this._reverseDelayTime="function"==typeof e?e(this._reverseDelayTime):e,this}},{key:"yoyo",value:function value(e,t){return this._yoyo="function"==typeof e?e(this._yoyo):null===e?this._yoyo:e,e||(this._reversed=!1),this._easingReverse=t||null,this}},{key:"easing",value:function value(e){return this._easingFunction=e,this}},{key:"interpolation",value:function value(e){return"function"==typeof e&&(this._interpolationFunction=e),this}},{key:"reassignValues",value:function value(e){var t=this._valuesStart,r=this.object,n=this._delayTime;for(var i in this._isPlaying=!0,this._startTime=void 0!==e?e:m(),this._startTime+=n,this._reversed=!1,C(this),t){var o=t[i];r[i]=o}return this}},{key:"update",value:function value(e,t,r){var n,i,o,a=this._onStartCallbackFired,s=this._easingFunction,c=this._interpolationFunction,u=this._easingReverse,l=this._repeat,h=this._delayTime,p=this._reverseDelayTime,f=this._yoyo,d=this._reversed,g=this._startTime,y=this._prevTime,v=this._duration,_=this._valuesStart,b=this._valuesEnd,w=this.object,x=this._isFinite,M=this._isPlaying,S=this.__render,C=this._chainedTweensCount,P=0;if(v){var T=(e=void 0!==e?e:m())-y;if(this._prevTime=e,250<T&&(e-=T-50/3),!M||e<g&&!r)return!0;n=1<(n=(e-g)/v)?1:n,n=d?1-n:n}else n=1,l=0;if(a||(this._rendered||(this.render(),this._rendered=!0),this.emit("start",w),this._onStartCallbackFired=!0),i=d&&u||s,!w)return!0;for(o in b){var A=_[o];if(null!=A||O[o]&&O[o].update){var L=b[o],k=i[o]?i[o](n):"function"==typeof i?i(n):ie(n),I=c[o]?c[o]:"function"==typeof c?c:$.Linear;"number"==typeof L?w[o]=((A+(L-A)*k)*H|0)/H:Array.isArray(L)&&!Array.isArray(A)?w[o]=I(L,k,w[o]):L&&L.update?L.update(k):"function"==typeof L?w[o]=L(k):"string"==typeof L&&"number"==typeof A?w[o]=A+parseFloat(L[0]+L.substr(2))*k:U(o,w,_,b,k,n),O[o]&&O[o].update&&O[o].update.call(this,w[o],A,L,k,n,o),P++}}if(!P)return E(this),!1;if(S&&q.Renderer&&q.Renderer.update&&q.Renderer.update.call(this,w,n),this.emit("update",w,n,e),1===n||d&&0===n){if(0<l&&0<v){if(x&&this._repeat--,f)this._reversed=!d;else for(o in b){var N=b[o];"string"==typeof N&&"number"==typeof _[o]&&(_[o]+=parseFloat(N[0]+N.substr(2)))}return this.emit(f&&!d?"reverse":"repeat",w),this._startTime=d&&p?e-p:e+h,!0}if(t||(this._isPlaying=!1,E(this),ne--),this.emit("complete",w),this._repeat=this._r,C)for(var F=0;F<C;F++)this[R+F].start(e+v);return!1}return!0}}]),q}();o.Plugins=O,o.Selector=re,o.Interpolator=function(e,t){var r=Array.isArray(e),n="string"==typeof e?e:r?e.slice():f({},e);if(r)for(var i=0,o=e.length;i<o;i++)S(i,n,e,t);else if("object"===_(e))for(var a in e)S(a,n,e,t);else if("string"==typeof e){e=A(e),t=A(t);for(var s=1;s<e.length;)e[s]===t[s]&&"string"==typeof e[s-1]?(e.splice(s-1,2,e[s-1]+e[s]),t.splice(s-1,2,t[s-1]+t[s])):s++;for(var c={isString:!0,length:e.length};s<c.length;)c[s]=e[s],s++}return function(i){if(r)for(var o=0,a=e.length;o<a;o++)U(o,n,e,t,i);else if("object"===_(n))for(var s in e)U(s,n,e,t,i);else"string"==typeof n&&(n=U(0,0,e,t,i,i,!0));return n}},o.onTick=function(e){return g.push({update:e})},o.has=function(e){return null!==P(e)},o.get=P,o.getAll=function(){return g},o.removeAll=function(){g.length=0},o.remove=E,o.add=C,o.now=m,o.update=T,o.autoPlay=function(e){v=e},o.isRunning=function(){return y},o.Tween=oe,o.Easing=L,o.Interpolation=$,Object.defineProperty(o,"__esModule",{value:!0})},"object"==l(t)&&void 0!==e?u(t):(a=[t],void 0===(s="function"==typeof(o=u)?o.apply(t,a):o)||(e.exports=s))}).call(t,r(69),r(136))},function(e,t,r){var n,i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};
/*! Hammer.JS - v2.0.7 - 2016-04-22
 * http://hammerjs.github.io/
 *
 * Copyright (c) 2016 Jorik Tangelder;
 * Licensed under the MIT license */
!function(o,a,s,c){"use strict";var u,l=["","webkit","Moz","MS","ms","o"],h=a.createElement("div"),p="function",f=Math.round,d=Math.abs,m=Date.now;function setTimeoutContext(e,t,r){return setTimeout(bindFn(e,r),t)}function invokeArrayArg(e,t,r){return!!Array.isArray(e)&&(each(e,r[t],r),!0)}function each(e,t,r){var n;if(e)if(e.forEach)e.forEach(t,r);else if(e.length!==c)for(n=0;n<e.length;)t.call(r,e[n],n,e),n++;else for(n in e)e.hasOwnProperty(n)&&t.call(r,e[n],n,e)}function deprecate(e,t,r){var n="DEPRECATED METHOD: "+t+"\n"+r+" AT \n";return function(){var t=new Error("get-stack-trace"),r=t&&t.stack?t.stack.replace(/^[^\(]+?[\n$]/gm,"").replace(/^\s+at\s+/gm,"").replace(/^Object.<anonymous>\s*\(/gm,"{anonymous}()@"):"Unknown Stack Trace",i=o.console&&(o.console.warn||o.console.log);return i&&i.call(o.console,n,r),e.apply(this,arguments)}}u="function"!=typeof Object.assign?function assign(e){if(e===c||null===e)throw new TypeError("Cannot convert undefined or null to object");for(var t=Object(e),r=1;r<arguments.length;r++){var n=arguments[r];if(n!==c&&null!==n)for(var i in n)n.hasOwnProperty(i)&&(t[i]=n[i])}return t}:Object.assign;var g=deprecate(function extend(e,t,r){for(var n=Object.keys(t),i=0;i<n.length;)(!r||r&&e[n[i]]===c)&&(e[n[i]]=t[n[i]]),i++;return e},"extend","Use `assign`."),y=deprecate(function merge(e,t){return g(e,t,!0)},"merge","Use `assign`.");function inherit(e,t,r){var n,i=t.prototype;(n=e.prototype=Object.create(i)).constructor=e,n._super=i,r&&u(n,r)}function bindFn(e,t){return function boundFn(){return e.apply(t,arguments)}}function boolOrFn(e,t){return(void 0===e?"undefined":i(e))==p?e.apply(t&&t[0]||c,t):e}function ifUndefined(e,t){return e===c?t:e}function addEventListeners(e,t,r){each(splitStr(t),function(t){e.addEventListener(t,r,!1)})}function removeEventListeners(e,t,r){each(splitStr(t),function(t){e.removeEventListener(t,r,!1)})}function hasParent(e,t){for(;e;){if(e==t)return!0;e=e.parentNode}return!1}function inStr(e,t){return e.indexOf(t)>-1}function splitStr(e){return e.trim().split(/\s+/g)}function inArray(e,t,r){if(e.indexOf&&!r)return e.indexOf(t);for(var n=0;n<e.length;){if(r&&e[n][r]==t||!r&&e[n]===t)return n;n++}return-1}function toArray(e){return Array.prototype.slice.call(e,0)}function uniqueArray(e,t,r){for(var n=[],i=[],o=0;o<e.length;){var a=t?e[o][t]:e[o];inArray(i,a)<0&&n.push(e[o]),i[o]=a,o++}return r&&(n=t?n.sort(function sortUniqueArray(e,r){return e[t]>r[t]}):n.sort()),n}function prefixed(e,t){for(var r,n,i=t[0].toUpperCase()+t.slice(1),o=0;o<l.length;){if((n=(r=l[o])?r+i:t)in e)return n;o++}return c}var v=1;function getWindowForElement(e){var t=e.ownerDocument||e;return t.defaultView||t.parentWindow||o}var _="ontouchstart"in o,b=prefixed(o,"PointerEvent")!==c,w=_&&/mobile|tablet|ip(ad|hone|od)|android/i.test(navigator.userAgent),x=25,M=1,S=2,C=4,P=8,E=1,T=2,O=4,A=8,L=16,k=T|O,R=A|L,I=k|R,N=["x","y"],F=["clientX","clientY"];function Input(e,t){var r=this;this.manager=e,this.callback=t,this.element=e.element,this.target=e.options.inputTarget,this.domHandler=function(t){boolOrFn(e.options.enable,[e])&&r.handler(t)},this.init()}function inputHandler(e,t,r){var n=r.pointers.length,i=r.changedPointers.length,o=t&M&&n-i==0,a=t&(C|P)&&n-i==0;r.isFirst=!!o,r.isFinal=!!a,o&&(e.session={}),r.eventType=t,function computeInputData(e,t){var r=e.session,n=t.pointers,i=n.length;r.firstInput||(r.firstInput=simpleCloneInputData(t));i>1&&!r.firstMultiple?r.firstMultiple=simpleCloneInputData(t):1===i&&(r.firstMultiple=!1);var o=r.firstInput,a=r.firstMultiple,s=a?a.center:o.center,u=t.center=getCenter(n);t.timeStamp=m(),t.deltaTime=t.timeStamp-o.timeStamp,t.angle=getAngle(s,u),t.distance=getDistance(s,u),function computeDeltaXY(e,t){var r=t.center,n=e.offsetDelta||{},i=e.prevDelta||{},o=e.prevInput||{};t.eventType!==M&&o.eventType!==C||(i=e.prevDelta={x:o.deltaX||0,y:o.deltaY||0},n=e.offsetDelta={x:r.x,y:r.y});t.deltaX=i.x+(r.x-n.x),t.deltaY=i.y+(r.y-n.y)}(r,t),t.offsetDirection=getDirection(t.deltaX,t.deltaY);var l=getVelocity(t.deltaTime,t.deltaX,t.deltaY);t.overallVelocityX=l.x,t.overallVelocityY=l.y,t.overallVelocity=d(l.x)>d(l.y)?l.x:l.y,t.scale=a?function getScale(e,t){return getDistance(t[0],t[1],F)/getDistance(e[0],e[1],F)}(a.pointers,n):1,t.rotation=a?function getRotation(e,t){return getAngle(t[1],t[0],F)+getAngle(e[1],e[0],F)}(a.pointers,n):0,t.maxPointers=r.prevInput?t.pointers.length>r.prevInput.maxPointers?t.pointers.length:r.prevInput.maxPointers:t.pointers.length,function computeIntervalInputData(e,t){var r,n,i,o,a=e.lastInterval||t,s=t.timeStamp-a.timeStamp;if(t.eventType!=P&&(s>x||a.velocity===c)){var u=t.deltaX-a.deltaX,l=t.deltaY-a.deltaY,h=getVelocity(s,u,l);n=h.x,i=h.y,r=d(h.x)>d(h.y)?h.x:h.y,o=getDirection(u,l),e.lastInterval=t}else r=a.velocity,n=a.velocityX,i=a.velocityY,o=a.direction;t.velocity=r,t.velocityX=n,t.velocityY=i,t.direction=o}(r,t);var h=e.element;hasParent(t.srcEvent.target,h)&&(h=t.srcEvent.target);t.target=h}(e,r),e.emit("hammer.input",r),e.recognize(r),e.session.prevInput=r}function simpleCloneInputData(e){for(var t=[],r=0;r<e.pointers.length;)t[r]={clientX:f(e.pointers[r].clientX),clientY:f(e.pointers[r].clientY)},r++;return{timeStamp:m(),pointers:t,center:getCenter(t),deltaX:e.deltaX,deltaY:e.deltaY}}function getCenter(e){var t=e.length;if(1===t)return{x:f(e[0].clientX),y:f(e[0].clientY)};for(var r=0,n=0,i=0;i<t;)r+=e[i].clientX,n+=e[i].clientY,i++;return{x:f(r/t),y:f(n/t)}}function getVelocity(e,t,r){return{x:t/e||0,y:r/e||0}}function getDirection(e,t){return e===t?E:d(e)>=d(t)?e<0?T:O:t<0?A:L}function getDistance(e,t,r){r||(r=N);var n=t[r[0]]-e[r[0]],i=t[r[1]]-e[r[1]];return Math.sqrt(n*n+i*i)}function getAngle(e,t,r){r||(r=N);var n=t[r[0]]-e[r[0]],i=t[r[1]]-e[r[1]];return 180*Math.atan2(i,n)/Math.PI}Input.prototype={handler:function handler(){},init:function init(){this.evEl&&addEventListeners(this.element,this.evEl,this.domHandler),this.evTarget&&addEventListeners(this.target,this.evTarget,this.domHandler),this.evWin&&addEventListeners(getWindowForElement(this.element),this.evWin,this.domHandler)},destroy:function destroy(){this.evEl&&removeEventListeners(this.element,this.evEl,this.domHandler),this.evTarget&&removeEventListeners(this.target,this.evTarget,this.domHandler),this.evWin&&removeEventListeners(getWindowForElement(this.element),this.evWin,this.domHandler)}};var j={mousedown:M,mousemove:S,mouseup:C},B="mousedown",V="mousemove mouseup";function MouseInput(){this.evEl=B,this.evWin=V,this.pressed=!1,Input.apply(this,arguments)}inherit(MouseInput,Input,{handler:function MEhandler(e){var t=j[e.type];t&M&&0===e.button&&(this.pressed=!0),t&S&&1!==e.which&&(t=C),this.pressed&&(t&C&&(this.pressed=!1),this.callback(this.manager,t,{pointers:[e],changedPointers:[e],pointerType:"mouse",srcEvent:e}))}});var D={pointerdown:M,pointermove:S,pointerup:C,pointercancel:P,pointerout:P},U={2:"touch",3:"pen",4:"mouse",5:"kinect"},G="pointerdown",z="pointermove pointerup pointercancel";function PointerEventInput(){this.evEl=G,this.evWin=z,Input.apply(this,arguments),this.store=this.manager.session.pointerEvents=[]}o.MSPointerEvent&&!o.PointerEvent&&(G="MSPointerDown",z="MSPointerMove MSPointerUp MSPointerCancel"),inherit(PointerEventInput,Input,{handler:function PEhandler(e){var t=this.store,r=!1,n=e.type.toLowerCase().replace("ms",""),i=D[n],o=U[e.pointerType]||e.pointerType,a="touch"==o,s=inArray(t,e.pointerId,"pointerId");i&M&&(0===e.button||a)?s<0&&(t.push(e),s=t.length-1):i&(C|P)&&(r=!0),s<0||(t[s]=e,this.callback(this.manager,i,{pointers:t,changedPointers:[e],pointerType:o,srcEvent:e}),r&&t.splice(s,1))}});var H={touchstart:M,touchmove:S,touchend:C,touchcancel:P},W="touchstart",q="touchstart touchmove touchend touchcancel";function SingleTouchInput(){this.evTarget=W,this.evWin=q,this.started=!1,Input.apply(this,arguments)}inherit(SingleTouchInput,Input,{handler:function TEhandler(e){var t=H[e.type];if(t===M&&(this.started=!0),this.started){var r=function normalizeSingleTouches(e,t){var r=toArray(e.touches),n=toArray(e.changedTouches);t&(C|P)&&(r=uniqueArray(r.concat(n),"identifier",!0));return[r,n]}.call(this,e,t);t&(C|P)&&r[0].length-r[1].length==0&&(this.started=!1),this.callback(this.manager,t,{pointers:r[0],changedPointers:r[1],pointerType:"touch",srcEvent:e})}}});var X={touchstart:M,touchmove:S,touchend:C,touchcancel:P},Y="touchstart touchmove touchend touchcancel";function TouchInput(){this.evTarget=Y,this.targetIds={},Input.apply(this,arguments)}inherit(TouchInput,Input,{handler:function MTEhandler(e){var t=X[e.type],r=function getTouches(e,t){var r=toArray(e.touches),n=this.targetIds;if(t&(M|S)&&1===r.length)return n[r[0].identifier]=!0,[r,r];var i,o,a=toArray(e.changedTouches),s=[],c=this.target;if(o=r.filter(function(e){return hasParent(e.target,c)}),t===M)for(i=0;i<o.length;)n[o[i].identifier]=!0,i++;i=0;for(;i<a.length;)n[a[i].identifier]&&s.push(a[i]),t&(C|P)&&delete n[a[i].identifier],i++;if(!s.length)return;return[uniqueArray(o.concat(s),"identifier",!0),s]}.call(this,e,t);r&&this.callback(this.manager,t,{pointers:r[0],changedPointers:r[1],pointerType:"touch",srcEvent:e})}});var J=2500,Z=25;function TouchMouseInput(){Input.apply(this,arguments);var e=bindFn(this.handler,this);this.touch=new TouchInput(this.manager,e),this.mouse=new MouseInput(this.manager,e),this.primaryTouch=null,this.lastTouches=[]}function setLastTouch(e){var t=e.changedPointers[0];if(t.identifier===this.primaryTouch){var r={x:t.clientX,y:t.clientY};this.lastTouches.push(r);var n=this.lastTouches;setTimeout(function removeLastTouch(){var e=n.indexOf(r);e>-1&&n.splice(e,1)},J)}}inherit(TouchMouseInput,Input,{handler:function TMEhandler(e,t,r){var n="touch"==r.pointerType,i="mouse"==r.pointerType;if(!(i&&r.sourceCapabilities&&r.sourceCapabilities.firesTouchEvents)){if(n)(function recordTouches(e,t){e&M?(this.primaryTouch=t.changedPointers[0].identifier,setLastTouch.call(this,t)):e&(C|P)&&setLastTouch.call(this,t)}).call(this,t,r);else if(i&&function isSyntheticEvent(e){for(var t=e.srcEvent.clientX,r=e.srcEvent.clientY,n=0;n<this.lastTouches.length;n++){var i=this.lastTouches[n],o=Math.abs(t-i.x),a=Math.abs(r-i.y);if(o<=Z&&a<=Z)return!0}return!1}.call(this,r))return;this.callback(e,t,r)}},destroy:function destroy(){this.touch.destroy(),this.mouse.destroy()}});var K=prefixed(h.style,"touchAction"),Q=K!==c,$="auto",ee="manipulation",te="none",re="pan-x",ne="pan-y",ie=function getTouchActionProps(){if(!Q)return!1;var e={},t=o.CSS&&o.CSS.supports;return["auto","manipulation","pan-y","pan-x","pan-x pan-y","none"].forEach(function(r){e[r]=!t||o.CSS.supports("touch-action",r)}),e}();function TouchAction(e,t){this.manager=e,this.set(t)}TouchAction.prototype={set:function set(e){"compute"==e&&(e=this.compute()),Q&&this.manager.element.style&&ie[e]&&(this.manager.element.style[K]=e),this.actions=e.toLowerCase().trim()},update:function update(){this.set(this.manager.options.touchAction)},compute:function compute(){var e=[];return each(this.manager.recognizers,function(t){boolOrFn(t.options.enable,[t])&&(e=e.concat(t.getTouchAction()))}),function cleanTouchActions(e){if(inStr(e,te))return te;var t=inStr(e,re),r=inStr(e,ne);if(t&&r)return te;if(t||r)return t?re:ne;if(inStr(e,ee))return ee;return $}(e.join(" "))},preventDefaults:function preventDefaults(e){var t=e.srcEvent,r=e.offsetDirection;if(this.manager.session.prevented)t.preventDefault();else{var n=this.actions,i=inStr(n,te)&&!ie[te],o=inStr(n,ne)&&!ie[ne],a=inStr(n,re)&&!ie[re];if(i){var s=1===e.pointers.length,c=e.distance<2,u=e.deltaTime<250;if(s&&c&&u)return}if(!a||!o)return i||o&&r&k||a&&r&R?this.preventSrc(t):void 0}},preventSrc:function preventSrc(e){this.manager.session.prevented=!0,e.preventDefault()}};var oe=1,ae=2,se=4,ce=8,ue=ce,le=16;function Recognizer(e){this.options=u({},this.defaults,e||{}),this.id=function uniqueId(){return v++}(),this.manager=null,this.options.enable=ifUndefined(this.options.enable,!0),this.state=oe,this.simultaneous={},this.requireFail=[]}function stateStr(e){return e&le?"cancel":e&ce?"end":e&se?"move":e&ae?"start":""}function directionStr(e){return e==L?"down":e==A?"up":e==T?"left":e==O?"right":""}function getRecognizerByNameIfManager(e,t){var r=t.manager;return r?r.get(e):e}function AttrRecognizer(){Recognizer.apply(this,arguments)}function PanRecognizer(){AttrRecognizer.apply(this,arguments),this.pX=null,this.pY=null}function PinchRecognizer(){AttrRecognizer.apply(this,arguments)}function PressRecognizer(){Recognizer.apply(this,arguments),this._timer=null,this._input=null}function RotateRecognizer(){AttrRecognizer.apply(this,arguments)}function SwipeRecognizer(){AttrRecognizer.apply(this,arguments)}function TapRecognizer(){Recognizer.apply(this,arguments),this.pTime=!1,this.pCenter=!1,this._timer=null,this._input=null,this.count=0}function Hammer(e,t){return(t=t||{}).recognizers=ifUndefined(t.recognizers,Hammer.defaults.preset),new Manager(e,t)}Recognizer.prototype={defaults:{},set:function set(e){return u(this.options,e),this.manager&&this.manager.touchAction.update(),this},recognizeWith:function recognizeWith(e){if(invokeArrayArg(e,"recognizeWith",this))return this;var t=this.simultaneous;return t[(e=getRecognizerByNameIfManager(e,this)).id]||(t[e.id]=e,e.recognizeWith(this)),this},dropRecognizeWith:function dropRecognizeWith(e){return invokeArrayArg(e,"dropRecognizeWith",this)?this:(e=getRecognizerByNameIfManager(e,this),delete this.simultaneous[e.id],this)},requireFailure:function requireFailure(e){if(invokeArrayArg(e,"requireFailure",this))return this;var t=this.requireFail;return-1===inArray(t,e=getRecognizerByNameIfManager(e,this))&&(t.push(e),e.requireFailure(this)),this},dropRequireFailure:function dropRequireFailure(e){if(invokeArrayArg(e,"dropRequireFailure",this))return this;e=getRecognizerByNameIfManager(e,this);var t=inArray(this.requireFail,e);return t>-1&&this.requireFail.splice(t,1),this},hasRequireFailures:function hasRequireFailures(){return this.requireFail.length>0},canRecognizeWith:function canRecognizeWith(e){return!!this.simultaneous[e.id]},emit:function emit(e){var t=this,r=this.state;function emit(r){t.manager.emit(r,e)}r<ce&&emit(t.options.event+stateStr(r)),emit(t.options.event),e.additionalEvent&&emit(e.additionalEvent),r>=ce&&emit(t.options.event+stateStr(r))},tryEmit:function tryEmit(e){if(this.canEmit())return this.emit(e);this.state=32},canEmit:function canEmit(){for(var e=0;e<this.requireFail.length;){if(!(this.requireFail[e].state&(32|oe)))return!1;e++}return!0},recognize:function recognize(e){var t=u({},e);if(!boolOrFn(this.options.enable,[this,t]))return this.reset(),void(this.state=32);this.state&(ue|le|32)&&(this.state=oe),this.state=this.process(t),this.state&(ae|se|ce|le)&&this.tryEmit(t)},process:function process(e){},getTouchAction:function getTouchAction(){},reset:function reset(){}},inherit(AttrRecognizer,Recognizer,{defaults:{pointers:1},attrTest:function attrTest(e){var t=this.options.pointers;return 0===t||e.pointers.length===t},process:function process(e){var t=this.state,r=e.eventType,n=t&(ae|se),i=this.attrTest(e);return n&&(r&P||!i)?t|le:n||i?r&C?t|ce:t&ae?t|se:ae:32}}),inherit(PanRecognizer,AttrRecognizer,{defaults:{event:"pan",threshold:10,pointers:1,direction:I},getTouchAction:function getTouchAction(){var e=this.options.direction,t=[];return e&k&&t.push(ne),e&R&&t.push(re),t},directionTest:function directionTest(e){var t=this.options,r=!0,n=e.distance,i=e.direction,o=e.deltaX,a=e.deltaY;return i&t.direction||(t.direction&k?(i=0===o?E:o<0?T:O,r=o!=this.pX,n=Math.abs(e.deltaX)):(i=0===a?E:a<0?A:L,r=a!=this.pY,n=Math.abs(e.deltaY))),e.direction=i,r&&n>t.threshold&&i&t.direction},attrTest:function attrTest(e){return AttrRecognizer.prototype.attrTest.call(this,e)&&(this.state&ae||!(this.state&ae)&&this.directionTest(e))},emit:function emit(e){this.pX=e.deltaX,this.pY=e.deltaY;var t=directionStr(e.direction);t&&(e.additionalEvent=this.options.event+t),this._super.emit.call(this,e)}}),inherit(PinchRecognizer,AttrRecognizer,{defaults:{event:"pinch",threshold:0,pointers:2},getTouchAction:function getTouchAction(){return[te]},attrTest:function attrTest(e){return this._super.attrTest.call(this,e)&&(Math.abs(e.scale-1)>this.options.threshold||this.state&ae)},emit:function emit(e){if(1!==e.scale){var t=e.scale<1?"in":"out";e.additionalEvent=this.options.event+t}this._super.emit.call(this,e)}}),inherit(PressRecognizer,Recognizer,{defaults:{event:"press",pointers:1,time:251,threshold:9},getTouchAction:function getTouchAction(){return[$]},process:function process(e){var t=this.options,r=e.pointers.length===t.pointers,n=e.distance<t.threshold,i=e.deltaTime>t.time;if(this._input=e,!n||!r||e.eventType&(C|P)&&!i)this.reset();else if(e.eventType&M)this.reset(),this._timer=setTimeoutContext(function(){this.state=ue,this.tryEmit()},t.time,this);else if(e.eventType&C)return ue;return 32},reset:function reset(){clearTimeout(this._timer)},emit:function emit(e){this.state===ue&&(e&&e.eventType&C?this.manager.emit(this.options.event+"up",e):(this._input.timeStamp=m(),this.manager.emit(this.options.event,this._input)))}}),inherit(RotateRecognizer,AttrRecognizer,{defaults:{event:"rotate",threshold:0,pointers:2},getTouchAction:function getTouchAction(){return[te]},attrTest:function attrTest(e){return this._super.attrTest.call(this,e)&&(Math.abs(e.rotation)>this.options.threshold||this.state&ae)}}),inherit(SwipeRecognizer,AttrRecognizer,{defaults:{event:"swipe",threshold:10,velocity:.3,direction:k|R,pointers:1},getTouchAction:function getTouchAction(){return PanRecognizer.prototype.getTouchAction.call(this)},attrTest:function attrTest(e){var t,r=this.options.direction;return r&(k|R)?t=e.overallVelocity:r&k?t=e.overallVelocityX:r&R&&(t=e.overallVelocityY),this._super.attrTest.call(this,e)&&r&e.offsetDirection&&e.distance>this.options.threshold&&e.maxPointers==this.options.pointers&&d(t)>this.options.velocity&&e.eventType&C},emit:function emit(e){var t=directionStr(e.offsetDirection);t&&this.manager.emit(this.options.event+t,e),this.manager.emit(this.options.event,e)}}),inherit(TapRecognizer,Recognizer,{defaults:{event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10},getTouchAction:function getTouchAction(){return[ee]},process:function process(e){var t=this.options,r=e.pointers.length===t.pointers,n=e.distance<t.threshold,i=e.deltaTime<t.time;if(this.reset(),e.eventType&M&&0===this.count)return this.failTimeout();if(n&&i&&r){if(e.eventType!=C)return this.failTimeout();var o=!this.pTime||e.timeStamp-this.pTime<t.interval,a=!this.pCenter||getDistance(this.pCenter,e.center)<t.posThreshold;if(this.pTime=e.timeStamp,this.pCenter=e.center,a&&o?this.count+=1:this.count=1,this._input=e,0===this.count%t.taps)return this.hasRequireFailures()?(this._timer=setTimeoutContext(function(){this.state=ue,this.tryEmit()},t.interval,this),ae):ue}return 32},failTimeout:function failTimeout(){return this._timer=setTimeoutContext(function(){this.state=32},this.options.interval,this),32},reset:function reset(){clearTimeout(this._timer)},emit:function emit(){this.state==ue&&(this._input.tapCount=this.count,this.manager.emit(this.options.event,this._input))}}),Hammer.VERSION="2.0.7",Hammer.defaults={domEvents:!1,touchAction:"compute",enable:!0,inputTarget:null,inputClass:null,preset:[[RotateRecognizer,{enable:!1}],[PinchRecognizer,{enable:!1},["rotate"]],[SwipeRecognizer,{direction:k}],[PanRecognizer,{direction:k},["swipe"]],[TapRecognizer],[TapRecognizer,{event:"doubletap",taps:2},["tap"]],[PressRecognizer]],cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}};function Manager(e,t){this.options=u({},Hammer.defaults,t||{}),this.options.inputTarget=this.options.inputTarget||e,this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=e,this.input=function createInputInstance(e){var t=e.options.inputClass;return new(t||(b?PointerEventInput:w?TouchInput:_?TouchMouseInput:MouseInput))(e,inputHandler)}(this),this.touchAction=new TouchAction(this,this.options.touchAction),toggleCssProps(this,!0),each(this.options.recognizers,function(e){var t=this.add(new e[0](e[1]));e[2]&&t.recognizeWith(e[2]),e[3]&&t.requireFailure(e[3])},this)}function toggleCssProps(e,t){var r,n=e.element;n.style&&(each(e.options.cssProps,function(i,o){r=prefixed(n.style,o),t?(e.oldCssProps[r]=n.style[r],n.style[r]=i):n.style[r]=e.oldCssProps[r]||""}),t||(e.oldCssProps={}))}Manager.prototype={set:function set(e){return u(this.options,e),e.touchAction&&this.touchAction.update(),e.inputTarget&&(this.input.destroy(),this.input.target=e.inputTarget,this.input.init()),this},stop:function stop(e){this.session.stopped=e?2:1},recognize:function recognize(e){var t=this.session;if(!t.stopped){var r;this.touchAction.preventDefaults(e);var n=this.recognizers,i=t.curRecognizer;(!i||i&&i.state&ue)&&(i=t.curRecognizer=null);for(var o=0;o<n.length;)r=n[o],2===t.stopped||i&&r!=i&&!r.canRecognizeWith(i)?r.reset():r.recognize(e),!i&&r.state&(ae|se|ce)&&(i=t.curRecognizer=r),o++}},get:function get(e){if(e instanceof Recognizer)return e;for(var t=this.recognizers,r=0;r<t.length;r++)if(t[r].options.event==e)return t[r];return null},add:function add(e){if(invokeArrayArg(e,"add",this))return this;var t=this.get(e.options.event);return t&&this.remove(t),this.recognizers.push(e),e.manager=this,this.touchAction.update(),e},remove:function remove(e){if(invokeArrayArg(e,"remove",this))return this;if(e=this.get(e)){var t=this.recognizers,r=inArray(t,e);-1!==r&&(t.splice(r,1),this.touchAction.update())}return this},on:function on(e,t){if(e!==c&&t!==c){var r=this.handlers;return each(splitStr(e),function(e){r[e]=r[e]||[],r[e].push(t)}),this}},off:function off(e,t){if(e!==c){var r=this.handlers;return each(splitStr(e),function(e){t?r[e]&&r[e].splice(inArray(r[e],t),1):delete r[e]}),this}},emit:function emit(e,t){this.options.domEvents&&function triggerDomEvent(e,t){var r=a.createEvent("Event");r.initEvent(e,!0,!0),r.gesture=t,t.target.dispatchEvent(r)}(e,t);var r=this.handlers[e]&&this.handlers[e].slice();if(r&&r.length){t.type=e,t.preventDefault=function(){t.srcEvent.preventDefault()};for(var n=0;n<r.length;)r[n](t),n++}},destroy:function destroy(){this.element&&toggleCssProps(this,!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}},u(Hammer,{INPUT_START:M,INPUT_MOVE:S,INPUT_END:C,INPUT_CANCEL:P,STATE_POSSIBLE:oe,STATE_BEGAN:ae,STATE_CHANGED:se,STATE_ENDED:ce,STATE_RECOGNIZED:ue,STATE_CANCELLED:le,STATE_FAILED:32,DIRECTION_NONE:E,DIRECTION_LEFT:T,DIRECTION_RIGHT:O,DIRECTION_UP:A,DIRECTION_DOWN:L,DIRECTION_HORIZONTAL:k,DIRECTION_VERTICAL:R,DIRECTION_ALL:I,Manager:Manager,Input:Input,TouchAction:TouchAction,TouchInput:TouchInput,MouseInput:MouseInput,PointerEventInput:PointerEventInput,TouchMouseInput:TouchMouseInput,SingleTouchInput:SingleTouchInput,Recognizer:Recognizer,AttrRecognizer:AttrRecognizer,Tap:TapRecognizer,Pan:PanRecognizer,Swipe:SwipeRecognizer,Pinch:PinchRecognizer,Rotate:RotateRecognizer,Press:PressRecognizer,on:addEventListeners,off:removeEventListeners,each:each,merge:y,extend:g,assign:u,inherit:inherit,bindFn:bindFn,prefixed:prefixed}),(void 0!==o?o:"undefined"!=typeof self?self:{}).Hammer=Hammer,(n=function(){return Hammer}.call(t,r,t,e))===c||(e.exports=n)}(window,document)},function(e,t,r){"use strict";r.d(t,"a",function(){return p}),r.d(t,"c",function(){return h}),r.d(t,"b",function(){return f}),r.d(t,"d",function(){return a});var n=function(){function defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(e,t,r){return t&&defineProperties(e.prototype,t),r&&defineProperties(e,r),e}}();function _toConsumableArray(e){if(Array.isArray(e)){for(var t=0,r=Array(e.length);t<e.length;t++)r[t]=e[t];return r}return Array.from(e)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var i=function(){function AngleConverter(){_classCallCheck(this,AngleConverter)}return n(AngleConverter,null,[{key:"toDegree",value:function toDegree(e){return 180*e/Math.PI}},{key:"toRadian",value:function toRadian(e){return e*Math.PI/180}}]),AngleConverter}(),o=function(){function WGS84(e,t,r){_classCallCheck(this,WGS84),this.a=e,this.e=t,this.f=r,this.k0=.9996,this.ePow2=Math.pow(this.e,2),this.ePow4=Math.pow(this.e,4),this.ePow6=Math.pow(this.e,6),this.e1sq=this.ePow2/(1-this.ePow2)}return n(WGS84,null,[{key:"fromFlattening",value:function fromFlattening(e,t){return new this(e,Math.sqrt(2*t-Math.pow(t,2)),t)}}]),WGS84}().fromFlattening(6378137,1/298.257223563),a=function UtmGridZone(e){_classCallCheck(this,UtmGridZone),this.k=o.k0,this.E=5e5;var t=i.toDegree(e.long);this.zone=t<0?Math.floor((180+t)/6+1):Math.floor(t/6+31),this.long=i.toRadian(6*(this.zone-30)-3),this.N=e.lat<0?1e7:0,this.hemi=0===this.N?1:-1},s=1-o.ePow2/4-3/64*o.ePow4-5/256*o.ePow6,c=3/8*o.ePow2+3/32*o.ePow4+45/1024*o.ePow6,u=15/256*o.ePow4+45/1024*o.ePow6,l=35/3072*o.ePow6,h=function Utm(e,t,r,n,i){_classCallCheck(this,Utm),this.E=e,this.N=t,this.alt=r,this.hemi=n,this.zone=i},p=function(){function Gps(e,t,r){_classCallCheck(this,Gps),this.lat=e,this.long=t,this.alt=r}return n(Gps,[{key:"latInDegree",get:function get(){return i.toDegree(this.lat)}},{key:"longInDegree",get:function get(){return i.toDegree(this.long)}}],[{key:"fromDegree",value:function fromDegree(e,t,r){return new this(i.toRadian(e),i.toRadian(t),r)}}]),Gps}(),f=function(){function GpsToUtmConverter(){_classCallCheck(this,GpsToUtmConverter)}return n(GpsToUtmConverter,null,[{key:"toUtm",value:function toUtm(e,t){var r=new function GpsToUtmVariables(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;_classCallCheck(this,GpsToUtmVariables),this.gps=e,this.utmGridZone=t||new a(this.gps),this.deltaLong=this.gps.long-this.utmGridZone.long,this.Nu=1/Math.sqrt(1-o.ePow2*Math.pow(Math.sin(this.gps.lat),2)),this.A=this.deltaLong*Math.cos(this.gps.lat),this.APow2=Math.pow(this.A,2),this.APow3=Math.pow(this.A,3),this.APow4=Math.pow(this.A,4),this.APow5=Math.pow(this.A,5),this.APow6=Math.pow(this.A,6);var r=Math.sin(2*this.gps.lat),n=Math.sin(4*this.gps.lat),i=Math.sin(6*this.gps.lat);this.S=s*this.gps.lat-c*r+u*n-l*i,this.T=Math.pow(Math.tan(this.gps.lat),2),this.TPow2=Math.pow(this.T,2),this.C=o.ePow2/(1-o.ePow2)*Math.pow(Math.cos(this.gps.lat),2),this.CPow2=Math.pow(this.C,2),this.E=this.A+(1-this.T+this.C)/6*this.APow3,this.E+=(5-18*this.T+this.TPow2)*this.APow5/120,this.E*=this.utmGridZone.k*o.a*this.Nu,this.E+=this.utmGridZone.E,this.N=this.APow2/2,this.N+=(5-this.T+9*this.C+4*this.CPow2)*this.APow4/24,this.N+=(61-58*this.T+this.TPow2)*this.APow6/720,this.N*=this.Nu*Math.tan(this.gps.lat),this.N+=this.S,this.N*=o.a*this.utmGridZone.k,this.N+=this.utmGridZone.N}(e,t);return new h(r.E,r.N,e.alt,r.utmGridZone.hemi,r.utmGridZone.zone)}},{key:"toGps",value:function toGps(e){var t=new function UtmToGpsVariables(e){_classCallCheck(this,UtmToGpsVariables);var t=e.N,r=1===e.hemi;r||(t=1e7-t);var n=t/o.k0/(o.a*(1-Math.pow(o.e,2)/4-3*Math.pow(o.e,4)/64-5*Math.pow(o.e,6)/256)),i=(1-Math.pow(1-o.ePow2,.5))/(1+Math.pow(1-o.ePow2,.5)),a=21*Math.pow(i,2)/16-55*Math.pow(i,4)/32,s=151*Math.pow(i,3)/96,c=1097*Math.pow(i,4)/512,u=n+(3*i/2-27*Math.pow(i,3)/32)*Math.sin(2*n)+a*Math.sin(4*n)+s*Math.sin(6*n)+c*Math.sin(8*n),l=o.a/Math.pow(1-Math.pow(o.e*Math.sin(u),2),.5),h=o.a*(1-o.ePow2)/Math.pow(1-Math.pow(o.e*Math.sin(u),2),1.5),p=l*Math.tan(u)/h,f=5e5-e.E,d=f/(l*o.k0),m=d*d/2,g=Math.pow(Math.tan(u),2),y=o.e1sq*Math.pow(Math.cos(u),2),v=(5+3*g+10*y-4*y*y-9*o.e1sq)*Math.pow(d,4)/24,_=(61+90*g+298*y+45*g*g-252*o.e1sq-3*y*y)*Math.pow(d,6)/720,b=(f/(l*o.k0)-(1+2*g+y)*Math.pow(d,3)/6+(5-2*y+28*g-3*Math.pow(y,2)+8*o.e1sq+24*Math.pow(g,2))*Math.pow(d,5)/120)/Math.cos(u)*180/Math.PI;this.latitude=180*(u-p*(m+v+_))/Math.PI,r||(this.latitude=-this.latitude);var w=e.zone>0?6*e.zone-183:3;this.longitude=w-b}(e);return p.fromDegree(t.latitude,t.longitude,e.alt)}}]),GpsToUtmConverter}(),d=function(){function Matrix(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;_classCallCheck(this,Matrix),this.n=e,this.m=t,null===r?(this.values=new Array(this.n*this.m),this.values.fill(0)):this.values=r}return n(Matrix,[{key:"get",value:function get(e,t){return this.values[this.getIndex(e,t)]}},{key:"set",value:function set(e,t,r){return this.values[this.getIndex(e,t)]=r,this}},{key:"getIndex",value:function getIndex(e,t){if("number"!=typeof e||e>=this.n)throw new Error("Invalid row index");if("number"!=typeof t||t>=this.m)throw new Error("Invalid column index");return e*this.m+t}},{key:"transpose",value:function transpose(){for(var e=new Matrix(this.m,this.n),t=0;t<this.n;t++)for(var r=0;r<this.m;r++)e.set(r,t,this.get(t,r));return e}},{key:"multiply",value:function multiply(e){if("number"!=typeof e)throw new Error("Expected a number");return this.values=this.values.map(function(t){return t*e}),this}},{key:"extractColumn",value:function extractColumn(e){for(var t=new Matrix(this.n,1),r=0;r<this.n;r++)t.set(r,0,this.get(r,e));return t}}],[{key:"sum",value:function sum(e,t){if(e.m!==t.m||e.n!==t.n)throw new Error("Invalid given matrices");return new Matrix(e.n,e.m,e.values.map(function(e,r){return e+t.values[r]}))}},{key:"identity",value:function identity(e){for(var t=new Matrix(e,e),r=0;r<e;r++)t.set(r,r,1);return t}},{key:"additiveInverse",value:function additiveInverse(e){return new Matrix(e.n,e.m,e.values.map(function(e){return-1*e}))}},{key:"product",value:function product(e,t){if(!(e instanceof Matrix&&t instanceof Matrix))throw new Error("Expected two Matrices");if(e.m!==t.n)throw new Error("Invalid given matrices");for(var r=e.m,n=new Matrix(e.n,t.m),i=0;i<n.n;i++)for(var o=0;o<n.m;o++){for(var a=0,s=0;s<r;s++)a+=e.get(i,s)*t.get(s,o);n.set(i,o,a)}return n}},{key:"inverseMatrix3",value:function inverseMatrix3(e){if(3!==e.n||3!==e.m)throw new Error("Works only with Matrix 3");var t=e.extractColumn(0),r=e.extractColumn(1),n=e.extractColumn(2),i=this.determinantMatrix3(e);if(0===i)throw new Error("Not inversible matrix");var o=this.crossProductVector3(r,n).transpose().multiply(1/i),a=this.crossProductVector3(n,t).transpose().multiply(1/i),s=this.crossProductVector3(t,r).transpose().multiply(1/i),c=new Matrix(3,3);return c.set(0,0,o.get(0,0)),c.set(0,1,o.get(0,1)),c.set(0,2,o.get(0,2)),c.set(1,0,a.get(0,0)),c.set(1,1,a.get(0,1)),c.set(1,2,a.get(0,2)),c.set(2,0,s.get(0,0)),c.set(2,1,s.get(0,1)),c.set(2,2,s.get(0,2)),c}},{key:"determinantMatrix3",value:function determinantMatrix3(e){if(3!==e.n||3!==e.m)throw new Error("Works only with Matrix 3");var t=e.extractColumn(0),r=e.extractColumn(1),n=e.extractColumn(2);return Matrix.dotProductVector(t,Matrix.crossProductVector3(r,n))}},{key:"crossProductVector3",value:function crossProductVector3(e,t){if(3!==e.n||1!==e.m||3!==t.n||1!==t.m)throw new Error("Works only with Matrix 3x1");var r=new Matrix(3,1);return r.set(0,0,e.get(1,0)*t.get(2,0)-e.get(2,0)*t.get(1,0)),r.set(1,0,e.get(2,0)*t.get(0,0)-e.get(0,0)*t.get(2,0)),r.set(2,0,e.get(0,0)*t.get(1,0)-e.get(1,0)*t.get(0,0)),r}},{key:"dotProductVector",value:function dotProductVector(e,t){if(1!==e.m||1!==t.m||e.n!==t.n)throw new Error("Works only with Matrix nx1");for(var r=0,n=0;n<e.n;n++)r+=e.get(n,0)*t.get(n,0);return r}}]),Matrix}(),m=function(){function LinearSquareRegression(){_classCallCheck(this,LinearSquareRegression)}return n(LinearSquareRegression,null,[{key:"compute2ParametersRegression",value:function compute2ParametersRegression(e){for(var t=e.length,r=new d(t,3),n=new d(t,1),i=0;i<t;i++)r.set(i,0,1),r.set(i,1,e[i].parameters.get(0,0)),r.set(i,2,e[i].parameters.get(1,0)),n.set(i,0,e[i].result);var o=r.transpose();return d.product(d.product(d.inverseMatrix3(d.product(o,r)),o),n)}}]),LinearSquareRegression}();!function(){function EuclideanSpaceTransform(e,t){_classCallCheck(this,EuclideanSpaceTransform),this.transformMatrix=e,this.translateMatrix=t,this._reverseTransform=null}n(EuclideanSpaceTransform,[{key:"convert",value:function convert(e){var t=new d(3,1,[e.x,e.y,e.z]),r=d.sum(d.product(this.transformMatrix,t),this.translateMatrix);return{x:r.get(0,0),y:r.get(1,0),z:r.get(2,0)}}},{key:"revert",value:function revert(e){return this.reverseTransform.convert(e)}},{key:"getDistanceAverageError",value:function getDistanceAverageError(e,t){for(var r=e.length,n=0,i=0;i<r;i++){var o=e[i],a=t[i];n+=this.constructor._getDistance(this.convert(o),a)}return n/r}},{key:"getDistanceErrorRepartitionFromAverage",value:function getDistanceErrorRepartitionFromAverage(e,t){var r=e.length,n=this.getDistanceAverageError(e,t),i=new Array(10);i.fill(0);for(var o=0;o<r;o++){var a=e[o],s=t[o],c=this.constructor._getDistance(this.convert(a),s),u=Math.abs(n-c)/n*100,l=Math.trunc(u/10);l>9&&(l=9),i[l]++}return i.map(function(e){return Math.floor(e/r*100)})}},{key:"getRelativeDistanceErrorFromAverage",value:function getRelativeDistanceErrorFromAverage(e,t){for(var r=e.length,n=this.getDistanceAverageError(e,t),i=[],o=0;o<r;o++){var a=e[o],s=t[o],c=this.constructor._getDistance(this.convert(a),s);i[o]=Math.abs(n-c)/n*100}return i}},{key:"getAmplitudeError",value:function getAmplitudeError(e,t){for(var r=e.length,n={x:1/0,y:1/0,z:1/0},i={x:-1/0,y:-1/0,z:-1/0},o=0;o<r;o++){var a=e[o],s=t[o],c=this.convert(a),u=Math.abs(c.x-s.x),l=Math.abs(c.y-s.y);u<n.x&&(n.x=u),u>i.x&&(i.x=u),l<n.y&&(n.y=l),l>i.y&&(i.y=l)}return{x:i.x-n.x,y:i.y-n.y}}},{key:"reverseTransform",get:function get(){if(null===this._reverseTransform){var e=d.inverseMatrix3(this.transformMatrix),t=d.additiveInverse(d.product(e,this.translateMatrix));this._reverseTransform=new EuclideanSpaceTransform(e,t),this._reverseTransform._reverseTransform=this}return this._reverseTransform}}],[{key:"computeSample",value:function computeSample(e,t){return this._leastSquareComputeSample(e,t)}},{key:"_leastSquareComputeSample",value:function _leastSquareComputeSample(e,t){for(var r=[],n=0;n<e.length;n++){var i=[].concat(_toConsumableArray(e)),o=[].concat(_toConsumableArray(t)),a=i[n],s=o[n];i[n]=i[0],o[n]=o[0],i[0]=a,o[0]=s,r.push(this._leastSquareComputeSampleWithOrigin(i,o))}return this._selectResultLeastAverageDistanceError(r,e,t)}},{key:"_leastSquareComputeSampleWithOrigin",value:function _leastSquareComputeSampleWithOrigin(e,t){for(var r=[],n=[],i=e[0],o=t[0],a=1;a<e.length;a++){var s=e[a],c=t[a],u=new d(2,1);u.set(0,0,s.x-i.x),u.set(1,0,s.y-i.y);var l=new d(2,1);l.set(0,0,c.x-o.x),l.set(1,0,c.y-o.y),r.push({parameters:u,result:l.get(0,0)}),n.push({parameters:u,result:l.get(1,0)})}var h=m.compute2ParametersRegression(r),p=m.compute2ParametersRegression(n),f=new d(3,3);f.set(0,0,h.get(1,0)),f.set(0,1,h.get(2,0)),f.set(0,2,0),f.set(1,0,p.get(1,0)),f.set(1,1,p.get(2,0)),f.set(1,2,0),f.set(2,0,0),f.set(2,1,0),f.set(2,2,1);var g=new d(3,1);return g.set(0,0,o.x+h.get(0,0)-h.get(1,0)*i.x-h.get(2,0)*i.y),g.set(1,0,o.y+p.get(0,0)-p.get(1,0)*i.x-p.get(2,0)*i.y),g.set(2,0,0),new EuclideanSpaceTransform(f,g)}},{key:"_linearComputeSample",value:function _linearComputeSample(e,t){for(var r=e.length,n=[],i=0;i<r-2;i++)for(var o=e[i],a=t[i],s=i+1;s<r-1;s++)for(var c=e[s],u=t[s],l=s+1;l<r;l++){var h=e[l],p=t[l],f=this._linearComputeTripletSample(o,c,h,a,u,p);n.push(f)}return this._selectResultLeastAverageDistanceError(n,e,t)}},{key:"_linearComputeTripletSample",value:function _linearComputeTripletSample(e,t,r,n,i,o){var a=t.x-e.x,s=t.y-e.y,c=r.x-e.x,u=r.y-e.y,l=i.x-n.x,h=i.y-n.y,p=((o.x-n.x)*a-l*c)/(u*a-c*s),f=((o.y-n.y)*a-h*c)/(u*a-c*s),m=(l-p*s)/a,g=(h-f*s)/a,y=new d(3,3);y.set(0,0,m),y.set(0,1,p),y.set(0,2,0),y.set(1,0,g),y.set(1,1,f),y.set(1,2,0),y.set(2,0,0),y.set(2,1,0),y.set(2,2,1);var v=new d(3,1);return v.set(0,0,n.x-m*e.x-p*e.y),v.set(1,0,n.y-g*e.x-f*e.y),v.set(2,0,0),new EuclideanSpaceTransform(y,v)}},{key:"_selectResultLeastAverageDistanceError",value:function _selectResultLeastAverageDistanceError(e,t,r){var n=null,i=1/0;if(!Array.isArray(e)||0===e.length)throw new Error("Expected a non empty array");return e.forEach(function(e){var o=e.getDistanceAverageError(t,r);o<i&&(n=e,i=o)}),n}},{key:"_getDistance",value:function _getDistance(e,t){return Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2))}}])}()},function(e,t,r){"use strict";var n=r(68),i=r(96),o=r(43),a=function(){function defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(e,t,r){return t&&defineProperties(e.prototype,t),r&&defineProperties(e,r),e}}();var s=function(e){function Options(){return function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,Options),function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(Options.__proto__||Object.getPrototypeOf(Options)).apply(this,arguments))}return function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(Options,n["a"]),a(Options,[{key:"reset",value:function reset(){(function get(e,t,r){null===e&&(e=Function.prototype);var n=Object.getOwnPropertyDescriptor(e,t);if(void 0===n){var i=Object.getPrototypeOf(e);return null===i?void 0:get(i,t,r)}if("value"in n)return n.value;var o=n.get;return void 0!==o?o.call(r):void 0})(Options.prototype.__proto__||Object.getPrototypeOf(Options.prototype),"reset",this).call(this),this.cachePublicUrl=null,this.client=new i.g,this.map=new o.e}}]),Options}();t.a=s},function(e,t,r){"use strict";var n=r(379),i=function(){function defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(e,t,r){return t&&defineProperties(e.prototype,t),r&&defineProperties(e,r),e}}();function _toConsumableArray(e){if(Array.isArray(e)){for(var t=0,r=Array(e.length);t<e.length;t++)r[t]=e[t];return r}return Array.from(e)}var o=function(){function WebBridge(e,t){!function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,WebBridge),this._root=e,this.options=new n.a(t),this.options.addListenerOnMessageFromNative(this._onMessage.bind(this))}return i(WebBridge,[{key:"_sendMessage",value:function _sendMessage(e){return this.options.sendMessageToNative(e)}},{key:"_onMessage",value:function _onMessage(e){if(""!==e.data){var t=JSON.parse(e.data);switch(t.type){case"promise":this._handlePromiseExecMessage(t);break;case"function":this._handleFunctionExecMessage(t);break;default:throw new Error("AdsumWebViewBridge.AdsumWebMapProxy: Invalid message type "+t.type)}}}},{key:"_notify",value:function _notify(e){for(var t=arguments.length,r=Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];var i=e.module,o=e.method;this._sendMessage(JSON.stringify({type:"notify",module:i,method:o,args:r}))}},{key:"_handlePromiseExecMessage",value:function _handlePromiseExecMessage(e){var t=this,r=null;try{var n,i=this._root;e.module.split(".").forEach(function(e){i=i[e]}),r=(n=i)[e.method].apply(n,_toConsumableArray(e.args))}catch(t){console.error("AdsumWebMapBridge.WebBridge: Cannot resolve module "+e.module),r=Promise.reject(t)}r.then(function(r){t._sendMessage(JSON.stringify({type:"result",status:"success",uuid:e.uuid,result:r}))}).catch(function(r){t._sendMessage(JSON.stringify({type:"result",status:"fail",uuid:e.uuid,error:{name:r.name,message:r.message,stack:r.stack}}))})}},{key:"_handleFunctionExecMessage",value:function _handleFunctionExecMessage(e){try{var t,r=this._root;e.module.split(".").forEach(function(e){r=r[e]}),this._sendMessage(JSON.stringify({type:"result",status:"success",uuid:e.uuid,result:(t=r)[e.method].apply(t,_toConsumableArray(e.args))}))}catch(t){this._sendMessage(JSON.stringify({type:"result",status:"fail",uuid:e.uuid,error:{name:t.name,message:t.message,stack:t.stack}}))}}}]),WebBridge}();t.a=o},function(e,t,r){"use strict";var n=r(68),i=function(){function defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(e,t,r){return t&&defineProperties(e.prototype,t),r&&defineProperties(e,r),e}}();var o=function(e){function WebBridgeOptions(){return function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,WebBridgeOptions),function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(WebBridgeOptions.__proto__||Object.getPrototypeOf(WebBridgeOptions)).apply(this,arguments))}return function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(WebBridgeOptions,n["a"]),i(WebBridgeOptions,[{key:"reset",value:function reset(){(function get(e,t,r){null===e&&(e=Function.prototype);var n=Object.getOwnPropertyDescriptor(e,t);if(void 0===n){var i=Object.getPrototypeOf(e);return null===i?void 0:get(i,t,r)}if("value"in n)return n.value;var o=n.get;return void 0!==o?o.call(r):void 0})(WebBridgeOptions.prototype.__proto__||Object.getPrototypeOf(WebBridgeOptions.prototype),"reset",this).call(this),this.sendMessageToNative=function(e){window.postMessage(e,"*")},this.addListenerOnMessageFromNative=function(e){window.addEventListener("message",e,!1)}}}]),WebBridgeOptions}();t.a=o},function(e,t,r){"use strict";var n=function(){function defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(e,t,r){return t&&defineProperties(e.prototype,t),r&&defineProperties(e,r),e}}();var i=function(){function CameraManagerProxy(e){!function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,CameraManagerProxy),this._adsumWebMapProxy=e,this.cameraManager=null}return n(CameraManagerProxy,[{key:"init",value:function init(e){this.cameraManager=e}},{key:"centerOnFloor",value:function centerOnFloor(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(null===e)return this.cameraManager.centerOnFloor(null);var r=this._adsumWebMapProxy.objectManagerProxy;return this.cameraManager.centerOnFloor(r.deserializeAdsumObject3D(e),t)}},{key:"centerOn",value:function centerOn(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,n=this._adsumWebMapProxy.objectManagerProxy;return this.cameraManager.centerOn(n.deserializeAdsumObject3D(e),t,r)}}]),CameraManagerProxy}();t.a=i},function(e,t,r){"use strict";var n=r(43),i=r(98),o=function(){function defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(e,t,r){return t&&defineProperties(e.prototype,t),r&&defineProperties(e,r),e}}();var a=function(){function MouseManagerProxy(e,t){!function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,MouseManagerProxy),this._adsumWebMapProxy=e,this.bridge=t,this.mouseManager=null}return o(MouseManagerProxy,[{key:"init",value:function init(e){this.mouseManager=e,this._bindEvents()}},{key:"_bindEvents",value:function _bindEvents(){var e=this;this.mouseManager.addEventListener(n.d.click,function(t){var r=e._adsumWebMapProxy.objectManagerProxy;e.bridge._notify(i.a.mouseManager._handleWebClickEvent,t.intersects.map(function(e){return{distance:e.distance,object:r.serializeAdsumObject3D(e.object),position:e.position}}))}),this.mouseManager.addEventListener(n.d.dblClick,function(t){var r=e._adsumWebMapProxy.objectManagerProxy;e.bridge._notify(i.a.mouseManager._handleWebDblClickEvent,t.intersects.map(function(e){return{distance:e.distance,object:r.serializeAdsumObject3D(e.object),position:e.position}}))})}}]),MouseManagerProxy}();t.a=a},function(e,t,r){"use strict";var n=r(43),i=r(49),o=r(383),a=r(384),s=r(385),c=r(100),u=r(386),l=r(387),h=r(388),p=r(99),f=function(){function defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(e,t,r){return t&&defineProperties(e.prototype,t),r&&defineProperties(e,r),e}}();var d=function(){function ObjectManagerProxy(e){!function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,ObjectManagerProxy),this._adsumWebMapProxy=e,this.objectManager=null,this.adsumObjectDelegate=new i.a(this),this.buildingDelegate=new o.a(this),this.floorDelegate=new a.a(this),this.labelImageDelegate=new s.a(this),this.labelDelegate=new c.a(this),this.labelTextDelegate=new u.a(this),this.siteDelegate=new l.a(this),this.spaceDelegate=new h.a(this)}return f(ObjectManagerProxy,[{key:"init",value:function init(e){var t=this;this.objectManager=e;var r=[this.serializeAdsumObject3D(this.objectManager.site)];return this.objectManager.buildings.forEach(function(e){r.push(t.serializeAdsumObject3D(e))}),this.objectManager.floors.forEach(function(e){r.push(t.serializeAdsumObject3D(e))}),this.objectManager.spaces.forEach(function(e){r.push(t.serializeAdsumObject3D(e))}),this.objectManager.labels.forEach(function(e){r.push(t.serializeAdsumObject3D(e))}),r}},{key:"serializeAdsumObject3Ds",value:function serializeAdsumObject3Ds(e){var t=this,r=[];return e.forEach(function(e){r.push(t.serializeAdsumObject3D(e))}),r}},{key:"serializeAdsumObject3D",value:function serializeAdsumObject3D(e){return null===e?null:{id:p.a.serialize(e.id),type:e.getType()}}},{key:"deserializeAdsumObject3Ds",value:function deserializeAdsumObject3Ds(e){var t=this;return e.map(function(e){return t.deserializeAdsumObject3D(e)})}},{key:"deserializeAdsumObject3D",value:function deserializeAdsumObject3D(e){if(null===e)return null;var t=p.a.deserialize(e.id);switch(e.type){case n.a.SiteObject:return this.objectManager.site;case n.a.BuildingObject:return this.objectManager.buildings.get(t);case n.a.FloorObject:return this.objectManager.floors.get(t);case n.a.SpaceObject:return this.objectManager.spaces.get(t);case n.a.LabelImageObject:case n.a.LabelTextObject:return this.objectManager.labels.get(t);default:throw new Error("AdsumWebViewBridge.ObjectManagerProxy: Unexpected type "+e.type)}}}]),ObjectManagerProxy}();t.a=d},function(e,t,r){"use strict";var n=r(49),i=function(){function defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(e,t,r){return t&&defineProperties(e.prototype,t),r&&defineProperties(e,r),e}}();var o=function(e){function BuildingObjectDelegate(){return function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,BuildingObjectDelegate),function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(BuildingObjectDelegate.__proto__||Object.getPrototypeOf(BuildingObjectDelegate)).apply(this,arguments))}return function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(BuildingObjectDelegate,n["a"]),i(BuildingObjectDelegate,[{key:"getSite",value:function getSite(e){return this.objectManagerProxy.serializeAdsumObject3D(this._getInstance(e).site)}},{key:"getFloors",value:function getFloors(e){return this.objectManagerProxy.serializeAdsumObject3Ds(this._getInstance(e).floors)}},{key:"getLabels",value:function getLabels(e){return this.objectManagerProxy.serializeAdsumObject3Ds(this._getInstance(e).labels)}},{key:"setColor",value:function setColor(e,t){this._getInstance(e).setColor(t)}},{key:"isInitialColor",value:function isInitialColor(e){return this._getInstance(e).isInitialColor()}},{key:"resetColor",value:function resetColor(e){this._getInstance(e).resetColor()}}]),BuildingObjectDelegate}();t.a=o},function(e,t,r){"use strict";var n=r(49),i=function(){function defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(e,t,r){return t&&defineProperties(e.prototype,t),r&&defineProperties(e,r),e}}();var o=function(e){function FloorObjectDelegate(){return function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,FloorObjectDelegate),function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(FloorObjectDelegate.__proto__||Object.getPrototypeOf(FloorObjectDelegate)).apply(this,arguments))}return function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(FloorObjectDelegate,n["a"]),i(FloorObjectDelegate,[{key:"getBuilding",value:function getBuilding(e){return this.objectManagerProxy.serializeAdsumObject3D(this._getInstance(e).building)}},{key:"getSpaces",value:function getSpaces(e){return this.objectManagerProxy.serializeAdsumObject3Ds(this._getInstance(e).spaces)}},{key:"getLabels",value:function getLabels(e){return this.objectManagerProxy.serializeAdsumObject3Ds(this._getInstance(e).labels)}},{key:"getAltitude",value:function getAltitude(e){return this._getInstance(e).altitude}}]),FloorObjectDelegate}();t.a=o},function(e,t,r){"use strict";var n=r(100);var i=function(e){function LabelImageObjectDelegate(){return function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,LabelImageObjectDelegate),function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(LabelImageObjectDelegate.__proto__||Object.getPrototypeOf(LabelImageObjectDelegate)).apply(this,arguments))}return function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(LabelImageObjectDelegate,n["a"]),LabelImageObjectDelegate}();t.a=i},function(e,t,r){"use strict";var n=r(100);var i=function(e){function LabelTextObjectDelegate(){return function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,LabelTextObjectDelegate),function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(LabelTextObjectDelegate.__proto__||Object.getPrototypeOf(LabelTextObjectDelegate)).apply(this,arguments))}return function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(LabelTextObjectDelegate,n["a"]),LabelTextObjectDelegate}();t.a=i},function(e,t,r){"use strict";var n=r(49),i=function(){function defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(e,t,r){return t&&defineProperties(e.prototype,t),r&&defineProperties(e,r),e}}();var o=function(e){function SiteObjectDelegate(){return function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,SiteObjectDelegate),function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(SiteObjectDelegate.__proto__||Object.getPrototypeOf(SiteObjectDelegate)).apply(this,arguments))}return function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(SiteObjectDelegate,n["a"]),i(SiteObjectDelegate,[{key:"getBuildings",value:function getBuildings(e){return this.objectManagerProxy.serializeAdsumObject3Ds(this._getInstance(e).buildings)}},{key:"getSpaces",value:function getSpaces(e){return this.objectManagerProxy.serializeAdsumObject3Ds(this._getInstance(e).spaces)}},{key:"getLabels",value:function getLabels(e){return this.objectManagerProxy.serializeAdsumObject3Ds(this._getInstance(e).labels)}}]),SiteObjectDelegate}();t.a=o},function(e,t,r){"use strict";var n=r(49),i=function(){function defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(e,t,r){return t&&defineProperties(e.prototype,t),r&&defineProperties(e,r),e}}();var o=function(e){function SpaceObjectDelegate(){return function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,SpaceObjectDelegate),function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(SpaceObjectDelegate.__proto__||Object.getPrototypeOf(SpaceObjectDelegate)).apply(this,arguments))}return function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(SpaceObjectDelegate,n["a"]),i(SpaceObjectDelegate,[{key:"getParent",value:function getParent(e){return this.objectManagerProxy.serializeAdsumObject3D(this._getInstance(e).parent)}},{key:"getLabels",value:function getLabels(e){return this.objectManagerProxy.serializeAdsumObject3Ds(this._getInstance(e).labels)}},{key:"setColor",value:function setColor(e,t){this._getInstance(e).setColor(t)}},{key:"isInitialColor",value:function isInitialColor(e){return this._getInstance(e).isInitialColor()}},{key:"resetColor",value:function resetColor(e){this._getInstance(e).resetColor()}},{key:"isBounced",value:function isBounced(e){return this._getInstance(e).isBounced()}},{key:"getBounceFactor",value:function getBounceFactor(e){return this._getInstance(e).getBounceFactor()}},{key:"bounceUp",value:function bounceUp(e,t){this._getInstance(e).bounceUp(t)}},{key:"bounceDown",value:function bounceDown(e){this._getInstance(e).bounceDown()}}]),SpaceObjectDelegate}();t.a=o},function(e,t,r){"use strict";var n=r(43),i=r(98),o=function(){function defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(e,t,r){return t&&defineProperties(e.prototype,t),r&&defineProperties(e,r),e}}();var a=function(){function SceneManagerProxy(e,t){!function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,SceneManagerProxy),this._adsumWebMapProxy=e,this.bridge=t,this.sceneManager=null}return o(SceneManagerProxy,[{key:"init",value:function init(e){this.sceneManager=e,this.sceneManager.addEventListener(n.g.floor.didChanged,this._onFloorChanged.bind(this))}},{key:"getCurrentFloor",value:function getCurrentFloor(){return this._adsumWebMapProxy.objectManagerProxy.serializeAdsumObject3D(this.sceneManager.getCurrentFloor())}},{key:"setCurrentFloor",value:function setCurrentFloor(e){var t=this._adsumWebMapProxy.objectManagerProxy;return this.sceneManager.setCurrentFloor(t.deserializeAdsumObject3D(e)).then(function(){})}},{key:"_onFloorChanged",value:function _onFloorChanged(e){var t=this._adsumWebMapProxy.objectManagerProxy;this.bridge._notify(i.a.sceneManager._handleWebFloorDidChanged,{type:e.type,previous:t.serializeAdsumObject3D(e.previous),current:t.serializeAdsumObject3D(e.current)})}}]),SceneManagerProxy}();t.a=a},function(e,t,r){"use strict";var n=r(43),i=r(98),o=r(391),a=r(392),s=function(){function defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(e,t,r){return t&&defineProperties(e.prototype,t),r&&defineProperties(e,r),e}}();var c=function(){function WayfindingManagerProxy(e,t){!function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,WayfindingManagerProxy),this._adsumWebMapProxy=e,this.bridge=t,this.wayfindingManager=null,this.locationRepositoryProxy=new o.a(e,t),this.pathRepository=new a.a(this.locationRepositoryProxy,this._adsumWebMapProxy.objectManagerProxy)}return s(WayfindingManagerProxy,[{key:"init",value:function init(e){return this.wayfindingManager=e,this.wayfindingManager.addEventListener(n.h.user.position.didChanged,this._onUserPositionChanged.bind(this)),this.locationRepositoryProxy.init(e.locationRepository)}},{key:"computePath",value:function computePath(e){var t=this,r=this.pathRepository.deserialize(e);return this.wayfindingManager.computePath(r).then(function(){return t.pathRepository.serialize(r)})}},{key:"removePath",value:function removePath(e){this.wayfindingManager.removePath(this.pathRepository.deserialize(e))}},{key:"removePathSection",value:function removePathSection(e){this.wayfindingManager.removePathSection(this.pathRepository.deserializePathSection(e))}},{key:"drawPathSection",value:function drawPathSection(e){return this.wayfindingManager.drawPathSection(this.pathRepository.deserializePathSection(e))}},{key:"_onUserPositionChanged",value:function _onUserPositionChanged(e){var t=this._adsumWebMapProxy.objectManagerProxy;this.bridge._notify(i.a.wayfindingManager._handleWebUserPositionDidChanged,{type:e.type,floor:t.serializeAdsumObject3D(e.floor)})}},{key:"getUserUtmPosition",value:function getUserUtmPosition(){var e=this.wayfindingManager.getUserUtmPosition();if(null===e)return null;var t=this._adsumWebMapProxy.objectManagerProxy;return{utm:e.utm,floor:t.serializeAdsumObject3D(e.floor)}}},{key:"getUserGpsPosition",value:function getUserGpsPosition(){var e=this.wayfindingManager.getUserGpsPosition();if(null===e)return null;var t=this._adsumWebMapProxy.objectManagerProxy;return{gps:e.gps,floor:t.serializeAdsumObject3D(e.floor)}}},{key:"setUserAdsumPosition",value:function setUserAdsumPosition(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=this._adsumWebMapProxy.objectManagerProxy;this.wayfindingManager.setUserAdsumPosition(e,n.deserializeAdsumObject3D(t),r)}},{key:"setUserGpsPosition",value:function setUserGpsPosition(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=this._adsumWebMapProxy.objectManagerProxy;this.wayfindingManager.setUserGpsPosition(e,r.deserializeAdsumObject3D(t))}},{key:"setUserUtmPosition",value:function setUserUtmPosition(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=this._adsumWebMapProxy.objectManagerProxy;this.wayfindingManager.setUserUtmPosition(e,r.deserializeAdsumObject3D(t))}},{key:"getUserDistanceFromPath",value:function getUserDistanceFromPath(e){return this.wayfindingManager.getUserDistanceFromPath(this.pathRepository.deserialize(e))}},{key:"getUserDistanceFromPathSection",value:function getUserDistanceFromPathSection(e){return this.wayfindingManager.getUserDistanceFromPathSection(this.pathRepository.deserializePathSection(e))}}]),WayfindingManagerProxy}();t.a=c},function(e,t,r){"use strict";var n=r(99),i=function(){function defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(e,t,r){return t&&defineProperties(e.prototype,t),r&&defineProperties(e,r),e}}();var o=function(){function LocationRepositoryProxy(e,t){!function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,LocationRepositoryProxy),this._adsumWebMapProxy=e,this.bridge=t,this.locationRepository=null}return i(LocationRepositoryProxy,[{key:"init",value:function init(e){var t=this;this.locationRepository=e;var r=[];return this.locationRepository.locations.forEach(function(e){r.push(t.serializeAdsumLocation(e))}),r}},{key:"getUserLocation",value:function getUserLocation(){return this.serializeAdsumLocation(this.locationRepository.userLocation)}},{key:"serializeAdsumLocations",value:function serializeAdsumLocations(e){var t=this,r=[];return e.forEach(function(e){r.push(t.serializeAdsumLocation(e))}),r}},{key:"serializeAdsumLocation",value:function serializeAdsumLocation(e){return null===e?null:n.a.serialize(e.id)}},{key:"deserializeAdsumLocations",value:function deserializeAdsumLocations(e){var t=this;return e.map(function(e){return t.deserializeAdsumLocation(e)})}},{key:"deserializeAdsumLocation",value:function deserializeAdsumLocation(e){return null===e?null:this.locationRepository.get(n.a.deserialize(e))}}]),LocationRepositoryProxy}();t.a=o},function(e,t,r){"use strict";var n=r(43),i=function(){function defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(e,t,r){return t&&defineProperties(e.prototype,t),r&&defineProperties(e,r),e}}();var o=function(){function PathRepository(e,t){!function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,PathRepository),this.idByPath=new Map,this.pathById=new Map,this.autoIncrementPathSections=0,this.idByPathSection=new Map,this.pathSectionById=new Map,this.locationRepositoryProxy=e,this.objectManagerProxy=t}return i(PathRepository,[{key:"deserialize",value:function deserialize(e){var t=e.id,r=e.from,i=e.to,o=e.pmr,a=e.pathSections,s=null;return this.pathById.has(t)?s=this.pathById.get(t):(s=new n.f,this.pathById.set(t,s),this.idByPath.set(s,t)),s.from=this.locationRepositoryProxy.deserializeAdsumLocation(r),s.to=this.locationRepositoryProxy.deserializeAdsumLocation(i),s.pmr=o,s.pathSections=this.deserializePathSections(a),s}},{key:"serialize",value:function serialize(e){return{id:this.idByPath.get(e),from:this.locationRepositoryProxy.serializeAdsumLocation(e.from),to:this.locationRepositoryProxy.serializeAdsumLocation(e.to),computed:e.computed,distance:e.getDistance(),pathSections:this.serializePathSections(e.pathSections)}}},{key:"serializePathSections",value:function serializePathSections(e){var t=this;return e.map(function(e){return t.serializePathSection(e)})}},{key:"serializePathSection",value:function serializePathSection(e){var t=null;return this.idByPathSection.has(e)?t=this.idByPathSection.get(e):(t=this.autoIncrementPathSections++,this.idByPathSection.set(e,t),this.pathSectionById.set(t,e)),{id:t,from:this.locationRepositoryProxy.serializeAdsumLocation(e.from),to:this.locationRepositoryProxy.serializeAdsumLocation(e.to),ground:this.objectManagerProxy.serializeAdsumObject3D(e.ground),distance:e.getDistance()}}},{key:"deserializePathSections",value:function deserializePathSections(e){var t=this;return e.map(function(e){return t.deserializePathSection(e)})}},{key:"deserializePathSection",value:function deserializePathSection(e){var t=e.id;return this.pathSectionById.has(t)?this.pathSectionById.get(t):null}}]),PathRepository}();t.a=o}])});

/***/ })
/******/ ]);